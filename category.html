<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title id="dynamic-title">Category Loading... | The Daily Origin</title>

    <!-- Tailwind CSS with Custom Config -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ["Inter", "sans-serif"],
              serif: ["Playfair Display", "serif"],
              display: ["DM Serif Display", "serif"],
            },
            animation: {
              "fade-in": "fadeIn 0.5s ease-out",
            },
            keyframes: {
              fadeIn: {
                "0%": { opacity: "0", transform: "translateY(10px)" },
                "100%": { opacity: "1", transform: "translateY(0)" },
              },
            },
          },
        },
      };
    </script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Inter:wght@300;400;500;600;700;900&family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400&display=swap"
      rel="stylesheet"
    />

    <!-- SEO Metadata -->
    <meta
      id="dynamic-description"
      name="description"
      content="Loading the latest articles..."
    />
    <meta name="robots" content="index, follow" />
    <link
      id="dynamic-canonical"
      rel="canonical"
      href="https://www.thedailyorigin.com/category"
    />

    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #ffffff;
        color: #000000;
        overflow-x: hidden;
      }

      /* Smooth Scrolling */
      html {
        scroll-behavior: smooth;
      }

      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 6px;
      }
      ::-webkit-scrollbar-track {
        background: #f1f1f1;
      }
      ::-webkit-scrollbar-thumb {
        background: #000;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #333;
      }

      /* Loading Overlay */
      #loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: white;
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 0.5s ease;
      }

      /* Mobile Menu Transitions */
      #mobile-menu {
        transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      }

      /* Search Bar Transition */
      #search-bar {
        transition: all 0.3s ease;
      }

      /* --- NEWS TRACKER STYLES (MATCHING INDEX.HTML) --- */
      .ticker-wrap {
        width: 100%;
        overflow: hidden;
        background-color: #e90606; /* Red background for breaking news */
        color: white;
        height: 100%;
        display: flex;
        align-items: center;
      }
      .ticker-move {
        display: flex;
        width: fit-content;
        animation: ticker 45s linear infinite;
      }
      .ticker-content {
        display: flex;
        align-items: center;
        flex-shrink: 0;
      }
      .ticker-wrap:hover .ticker-move {
        animation-play-state: paused;
      }
      @keyframes ticker {
        0% {
          transform: translateX(0);
        }
        100% {
          transform: translateX(-50%);
        }
      }
    </style>
  </head>
  <body class="antialiased flex flex-col min-h-screen">
    <!-- Loading Overlay -->
    <div id="loading-overlay">
      <div class="text-center">
        <h2 class="font-display text-5xl mb-2">The Daily Origin</h2>
        <div class="h-1 w-12 bg-[#E90606] mx-auto mb-4"></div>
        <p
          class="text-[10px] uppercase tracking-[0.3em] text-gray-400 animate-pulse"
        >
          Loading Content
        </p>
      </div>
    </div>

    <!-- Navigation -->
    <nav class="border-b-4 border-black sticky top-0 bg-white z-50">
      <!-- Top Utility Bar (Desktop) -->
      <div
        class="hidden lg:flex justify-between items-center px-6 py-2 bg-black text-white text-[10px] uppercase tracking-widest font-bold"
      >
        <div id="current-date">Fetching Date...</div>
        <div class="flex space-x-6">
          <a href="#" class="hover:text-[#E90606] transition-colors"
            >Subscribe</a
          >
          <a href="#" class="hover:text-[#E90606] transition-colors">Sign In</a>
        </div>
      </div>

      <!-- Main Nav -->
      <div
        class="max-w-[1440px] mx-auto px-6 h-20 lg:h-24 flex items-center justify-between"
      >
        <!-- Mobile Menu Trigger -->
        <button
          id="mobile-menu-btn"
          class="lg:hidden p-2 -ml-2 hover:bg-gray-100 rounded-full transition"
        >
          <i data-lucide="menu" class="w-6 h-6"></i>
        </button>

        <!-- Logo -->
        <a
          href="index.html"
          class="absolute left-1/2 -translate-x-1/2 lg:static lg:translate-x-0 lg:left-0 flex flex-col items-center lg:items-start group"
        >
          <h1
            class="font-display text-3xl lg:text-4xl font-black tracking-tighter leading-none group-hover:opacity-80 transition-opacity"
          >
            The Daily Origin<span class="text-[#E90606]">.</span>
          </h1>
        </a>

        <!-- Desktop Links -->
        <div class="hidden lg:flex items-center space-x-8">
          <a
            href="./category?category=World"
            class="nav-link text-xs font-bold uppercase tracking-widest hover:text-[#E90606] transition-colors relative after:content-[''] after:absolute after:bottom-[-4px] after:left-0 after:w-0 after:h-[2px] after:bg-[#E90606] hover:after:w-full after:transition-all"
            >World</a
          >
          <a
            href="./category?category=Politics"
            class="nav-link text-xs font-bold uppercase tracking-widest hover:text-[#E90606] transition-colors relative after:content-[''] after:absolute after:bottom-[-4px] after:left-0 after:w-0 after:h-[2px] after:bg-[#E90606] hover:after:w-full after:transition-all"
            >Politics</a
          >
          <a
            href="./category?category=Tech"
            class="nav-link text-xs font-bold uppercase tracking-widest hover:text-[#E90606] transition-colors relative after:content-[''] after:absolute after:bottom-[-4px] after:left-0 after:w-0 after:h-[2px] after:bg-[#E90606] hover:after:w-full after:transition-all"
            >Tech</a
          >
          <a
            href="./category?category=Culture"
            class="nav-link text-xs font-bold uppercase tracking-widest hover:text-[#E90606] transition-colors relative after:content-[''] after:absolute after:bottom-[-4px] after:left-0 after:w-0 after:h-[2px] after:bg-[#E90606] hover:after:w-full after:transition-all"
            >Culture</a
          >
          <a
            href="./category?category=Sports"
            class="nav-link text-xs font-bold uppercase tracking-widest hover:text-[#E90606] transition-colors relative after:content-[''] after:absolute after:bottom-[-4px] after:left-0 after:w-0 after:h-[2px] after:bg-[#E90606] hover:after:w-full after:transition-all"
            >Sports</a
          >
        </div>

        <!-- Search Toggle -->
        <div class="flex items-center">
          <button
            id="search-toggle"
            class="p-2 hover:bg-gray-100 rounded-full transition-colors"
          >
            <i data-lucide="search" class="w-5 h-5"></i>
          </button>
        </div>
      </div>

      <!-- Inline Search Bar (Hidden by default) -->
      <div
        id="search-bar"
        class="hidden border-t border-gray-100 bg-gray-50 overflow-hidden"
      >
        <div class="max-w-[1440px] mx-auto px-6 py-4 flex items-center gap-4">
          <i data-lucide="search" class="w-4 h-4 text-gray-400"></i>
          <input
            type="text"
            id="search-input"
            placeholder="Search articles in this category..."
            class="w-full bg-transparent border-none text-xl font-serif focus:ring-0 placeholder:italic placeholder:text-gray-400 outline-none"
          />
          <button
            id="search-close"
            class="text-[10px] font-bold uppercase tracking-widest hover:text-[#E90606]"
          >
            Close
          </button>
        </div>
      </div>
    </nav>

    <!-- Mobile Menu Sidebar -->
    <div
      id="mobile-menu"
      class="fixed inset-y-0 left-0 w-[85%] max-w-sm bg-black text-white z-[60] transform -translate-x-full overflow-y-auto"
    >
      <div class="p-8 flex flex-col h-full">
        <div class="flex justify-between items-center mb-12">
          <span class="font-display text-2xl">Menu</span>
          <button
            id="mobile-menu-close"
            class="p-2 hover:bg-white/10 rounded-full transition"
          >
            <i data-lucide="x" class="w-6 h-6"></i>
          </button>
        </div>

        <div class="flex flex-col space-y-6 mb-auto">
          <a
            href="index.html"
            class="text-3xl font-display hover:text-[#E90606] transition-colors"
            >Home</a
          >
          <a
            href="./category?category=World"
            class="text-2xl font-serif italic text-gray-300 hover:text-white hover:pl-2 transition-all"
            >World News</a
          >
          <a
            href="./category?category=Politics"
            class="text-2xl font-serif italic text-gray-300 hover:text-white hover:pl-2 transition-all"
            >Politics</a
          >
          <a
            href="./category?category=Tech"
            class="text-2xl font-serif italic text-gray-300 hover:text-white hover:pl-2 transition-all"
            >Technology</a
          >
          <a
            href="./category?category=Culture"
            class="text-2xl font-serif italic text-gray-300 hover:text-white hover:pl-2 transition-all"
            >Culture</a
          >
          <a
            href="./category?category=Sports"
            class="text-2xl font-serif italic text-gray-300 hover:text-white hover:pl-2 transition-all"
            >Sports</a
          >
        </div>

        <div class="pt-12 border-t border-white/20">
          <button
            class="w-full py-4 bg-[#E90606] text-white font-bold uppercase tracking-widest text-xs mb-4"
          >
            Subscribe
          </button>
          <p
            class="text-[10px] text-gray-500 uppercase tracking-widest text-center"
          >
            &copy; 2025 The Daily Origin
          </p>
        </div>
      </div>
    </div>
    <div
      id="mobile-overlay"
      class="fixed inset-0 bg-white/80 backdrop-blur-sm z-[55] hidden transition-opacity"
    ></div>

    <!-- Breaking News Ticker (UPDATED TO MATCH INDEX.HTML) -->
    <div
      class="bg-[#E90606] text-white py-2 border-b border-black shadow-sm h-10 overflow-hidden relative z-40"
    >
      <div class="flex items-center max-w-[1440px] mx-auto h-full relative">
        <div
          class="absolute left-0 top-0 bottom-0 bg-[#E90606] z-10 px-4 flex items-center shadow-[5px_0_10px_rgba(233,6,6,1)]"
        >
          <span
            class="text-[10px] font-black uppercase tracking-widest bg-black px-2 py-1"
            >Breaking</span
          >
        </div>
        <div class="flex-1 overflow-hidden relative h-full ml-24">
          <!-- Ticker Content Wrapper -->
          <div class="ticker-wrap">
            <div class="ticker-move" id="breaking-news-ticker">
              <!-- Content Injected via JS -->
              <div class="ticker-content">
                <span
                  class="text-xs font-bold uppercase tracking-wider opacity-80 px-4"
                  >Loading latest updates from the newsroom...</span
                >
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <main class="flex-grow max-w-[1440px] mx-auto px-6 py-12 lg:py-16 w-full">
      <!-- Category Header -->
      <header class="mb-20 relative">
        <div class="absolute top-0 left-0 w-24 h-1 bg-black"></div>
        <h1
          id="category-header-title"
          class="font-display text-6xl md:text-8xl lg:text-9xl mb-6 tracking-tighter mt-8"
        >
          Loading
        </h1>
        <div
          class="flex flex-col md:flex-row md:items-end justify-between gap-6 border-b border-gray-200 pb-8"
        >
          <p
            id="category-header-description"
            class="font-serif text-xl md:text-2xl text-gray-600 italic max-w-2xl leading-relaxed"
          >
            Curated stories, expert analysis, and in-depth reporting.
          </p>
          <div
            class="flex items-center gap-2 text-xs font-bold uppercase tracking-widest"
          >
            <span class="w-2 h-2 bg-[#E90606] rounded-full"></span>
            Live Feed
          </div>
        </div>
      </header>

      <!-- Layout Grid -->
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 lg:gap-20">
        <!-- Main Article List (Span 8) -->
        <div class="lg:col-span-8">
          <div class="flex items-center justify-between mb-8">
            <h2 class="font-bold text-sm uppercase tracking-widest">
              Latest Stories
            </h2>
            <div class="h-[1px] bg-gray-200 flex-grow ml-4"></div>
          </div>

          <div id="category-articles-list" class="space-y-16">
            <!-- Loading Skeletons -->
            <div class="animate-pulse space-y-4">
              <div class="aspect-[16/9] bg-gray-100 w-full"></div>
              <div class="h-8 bg-gray-100 w-3/4"></div>
              <div class="h-20 bg-gray-100 w-full"></div>
            </div>
          </div>
        </div>

        <!-- Sidebar (Span 4) -->
        <aside class="lg:col-span-4 space-y-16">
          <!-- Newsletter Widget -->
          <div class="bg-gray-50 border border-gray-100 p-8 text-center">
            <h3 class="font-display text-3xl mb-2">The Briefing</h3>
            <p class="font-serif text-sm text-gray-500 italic mb-6">
              Essential news, curated daily.
            </p>
            <div class="space-y-3">
              <input
                type="email"
                placeholder="Email Address"
                class="w-full px-4 py-3 bg-white border border-gray-200 focus:border-black focus:ring-0 transition-colors font-serif text-sm"
              />
              <button
                class="w-full bg-black text-white font-bold uppercase text-[10px] tracking-[0.2em] py-3 hover:bg-[#E90606] transition-colors"
              >
                Subscribe
              </button>
            </div>
          </div>

          <!-- Trending / Sidebar List -->
          <div id="popular-section">
            <div class="flex items-center justify-between mb-6">
              <h2
                class="font-bold text-sm uppercase tracking-widest text-[#E90606]"
              >
                Trending
              </h2>
              <div class="h-[1px] bg-[#E90606]/20 flex-grow ml-4"></div>
            </div>
            <div id="sidebar-list" class="space-y-8 divide-y divide-gray-100">
              <!-- Sidebar items injected here -->
            </div>
          </div>

          <!-- Advertisement / Box -->
          <div
            class="aspect-square bg-black flex items-center justify-center text-white p-8 text-center"
          >
            <div>
              <span
                class="block text-[10px] uppercase tracking-widest opacity-50 mb-2"
                >Advertisement</span
              >
              <p class="font-display text-2xl">
                Support Independent Journalism
              </p>
            </div>
          </div>
        </aside>
      </div>
    </main>

    <!-- Footer -->
    <footer class="bg-black text-white border-t-[6px] border-[#E90606]">
      <div class="container mx-auto px-4 lg:px-8 py-20">
        <div
          class="flex flex-col md:flex-row justify-between items-start mb-16"
        >
          <div class="mb-10 md:mb-0">
            <h2 class="font-display font-black text-5xl mb-6 tracking-tight">
              The Daily Origin
            </h2>
            <div
              class="flex space-x-8 text-xs font-sans font-bold uppercase tracking-widest text-gray-500"
            >
              <a href="#" class="hover:text-white transition-colors">About</a>
              <a href="#" class="hover:text-white transition-colors">Contact</a>
              <a href="#" class="hover:text-white transition-colors">Careers</a>
              <a href="#" class="hover:text-white transition-colors">Press</a>
            </div>
          </div>
          <div class="flex space-x-4">
            <a
              href="#"
              class="w-12 h-12 border border-gray-800 flex items-center justify-center hover:bg-[#E90606] hover:border-[#E90606] transition-all"
              ><i data-lucide="twitter" class="w-5 h-5"></i
            ></a>
            <a
              href="#"
              class="w-12 h-12 border border-gray-800 flex items-center justify-center hover:bg-[#E90606] hover:border-[#E90606] transition-all"
              ><i data-lucide="facebook" class="w-5 h-5"></i
            ></a>
            <a
              href="#"
              class="w-12 h-12 border border-gray-800 flex items-center justify-center hover:bg-[#E90606] hover:border-[#E90606] transition-all"
              ><i data-lucide="instagram" class="w-5 h-5"></i
            ></a>
          </div>
        </div>

        <div
          class="grid grid-cols-2 md:grid-cols-4 gap-12 text-sm text-gray-400 border-t border-gray-900 pt-12 font-serif"
        >
          <ul>
            <li
              class="mb-4 font-sans font-bold text-white uppercase tracking-widest text-xs"
            >
              World
            </li>
            <li class="mb-2">
              <a href="#" class="hover:text-white">U.S. Politics</a>
            </li>
            <li class="mb-2">
              <a href="#" class="hover:text-white">World News</a>
            </li>
            <li class="mb-2">
              <a href="#" class="hover:text-white">Climate Change</a>
            </li>
          </ul>
          <ul>
            <li
              class="mb-4 font-sans font-bold text-white uppercase tracking-widest text-xs"
            >
              Innovation
            </li>
            <li class="mb-2">
              <a href="#" class="hover:text-white">Business</a>
            </li>
            <li class="mb-2"><a href="#" class="hover:text-white">Tech</a></li>
            <li class="mb-2">
              <a href="#" class="hover:text-white">Science</a>
            </li>
          </ul>
          <ul>
            <li
              class="mb-4 font-sans font-bold text-white uppercase tracking-widest text-xs"
            >
              Culture
            </li>
            <li class="mb-2"><a href="#" class="hover:text-white">Books</a></li>
            <li class="mb-2"><a href="#" class="hover:text-white">Arts</a></li>
            <li class="mb-2"><a href="#" class="hover:text-white">Style</a></li>
          </ul>
          <ul>
            <li
              class="mb-4 font-sans font-bold text-white uppercase tracking-widest text-xs"
            >
              Legal
            </li>
            <li class="mb-2">
              <a href="#" class="hover:text-white">Privacy Policy</a>
            </li>
            <li class="mb-2">
              <a href="#" class="hover:text-white">Terms of Service</a>
            </li>
          </ul>
        </div>

        <!-- Bottom Section: Copyright & Developer Credit -->
        <div
          class="border-t border-gray-900 mt-8 pt-8 flex flex-col-reverse md:flex-row justify-between items-center gap-8"
        >
          <!-- Copyright -->
          <div class="text-xs text-gray-600 font-sans">
            Â© 2025 The Daily Origin
          </div>

          <!-- Built By Badge -->
          <div class="group relative inline-flex">
            <!-- Animated Background Glow -->
            <div
              class="absolute -inset-0.5 bg-gradient-to-r from-red-600 via-purple-600 to-red-600 rounded-full opacity-30 group-hover:opacity-75 blur-md transition duration-500"
            ></div>

            <!-- Badge Container -->
            <div
              class="relative flex items-center gap-3 bg-black/95 backdrop-blur-xl rounded-full pl-1.5 pr-5 py-1.5 border border-white/10 shadow-2xl ring-1 ring-white/5"
            >
              <!-- Profile Image -->
              <a
                href="https://shadikhossain.onrender.com"
                target="_blank"
                class="relative block shrink-0 group/img"
              >
                <div
                  class="w-10 h-10 rounded-full overflow-hidden border-2 border-zinc-800 group-hover:border-red-500 transition-colors duration-300"
                >
                  <img
                    src="the_daily_origin_founder.jpg"
                    alt="Shadik Hossain"
                    class="w-full h-full object-cover transform group-hover/img:scale-110 transition-transform duration-500"
                    onerror="this.onerror=null; this.src='https://ui-avatars.com/api/?name=Shadik+Hossain&background=18181b&color=e4e4e7';"
                  />
                </div>
                <!-- Status Dot -->
                <div
                  class="absolute bottom-0.5 right-0.5 w-2.5 h-2.5 bg-green-500 border-2 border-black rounded-full"
                ></div>
              </a>

              <!-- Text Info -->
              <div class="flex flex-col justify-center leading-none space-y-1">
                <div class="flex items-center gap-1.5">
                  <span
                    class="text-[9px] uppercase tracking-widest text-zinc-500 font-bold"
                    >Built by</span
                  >
                  <a
                    href="https://shadikhossain.onrender.com"
                    target="_blank"
                    class="text-xs font-bold text-gray-200 group-hover:text-white transition-colors hover:underline decoration-red-500/50 underline-offset-2"
                  >
                    Shadik Hossain
                  </a>
                </div>

                <div class="flex items-center gap-1.5">
                  <span class="text-[9px] text-zinc-600">Founder of</span>
                  <a
                    href="https://softshilpo.com"
                    target="_blank"
                    class="flex items-center gap-1 text-[9px] font-semibold text-red-400 hover:text-red-300 transition-colors bg-red-900/10 px-2 py-0.5 rounded-full border border-red-500/20"
                  >
                    SoftShilpo
                    <i data-lucide="arrow-up-right" class="w-2.5 h-2.5"></i>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <!-- Firebase Logic -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
      import {
        getAuth,
        signInAnonymously,
        signInWithCustomToken,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
      import {
        getFirestore,
        collection,
        onSnapshot,
        query,
        where,
        limit,
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

      // --- Config ---
      const firebaseConfig = {
        apiKey: "AIzaSyCFVD4Ts03OXJ14aJ5h_HGAAuiIg5nme7A",
        authDomain: "edu-env.firebaseapp.com",
        projectId: "edu-env",
        storageBucket: "edu-env.firebasestorage.app",
        messagingSenderId: "259668089849",
        appId: "1:259668089849:web:70a92e04ce3331ed533b28",
        measurementId: "G-VK9WTY47JB",
      };

      const appId =
        typeof __app_id !== "undefined" ? __app_id : "default-news-app";
      const initialAuthToken =
        typeof __initial_auth_token !== "undefined"
          ? __initial_auth_token
          : null;

      // --- Refs ---
      const loadingOverlay = document.getElementById("loading-overlay");
      const articlesListContainer = document.getElementById(
        "category-articles-list"
      );
      const sidebarListContainer = document.getElementById("sidebar-list");
      const categoryHeaderTitle = document.getElementById(
        "category-header-title"
      );
      const categoryHeaderDescription = document.getElementById(
        "category-header-description"
      );
      const breakingTicker = document.getElementById("breaking-news-ticker");
      const searchInput = document.getElementById("search-input");
      const dateEl = document.getElementById("current-date");

      // --- Helper Functions ---
      function getCategoryFromUrl() {
        const params = new URLSearchParams(window.location.search);
        let category = params.get("category") || "World";
        // Capitalize first letter
        return (
          category.charAt(0).toUpperCase() + category.slice(1).toLowerCase()
        );
      }

      function formatRelativeTime(date) {
        if (!date) return "";
        if (date.toDate) date = date.toDate();
        const now = new Date();
        const diff = Math.floor((now - date) / 1000);
        if (diff < 60) return "Just now";
        if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;
        if (diff < 86400) return `${Math.floor(diff / 3600)}h ago`;
        return date.toLocaleDateString("en-US", {
          month: "short",
          day: "numeric",
        });
      }

      // --- HTML Generators ---

      function createMainArticleHTML(article) {
        const timeAgo = formatRelativeTime(article.publishedAt);
        const image =
          article.imageUrl ||
          `https://via.placeholder.com/800x600?text=${article.category}`;
        return `
            <article class="group grid grid-cols-1 md:grid-cols-12 gap-8 cursor-pointer animate-fade-in" onclick="window.location.href='./article?id=${
              article.id
            }'">
                <div class="md:col-span-7 flex flex-col justify-center order-2 md:order-1">
                    <div class="flex items-center gap-3 mb-4">
                        <span class="text-[10px] font-bold uppercase tracking-widest text-white bg-black px-2 py-1">${
                          article.category
                        }</span>
                        <span class="text-[10px] font-bold uppercase tracking-widest text-gray-400">${timeAgo}</span>
                    </div>
                    <h3 class="font-display text-3xl md:text-4xl leading-[1.1] mb-4 group-hover:underline decoration-2 underline-offset-4 decoration-[#E90606] transition-all">${
                      article.title
                    }</h3>
                    <p class="font-serif text-lg text-gray-600 line-clamp-2 leading-relaxed mb-6">${
                      article.summary ||
                      article.excerpt ||
                      "Click to read the full story and analysis."
                    }</p>
                    <div class="flex items-center gap-2 text-xs font-bold uppercase tracking-widest group-hover:translate-x-2 transition-transform duration-300">
                        Read Story <i data-lucide="arrow-right" class="w-4 h-4"></i>
                    </div>
                </div>
                 <div class="md:col-span-5 relative aspect-[4/3] overflow-hidden order-1 md:order-2">
                     <img src="${image}" alt="${article.title}" 
                          class="absolute inset-0 w-full h-full object-cover transition-transform duration-700 ease-out group-hover:scale-105" loading="lazy">
                </div>
            </article>
            <hr class="border-gray-100 last:hidden" />
        `;
      }

      function createSidebarArticleHTML(article) {
        return `
            <article class="group cursor-pointer py-4 first:pt-0" onclick="window.location.href='./article?id=${
              article.id
            }'">
                <div class="flex items-baseline gap-2 mb-2">
                    <span class="w-1.5 h-1.5 rounded-full bg-gray-300 group-hover:bg-[#E90606] transition-colors"></span>
                    <span class="text-[10px] font-bold uppercase tracking-widest text-gray-400 group-hover:text-[#E90606] transition-colors">${
                      article.category || "News"
                    }</span>
                </div>
                <h4 class="font-display text-xl leading-tight group-hover:underline decoration-1 underline-offset-2">${
                  article.title
                }</h4>
            </article>
         `;
      }

      // --- Initialization ---
      let app, db, auth;
      let currentCategory = getCategoryFromUrl();
      let allArticlesCache = []; // For client-side search filtering

      function init() {
        // Set Date
        const options = {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric",
        };
        if (dateEl)
          dateEl.innerText = new Date().toLocaleDateString("en-US", options);

        // Update Title
        document.title = `${currentCategory} News | The Daily Origin`;
        if (categoryHeaderTitle)
          categoryHeaderTitle.innerText = currentCategory;

        // Setup Icons
        lucide.createIcons();

        // Setup Mobile Menu
        setupMobileMenu();

        // Setup Search
        setupSearch();

        // Firebase
        app = initializeApp(firebaseConfig);
        db = getFirestore(app);
        auth = getAuth(app);

        onAuthStateChanged(auth, async (user) => {
          if (!user && initialAuthToken) {
            await signInWithCustomToken(auth, initialAuthToken).catch(
              console.error
            );
          } else if (!user) {
            await signInAnonymously(auth).catch(console.error);
          }
          startListeners();
        });
      }

      function setupMobileMenu() {
        const menuBtn = document.getElementById("mobile-menu-btn");
        const closeBtn = document.getElementById("mobile-menu-close");
        const menu = document.getElementById("mobile-menu");
        const overlay = document.getElementById("mobile-overlay");

        function toggleMenu() {
          const isOpen = menu.classList.contains("translate-x-0");
          if (isOpen) {
            menu.classList.remove("translate-x-0");
            menu.classList.add("-translate-x-full");
            overlay.classList.add("hidden");
          } else {
            menu.classList.add("translate-x-0");
            menu.classList.remove("-translate-x-full");
            overlay.classList.remove("hidden");
          }
        }

        if (menuBtn) menuBtn.addEventListener("click", toggleMenu);
        if (closeBtn) closeBtn.addEventListener("click", toggleMenu);
        if (overlay) overlay.addEventListener("click", toggleMenu);
      }

      function setupSearch() {
        const toggle = document.getElementById("search-toggle");
        const bar = document.getElementById("search-bar");
        const close = document.getElementById("search-close");

        function toggleSearch() {
          bar.classList.toggle("hidden");
          if (!bar.classList.contains("hidden")) {
            searchInput.focus();
          } else {
            searchInput.value = "";
            filterArticles(""); // Reset filter
          }
        }

        if (toggle) toggle.addEventListener("click", toggleSearch);
        if (close) close.addEventListener("click", toggleSearch);

        // Client-side search logic
        searchInput.addEventListener("keyup", (e) => {
          filterArticles(e.target.value);
        });
      }

      function filterArticles(term) {
        if (!term) {
          renderMainArticles(allArticlesCache);
          return;
        }
        const lower = term.toLowerCase();
        const filtered = allArticlesCache.filter(
          (a) =>
            (a.title && a.title.toLowerCase().includes(lower)) ||
            (a.summary && a.summary.toLowerCase().includes(lower))
        );
        renderMainArticles(filtered);
      }

      function renderMainArticles(articles) {
        if (articles.length === 0) {
          articlesListContainer.innerHTML = `<div class="py-12 text-center border border-dashed border-gray-300 rounded"><p class="font-serif text-xl text-gray-500 italic">No stories found matching your criteria.</p></div>`;
          return;
        }
        articlesListContainer.innerHTML = articles
          .map(createMainArticleHTML)
          .join("");
        lucide.createIcons();
      }

      function startListeners() {
        const articlesRef = collection(
          db,
          `artifacts/${appId}/public/data/articles`
        );

        // 1. Category Query
        const catQuery = query(
          articlesRef,
          where("category", "==", currentCategory)
        );

        onSnapshot(catQuery, (snap) => {
          if (snap.empty) {
            articlesListContainer.innerHTML = `<p class="text-xl font-serif italic text-gray-500">No stories found in ${currentCategory}.</p>`;
            allArticlesCache = [];
          } else {
            let articles = snap.docs.map((d) => ({ id: d.id, ...d.data() }));
            // Client-side sort
            articles.sort(
              (a, b) =>
                (b.publishedAt?.seconds || 0) - (a.publishedAt?.seconds || 0)
            );

            allArticlesCache = articles;
            renderMainArticles(articles);
          }
          loadingOverlay.style.opacity = "0";
          setTimeout(() => (loadingOverlay.style.display = "none"), 500);
        });

        // 2. Sidebar Query (Just some recent items)
        // We limit to 5 to not overwhelm
        const sidebarQuery = query(articlesRef, limit(5));
        onSnapshot(sidebarQuery, (snap) => {
          if (!snap.empty) {
            let articles = snap.docs.map((d) => ({ id: d.id, ...d.data() }));
            // Filter out current category if possible to show variety, or just show top
            sidebarListContainer.innerHTML = articles
              .slice(0, 5)
              .map(createSidebarArticleHTML)
              .join("");
          }
        });

        // 3. Breaking News Ticker (UPDATED LOGIC)
        const breakingQuery = query(
          articlesRef,
          where("isBreaking", "==", true)
        );
        onSnapshot(breakingQuery, (snap) => {
          const tickerContainer = document.getElementById(
            "breaking-news-ticker"
          );
          if (!tickerContainer) return;

          let content = "";

          if (!snap.empty) {
            const items = snap.docs
              .map(
                (d) =>
                  `<a href="./article?id=${
                    d.id
                  }" class="mx-8 text-sm font-bold uppercase tracking-widest hover:text-black transition-colors flex items-center"><span class="text-black font-black mr-2">/</span> ${
                    d.data().title
                  }</a>`
              )
              .join("");
            // Wrap in ticker-content for CSS animation
            content = `<div class="ticker-content">${items}</div><div class="ticker-content">${items}</div>`;
          } else {
            // Fallback content
            const fallbackItems = `<span class="mx-8 text-sm font-bold uppercase tracking-widest flex items-center"><span class="text-black font-black mr-2">/</span> Welcome to The Daily Origin.</span><span class="mx-8 text-sm font-bold uppercase tracking-widest flex items-center"><span class="text-black font-black mr-2">/</span> Unbiased. Unfiltered. Uncompromising.</span>`;
            content = `<div class="ticker-content">${fallbackItems}</div><div class="ticker-content">${fallbackItems}</div>`;
          }

          tickerContainer.innerHTML = content;
        });
      }

      // Run
      init();
    </script>
  </body>
</html>
