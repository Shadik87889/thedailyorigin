<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title id="dynamic-title">Category Loading... | The Daily Origin</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Font: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="shortcut icon"
      href="the_daily_origin_favicon.png"
      type="image/x-icon"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Caveat:wght@700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Oswald:wght=700&display=swap"
      rel="stylesheet"
    />

    <!-- 1. Primary Metadata -->
    <meta
      id="dynamic-description"
      name="description"
      content="Loading the latest articles for this category..."
    />
    <meta name="robots" content="index, follow" />

    <!-- 2. Dynamic Canonical URL (CRITICAL for SEO) -->
    <link
      id="dynamic-canonical"
      rel="canonical"
      href="https://www.thedailyorigin.com/category"
    />

    <!-- 3. Open Graph (for Facebook, LinkedIn, etc.) -->
    <meta id="og-title" property="og:title" content="Category Loading..." />
    <meta
      id="og-description"
      property="og:description"
      content="Loading the latest articles for this category..."
    />
    <meta
      id="og-url"
      property="og:url"
      content="https://www.thedailyorigin.com/category"
    />
    <meta property="og:site_name" content="The Daily Origin" />
    <meta property="og:type" content="website" />
    <meta
      property="og:image"
      content="https://www.thedailyorigin.com/the_daily_origin_social_preview.png"
    />

    <!-- 4. Twitter Card (for Twitter) -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta
      id="twitter-title"
      name="twitter:title"
      content="Category Loading..."
    />
    <meta
      id="twitter-description"
      name="twitter:description"
      content="Loading the latest articles for this category..."
    />
    <meta
      name="twitter:image"
      content="https://www.thedailyorigin.com/the_daily_origin_social_preview.png"
    />

    <!-- 5. Schema.org Structured Data (JSON-LD) - Dynamic content will be injected here -->
    <script id="dynamic-schema" type="application/ld+json">
      <!-- Dynamic Schema will be generated by JavaScript -->
    </script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Custom Styles for Futuristic Look -->
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #020617; /* slate-950 */
        color: #d1d5db; /* gray-300 */
        overflow-x: hidden;
      }

      .header-glass {
        background-color: rgba(2, 6, 23, 0.6);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-bottom: 1px solid #1e293b;
      }

      .logo-main {
        font-family: "Oswald", sans-serif;
        font-weight: 700;
      }

      .logo-artisan {
        font-family: "Caveat", cursive;
      }

      .ticker-wrap {
        width: 100%;
        overflow: hidden;
      }
      .ticker-move {
        display: flex;
        width: fit-content;
        animation: ticker 25s linear infinite;
        will-change: transform;
      }
      .ticker-content {
        flex-shrink: 0;
        white-space: nowrap;
      }
      .ticker-move:hover {
        animation-play-state: paused;
      }
      @keyframes ticker {
        0% {
          transform: translateX(0);
        }
        100% {
          transform: translateX(-50%);
        }
      }

      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #0f172a;
      }
      ::-webkit-scrollbar-thumb {
        background: #0891b2;
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #22d3ee;
      }

      #loading-spinner {
        border: 4px solid #1e293b;
        border-top: 4px solid #22d3ee;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .section-title {
        position: relative;
        padding-bottom: 0.75rem;
        margin-bottom: 2rem;
        border-bottom: 1px solid #1e293b;
      }
      .section-title::after {
        content: "";
        position: absolute;
        bottom: -1px;
        left: 0;
        width: 100px;
        height: 2px;
        background: linear-gradient(to right, #22d3ee, #0891b2);
      }

      .text-gradient {
        background: linear-gradient(to right, #22d3ee, #60a5fa);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-fill-color: transparent;
      }

      .text-ellipsis-lines-2 {
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .desktop-nav-link {
        position: relative;
        padding-bottom: 4px;
      }

      .desktop-nav-link::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 2px;
        background: linear-gradient(to right, #22d3ee, #60a5fa);
        transform: scaleX(0);
        transform-origin: left;
        transition: transform 0.3s cubic-bezier(0.19, 1, 0.22, 1);
      }

      .desktop-nav-link:hover::after {
        transform: scaleX(1);
      }

      .desktop-nav-link:hover {
        color: #e5e7eb;
      }

      .ticker-font {
        font-family: "Oswald", sans-serif;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        font-size: 0.95rem;
      }

      /* Mobile Menu Styles (copied from index) */
      #mobile-menu-overlay {
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease-in-out, visibility 0.3s;
      }
      #mobile-menu {
        transform: translate-x-full;
        transition: transform 0.3s ease-in-out;
      }
      #mobile-menu nav a,
      #mobile-menu .mobile-social-links {
        opacity: 0;
        transform: translateX(20px);
        transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
      }
      #mobile-menu.menu-open nav a {
        opacity: 1;
        transform: translateX(0);
      }
      #mobile-menu.menu-open nav a:nth-child(1) {
        transition-delay: 0.1s;
      }
      #mobile-menu.menu-open nav a:nth-child(2) {
        transition-delay: 0.15s;
      }
      #mobile-menu.menu-open nav a:nth-child(3) {
        transition-delay: 0.2s;
      }
      #mobile-menu.menu-open nav a:nth-child(4) {
        transition-delay: 0.25s;
      }
      #mobile-menu.menu-open nav a:nth-child(5) {
        transition-delay: 0.3s;
      }
      #mobile-menu.menu-open nav a:nth-child(6) {
        transition-delay: 0.35s;
      }
      #mobile-menu.menu-open nav a:nth-child(7) {
        transition-delay: 0.4s;
      }
      #mobile-menu.menu-open nav a:nth-child(8) {
        transition-delay: 0.45s;
      } /* NEW: Others */
      #mobile-menu.menu-open .mobile-social-links {
        opacity: 1;
        transform: translateY(0);
        transition-delay: 0.5s;
      }
    </style>
  </head>
  <body class="antialiased">
    <!-- Loading Overlay -->
    <div
      id="loading-overlay"
      class="fixed inset-0 bg-slate-950 z-50 flex flex-col justify-center items-center"
    >
      <div id="loading-spinner"></div>
      <p class="text-cyan-400 mt-4 text-lg">Loading Category Feed...</p>
    </div>

    <!-- Header -->
    <header class="header-glass sticky top-0 z-40 w-full">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-20">
          <!-- Logo -->
          <a href="./index" class="flex items-baseline space-x-2">
            <span class="text-3xl text-white logo-main">The Daily</span>
            <span class="relative">
              <span class="text-4xl font-bold text-cyan-400 logo-artisan"
                >Origin</span
              >
              <svg
                class="absolute left-0 w-full h-4 -bottom-1 text-cyan-500"
                viewBox="0 0 100 20"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                preserveAspectRatio="none"
              >
                <path
                  d="M2 12 C 30 22 70 22 98 12"
                  stroke="currentColor"
                  stroke-width="3"
                  stroke-linecap="round"
                />
              </svg>
              <span
                class="absolute top-0 -right-5 transform -translate-y-1/2 rotate-12 bg-yellow-400 text-yellow-900 text-[10px] font-bold px-1.5 py-0.5 rounded-sm"
              >
                BETA
              </span>
            </span>
          </a>

          <!-- Desktop Navigation -->
          <!-- ADDED 'Others' link -->
          <nav class="hidden md:flex space-x-8">
            <a
              href="./category?category=World"
              class="text-sm font-medium text-gray-300 transition-colors desktop-nav-link"
              >World</a
            >
            <a
              href="./category?category=Tech"
              class="text-sm font-medium text-gray-300 transition-colors desktop-nav-link"
              >Tech</a
            >
            <a
              href="./category?category=Politics"
              class="text-sm font-medium text-gray-300 transition-colors desktop-nav-link"
              >Politics</a
            >
            <a
              href="./category?category=Culture"
              class="text-sm font-medium text-gray-300 transition-colors desktop-nav-link"
              >Culture</a
            >
            <a
              href="./category?category=Science"
              class="text-sm font-medium text-gray-300 transition-colors desktop-nav-link"
              >Science</a
            >
            <a
              href="./category?category=Sports"
              class="text-sm font-medium text-gray-300 transition-colors desktop-nav-link"
              >Sports</a
            >
            <a
              href="./category?category=Education"
              class="text-sm font-medium text-gray-300 transition-colors desktop-nav-link"
              >Education</a
            >
            <a
              href="./category?category=Others"
              class="text-sm font-medium text-gray-300 transition-colors desktop-nav-link"
              >Others</a
            >
          </nav>

          <!-- Mobile Menu Button -->
          <div class="flex items-center space-x-4">
            <button
              id="search-open-btn"
              class="text-gray-400 hover:text-cyan-400 transition-colors"
            >
              <i data-lucide="search" class="w-6 h-6"></i>
            </button>
            <button
              class="md:hidden text-gray-400 hover:text-cyan-400 transition-colors"
              id="mobile-menu-btn"
            >
              <i
                data-lucide="menu"
                class="w-6 h-6"
                id="mobile-menu-open-icon"
              ></i>
              <i
                data-lucide="x"
                class="w-6 h-6 hidden"
                id="mobile-menu-close-icon"
              ></i>
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- Mobile Menu Overlay -->
    <div
      id="mobile-menu-overlay"
      class="fixed inset-0 bg-black/70 z-40 opacity-0 invisible transition-opacity duration-300 ease-in-out md:hidden"
    ></div>

    <!-- Advanced Mobile Menu -->
    <div
      id="mobile-menu"
      class="fixed top-0 right-0 h-full w-80 max-w-full bg-slate-950 z-50 transform translate-x-full transition-transform duration-300 ease-in-out md:hidden shadow-2xl shadow-black flex flex-col"
    >
      <div
        class="flex-shrink-0 flex justify-between items-center p-6 border-b border-slate-800"
      >
        <span class="text-xl font-bold text-white">Menu</span>
        <button
          class="text-gray-400 hover:text-cyan-400"
          id="mobile-menu-close-btn"
        >
          <i data-lucide="x" class="w-6 h-6"></i>
        </button>
      </div>
      <nav class="flex-grow flex flex-col p-6 overflow-y-auto">
        <a
          href="./category?category=World"
          class="block px-4 py-3 text-base font-medium text-gray-300 hover:text-cyan-400 hover:bg-slate-800 transition-colors border-b border-slate-800"
          >World</a
        >
        <a
          href="./category?category=Tech"
          class="block px-4 py-3 text-base font-medium text-gray-300 hover:text-cyan-400 hover:bg-slate-800 transition-colors border-b border-slate-800"
          >Tech</a
        >
        <a
          href="./category?category=Politics"
          class="block px-4 py-3 text-base font-medium text-gray-300 hover:text-cyan-400 hover:bg-slate-800 transition-colors border-b border-slate-800"
          >Politics</a
        >
        <a
          href="./category?category=Culture"
          class="block px-4 py-3 text-base font-medium text-gray-300 hover:text-cyan-400 hover:bg-slate-800 transition-colors border-b border-slate-800"
          >Culture</a
        >
        <a
          href="./category?category=Science"
          class="block px-4 py-3 text-base font-medium text-gray-300 hover:text-cyan-400 hover:bg-slate-800 transition-colors border-b border-slate-800"
          >Science</a
        >
        <a
          href="./category?category=Sports"
          class="block px-4 py-3 text-base font-medium text-gray-300 hover:text-cyan-400 hover:bg-slate-800 transition-colors border-b border-slate-800"
          >Sports</a
        >
        <a
          href="./category?category=Education"
          class="block px-4 py-3 text-base font-medium text-gray-300 hover:text-cyan-400 hover:bg-slate-800 transition-colors border-b border-slate-800"
          >Education</a
        >
        <a
          href="./category?category=Others"
          class="block px-4 py-3 text-base font-medium text-gray-300 hover:text-cyan-400 hover:bg-slate-800 transition-colors border-b border-slate-800"
          >Others</a
        >
      </nav>
      <div
        class="flex-shrink-0 p-6 border-t border-slate-800 mobile-social-links"
      >
        <div class="flex space-x-6 justify-center">
          <a
            href="#"
            class="text-gray-400 hover:text-cyan-400 transition-colors"
            aria-label="Twitter"
          >
            <i data-lucide="twitter" class="w-6 h-6"></i>
          </a>
          <a
            href="#"
            class="text-gray-400 hover:text-cyan-400 transition-colors"
            aria-label="Facebook"
          >
            <i data-lucide="facebook" class="w-6 h-6"></i>
          </a>
          <a
            href="#"
            class="text-gray-400 hover:text-cyan-400 transition-colors"
            aria-label="Instagram"
          >
            <i data-lucide="instagram" class="w-6 h-6"></i>
          </a>
        </div>
      </div>
    </div>

    <!-- Breaking News Ticker -->
    <div class="bg-slate-900 border-b-2 border-cyan-700">
      <div
        class="container mx-auto px-4 sm:px-6 lg:px-8 flex items-center h-12"
      >
        <span
          class="bg-cyan-500 text-slate-900 text-xs font-extrabold uppercase px-3 py-1 rounded-sm flex-shrink-0"
        >
          Breaking
        </span>
        <div class="ticker-wrap ml-4 flex-1 min-w-0">
          <div class="ticker-move" id="breaking-news-ticker">
            <span class="text-gray-400 px-4">Loading breaking news...</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
      <!-- Category Header -->
      <header class="mb-10 text-center">
        <p
          class="text-cyan-400 text-sm font-bold uppercase tracking-widest mb-2"
        >
          Category Feed
        </p>
        <h1
          id="category-header-title"
          class="text-5xl md:text-6xl font-black text-white logo-main uppercase"
        >
          Loading...
        </h1>
        <p
          id="category-header-description"
          class="text-lg text-gray-400 mt-3 max-w-3xl mx-auto"
        >
          Discover the latest headlines, analysis, and deep dives in this
          category.
        </p>
        <!-- User ID Display (for collaborative context) -->
        <p id="user-id-display" class="text-xs text-slate-600 mt-4">User ID:</p>
      </header>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-12 lg:gap-16">
        <!-- Main Article List (col-span-2) -->
        <div class="lg:col-span-2 space-y-8" id="category-articles-list">
          <!-- Articles will be injected here -->
          <p class="text-gray-500 text-center">Loading articles...</p>
        </div>

        <!-- Sidebar (col-span-1) - Placeholder for popular stories or ads -->
        <aside class="space-y-12 hidden lg:block">
          <section>
            <h2 class="text-3xl font-bold text-white section-title">
              Popular in Category
            </h2>
            <div id="popular-articles-list" class="space-y-6">
              <!-- Placeholder items, will be filtered to match category -->
              <div class="p-6 bg-slate-900 rounded-lg border border-slate-800">
                <h3 class="text-lg font-bold text-white">Ad Placeholder</h3>
                <p class="text-sm text-gray-400 mt-1">
                  Your message here. Support independent journalism.
                </p>
              </div>
              <div class="p-6 bg-slate-900 rounded-lg border border-slate-800">
                <h3 class="text-lg font-bold text-white">Top Read Story</h3>
                <p class="text-sm text-gray-400 mt-1">
                  Article summaries would appear here to fill the sidebar.
                </p>
              </div>
            </div>
          </section>
        </aside>
      </div>
    </main>

    <!-- Footer -->
    <footer class="bg-slate-900 border-t border-slate-800 mt-16">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-8">
          <div class="col-span-2 lg:col-span-2">
            <a href="./index" class="flex items-baseline space-x-2 mb-4">
              <span class="text-2xl text-white logo-main">The Daily</span>
              <span class="relative">
                <span class="text-3xl font-bold text-cyan-400 logo-artisan"
                  >Origin</span
                >
                <svg
                  class="absolute left-0 w-full h-3 -bottom-1 text-cyan-500"
                  viewBox="0 0 100 20"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                  preserveAspectRatio="none"
                >
                  <path
                    d="M2 12 C 30 22 70 22 98 12"
                    stroke="currentColor"
                    stroke-width="3"
                    stroke-linecap="round"
                  />
                </svg>
                <span
                  class="absolute top-0 -right-4 transform -translate-y-1/2 rotate-12 bg-yellow-400 text-yellow-900 text-[9px] font-bold px-1.5 py-0.5 rounded-sm"
                >
                  BETA
                </span>
              </span>
            </a>
            <p class="text-sm text-gray-400 max-w-xs">
              The future of information, delivered today. Unbiased, unfiltered,
              and uncompromising.
            </p>
          </div>

          <div>
            <h3
              class="text-sm font-semibold text-gray-400 uppercase tracking-wider"
            >
              Categories
            </h3>
            <ul class="mt-4 space-y-2">
              <li>
                <a
                  href="./category?category=World"
                  class="text-sm text-gray-300 hover:text-cyan-400"
                  >World</a
                >
              </li>
              <li>
                <a
                  href="./category?category=Tech"
                  class="text-sm text-gray-300 hover:text-cyan-400"
                  >Tech</a
                >
              </li>
              <li>
                <a
                  href="./category?category=Politics"
                  class="text-sm text-gray-300 hover:text-cyan-400"
                  >Politics</a
                >
              </li>
              <li>
                <a
                  href="./category?category=Science"
                  class="text-sm text-gray-300 hover:text-cyan-400"
                  >Science</a
                >
              </li>
              <li>
                <a
                  href="./category?category=Culture"
                  class="text-sm text-gray-300 hover:text-cyan-400"
                  >Culture</a
                >
              </li>
              <li>
                <a
                  href="./category?category=Sports"
                  class="text-sm text-gray-300 hover:text-cyan-400"
                  >Sports</a
                >
              </li>
              <li>
                <a
                  href="./category?category=Education"
                  class="text-sm text-gray-300 hover:text-cyan-400"
                  >Education</a
                >
              </li>
              <li>
                <a
                  href="./category?category=Others"
                  class="text-sm text-gray-300 hover:text-cyan-400"
                  >Others</a
                >
              </li>
            </ul>
          </div>

          <div>
            <h3
              class="text-sm font-semibold text-gray-400 uppercase tracking-wider"
            >
              Company
            </h3>
            <ul class="mt-4 space-y-2">
              <li>
                <a
                  href="./about-us"
                  class="text-sm text-gray-300 hover:text-cyan-400"
                  >About Us</a
                >
              </li>
              <li>
                <a href="#" class="text-sm text-gray-300 hover:text-cyan-400"
                  >Careers</a
                >
              </li>
              <li>
                <a href="#" class="text-sm text-gray-300 hover:text-cyan-400"
                  >Ethics Policy</a
                >
              </li>
              <li>
                <a href="#" class="text-sm text-gray-300 hover:text-cyan-400"
                  >Contact</a
                >
              </li>
            </ul>
          </div>

          <div>
            <h3
              class="text-sm font-semibold text-gray-400 uppercase tracking-wider"
            >
              Legal
            </h3>
            <ul class="mt-4 space-y-2">
              <li>
                <a href="#" class="text-sm text-gray-300 hover:text-cyan-400"
                  >Privacy Policy</a
                >
              </li>
              <li>
                <a href="#" class="text-sm text-gray-300 hover:text-cyan-400"
                  >Terms of Service</a
                >
              </li>
            </ul>
          </div>

          <div>
            <h3
              class="text-sm font-semibold text-gray-400 uppercase tracking-wider"
            >
              Get the App
            </h3>
            <div class="mt-4 space-y-3">
              <a
                href="#"
                class="flex items-center justify-center bg-slate-800 hover:bg-slate-700 text-white py-2 px-3 rounded-lg text-sm"
              >
                <span>App Store</span>
              </a>
              <a
                href="#"
                class="flex items-center justify-center bg-slate-800 hover:bg-slate-700 text-white py-2 px-3 rounded-lg text-sm"
              >
                <span>Google Play</span>
              </a>
            </div>
          </div>
        </div>

        <div
          class="mt-8 border-t border-slate-800 pt-8 flex flex-col md:flex-row justify-between items-center"
        >
          <p class="text-sm text-gray-400">
            &copy; 2025 The Daily Origin. All rights reserved.
          </p>
          <div class="flex space-x-6 mt-4 md:mt-0">
            <a
              href="#"
              class="text-gray-400 hover:text-cyan-400 transition-colors"
            >
              <i data-lucide="twitter" class="w-5 h-5"></i>
            </a>
            <a
              href="#"
              class="text-gray-400 hover:text-cyan-400 transition-colors"
            >
              <i data-lucide="facebook" class="w-5 h-5"></i>
            </a>
            <a
              href="#"
              class="text-gray-400 hover:text-cyan-400 transition-colors"
            >
              <i data-lucide="instagram" class="w-5 h-5"></i>
            </a>
          </div>
        </div>
      </div>
    </footer>

    <!-- Firebase and App Logic -->
    <script type="module">
      // Import Firebase functions
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
      import {
        getAuth,
        signInAnonymously,
        signInWithCustomToken,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
      import {
        getFirestore,
        collection,
        onSnapshot,
        query,
        where,
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

      // --- Your Provided Firebase Config ---
      const firebaseConfig = {
        apiKey: "AIzaSyCFVD4Ts03OXJ14aJ5h_HGAAuiIg5nme7A",
        authDomain: "edu-env.firebaseapp.com",
        projectId: "edu-env",
        storageBucket: "edu-env.firebasestorage.app",
        messagingSenderId: "259668089849",
        appId: "1:259668089849:web:70a92e04ce3331ed533b28",
        measurementId: "G-VK9WTY47JB",
      };

      // --- Global Variables ---
      let app, db, auth;
      let userId = null;
      let currentCategory = null;

      // Get App ID from canvas environment, or use a default
      const appId =
        typeof __app_id !== "undefined" ? __app_id : "default-news-app";

      // Get initial auth token from canvas environment
      const initialAuthToken =
        typeof __initial_auth_token !== "undefined"
          ? __initial_auth_token
          : null;

      // --- UI Element References ---
      const loadingOverlay = document.getElementById("loading-overlay");
      const articlesListContainer = document.getElementById(
        "category-articles-list"
      );
      const categoryHeaderTitle = document.getElementById(
        "category-header-title"
      );
      const categoryHeaderDescription = document.getElementById(
        "category-header-description"
      );
      const breakingNewsTicker = document.getElementById(
        "breaking-news-ticker"
      );
      const userIdDisplay = document.getElementById("user-id-display");

      // NEW: Mobile Menu Elements (for consistency)
      const mobileMenuBtn = document.getElementById("mobile-menu-btn");
      const mobileMenuOverlay = document.getElementById("mobile-menu-overlay");
      const mobileMenu = document.getElementById("mobile-menu");
      const mobileMenuOpenIcon = document.getElementById(
        "mobile-menu-open-icon"
      );
      const mobileMenuCloseIcon = document.getElementById(
        "mobile-menu-close-icon"
      );
      const mobileMenuCloseBtn = document.getElementById(
        "mobile-menu-close-btn"
      );

      // NEW: Dynamic SEO Elements
      const dynamicTitle = document.getElementById("dynamic-title");
      const dynamicDescription = document.getElementById("dynamic-description");
      const dynamicCanonical = document.getElementById("dynamic-canonical");
      const ogTitle = document.getElementById("og-title");
      const ogDescription = document.getElementById("og-description");
      const ogUrl = document.getElementById("og-url");
      const twitterTitle = document.getElementById("twitter-title");
      const twitterDescription = document.getElementById("twitter-description");
      const dynamicSchema = document.getElementById("dynamic-schema");

      // --- Helper Functions ---

      /**
       * Extracts the 'category' query parameter from the URL.
       */
      function getCategoryFromUrl() {
        const params = new URLSearchParams(window.location.search);
        // Default to 'World' if no category is provided
        let category = params.get("category") || "World";
        // Normalize case for display and queries
        return (
          category.charAt(0).toUpperCase() + category.slice(1).toLowerCase()
        );
      }

      /**
       * Formats a Firebase Timestamp or JS Date into a relative time string
       */
      function formatRelativeTime(date) {
        if (date.toDate) {
          date = date.toDate();
        }
        const now = new Date();
        const seconds = Math.floor((now - date) / 1000);

        if (seconds < 5) return "just now";

        let interval = seconds / 31536000;
        if (interval >= 1) {
          return Math.floor(interval) + " years ago";
        }
        interval = seconds / 2592000;
        if (interval >= 1) {
          return Math.floor(interval) + " months ago";
        }
        interval = seconds / 86400;
        if (interval >= 1) {
          return Math.floor(interval) + " days ago";
        }
        interval = seconds / 3600;
        if (interval >= 1) {
          return Math.floor(interval) + " hours ago";
        }
        interval = seconds / 60;
        if (interval >= 1) {
          return Math.floor(interval) + " minutes ago";
        }
        return Math.floor(seconds) + " seconds ago";
      }

      /**
       * Creates HTML for a main feed list article. (Same as index list style)
       */
      function createListArticleHTML(article) {
        const timeAgo = article.publishedAt
          ? formatRelativeTime(article.publishedAt)
          : "Just now";
        const articleLink = `./article?id=${article.id}`;
        return `
                <a href="${articleLink}" class="block group bg-slate-900 rounded-lg overflow-hidden border border-slate-800 md:flex transition-all duration-300 shadow-lg shadow-slate-950/50 hover:border-cyan-600 hover:shadow-2xl hover:shadow-cyan-800/20" aria-label="Read article: ${article.title}">
                    <div class="w-full md:w-1/3 flex-shrink-0">
                        <img src="${article.imageUrl}" alt="${article.title}" 
                             onerror="this.src='https://source.unsplash.com/600x400/?${article.category},news';"
                             class="w-full h-full aspect-video object-cover transition-transform duration-300 group-hover:scale-105">
                    </div>
                    <div class="p-6 flex flex-col justify-between min-w-0">
                        <div class="overflow-hidden"> 
                            <span class="text-gradient text-xs font-bold uppercase tracking-wider relative z-20">${article.category}</span>
                            <h3 class="text-xl font-bold text-white mt-2 mb-3 group-hover:text-cyan-300 transition-colors text-ellipsis-lines-2">
                                ${article.title}
                            </h3>
                            <p class="text-sm text-gray-400 mb-3 hidden sm:block text-ellipsis-lines-2">${article.summary}</p>
                        </div>
                        <span class="text-xs font-medium text-gray-400">${timeAgo}</span>
                    </div>
                </a>
            `;
      }

      /**
       * Creates HTML for a single item in the breaking news ticker.
       */
      function createTickerItemHTML(article) {
        const articleLink = `./article?id=${article.id}`;
        return `
                <a href="${articleLink}" class="ticker-font text-gray-300 hover:text-cyan-400 transition-colors mx-6" aria-label="Read breaking article: ${article.title}">
                    <span class="text-white/80">${article.category}:</span> ${article.title}
                </a>
                <span class="text-cyan-700 font-light text-2xl" aria-hidden="true">&bull;</span>
            `;
      }

      // --- NEW: Dynamic SEO Implementation (The "World Best" Part) ---
      function updateDynamicSEO(category) {
        const categoryUrl = `https://www.thedailyorigin.com/category?category=${category}`;
        const pageTitle = `${category} News | The Daily Origin`;
        const description = `Discover the latest headlines, analysis, and deep dives in the ${category} category from The Daily Origin. Unbiased, unfiltered news.`;

        // 1. HTML Title and Meta Description
        dynamicTitle.textContent = pageTitle;
        dynamicDescription.setAttribute("content", description);

        // 2. Canonical URL
        dynamicCanonical.setAttribute("href", categoryUrl);

        // 3. Open Graph / Twitter Tags
        ogTitle.setAttribute("content", pageTitle);
        ogDescription.setAttribute("content", description);
        ogUrl.setAttribute("content", categoryUrl);
        twitterTitle.setAttribute("content", pageTitle);
        twitterDescription.setAttribute("content", description);

        // 4. Schema.org JSON-LD (CRITICAL for Collection Pages)
        const schemaData = {
          "@context": "https://schema.org",
          "@type": "CollectionPage",
          name: pageTitle,
          description: description,
          url: categoryUrl,
          mainContentOfPage: {
            "@type": "WebPageElement",
            cssSelector: "#category-articles-list",
          },
          about: {
            "@type": "Thing",
            name: category,
          },
          isPartOf: {
            "@type": "WebSite",
            url: "https://www.thedailyorigin.com/",
            name: "The Daily Origin",
          },
        };

        // Inject the dynamic schema into the script tag
        dynamicSchema.textContent = JSON.stringify(schemaData, null, 2);

        // 5. Update UI Headers
        categoryHeaderTitle.textContent = category.toUpperCase();
        categoryHeaderDescription.textContent = description;
      }

      // --- Firebase Initialization and Main Logic ---

      async function initializeFirebase() {
        currentCategory = getCategoryFromUrl();
        updateDynamicSEO(currentCategory); // Apply dynamic SEO immediately

        try {
          app = initializeApp(firebaseConfig);
          db = getFirestore(app);
          auth = getAuth(app);

          onAuthStateChanged(auth, async (user) => {
            if (user) {
              console.log("User is signed in:", user.uid);
              userId = user.uid;
              userIdDisplay.textContent = `User ID: ${userId}`;
              setupDataListeners();
            } else {
              console.log(
                "User is signed out. Attempting anonymous sign-in..."
              );
              try {
                if (initialAuthToken) {
                  await signInWithCustomToken(auth, initialAuthToken);
                } else {
                  await signInAnonymously(auth);
                }
              } catch (authError) {
                console.error("Error during sign-in:", authError);
                // Load public data even if auth fails
                setupDataListeners();
              }
            }
          });
        } catch (error) {
          console.error("Error initializing Firebase:", error);
          loadingOverlay.innerHTML =
            '<p class="text-red-500">Error connecting to data feed.</p>';
        }
      }

      /**
       * Sets up the real-time data listener, filtered by the current category.
       */
      function setupDataListeners() {
        const articlesCollectionPath = `artifacts/${appId}/public/data/articles`;
        const articlesRef = collection(db, articlesCollectionPath);

        // 1. Query for the specific category
        const categoryQuery = query(
          articlesRef,
          where("category", "==", currentCategory)
        );

        // 2. Query for breaking news (for the ticker, no filter)
        const breakingQuery = query(
          articlesRef,
          where("isBreaking", "==", true)
        );

        // Setup Category Articles Listener
        onSnapshot(
          categoryQuery,
          (snapshot) => {
            articlesListContainer.innerHTML = ""; // Clear previous articles

            if (snapshot.empty) {
              articlesListContainer.innerHTML = `<p class="text-2xl text-gray-500 text-center py-12">
                        No articles found in the <span class="text-cyan-400">${currentCategory}</span> category yet.
                    </p>`;
            } else {
              const articles = snapshot.docs.map((doc) => ({
                id: doc.id,
                ...doc.data(),
              }));

              // Sort articles by published date, newest first (in memory to avoid index issues)
              articles.sort((a, b) => {
                const dateA = a.publishedAt?.toDate
                  ? a.publishedAt.toDate()
                  : new Date(0);
                const dateB = b.publishedAt?.toDate
                  ? b.publishedAt.toDate()
                  : new Date(0);
                return dateB - dateA;
              });

              articles.forEach((article) => {
                articlesListContainer.innerHTML += createListArticleHTML(
                  article
                );
              });
            }
            loadingOverlay.style.display = "none";
          },
          (error) => {
            console.error("Error with category onSnapshot listener:", error);
            articlesListContainer.innerHTML =
              '<p class="text-red-500">Error fetching category articles.</p>';
            loadingOverlay.style.display = "none";
          }
        );

        // Setup Breaking News Ticker Listener
        onSnapshot(breakingQuery, (snapshot) => {
          breakingNewsTicker.innerHTML = "";
          if (!snapshot.empty) {
            const breakingNews = snapshot.docs.map((doc) => ({
              ...doc.data(),
              id: doc.id,
            }));

            let tickerHTML = "";
            breakingNews.forEach((article) => {
              tickerHTML += createTickerItemHTML(article);
            });

            // Create two identical blocks for seamless looping
            breakingNewsTicker.innerHTML = `<div class="ticker-content">${tickerHTML}</div>
                         <div class="ticker-content">${tickerHTML}</div>`;
          }
        });
      }

      // --- Mobile Menu Toggle Functions (for consistency) ---
      function openMenu() {
        mobileMenu.classList.remove("translate-x-full");
        mobileMenu.classList.add("menu-open");
        mobileMenuOverlay.classList.remove("opacity-0", "invisible");
        mobileMenuOpenIcon.classList.add("hidden");
        mobileMenuCloseIcon.classList.remove("hidden");
        document.body.style.overflow = "hidden";
      }

      function closeMenu() {
        mobileMenu.classList.add("translate-x-full");
        mobileMenu.classList.remove("menu-open");
        mobileMenuOverlay.classList.add("opacity-0", "invisible");
        mobileMenuOpenIcon.classList.remove("hidden");
        mobileMenuCloseIcon.classList.add("hidden");
        document.body.style.overflow = "";
      }

      // --- App Entry Point ---
      document.addEventListener("DOMContentLoaded", () => {
        lucide.createIcons();

        // Mobile Menu Event Listeners
        mobileMenuBtn.addEventListener("click", openMenu);
        mobileMenuCloseBtn.addEventListener("click", closeMenu);
        mobileMenuOverlay.addEventListener("click", closeMenu);

        // Initialize Firebase
        initializeFirebase();
      });
    </script>
  </body>
</html>
