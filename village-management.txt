<!DOCTYPE html>
<html lang="bn">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ভিলেজ ম্যানেজমেন্ট সিস্টেম | ড্যাশবোর্ড</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Google Font (Noto Sans Bengali & Inter) -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+Bengali:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['"Noto Sans Bengali"', '"Inter"', "sans-serif"],
            },
            colors: {
              primary: {
                50: "#eff6ff",
                100: "#dbeafe",
                500: "#3b82f6",
                600: "#2563eb",
                700: "#1d4ed8",
                900: "#1e3a8a",
              },
              slate: {
                850: "#151f32",
              },
            },
            boxShadow: {
              soft: "0 4px 20px -2px rgba(0, 0, 0, 0.05)",
            },
          },
        },
      };
    </script>

    <style>
      /* Global Smoothness */
      body {
        font-family: "Noto Sans Bengali", "Inter", sans-serif;
        background-color: #f8fafc; /* Slate-50 */
        -webkit-font-smoothing: antialiased;
        color: #334155; /* Slate-700 */
      }

      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 7px;
        height: 7px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 10px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }

      /* Animations */
      .fade-in {
        animation: fadeIn 0.4s ease-in-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Loader */
      .loader-overlay {
        background-color: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(4px);
      }
      .loader {
        border: 4px solid #e2e8f0;
        border-top: 4px solid #2563eb;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 0.8s cubic-bezier(0.55, 0.055, 0.675, 0.19) infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Sidebar Active State */
      .sidebar-link {
        transition: all 0.2s ease;
      }
      .sidebar-link:hover {
        background-color: #f1f5f9;
        color: #0f172a;
      }
      .sidebar-link.active {
        background-color: #eff6ff; /* primary-50 */
        color: #2563eb; /* primary-600 */
        font-weight: 600;
        border-right: 3px solid #2563eb;
      }
      .sidebar-link i {
        transition: color 0.2s ease;
      }

      /* Modal Transitions */
      .modal {
        transition: opacity 0.3s ease, visibility 0.3s ease;
      }
      .modal-content {
        transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
      }
      .hidden-transition {
        visibility: hidden;
        opacity: 0;
      }

      /* Input Fields */
      input,
      select,
      textarea {
        transition: all 0.2s;
      }
      input:focus,
      select:focus,
      textarea:focus {
        border-color: #2563eb;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        outline: none;
      }

      /* Table Styling */
      th {
        letter-spacing: 0.025em;
        text-transform: uppercase;
      }
      tr {
        transition: background-color 0.15s;
      }
    </style>
  </head>
  <body>
    <!-- Global Loader -->
    <div
      id="global-loader"
      class="loader-overlay fixed inset-0 flex items-center justify-center z-[9999] hidden-transition"
    >
      <div class="loader"></div>
    </div>

    <!-- Auth Container (Login/Signup) -->
    <div
      id="auth-container"
      class="min-h-screen flex items-center justify-center p-4 relative overflow-hidden"
    >
      <!-- Background Pattern -->
      <div class="absolute inset-0 z-0 opacity-50">
        <div
          class="absolute top-[-10%] left-[-10%] w-96 h-96 bg-blue-200 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob"
        ></div>
        <div
          class="absolute top-[-10%] right-[-10%] w-96 h-96 bg-purple-200 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-2000"
        ></div>
        <div
          class="absolute -bottom-32 left-20 w-96 h-96 bg-indigo-200 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-4000"
        ></div>
      </div>

      <div
        class="max-w-4xl w-full bg-white/80 backdrop-blur-xl rounded-2xl shadow-2xl overflow-hidden flex z-10 border border-white/50"
      >
        <!-- Left Side: Welcome / Branding -->
        <div
          class="hidden md:flex w-1/2 bg-gradient-to-br from-blue-600 to-indigo-700 p-12 flex-col justify-between text-white relative overflow-hidden"
        >
          <div
            class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"
          ></div>
          <div>
            <h1 class="text-4xl font-bold mb-2">স্বাগতম</h1>
            <p class="text-blue-100 text-lg">
              আধুনিক গ্রাম ব্যবস্থাপনা সিস্টেমে আপনাকে স্বাগতম।
            </p>
          </div>
          <div class="space-y-4 z-10">
            <div
              class="flex items-center gap-3 bg-white/10 p-3 rounded-lg backdrop-blur-sm"
            >
              <i data-lucide="users" class="w-6 h-6 text-blue-200"></i>
              <span class="font-medium">জনগণ ব্যবস্থাপনা</span>
            </div>
            <div
              class="flex items-center gap-3 bg-white/10 p-3 rounded-lg backdrop-blur-sm"
            >
              <i data-lucide="home" class="w-6 h-6 text-blue-200"></i>
              <span class="font-medium">হোল্ডিং ট্র্যাকিং</span>
            </div>
            <div
              class="flex items-center gap-3 bg-white/10 p-3 rounded-lg backdrop-blur-sm"
            >
              <i data-lucide="hand-heart" class="w-6 h-6 text-blue-200"></i>
              <span class="font-medium">স্বেচ্ছাসেবী সেবা</span>
            </div>
          </div>
        </div>

        <!-- Right Side: Forms -->
        <div class="w-full md:w-1/2 p-8 md:p-12">
          <div class="text-center mb-8 md:hidden">
            <h1 class="text-2xl font-bold text-blue-700">ভিলেজ ম্যানেজমেন্ট</h1>
          </div>

          <!-- Tab Buttons -->
          <div class="flex bg-slate-100 p-1 rounded-xl mb-8">
            <button
              id="show-login-tab"
              class="flex-1 py-2.5 text-sm font-semibold rounded-lg shadow-sm bg-white text-blue-600 transition-all duration-200"
            >
              লগইন
            </button>
            <button
              id="show-signup-tab"
              class="flex-1 py-2.5 text-sm font-semibold text-slate-500 hover:text-slate-700 rounded-lg transition-all duration-200"
            >
              সাইন আপ
            </button>
          </div>

          <!-- Error Message -->
          <div
            id="auth-error"
            class="hidden bg-red-50 border border-red-200 text-red-600 rounded-lg p-3 mb-6 text-sm flex items-center gap-2"
          >
            <i data-lucide="alert-circle" class="w-4 h-4"></i>
            <span class="auth-error-text"></span>
          </div>

          <!-- Login Form -->
          <form id="login-form" class="fade-in">
            <h2 class="text-2xl font-bold text-slate-800 mb-1">
              ফিরে আসার জন্য ধন্যবাদ!
            </h2>
            <p class="text-slate-500 text-sm mb-6">
              আপনার অ্যাকাউন্টে প্রবেশ করুন
            </p>

            <div class="space-y-5">
              <div>
                <label
                  for="login-email"
                  class="block text-sm font-medium text-slate-700 mb-1.5"
                  >ইমেইল</label
                >
                <div class="relative">
                  <i
                    data-lucide="mail"
                    class="w-5 h-5 text-slate-400 absolute left-3 top-3"
                  ></i>
                  <input
                    type="email"
                    id="login-email"
                    required
                    class="w-full pl-10 pr-4 py-2.5 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white transition-colors"
                    placeholder="name@example.com"
                  />
                </div>
              </div>
              <div>
                <label
                  for="login-password"
                  class="block text-sm font-medium text-slate-700 mb-1.5"
                  >পাসওয়ার্ড</label
                >
                <div class="relative">
                  <i
                    data-lucide="lock"
                    class="w-5 h-5 text-slate-400 absolute left-3 top-3"
                  ></i>
                  <input
                    type="password"
                    id="login-password"
                    required
                    class="w-full pl-10 pr-4 py-2.5 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white transition-colors"
                    placeholder="••••••••"
                  />
                </div>
              </div>
            </div>

            <div class="flex justify-end mt-2 mb-6">
              <a
                href="#"
                id="forgot-password-link"
                class="text-sm font-medium text-blue-600 hover:text-blue-700"
                >পাসওয়ার্ড ভুলে গেছেন?</a
              >
            </div>

            <button
              type="submit"
              class="w-full bg-blue-600 text-white py-3 rounded-xl font-semibold hover:bg-blue-700 focus:ring-4 focus:ring-blue-200 transition-all shadow-lg shadow-blue-200"
            >
              লগইন করুন
            </button>
          </form>

          <!-- Signup Form -->
          <form id="signup-form" class="hidden fade-in">
            <h2 class="text-2xl font-bold text-slate-800 mb-1">
              নতুন একাউন্ট তৈরি করুন
            </h2>
            <p class="text-slate-500 text-sm mb-6">
              আপনার তথ্য দিয়ে নিবন্ধন করুন
            </p>

            <div class="space-y-5 mb-6">
              <div>
                <label
                  for="signup-email"
                  class="block text-sm font-medium text-slate-700 mb-1.5"
                  >ইমেইল</label
                >
                <div class="relative">
                  <i
                    data-lucide="mail"
                    class="w-5 h-5 text-slate-400 absolute left-3 top-3"
                  ></i>
                  <input
                    type="email"
                    id="signup-email"
                    required
                    class="w-full pl-10 pr-4 py-2.5 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white"
                    placeholder="name@example.com"
                  />
                </div>
              </div>
              <div>
                <label
                  for="signup-password"
                  class="block text-sm font-medium text-slate-700 mb-1.5"
                  >পাসওয়ার্ড (কমপক্ষে ৬ অক্ষর)</label
                >
                <div class="relative">
                  <i
                    data-lucide="key"
                    class="w-5 h-5 text-slate-400 absolute left-3 top-3"
                  ></i>
                  <input
                    type="password"
                    id="signup-password"
                    required
                    class="w-full pl-10 pr-4 py-2.5 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white"
                    placeholder="••••••••"
                  />
                </div>
              </div>
            </div>

            <button
              type="submit"
              class="w-full bg-indigo-600 text-white py-3 rounded-xl font-semibold hover:bg-indigo-700 focus:ring-4 focus:ring-indigo-200 transition-all shadow-lg shadow-indigo-200"
            >
              রেজিস্ট্রেশন করুন
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- App Container -->
    <div
      id="app-container"
      class="hidden flex h-screen overflow-hidden bg-slate-50"
    >
      <!-- Sidebar -->
      <aside
        id="sidebar"
        class="w-72 bg-white border-r border-slate-200 flex flex-col fixed inset-y-0 left-0 z-30 transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out shadow-soft"
      >
        <!-- Brand -->
        <div class="h-20 flex items-center px-8 border-b border-slate-100">
          <div
            class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center mr-3 shadow-lg shadow-blue-200"
          >
            <i data-lucide="building-2" class="text-white w-5 h-5"></i>
          </div>
          <h1 class="text-xl font-bold text-slate-800 tracking-tight">
            ম্যানেজমেন্ট
          </h1>
          <button
            id="close-sidebar-btn"
            class="md:hidden ml-auto text-slate-400 hover:text-slate-600"
          >
            <i data-lucide="x" class="w-6 h-6"></i>
          </button>
        </div>

        <!-- Navigation -->
        <nav class="flex-1 px-4 py-6 space-y-1 overflow-y-auto">
          <p
            class="px-4 text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2"
          >
            মেনু
          </p>
          <a
            href="#"
            class="sidebar-link flex items-center px-4 py-3 rounded-xl text-slate-600 group"
            data-page="page-dashboard"
          >
            <i
              data-lucide="layout-grid"
              class="w-5 h-5 mr-3 group-hover:text-blue-600"
            ></i>
            ড্যাশবোর্ড
          </a>
          <a
            href="#"
            class="sidebar-link flex items-center px-4 py-3 rounded-xl text-slate-600 group"
            data-page="page-volunteers"
          >
            <i
              data-lucide="heart-handshake"
              class="w-5 h-5 mr-3 group-hover:text-blue-600"
            ></i>
            স্বেচ্ছাসেবী
          </a>
          <a
            href="#"
            class="sidebar-link flex items-center px-4 py-3 rounded-xl text-slate-600 group"
            data-page="page-bongshos"
          >
            <i
              data-lucide="git-fork"
              class="w-5 h-5 mr-3 group-hover:text-blue-600"
            ></i>
            বংশ তালিকা
          </a>
          <a
            href="#"
            class="sidebar-link flex items-center px-4 py-3 rounded-xl text-slate-600 group"
            data-page="page-households"
          >
            <i
              data-lucide="home"
              class="w-5 h-5 mr-3 group-hover:text-blue-600"
            ></i>
            হোল্ডিং তালিকা
          </a>
          <a
            href="#"
            class="sidebar-link flex items-center px-4 py-3 rounded-xl text-slate-600 group"
            data-page="page-population"
          >
            <i
              data-lucide="users"
              class="w-5 h-5 mr-3 group-hover:text-blue-600"
            ></i>
            জনগণ
          </a>

          <p
            class="px-4 text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2 mt-6"
          >
            অন্যান্য
          </p>
          <a
            href="#"
            class="sidebar-link flex items-center px-4 py-3 rounded-xl text-slate-600 group"
            data-page="page-notices"
          >
            <i
              data-lucide="bell"
              class="w-5 h-5 mr-3 group-hover:text-blue-600"
            ></i>
            নোটিশ বোর্ড
          </a>
          <a
            href="#"
            class="sidebar-link flex items-center px-4 py-3 rounded-xl text-slate-600 group"
            data-page="page-admin"
          >
            <i
              data-lucide="settings-2"
              class="w-5 h-5 mr-3 group-hover:text-blue-600"
            ></i>
            প্রশাসন
          </a>
        </nav>

        <!-- User Footer -->
        <div class="p-4 border-t border-slate-100 bg-slate-50/50">
          <div class="flex items-center gap-3 mb-3">
            <div
              class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 font-bold"
            >
              <i data-lucide="user" class="w-5 h-5"></i>
            </div>
            <div class="overflow-hidden">
              <p class="text-xs text-slate-500">লগইন করা আছে</p>
              <p
                id="user-email-display"
                class="text-sm font-semibold text-slate-700 truncate"
              ></p>
            </div>
          </div>
          <button
            id="logout-button"
            class="w-full flex items-center justify-center py-2 px-4 rounded-lg text-red-600 bg-red-50 hover:bg-red-100 transition font-medium text-sm"
          >
            <i data-lucide="log-out" class="w-4 h-4 mr-2"></i>
            লগআউট
          </button>
        </div>
      </aside>

      <!-- Main Content -->
      <main
        id="main-content"
        class="flex-1 md:ml-72 h-screen overflow-y-auto scroll-smooth"
      >
        <!-- Mobile Header -->
        <header
          class="md:hidden bg-white/80 backdrop-blur border-b border-slate-200 sticky top-0 z-20 px-4 py-3 flex justify-between items-center"
        >
          <div class="flex items-center gap-2">
            <div
              class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center shadow-md"
            >
              <i data-lucide="building-2" class="text-white w-5 h-5"></i>
            </div>
            <span class="font-bold text-slate-800">ম্যানেজমেন্ট</span>
          </div>
          <button
            id="open-sidebar-btn"
            class="p-2 text-slate-600 hover:bg-slate-100 rounded-lg"
          >
            <i data-lucide="menu" class="w-6 h-6"></i>
          </button>
        </header>

        <div class="p-6 lg:p-10 max-w-7xl mx-auto pb-20">
          <!-- PAGE: DASHBOARD -->
          <div id="page-dashboard" class="page-content fade-in">
            <div
              class="flex flex-col md:flex-row md:items-center justify-between mb-8 gap-4"
            >
              <div>
                <h2 class="text-3xl font-bold text-slate-800 mb-1">
                  ড্যাশবোর্ড
                </h2>
                <p class="text-slate-500 text-sm">
                  আজকের তারিখ:
                  <span
                    id="dashboard-current-date"
                    class="font-medium text-blue-600"
                    >...</span
                  >
                </p>
              </div>
              <!-- Quick Search -->
              <div class="relative w-full md:w-80 group">
                <div
                  class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
                >
                  <i
                    data-lucide="search"
                    class="h-5 w-5 text-slate-400 group-focus-within:text-blue-500 transition-colors"
                  ></i>
                </div>
                <input
                  type="text"
                  id="dashboard-quick-search"
                  class="block w-full pl-10 pr-3 py-2.5 border border-slate-200 rounded-xl leading-5 bg-white text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition shadow-sm"
                  placeholder="হোল্ডিং বা ব্যক্তি খুঁজুন..."
                  onkeyup="handleDashboardSearch(this.value)"
                />
              </div>
            </div>

            <!-- Stats Row -->
            <div
              class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10"
            >
              <!-- Stat Card 1 -->
              <div
                class="bg-white rounded-2xl p-6 shadow-soft border border-slate-100 hover:shadow-lg transition-shadow cursor-pointer group"
                onclick="showPage('page-households')"
              >
                <div class="flex justify-between items-start">
                  <div>
                    <p
                      class="text-sm font-semibold text-slate-500 uppercase tracking-wider"
                    >
                      মোট হোল্ডিং
                    </p>
                    <h3
                      id="stat-total-households"
                      class="text-3xl font-bold text-slate-800 mt-2 group-hover:text-blue-600 transition-colors"
                    >
                      ...
                    </h3>
                  </div>
                  <div
                    class="p-3 bg-blue-50 text-blue-600 rounded-xl group-hover:scale-110 transition-transform"
                  >
                    <i data-lucide="home" class="w-6 h-6"></i>
                  </div>
                </div>
                <div
                  class="mt-4 h-1 w-full bg-slate-100 rounded-full overflow-hidden"
                >
                  <div class="h-full bg-blue-500 w-2/3 rounded-full"></div>
                </div>
              </div>

              <!-- Stat Card 2 -->
              <div
                class="bg-white rounded-2xl p-6 shadow-soft border border-slate-100 hover:shadow-lg transition-shadow cursor-pointer group"
                onclick="showPage('page-population')"
              >
                <div class="flex justify-between items-start">
                  <div>
                    <p
                      class="text-sm font-semibold text-slate-500 uppercase tracking-wider"
                    >
                      মোট জনগণ
                    </p>
                    <h3
                      id="stat-total-population"
                      class="text-3xl font-bold text-slate-800 mt-2 group-hover:text-emerald-600 transition-colors"
                    >
                      ...
                    </h3>
                  </div>
                  <div
                    class="p-3 bg-emerald-50 text-emerald-600 rounded-xl group-hover:scale-110 transition-transform"
                  >
                    <i data-lucide="users" class="w-6 h-6"></i>
                  </div>
                </div>
                <div
                  class="mt-4 h-1 w-full bg-slate-100 rounded-full overflow-hidden"
                >
                  <div class="h-full bg-emerald-500 w-3/4 rounded-full"></div>
                </div>
              </div>

              <!-- Stat Card 3 -->
              <div
                class="bg-white rounded-2xl p-6 shadow-soft border border-slate-100 hover:shadow-lg transition-shadow cursor-pointer group"
                onclick="showPage('page-volunteers')"
              >
                <div class="flex justify-between items-start">
                  <div>
                    <p
                      class="text-sm font-semibold text-slate-500 uppercase tracking-wider"
                    >
                      স্বেচ্ছাসেবী
                    </p>
                    <h3
                      id="stat-total-volunteers"
                      class="text-3xl font-bold text-slate-800 mt-2 group-hover:text-rose-600 transition-colors"
                    >
                      ...
                    </h3>
                  </div>
                  <div
                    class="p-3 bg-rose-50 text-rose-600 rounded-xl group-hover:scale-110 transition-transform"
                  >
                    <i data-lucide="heart-handshake" class="w-6 h-6"></i>
                  </div>
                </div>
                <div
                  class="mt-4 h-1 w-full bg-slate-100 rounded-full overflow-hidden"
                >
                  <div class="h-full bg-rose-500 w-1/2 rounded-full"></div>
                </div>
              </div>

              <!-- Stat Card 4 -->
              <div
                class="bg-white rounded-2xl p-6 shadow-soft border border-slate-100 hover:shadow-lg transition-shadow cursor-pointer group"
                onclick="showPage('page-bongshos')"
              >
                <div class="flex justify-between items-start">
                  <div>
                    <p
                      class="text-sm font-semibold text-slate-500 uppercase tracking-wider"
                    >
                      মোট বংশ
                    </p>
                    <h3
                      id="stat-total-bongshos"
                      class="text-3xl font-bold text-slate-800 mt-2 group-hover:text-purple-600 transition-colors"
                    >
                      ...
                    </h3>
                  </div>
                  <div
                    class="p-3 bg-purple-50 text-purple-600 rounded-xl group-hover:scale-110 transition-transform"
                  >
                    <i data-lucide="git-fork" class="w-6 h-6"></i>
                  </div>
                </div>
                <div
                  class="mt-4 h-1 w-full bg-slate-100 rounded-full overflow-hidden"
                >
                  <div class="h-full bg-purple-500 w-full rounded-full"></div>
                </div>
              </div>
            </div>

            <!-- Main Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
              <!-- Left Column: Contact & Age -->
              <div class="space-y-8">
                <!-- Contact Card -->
                <div
                  class="bg-white rounded-2xl shadow-soft border border-slate-100 overflow-hidden"
                >
                  <div
                    class="bg-blue-50 px-6 py-4 border-b border-blue-100 flex justify-between items-center"
                  >
                    <h3 class="font-bold text-blue-800 flex items-center">
                      <i data-lucide="phone" class="w-4 h-4 mr-2"></i> জরুরি
                      যোগাযোগ
                    </h3>
                    <button
                      onclick="showPage('page-admin')"
                      class="text-xs font-medium text-blue-600 hover:underline"
                    >
                      এডিট
                    </button>
                  </div>
                  <div class="p-6 space-y-4">
                    <div
                      class="flex items-center justify-between p-3 rounded-xl bg-slate-50 border border-slate-100"
                    >
                      <div>
                        <p class="text-xs text-slate-500">চেয়ারম্যান</p>
                        <p
                          id="dash-admin-chairman"
                          class="font-semibold text-slate-800"
                        >
                          --
                        </p>
                      </div>
                      <a
                        href="#"
                        id="dash-admin-chairman-call"
                        class="w-10 h-10 bg-white rounded-full border border-slate-200 flex items-center justify-center text-blue-600 hover:bg-blue-600 hover:text-white transition shadow-sm"
                      >
                        <i data-lucide="phone-call" class="w-4 h-4"></i>
                      </a>
                    </div>
                    <div
                      class="flex items-center justify-between p-3 rounded-xl bg-slate-50 border border-slate-100"
                    >
                      <div>
                        <p class="text-xs text-slate-500">মেম্বার</p>
                        <p
                          id="dash-admin-member"
                          class="font-semibold text-slate-800"
                        >
                          --
                        </p>
                      </div>
                      <a
                        href="#"
                        id="dash-admin-member-call"
                        class="w-10 h-10 bg-white rounded-full border border-slate-200 flex items-center justify-center text-blue-600 hover:bg-blue-600 hover:text-white transition shadow-sm"
                      >
                        <i data-lucide="phone-call" class="w-4 h-4"></i>
                      </a>
                    </div>
                    <div
                      class="flex items-center justify-between p-3 rounded-xl bg-slate-50 border border-slate-100"
                    >
                      <div>
                        <p class="text-xs text-slate-500">গ্রাম পুলিশ</p>
                        <p
                          id="dash-admin-police"
                          class="font-semibold text-slate-800"
                        >
                          --
                        </p>
                      </div>
                      <a
                        href="#"
                        id="dash-admin-police-call"
                        class="w-10 h-10 bg-white rounded-full border border-slate-200 flex items-center justify-center text-blue-600 hover:bg-blue-600 hover:text-white transition shadow-sm"
                      >
                        <i data-lucide="phone-call" class="w-4 h-4"></i>
                      </a>
                    </div>
                  </div>
                </div>

                <!-- Demographics -->
                <div
                  class="bg-white rounded-2xl shadow-soft border border-slate-100 p-6"
                >
                  <h3 class="font-bold text-slate-800 mb-6 flex items-center">
                    <i
                      data-lucide="bar-chart-2"
                      class="w-5 h-5 mr-2 text-emerald-500"
                    ></i>
                    বয়স ভিত্তিক তথ্য
                  </h3>
                  <div class="space-y-5">
                    <div>
                      <div
                        class="flex justify-between text-sm font-medium mb-2"
                      >
                        <span class="text-slate-600">শিশু (০-১৭)</span>
                        <span id="age-stat-child" class="text-emerald-600"
                          >0</span
                        >
                      </div>
                      <div class="w-full bg-slate-100 rounded-full h-2.5">
                        <div
                          id="bar-child"
                          class="bg-emerald-400 h-2.5 rounded-full transition-all duration-1000"
                          style="width: 0%;"
                        ></div>
                      </div>
                    </div>
                    <div>
                      <div
                        class="flex justify-between text-sm font-medium mb-2"
                      >
                        <span class="text-slate-600"
                          >প্রাপ্তবয়স্ক (১৮-৫৯)</span
                        >
                        <span id="age-stat-adult" class="text-blue-600">0</span>
                      </div>
                      <div class="w-full bg-slate-100 rounded-full h-2.5">
                        <div
                          id="bar-adult"
                          class="bg-blue-500 h-2.5 rounded-full transition-all duration-1000"
                          style="width: 0%;"
                        ></div>
                      </div>
                    </div>
                    <div>
                      <div
                        class="flex justify-between text-sm font-medium mb-2"
                      >
                        <span class="text-slate-600">প্রবীণ (৬০+)</span>
                        <span id="age-stat-senior" class="text-purple-600"
                          >0</span
                        >
                      </div>
                      <div class="w-full bg-slate-100 rounded-full h-2.5">
                        <div
                          id="bar-senior"
                          class="bg-purple-500 h-2.5 rounded-full transition-all duration-1000"
                          style="width: 0%;"
                        ></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Right Column -->
              <div class="lg:col-span-2 space-y-8">
                <!-- Quick Actions -->
                <div
                  class="bg-white rounded-2xl shadow-soft border border-slate-100 p-6"
                >
                  <h3 class="text-lg font-bold text-slate-800 mb-4">
                    দ্রুত অ্যাকশন
                  </h3>
                  <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    <button
                      onclick="showPage('page-households'); document.getElementById('add-household-btn').click();"
                      class="flex flex-col items-center justify-center p-4 rounded-xl border border-slate-100 bg-slate-50 hover:bg-blue-50 hover:border-blue-200 transition group"
                    >
                      <div
                        class="w-12 h-12 bg-white rounded-full shadow-sm flex items-center justify-center mb-2 group-hover:scale-110 transition-transform"
                      >
                        <i data-lucide="plus" class="text-blue-600"></i>
                      </div>
                      <span
                        class="text-sm font-medium text-slate-600 group-hover:text-blue-700"
                        >হোল্ডিং যোগ</span
                      >
                    </button>
                    <button
                      onclick="showPage('page-bongshos'); document.getElementById('add-bongsho-btn').click();"
                      class="flex flex-col items-center justify-center p-4 rounded-xl border border-slate-100 bg-slate-50 hover:bg-purple-50 hover:border-purple-200 transition group"
                    >
                      <div
                        class="w-12 h-12 bg-white rounded-full shadow-sm flex items-center justify-center mb-2 group-hover:scale-110 transition-transform"
                      >
                        <i data-lucide="plus" class="text-purple-600"></i>
                      </div>
                      <span
                        class="text-sm font-medium text-slate-600 group-hover:text-purple-700"
                        >বংশ যোগ</span
                      >
                    </button>
                    <button
                      onclick="showPage('page-notices'); document.getElementById('add-notice-btn').click();"
                      class="flex flex-col items-center justify-center p-4 rounded-xl border border-slate-100 bg-slate-50 hover:bg-amber-50 hover:border-amber-200 transition group"
                    >
                      <div
                        class="w-12 h-12 bg-white rounded-full shadow-sm flex items-center justify-center mb-2 group-hover:scale-110 transition-transform"
                      >
                        <i data-lucide="bell-plus" class="text-amber-600"></i>
                      </div>
                      <span
                        class="text-sm font-medium text-slate-600 group-hover:text-amber-700"
                        >নোটিশ দিন</span
                      >
                    </button>
                  </div>
                </div>

                <!-- Recent Activity -->
                <div
                  class="bg-white rounded-2xl shadow-soft border border-slate-100 overflow-hidden"
                >
                  <div
                    class="px-6 py-4 border-b border-slate-100 flex justify-between items-center"
                  >
                    <h3 class="font-bold text-slate-800">
                      সাম্প্রতিক কার্যক্রম
                    </h3>
                    <span
                      class="bg-slate-100 text-slate-600 text-xs px-2 py-1 rounded-md font-medium"
                      >সর্বশেষ ৫টি</span
                    >
                  </div>
                  <div
                    id="dashboard-recent-activity"
                    class="divide-y divide-slate-50"
                  >
                    <p class="p-6 text-center text-slate-400">লোড হচ্ছে...</p>
                  </div>
                </div>

                <!-- Notices -->
                <div>
                  <div class="flex justify-between items-end mb-4">
                    <h3 class="font-bold text-slate-800 text-lg">
                      নোটিশ বোর্ড
                    </h3>
                    <button
                      onclick="showPage('page-notices')"
                      class="text-sm text-blue-600 hover:underline font-medium"
                    >
                      সব দেখুন
                    </button>
                  </div>
                  <div id="dashboard-recent-notices" class="space-y-4">
                    <p
                      id="dashboard-notices-loading"
                      class="text-slate-500 text-sm"
                    >
                      লোড হচ্ছে...
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- PAGE: VOLUNTEERS -->
          <div id="page-volunteers" class="page-content hidden fade-in">
            <div
              class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4"
            >
              <div>
                <h2
                  class="text-3xl font-bold text-slate-800 flex items-center gap-3"
                >
                  <span class="p-2 bg-rose-100 rounded-lg"
                    ><i
                      data-lucide="heart-handshake"
                      class="w-6 h-6 text-rose-600"
                    ></i
                  ></span>
                  স্বেচ্ছাসেবী ও সেবা
                </h2>
                <p class="text-slate-500 text-sm mt-1 ml-1">
                  গ্রামে উপলব্ধ সেবাসমূহ এবং স্বেচ্ছাসেবীদের তালিকা
                </p>
              </div>
            </div>

            <!-- Filter Bar -->
            <div
              class="bg-white p-1 rounded-2xl shadow-sm border border-slate-200 mb-8 flex flex-col md:flex-row gap-4 items-center justify-between"
            >
              <div id="volunteer-filters" class="flex flex-wrap gap-2 p-2">
                <button
                  onclick="filterVolunteers('all')"
                  class="px-4 py-2 rounded-xl text-sm font-medium transition-all active-vol-filter bg-slate-800 text-white shadow-md"
                  data-type="all"
                >
                  সব
                </button>
                <button
                  onclick="filterVolunteers('blood')"
                  class="px-4 py-2 rounded-xl text-sm font-medium transition-all bg-white text-slate-600 hover:bg-rose-50 hover:text-rose-600 border border-transparent hover:border-rose-100"
                  data-type="blood"
                >
                  <i class="inline mr-1" data-lucide="droplet"></i>রক্তদান
                </button>
                <button
                  onclick="filterVolunteers('money')"
                  class="px-4 py-2 rounded-xl text-sm font-medium transition-all bg-white text-slate-600 hover:bg-emerald-50 hover:text-emerald-600 border border-transparent hover:border-emerald-100"
                  data-type="money"
                >
                  <i class="inline mr-1" data-lucide="banknote"></i>আর্থিক
                </button>
                <!-- Add others similarly with appropriate colors -->
                <button
                  onclick="filterVolunteers('education')"
                  class="px-4 py-2 rounded-xl text-sm font-medium transition-all bg-white text-slate-600 hover:bg-blue-50 hover:text-blue-600"
                  data-type="education"
                >
                  শিক্ষা
                </button>
                <button
                  onclick="filterVolunteers('health')"
                  class="px-4 py-2 rounded-xl text-sm font-medium transition-all bg-white text-slate-600 hover:bg-cyan-50 hover:text-cyan-600"
                  data-type="health"
                >
                  চিকিৎসা
                </button>
                <button
                  onclick="filterVolunteers('social')"
                  class="px-4 py-2 rounded-xl text-sm font-medium transition-all bg-white text-slate-600 hover:bg-orange-50 hover:text-orange-600"
                  data-type="social"
                >
                  সামাজিক
                </button>
              </div>
              <div class="p-2 w-full md:w-auto">
                <select
                  id="filter-vol-blood-group"
                  onchange="applyVolunteerFilters()"
                  class="w-full md:w-40 p-2.5 bg-slate-50 border border-slate-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-slate-200 outline-none"
                >
                  <option value="">রক্তের গ্রুপ</option>
                  <option value="A+">A+</option>
                  <option value="A-">A-</option>
                  <option value="B+">B+</option>
                  <option value="B-">B-</option>
                  <option value="O+">O+</option>
                  <option value="O-">O-</option>
                  <option value="AB+">AB+</option>
                  <option value="AB-">AB-</option>
                </select>
              </div>
            </div>

            <!-- Grid -->
            <div
              id="volunteer-grid"
              class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 min-h-[300px]"
            >
              <div class="col-span-full flex justify-center items-center h-64">
                <div class="loader"></div>
              </div>
            </div>

            <!-- Pagination (Reused Logic) -->
            <div
              class="flex flex-col md:flex-row justify-between items-center mt-8 bg-white p-4 rounded-xl border border-slate-200 shadow-sm"
            >
              <div
                id="pagination-info-volunteers"
                class="text-sm text-slate-500 font-medium"
              >
                Showing 0 to 0
              </div>
              <div class="flex gap-3 items-center mt-3 md:mt-0">
                <select
                  id="rows-per-page-volunteers"
                  onchange="changeRowsPerPage('volunteers', this.value)"
                  class="bg-slate-50 border border-slate-200 rounded-lg text-sm p-1.5 focus:outline-none"
                >
                  <option value="12">12</option>
                  <option value="24">24</option>
                </select>
                <div class="flex gap-1">
                  <button
                    id="prev-btn-volunteers"
                    onclick="changePage('volunteers', -1)"
                    class="p-2 rounded-lg border border-slate-200 hover:bg-slate-50 disabled:opacity-50 transition"
                  >
                    <i data-lucide="chevron-left" class="w-4 h-4"></i>
                  </button>
                  <span
                    id="page-display-volunteers"
                    class="px-3 py-2 text-sm font-bold text-slate-700"
                    >1</span
                  >
                  <button
                    id="next-btn-volunteers"
                    onclick="changePage('volunteers', 1)"
                    class="p-2 rounded-lg border border-slate-200 hover:bg-slate-50 disabled:opacity-50 transition"
                  >
                    <i data-lucide="chevron-right" class="w-4 h-4"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- PAGE: BONGSHOS -->
          <div id="page-bongshos" class="page-content hidden fade-in">
            <div
              class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4"
            >
              <div>
                <h2 class="text-3xl font-bold text-slate-800">বংশ তালিকা</h2>
                <p class="text-slate-500 text-sm mt-1">
                  গ্রামের সকল বংশের তালিকা এবং বিবরণ
                </p>
              </div>
              <button
                id="add-bongsho-btn"
                class="bg-slate-800 text-white px-6 py-3 rounded-xl font-medium hover:bg-slate-900 transition shadow-lg shadow-slate-200 flex items-center gap-2"
              >
                <i data-lucide="plus" class="w-4 h-4"></i> নতুন বংশ
              </button>
            </div>

            <div
              class="bg-white rounded-2xl shadow-soft border border-slate-100 overflow-hidden"
            >
              <div class="p-4 border-b border-slate-100">
                <input
                  type="text"
                  id="bongsho-search"
                  class="w-full md:w-1/3 p-2.5 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-purple-100 outline-none transition"
                  placeholder="খুঁজুন..."
                />
              </div>
              <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse">
                  <thead class="bg-slate-50 text-slate-500 text-xs uppercase">
                    <tr>
                      <th class="p-4 font-semibold">বংশের নাম</th>
                      <th class="p-4 font-semibold">বিবরণ</th>
                      <th class="p-4 font-semibold">হোল্ডিং সংখ্যা</th>
                      <th class="p-4 font-semibold text-right">পদক্ষেপ</th>
                    </tr>
                  </thead>
                  <tbody
                    id="bongsho-list"
                    class="divide-y divide-slate-100 text-sm text-slate-700"
                  >
                    <tr>
                      <td colspan="4" class="p-8 text-center text-slate-400">
                        লোড হচ্ছে...
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- PAGE: HOUSEHOLDS -->
          <div id="page-households" class="page-content hidden fade-in">
            <div
              class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4"
            >
              <div>
                <h2 class="text-3xl font-bold text-slate-800">
                  হোল্ডিং তালিকা
                </h2>
                <p class="text-slate-500 text-sm mt-1">
                  সকল বাড়ির বিস্তারিত তথ্য
                </p>
              </div>
              <button
                id="add-household-btn"
                class="bg-blue-600 text-white px-6 py-3 rounded-xl font-medium hover:bg-blue-700 transition shadow-lg shadow-blue-200 flex items-center gap-2"
              >
                <i data-lucide="home" class="w-4 h-4"></i> নতুন হোল্ডিং
              </button>
            </div>

            <!-- Advanced Filter -->
            <div
              class="bg-white rounded-2xl shadow-sm border border-slate-200 mb-6 overflow-hidden"
            >
              <div
                class="p-4 bg-slate-50 border-b border-slate-100 flex justify-between items-center cursor-pointer hover:bg-slate-100 transition"
                onclick="toggleFilter('household-filter-panel')"
              >
                <span
                  class="font-semibold text-slate-700 flex items-center gap-2"
                  ><i data-lucide="filter" class="w-4 h-4 text-blue-600"></i>
                  ফিল্টার</span
                >
                <i
                  data-lucide="chevron-down"
                  class="w-4 h-4 text-slate-400"
                ></i>
              </div>
              <div
                id="household-filter-panel"
                class="filter-panel grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-white hidden"
              >
                <input
                  type="text"
                  id="filter-household-search"
                  class="p-3 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-blue-100 outline-none"
                  placeholder="নাম, হোল্ডিং বা মোবাইল..."
                />
                <select
                  id="filter-household-bongsho"
                  class="p-3 border border-slate-200 rounded-xl text-sm bg-white focus:ring-2 focus:ring-blue-100 outline-none"
                  ><option value="">-- সব বংশ --</option></select
                >
                <select
                  id="filter-household-village"
                  class="p-3 border border-slate-200 rounded-xl text-sm bg-white focus:ring-2 focus:ring-blue-100 outline-none"
                  ><option value="">-- সব গ্রাম --</option></select
                >
                <div class="md:col-span-3 flex justify-end gap-3 pt-2">
                  <button
                    onclick="resetHouseholdFilters()"
                    class="px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg text-sm font-medium transition"
                  >
                    রিসেট
                  </button>
                  <button
                    onclick="applyHouseholdFilters()"
                    class="px-6 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 shadow-md shadow-blue-100 transition"
                  >
                    ফিল্টার প্রয়োগ
                  </button>
                </div>
              </div>
            </div>

            <div id="household-list" class="space-y-4 min-h-[200px]">
              <div class="flex justify-center p-10">
                <div class="loader"></div>
              </div>
            </div>

            <!-- Household Pagination -->
            <div
              class="flex flex-col md:flex-row justify-between items-center mt-8 bg-white p-4 rounded-xl border border-slate-200 shadow-sm"
            >
              <div
                id="pagination-info-household"
                class="text-sm text-slate-500 font-medium"
              >
                Loading...
              </div>
              <div class="flex gap-3 items-center mt-3 md:mt-0">
                <select
                  id="rows-per-page-household"
                  onchange="changeRowsPerPage('households', this.value)"
                  class="bg-slate-50 border border-slate-200 rounded-lg text-sm p-1.5"
                  ><option value="10">10</option
                  ><option value="20">20</option></select
                >
                <div class="flex gap-1">
                  <button
                    id="prev-btn-household"
                    onclick="changePage('households', -1)"
                    class="p-2 rounded-lg border border-slate-200 hover:bg-slate-50 disabled:opacity-50"
                  >
                    <i data-lucide="chevron-left" class="w-4 h-4"></i>
                  </button>
                  <span
                    id="page-display-household"
                    class="px-3 py-2 text-sm font-bold text-slate-700"
                    >1</span
                  >
                  <button
                    id="next-btn-household"
                    onclick="changePage('households', 1)"
                    class="p-2 rounded-lg border border-slate-200 hover:bg-slate-50 disabled:opacity-50"
                  >
                    <i data-lucide="chevron-right" class="w-4 h-4"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- PAGE: POPULATION -->
          <div id="page-population" class="page-content hidden fade-in">
            <div
              class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4"
            >
              <div>
                <h2 class="text-3xl font-bold text-slate-800">জনগণ তালিকা</h2>
                <p class="text-slate-500 text-sm mt-1">
                  গ্রামের সকল মানুষের তথ্যভান্ডার
                </p>
              </div>
              <button
                id="export-csv-btn"
                class="bg-emerald-600 text-white px-6 py-3 rounded-xl font-medium hover:bg-emerald-700 transition shadow-lg shadow-emerald-200 flex items-center gap-2"
              >
                <i data-lucide="download" class="w-4 h-4"></i> CSV ডাউনলোড
              </button>
            </div>

            <!-- Pop Filter -->
            <div
              class="bg-white rounded-2xl shadow-sm border border-slate-200 mb-6 overflow-hidden"
            >
              <div
                class="p-4 bg-slate-50 border-b border-slate-100 flex justify-between items-center cursor-pointer hover:bg-slate-100 transition"
                onclick="toggleFilter('population-filter-panel')"
              >
                <span
                  class="font-semibold text-slate-700 flex items-center gap-2"
                  ><i data-lucide="filter" class="w-4 h-4 text-emerald-600"></i>
                  ফিল্টার</span
                >
                <i
                  data-lucide="chevron-down"
                  class="w-4 h-4 text-slate-400"
                ></i>
              </div>
              <div
                id="population-filter-panel"
                class="filter-panel grid grid-cols-1 md:grid-cols-4 gap-4 p-4 bg-white hidden"
              >
                <input
                  type="text"
                  id="filter-pop-search"
                  class="col-span-2 p-3 border border-slate-200 rounded-xl text-sm outline-none focus:border-emerald-500"
                  placeholder="নাম, NID বা মোবাইল..."
                />
                <div class="flex gap-2">
                  <input
                    type="number"
                    id="filter-pop-age-min"
                    class="w-1/2 p-3 border border-slate-200 rounded-xl text-sm outline-none focus:border-emerald-500"
                    placeholder="Min Age"
                  />
                  <input
                    type="number"
                    id="filter-pop-age-max"
                    class="w-1/2 p-3 border border-slate-200 rounded-xl text-sm outline-none focus:border-emerald-500"
                    placeholder="Max Age"
                  />
                </div>
                <select
                  id="filter-pop-village"
                  class="p-3 border border-slate-200 rounded-xl text-sm bg-white outline-none focus:border-emerald-500"
                  ><option value="">-- গ্রাম --</option></select
                >
                <select
                  id="filter-pop-bongsho"
                  class="col-span-4 p-3 border border-slate-200 rounded-xl text-sm bg-white outline-none focus:border-emerald-500"
                  ><option value="">-- বংশ --</option></select
                >
                <div class="col-span-4 flex justify-end gap-3 pt-2">
                  <button
                    onclick="resetPopulationFilters()"
                    class="px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg text-sm font-medium"
                  >
                    রিসেট
                  </button>
                  <button
                    onclick="applyPopulationFilters()"
                    class="px-6 py-2 bg-emerald-600 text-white rounded-lg text-sm font-medium hover:bg-emerald-700 shadow-md shadow-emerald-100"
                  >
                    ফিল্টার
                  </button>
                </div>
              </div>
            </div>

            <div
              class="bg-white rounded-2xl shadow-soft border border-slate-100 overflow-hidden"
            >
              <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse">
                  <thead
                    class="bg-slate-50 text-slate-500 text-xs uppercase border-b border-slate-200"
                  >
                    <tr>
                      <th
                        class="p-4 font-semibold sortable-th cursor-pointer hover:bg-slate-100"
                        data-sort="name"
                      >
                        নাম ↕
                      </th>
                      <th class="p-4 font-semibold hidden md:table-cell">
                        পেশা ও রক্ত
                      </th>
                      <th class="p-4 font-semibold hidden md:table-cell">
                        NID
                      </th>
                      <th class="p-4 font-semibold hidden md:table-cell">
                        মোবাইল
                      </th>
                      <th class="p-4 font-semibold">হোল্ডিং</th>
                    </tr>
                  </thead>
                  <tbody
                    id="population-list"
                    class="divide-y divide-slate-100 text-sm text-slate-700"
                  >
                    <tr>
                      <td colspan="5" class="p-8 text-center text-slate-400">
                        লোড হচ্ছে...
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Population Pagination -->
            <div
              class="flex flex-col md:flex-row justify-between items-center mt-8 bg-white p-4 rounded-xl border border-slate-200 shadow-sm"
            >
              <div
                id="pagination-info-population"
                class="text-sm text-slate-500 font-medium"
              >
                Loading...
              </div>
              <div class="flex gap-3 items-center mt-3 md:mt-0">
                <select
                  id="rows-per-page-population"
                  onchange="changeRowsPerPage('population', this.value)"
                  class="bg-slate-50 border border-slate-200 rounded-lg text-sm p-1.5"
                  ><option value="50">50</option
                  ><option value="100">100</option></select
                >
                <div class="flex gap-1">
                  <button
                    id="prev-btn-population"
                    onclick="changePage('population', -1)"
                    class="p-2 rounded-lg border border-slate-200 hover:bg-slate-50 disabled:opacity-50"
                  >
                    <i data-lucide="chevron-left" class="w-4 h-4"></i>
                  </button>
                  <span
                    id="page-display-population"
                    class="px-3 py-2 text-sm font-bold text-slate-700"
                    >1</span
                  >
                  <button
                    id="next-btn-population"
                    onclick="changePage('population', 1)"
                    class="p-2 rounded-lg border border-slate-200 hover:bg-slate-50 disabled:opacity-50"
                  >
                    <i data-lucide="chevron-right" class="w-4 h-4"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- PAGE: NOTICES -->
          <div id="page-notices" class="page-content hidden fade-in">
            <div
              class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4"
            >
              <div>
                <h2 class="text-3xl font-bold text-slate-800">নোটিশ বোর্ড</h2>
                <p class="text-slate-500 text-sm mt-1">
                  জনসাধারণের জন্য গুরুত্বপূর্ণ ঘোষণা
                </p>
              </div>
              <button
                id="add-notice-btn"
                class="bg-amber-500 text-white px-6 py-3 rounded-xl font-medium hover:bg-amber-600 transition shadow-lg shadow-amber-200 flex items-center gap-2"
              >
                <i data-lucide="plus" class="w-4 h-4"></i> নতুন নোটিশ
              </button>
            </div>

            <div id="notice-list" class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <p
                id="notice-list-loading"
                class="col-span-full text-center text-slate-400 py-10"
              >
                লোড হচ্ছে...
              </p>
            </div>

            <div
              class="flex flex-col md:flex-row justify-between items-center mt-8 bg-white p-4 rounded-xl border border-slate-200 shadow-sm"
            >
              <div
                id="pagination-info-notices"
                class="text-sm text-slate-500 font-medium"
              >
                Loading...
              </div>
              <div class="flex gap-3 items-center mt-3 md:mt-0">
                <select
                  id="rows-per-page-notices"
                  onchange="changeRowsPerPage('notices', this.value)"
                  class="bg-slate-50 border border-slate-200 rounded-lg text-sm p-1.5"
                  ><option value="6">6</option
                  ><option value="12">12</option></select
                >
                <div class="flex gap-1">
                  <button
                    id="prev-btn-notices"
                    onclick="changePage('notices', -1)"
                    class="p-2 rounded-lg border border-slate-200 hover:bg-slate-50 disabled:opacity-50"
                  >
                    <i data-lucide="chevron-left" class="w-4 h-4"></i>
                  </button>
                  <span
                    id="page-display-notices"
                    class="px-3 py-2 text-sm font-bold text-slate-700"
                    >1</span
                  >
                  <button
                    id="next-btn-notices"
                    onclick="changePage('notices', 1)"
                    class="p-2 rounded-lg border border-slate-200 hover:bg-slate-50 disabled:opacity-50"
                  >
                    <i data-lucide="chevron-right" class="w-4 h-4"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- PAGE: ADMIN -->
          <div id="page-admin" class="page-content hidden fade-in">
            <h2 class="text-3xl font-bold text-slate-800 mb-8">
              প্রশাসনিক কনফিগারেশন
            </h2>
            <div
              class="bg-white rounded-2xl shadow-lg border border-slate-100 max-w-2xl mx-auto overflow-hidden"
            >
              <div class="bg-slate-800 p-6 text-white">
                <h3 class="text-xl font-bold">যোগাযোগ তথ্য আপডেট</h3>
                <p class="text-slate-400 text-sm">
                  জরুরি যোগাযোগের জন্য এই তথ্য ড্যাশবোর্ডে দেখানো হবে
                </p>
              </div>
              <form id="admin-info-form" class="p-8 space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2"
                      >চেয়ারম্যানের নাম</label
                    >
                    <input
                      type="text"
                      id="admin-chairman-name"
                      class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white"
                    />
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2"
                      >মোবাইল</label
                    >
                    <input
                      type="tel"
                      id="admin-chairman-mobile"
                      class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white"
                    />
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2"
                      >মেম্বারের নাম</label
                    >
                    <input
                      type="text"
                      id="admin-member-name"
                      class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white"
                    />
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2"
                      >মোবাইল</label
                    >
                    <input
                      type="tel"
                      id="admin-member-mobile"
                      class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white"
                    />
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2"
                      >গ্রাম পুলিশের নাম</label
                    >
                    <input
                      type="text"
                      id="admin-police-name"
                      class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white"
                    />
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2"
                      >মোবাইল</label
                    >
                    <input
                      type="tel"
                      id="admin-police-mobile"
                      class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white"
                    />
                  </div>
                </div>
                <button
                  id="admin-submit-btn"
                  type="submit"
                  class="w-full bg-slate-800 text-white py-3 rounded-xl font-bold hover:bg-slate-900 transition shadow-lg"
                >
                  তথ্য সংরক্ষণ করুন
                </button>
              </form>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- MODALS (Updated Designs) -->

    <!-- Generic Modal Structure for Add/Edit -->
    <!-- Add Household Modal -->
    <div
      id="add-household-modal"
      class="modal fixed inset-0 bg-slate-900/40 backdrop-blur-sm flex items-center justify-center p-4 hidden z-50 hidden-transition"
    >
      <div
        class="modal-content bg-white rounded-2xl shadow-2xl w-full max-w-lg transform scale-95 border border-white/50"
      >
        <div
          class="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50/50 rounded-t-2xl"
        >
          <h3
            id="household-modal-title"
            class="text-xl font-bold text-slate-800"
          >
            হোল্ডিং যোগ
          </h3>
          <button
            class="modal-close-btn text-slate-400 hover:text-slate-600 transition"
          >
            <i data-lucide="x" class="w-6 h-6"></i>
          </button>
        </div>
        <form
          id="add-household-form"
          class="p-6 space-y-4 max-h-[75vh] overflow-y-auto"
        >
          <input type="hidden" id="household-id" />
          <!-- Inputs with new styles -->
          <div class="grid grid-cols-1 gap-4">
            <div>
              <label
                class="text-xs font-bold text-slate-500 uppercase mb-1 block"
                >বংশ</label
              >
              <select
                id="household-bongsho"
                required
                class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white transition"
                ><option value="">-- নির্বাচন --</option></select
              >
            </div>
            <div>
              <label
                class="text-xs font-bold text-slate-500 uppercase mb-1 block"
                >বাড়ির নাম</label
              >
              <input
                type="text"
                id="household-common-name"
                required
                class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white transition"
              />
            </div>
            <div>
              <label
                class="text-xs font-bold text-slate-500 uppercase mb-1 block"
                >মালিকের নাম</label
              >
              <input
                type="text"
                id="household-owner-name"
                required
                class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white transition"
              />
            </div>
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label
                  class="text-xs font-bold text-slate-500 uppercase mb-1 block"
                  >পিতার নাম</label
                >
                <input
                  type="text"
                  id="household-owner-father"
                  class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white"
                />
              </div>
              <div>
                <label
                  class="text-xs font-bold text-slate-500 uppercase mb-1 block"
                  >হোল্ডিং নং</label
                >
                <input
                  type="text"
                  id="household-official-no"
                  class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white"
                />
              </div>
            </div>
            <div>
              <label
                class="text-xs font-bold text-slate-500 uppercase mb-1 block"
                >গ্রাম/পাড়া</label
              >
              <div class="flex gap-2">
                <select
                  id="household-area"
                  class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white"
                  ><option value="">-- নির্বাচন --</option></select
                >
                <button
                  type="button"
                  id="add-area-btn"
                  class="p-3 bg-slate-100 rounded-xl hover:bg-slate-200"
                >
                  <i data-lucide="plus" class="w-5 h-5"></i>
                </button>
              </div>
            </div>
            <div>
              <label
                class="text-xs font-bold text-slate-500 uppercase mb-1 block"
                >মোবাইল</label
              >
              <input
                type="tel"
                id="household-mobile"
                class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white"
              />
            </div>

            <!-- Owner Extra -->
            <div class="p-4 bg-blue-50/50 rounded-xl border border-blue-100">
              <p class="text-xs font-bold text-blue-600 uppercase mb-3">
                মালিকের অতিরিক্ত তথ্য
              </p>
              <div class="grid grid-cols-2 gap-3 mb-3">
                <input
                  type="text"
                  id="household-owner-occupation"
                  placeholder="পেশা"
                  class="p-2 border border-blue-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-200 outline-none"
                />
                <select
                  id="household-owner-blood"
                  class="p-2 border border-blue-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-200 outline-none"
                  ><option value="">রক্তের গ্রুপ</option
                  ><option value="A+">A+</option
                  ><option value="O+">O+</option></select
                >
              </div>
              <div class="space-y-2">
                <p class="text-xs text-slate-500">স্বেচ্ছাসেবী আগ্রহ:</p>
                <div class="flex flex-wrap gap-3">
                  <label class="flex items-center gap-1 text-sm"
                    ><input
                      type="checkbox"
                      id="h-vol-blood"
                      class="rounded text-blue-600"
                    />
                    রক্তদান</label
                  >
                  <label class="flex items-center gap-1 text-sm"
                    ><input
                      type="checkbox"
                      id="h-vol-money"
                      class="rounded text-blue-600"
                    />
                    আর্থিক</label
                  >
                  <label class="flex items-center gap-1 text-sm"
                    ><input
                      type="checkbox"
                      id="h-vol-education"
                      class="rounded text-blue-600"
                    />
                    শিক্ষা</label
                  >
                  <label class="flex items-center gap-1 text-sm"
                    ><input
                      type="checkbox"
                      id="h-vol-health"
                      class="rounded text-blue-600"
                    />
                    চিকিৎসা</label
                  >
                  <label class="flex items-center gap-1 text-sm"
                    ><input
                      type="checkbox"
                      id="h-vol-social"
                      class="rounded text-blue-600"
                    />
                    সামাজিক</label
                  >
                </div>
              </div>
            </div>
          </div>
          <button
            type="submit"
            id="household-form-submit"
            class="w-full py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 shadow-lg shadow-blue-100 transition"
          >
            সংরক্ষণ করুন
          </button>
        </form>
      </div>
    </div>

    <!-- Toast -->
    <div
      id="toast-notification"
      class="fixed bottom-6 right-6 bg-slate-800 text-white px-6 py-4 rounded-xl shadow-2xl transform transition-all duration-300 translate-y-20 opacity-0 z-[9999] flex items-center gap-3"
    >
      <span id="toast-message" class="font-medium">Notification</span>
    </div>

    <!-- Confirmation Modal -->
    <div
      id="confirmation-modal"
      class="modal fixed inset-0 bg-slate-900/40 backdrop-blur-sm flex items-center justify-center p-4 hidden z-[60] hidden-transition"
    >
      <div
        class="modal-content bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 text-center"
      >
        <div
          class="w-16 h-16 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4"
        >
          <i data-lucide="alert-triangle" class="w-8 h-8 text-red-500"></i>
        </div>
        <h3 id="confirm-title" class="text-xl font-bold text-slate-800 mb-2">
          নিশ্চিত?
        </h3>
        <p id="confirm-message" class="text-slate-500 mb-6">
          এই কাজটি ফিরিয়ে আনা যাবে না।
        </p>
        <div class="flex gap-3 justify-center">
          <button
            id="confirm-cancel-btn"
            class="px-5 py-2.5 rounded-xl bg-slate-100 text-slate-600 font-medium hover:bg-slate-200 transition"
          >
            না
          </button>
          <button
            id="confirm-delete-btn"
            class="px-5 py-2.5 rounded-xl bg-red-600 text-white font-medium hover:bg-red-700 shadow-lg shadow-red-200 transition"
          >
            হ্যাঁ, মুছুন
          </button>
        </div>
      </div>
    </div>

    <!-- Other Modals (Bongsho, Member, Notice, etc.) Structure reused with new classes -->
    <div
      id="add-bongsho-modal"
      class="modal fixed inset-0 bg-slate-900/40 backdrop-blur-sm flex items-center justify-center p-4 hidden z-50 hidden-transition"
    >
      <div
        class="modal-content bg-white rounded-2xl shadow-2xl w-full max-w-md p-6"
      >
        <div class="flex justify-between items-center mb-6">
          <h3 id="bongsho-modal-title" class="text-xl font-bold text-slate-800">
            নতুন বংশ
          </h3>
          <button class="modal-close-btn text-slate-400">
            <i data-lucide="x"></i>
          </button>
        </div>
        <form id="add-bongsho-form" class="space-y-4">
          <input type="hidden" id="bongsho-id" />
          <input
            type="text"
            id="bongsho-name"
            placeholder="বংশের নাম"
            required
            class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white"
          />
          <textarea
            id="bongsho-description"
            placeholder="বিবরণ (ঐচ্ছিক)"
            class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white h-24"
          ></textarea>
          <button
            type="submit"
            id="bongsho-form-submit"
            class="w-full py-3 bg-purple-600 text-white rounded-xl font-bold hover:bg-purple-700"
          >
            সংরক্ষণ করুন
          </button>
        </form>
      </div>
    </div>

    <div
      id="add-notice-modal"
      class="modal fixed inset-0 bg-slate-900/40 backdrop-blur-sm flex items-center justify-center p-4 hidden z-50 hidden-transition"
    >
      <div
        class="modal-content bg-white rounded-2xl shadow-2xl w-full max-w-lg p-6"
      >
        <div class="flex justify-between items-center mb-6">
          <h3 id="notice-modal-title" class="text-xl font-bold text-slate-800">
            নতুন নোটিশ
          </h3>
          <button class="modal-close-btn text-slate-400">
            <i data-lucide="x"></i>
          </button>
        </div>
        <form id="add-notice-form" class="space-y-4">
          <input type="hidden" id="notice-id" />
          <input
            type="text"
            id="notice-title"
            placeholder="শিরোনাম"
            required
            class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white"
          />
          <textarea
            id="notice-details"
            placeholder="বিস্তারিত..."
            rows="5"
            required
            class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white"
          ></textarea>
          <button
            type="submit"
            id="notice-form-submit"
            class="w-full py-3 bg-amber-500 text-white rounded-xl font-bold hover:bg-amber-600"
          >
            পোস্ট করুন
          </button>
        </form>
      </div>
    </div>

    <div
      id="add-member-modal"
      class="modal fixed inset-0 bg-slate-900/40 backdrop-blur-sm flex items-center justify-center p-4 hidden z-[55] hidden-transition"
    >
      <div
        class="modal-content bg-white rounded-2xl shadow-2xl w-full max-w-lg p-6 max-h-[85vh] overflow-y-auto"
      >
        <div
          class="flex justify-between items-center mb-6 border-b pb-4 border-slate-100"
        >
          <h3 id="member-modal-title" class="text-xl font-bold text-slate-800">
            সদস্য যোগ
          </h3>
          <button class="modal-close-btn text-slate-400">
            <i data-lucide="x"></i>
          </button>
        </div>
        <form id="add-member-form" class="space-y-4">
          <input type="hidden" id="member-id" />
          <input
            type="text"
            id="member-name"
            placeholder="নাম"
            required
            class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white"
          />
          <div class="flex gap-2">
            <select
              id="member-relation"
              required
              class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white"
              ><option value="">-- সম্পর্ক --</option></select
            >
            <button
              type="button"
              id="add-relation-btn"
              class="p-3 bg-slate-100 rounded-xl"
            >
              <i data-lucide="plus"></i>
            </button>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <input
              type="date"
              id="member-dob"
              class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white"
            />
            <input
              type="text"
              id="member-occupation"
              placeholder="পেশা"
              class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white"
            />
          </div>
          <div class="grid grid-cols-2 gap-4">
            <input
              type="text"
              id="member-nid"
              placeholder="NID / জন্ম সনদ"
              class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white"
            />
            <input
              type="tel"
              id="member-mobile"
              placeholder="মোবাইল"
              class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:bg-white"
            />
          </div>
          <div class="p-4 bg-slate-50 rounded-xl border border-slate-100">
            <select
              id="member-blood"
              class="w-full p-2 mb-3 border border-slate-200 rounded-lg text-sm"
              ><option value="">রক্তের গ্রুপ</option
              ><option value="A+">A+</option
              ><option value="O+">O+</option></select
            >
            <p class="text-xs text-slate-500 mb-2">স্বেচ্ছাসেবী:</p>
            <div class="flex flex-wrap gap-3">
              <label class="flex items-center gap-1 text-sm"
                ><input
                  type="checkbox"
                  id="vol-blood"
                  class="rounded text-blue-600"
                />
                রক্তদান</label
              >
              <label class="flex items-center gap-1 text-sm"
                ><input
                  type="checkbox"
                  id="vol-money"
                  class="rounded text-blue-600"
                />
                আর্থিক</label
              >
              <label class="flex items-center gap-1 text-sm"
                ><input
                  type="checkbox"
                  id="vol-education"
                  class="rounded text-blue-600"
                />
                শিক্ষা</label
              >
              <!-- ... others -->
            </div>
          </div>
          <button
            type="submit"
            id="member-form-submit"
            class="w-full py-3 bg-emerald-600 text-white rounded-xl font-bold hover:bg-emerald-700"
          >
            সংরক্ষণ করুন
          </button>
        </form>
      </div>
    </div>

    <!-- Household Details Modal -->
    <div
      id="household-details-modal"
      class="modal fixed inset-0 bg-slate-900/40 backdrop-blur-sm flex items-center justify-center p-4 hidden z-[52] hidden-transition"
    >
      <div
        class="modal-content bg-white rounded-2xl shadow-2xl w-full max-w-3xl h-[85vh] flex flex-col"
      >
        <div
          class="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50 rounded-t-2xl"
        >
          <h3 id="details-modal-title" class="text-xl font-bold text-slate-800">
            বিবরণ
          </h3>
          <button class="modal-close-btn text-slate-400 hover:text-slate-600">
            <i data-lucide="x"></i>
          </button>
        </div>
        <div class="flex-1 overflow-y-auto p-6">
          <div
            class="bg-blue-50/50 p-5 rounded-xl border border-blue-100 mb-6 relative overflow-hidden"
          >
            <div class="absolute top-0 right-0 p-4 opacity-10">
              <i data-lucide="home" class="w-24 h-24 text-blue-600"></i>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 relative z-10">
              <p>
                <span class="text-xs font-bold text-slate-400 uppercase"
                  >বাড়ির নাম</span
                ><br /><span
                  id="detail-common-name"
                  class="text-lg font-bold text-slate-800"
                ></span>
              </p>
              <p>
                <span class="text-xs font-bold text-slate-400 uppercase"
                  >মালিক</span
                ><br /><span
                  id="detail-owner-name"
                  class="text-slate-700 font-medium"
                ></span>
              </p>
              <!-- FIXED: Added the missing Father's Name field -->
              <p>
                <span class="text-xs font-bold text-slate-400 uppercase"
                  >পিতার নাম</span
                ><br /><span
                  id="detail-owner-father"
                  class="text-slate-700"
                ></span>
              </p>

              <p>
                <span class="text-xs font-bold text-slate-400 uppercase"
                  >হোল্ডিং নং</span
                ><br /><span
                  id="detail-holding-no"
                  class="text-slate-700"
                ></span>
              </p>
              <p>
                <span class="text-xs font-bold text-slate-400 uppercase"
                  >মোবাইল</span
                ><br /><span
                  id="detail-mobile"
                  class="text-slate-700 font-mono"
                ></span>
              </p>
              <p>
                <span class="text-xs font-bold text-slate-400 uppercase"
                  >বংশ</span
                ><br /><span
                  id="detail-bongsho-name"
                  class="text-slate-700"
                ></span>
              </p>
              <p>
                <span class="text-xs font-bold text-slate-400 uppercase"
                  >গ্রাম</span
                ><br /><span id="detail-area" class="text-slate-700"></span>
              </p>
            </div>
            <div class="mt-4 text-right">
              <button
                id="details-edit-household-btn"
                class="text-sm bg-white border border-blue-200 text-blue-600 px-4 py-2 rounded-lg font-medium hover:bg-blue-50 transition"
              >
                সম্পাদনা করুন
              </button>
            </div>
          </div>

          <div class="flex justify-between items-center mb-4">
            <h4 class="font-bold text-slate-700">সদস্য তালিকা</h4>
            <button
              id="open-add-member-modal-btn"
              class="text-sm bg-emerald-600 text-white px-3 py-1.5 rounded-lg hover:bg-emerald-700 transition flex items-center gap-1"
            >
              <i data-lucide="plus" class="w-4 h-4"></i> নতুন সদস্য
            </button>
          </div>
          <div id="family-member-list" class="space-y-3">
            <!-- List Items -->
          </div>
        </div>
      </div>
    </div>

    <!-- Dropdown Modal -->
    <div
      id="add-dropdown-option-modal"
      class="modal fixed inset-0 bg-slate-900/40 backdrop-blur-sm flex items-center justify-center p-4 hidden z-[60] hidden-transition"
    >
      <div
        class="modal-content bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6"
      >
        <h3
          id="dropdown-modal-title"
          class="text-lg font-bold text-slate-800 mb-4"
        >
          নতুন অপশন
        </h3>
        <input
          type="text"
          id="dropdown-new-value"
          class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 mb-4 focus:bg-white"
          placeholder="নাম..."
        />
        <div class="flex justify-end gap-3">
          <button
            id="dropdown-cancel-btn"
            class="px-4 py-2 bg-slate-100 rounded-lg text-sm"
          >
            বাতিল
          </button>
          <button
            id="dropdown-add-btn"
            class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm"
          >
            যোগ
          </button>
        </div>
      </div>
    </div>

    <div
      id="forgot-password-modal"
      class="modal fixed inset-0 bg-slate-900/40 backdrop-blur-sm flex items-center justify-center p-4 hidden z-[60] hidden-transition"
    >
      <div
        class="modal-content bg-white rounded-2xl shadow-2xl w-full max-w-md p-6"
      >
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold text-slate-800">পাসওয়ার্ড রিসেট</h3>
          <button class="modal-close-btn text-slate-400">
            <i data-lucide="x"></i>
          </button>
        </div>
        <form id="forgot-password-form">
          <p class="text-sm text-slate-500 mb-4">
            আপনার ইমেইল দিন, আমরা একটি লিঙ্ক পাঠাবো।
          </p>
          <input
            type="email"
            id="reset-email"
            required
            class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 mb-4"
            placeholder="ইমেইল"
          />
          <button
            type="submit"
            id="forgot-password-submit"
            class="w-full py-3 bg-blue-600 text-white rounded-xl font-bold"
          >
            লিঙ্ক পাঠান
          </button>
        </form>
      </div>
    </div>

    <!-- *********************************************************************************** -->
    <!-- JAVASCRIPT LOGIC (UNCHANGED FROM ORIGINAL) -->
    <!-- *********************************************************************************** -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";
      import {
        getAuth,
        onAuthStateChanged,
        createUserWithEmailAndPassword,
        signInWithEmailAndPassword,
        signOut,
        sendPasswordResetEmail,
        setPersistence,
        browserLocalPersistence,
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
      import {
        getFirestore,
        collection,
        addDoc,
        doc,
        setDoc,
        getDoc,
        getDocs,
        deleteDoc,
        updateDoc,
        onSnapshot,
        query,
        setLogLevel,
        Timestamp,
        collectionGroup,
        getCountFromServer,
        writeBatch,
        where,
        limit,
        orderBy,
        arrayUnion,
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCzrawBYP2xHj1sev0FSVJAYch8V7EpuMQ",
        authDomain: "rp-village-management.firebaseapp.com",
        projectId: "rp-village-management",
        storageBucket: "rp-village-management.firebasestorage.app",
        messagingSenderId: "499504549624",
        appId: "1:499504549624:web:42d9e868493cb2fee4350d",
        measurementId: "G-1YZJRLYN4G",
      };
      const appId = firebaseConfig.projectId || "default-village-app";
      if (!firebaseConfig.apiKey) {
        document.body.innerHTML =
          '<div class="p-8 text-center text-red-600">Firebase কনফিগারেশন ত্রুটিপূর্ণ।</div>';
        throw new Error("Invalid Firebase Config");
      }

      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const auth = getAuth(app);
      const db = getFirestore(app);
      setLogLevel("Debug");

      let currentUserId = null;
      let currentHouseholdId = null;
      let currentHouseholdData = null;
      let householdUnsubscribe = null;
      let familyMemberUnsubscribe = null;
      let populationUnsubscribe = null;
      let noticesUnsubscribe = null;
      let dashboardNoticesUnsubscribe = null;
      let bongshosUnsubscribe = null;
      let populationDataCache = [];
      let householdDataCache = [];
      let bongshoDataCache = [];
      let noticesDataCache = [];
      let dropdownCache = { villages: [], relations: [] };
      let currentDropdownAddingType = null;

      let householdFilters = { search: "", bongsho: "", village: "" };
      let populationFilters = {
        search: "",
        ageMin: "",
        ageMax: "",
        village: "",
        bongsho: "",
      };
      let paginationState = {
        households: { page: 1, limit: 10 },
        population: { page: 1, limit: 50 },
        volunteers: { page: 1, limit: 12 },
        notices: { page: 1, limit: 6 },
      };
      let currentVolType = "all";

      const bongshosCollectionPath = `/artifacts/${appId}/public/data/bongshos`;
      const householdsCollectionPath = `/artifacts/${appId}/public/data/households`;
      const allPeopleCollectionPath = `/artifacts/${appId}/public/data/allPeople`;
      const noticesCollectionPath = `/artifacts/${appId}/public/data/notices`;
      const adminDocPath = `/artifacts/${appId}/public/data/config/administration`;
      const configCollectionPath = `/artifacts/${appId}/public/data/config`;

      const globalLoader = document.getElementById("global-loader");
      const authContainer = document.getElementById("auth-container");
      const appContainer = document.getElementById("app-container");
      const sidebar = document.getElementById("sidebar");
      const openSidebarBtn = document.getElementById("open-sidebar-btn");
      const closeSidebarBtn = document.getElementById("close-sidebar-btn");
      const loginForm = document.getElementById("login-form");
      const signupForm = document.getElementById("signup-form");
      const showLoginTab = document.getElementById("show-login-tab");
      const showSignupTab = document.getElementById("show-signup-tab");
      const authError = document.getElementById("auth-error");
      const logoutButton = document.getElementById("logout-button");
      const userEmailDisplay = document.getElementById("user-email-display");
      const forgotPasswordLink = document.getElementById(
        "forgot-password-link"
      );
      const forgotPasswordModal = document.getElementById(
        "forgot-password-modal"
      );
      const forgotPasswordForm = document.getElementById(
        "forgot-password-form"
      );
      const forgotPasswordSubmit = document.getElementById(
        "forgot-password-submit"
      );
      const pageContents = document.querySelectorAll(".page-content");
      const sidebarLinks = document.querySelectorAll(".sidebar-link");
      const statTotalBongshos = document.getElementById("stat-total-bongshos");
      const statTotalHouseholds = document.getElementById(
        "stat-total-households"
      );
      const statTotalPopulation = document.getElementById(
        "stat-total-population"
      );
      const statTotalNotices = document.getElementById("stat-total-notices");
      const dashboardRecentNotices = document.getElementById(
        "dashboard-recent-notices"
      );
      const dashboardNoticesLoading = document.getElementById(
        "dashboard-notices-loading"
      );
      const dashboardCurrentDate = document.getElementById(
        "dashboard-current-date"
      );
      const dashAdminChairman = document.getElementById("dash-admin-chairman");
      const dashAdminChairmanCall = document.getElementById(
        "dash-admin-chairman-call"
      );
      const dashAdminMember = document.getElementById("dash-admin-member");
      const dashAdminMemberCall = document.getElementById(
        "dash-admin-member-call"
      );
      const dashAdminPolice = document.getElementById("dash-admin-police");
      const dashAdminPoliceCall = document.getElementById(
        "dash-admin-police-call"
      );
      const dashboardRecentActivity = document.getElementById(
        "dashboard-recent-activity"
      );
      const ageStatChild = document.getElementById("age-stat-child");
      const ageStatAdult = document.getElementById("age-stat-adult");
      const ageStatSenior = document.getElementById("age-stat-senior");
      const barChild = document.getElementById("bar-child");
      const barAdult = document.getElementById("bar-adult");
      const barSenior = document.getElementById("bar-senior");
      const statTotalVolunteers = document.getElementById(
        "stat-total-volunteers"
      );

      window.handleDashboardSearch = function (query) {
        if (query.length > 1) {
          showPage("page-population");
          document.getElementById("filter-pop-search").value = query;
          applyPopulationFilters();
        }
      };

      const addBongshoBtn = document.getElementById("add-bongsho-btn");
      const addBongshoModal = document.getElementById("add-bongsho-modal");
      const addBongshoForm = document.getElementById("add-bongsho-form");
      const bongshoModalTitle = document.getElementById("bongsho-modal-title");
      const bongshoFormSubmit = document.getElementById("bongsho-form-submit");
      const bongshoList = document.getElementById("bongsho-list");
      const bongshoSearch = document.getElementById("bongsho-search");
      const addHouseholdBtn = document.getElementById("add-household-btn");
      const addHouseholdModal = document.getElementById("add-household-modal");
      const addHouseholdForm = document.getElementById("add-household-form");
      const householdModalTitle = document.getElementById(
        "household-modal-title"
      );
      const householdFormSubmit = document.getElementById(
        "household-form-submit"
      );
      const householdList = document.getElementById("household-list");
      const householdBongshoSelect = document.getElementById(
        "household-bongsho"
      );
      const householdAreaSelect = document.getElementById("household-area");
      const addAreaBtn = document.getElementById("add-area-btn");
      const filterHouseholdSearch = document.getElementById(
        "filter-household-search"
      );
      const filterHouseholdBongsho = document.getElementById(
        "filter-household-bongsho"
      );
      const filterHouseholdVillage = document.getElementById(
        "filter-household-village"
      );
      const householdDetailsModal = document.getElementById(
        "household-details-modal"
      );
      const detailCommonName = document.getElementById("detail-common-name");
      const detailHoldingNo = document.getElementById("detail-holding-no");
      const detailBongshoName = document.getElementById("detail-bongsho-name");
      const detailOwnerName = document.getElementById("detail-owner-name");
      const detailOwnerFather = document.getElementById("detail-owner-father");
      const detailArea = document.getElementById("detail-area");
      const detailMobile = document.getElementById("detail-mobile");
      const detailsModalTitle = document.getElementById("details-modal-title");
      const detailsEditHouseholdBtn = document.getElementById(
        "details-edit-household-btn"
      );
      const familyMemberList = document.getElementById("family-member-list");
      const openAddMemberModalBtn = document.getElementById(
        "open-add-member-modal-btn"
      );
      const addMemberModal = document.getElementById("add-member-modal");
      const addMemberForm = document.getElementById("add-member-form");
      const memberModalTitle = document.getElementById("member-modal-title");
      const memberFormSubmit = document.getElementById("member-form-submit");
      const memberRelationSelect = document.getElementById("member-relation");
      const addRelationBtn = document.getElementById("add-relation-btn");
      const addDropdownOptionModal = document.getElementById(
        "add-dropdown-option-modal"
      );
      const dropdownModalTitle = document.getElementById(
        "dropdown-modal-title"
      );
      const dropdownInputLabel = document.getElementById(
        "dropdown-input-label"
      );
      const dropdownNewValue = document.getElementById("dropdown-new-value");
      const dropdownCancelBtn = document.getElementById("dropdown-cancel-btn");
      const dropdownAddBtn = document.getElementById("dropdown-add-btn");
      const populationList = document.getElementById("population-list");
      const exportCsvBtn = document.getElementById("export-csv-btn");
      const sortableThs = document.querySelectorAll(".sortable-th");
      const filterPopSearch = document.getElementById("filter-pop-search");
      const filterPopAgeMin = document.getElementById("filter-pop-age-min");
      const filterPopAgeMax = document.getElementById("filter-pop-age-max");
      const filterPopVillage = document.getElementById("filter-pop-village");
      const filterPopBongsho = document.getElementById("filter-pop-bongsho");
      const addNoticeBtn = document.getElementById("add-notice-btn");
      const addNoticeModal = document.getElementById("add-notice-modal");
      const addNoticeForm = document.getElementById("add-notice-form");
      const noticeModalTitle = document.getElementById("notice-modal-title");
      const noticeFormSubmit = document.getElementById("notice-form-submit");
      const noticeList = document.getElementById("notice-list");
      const noticeListLoading = document.getElementById("notice-list-loading");
      const volunteerGrid = document.getElementById("volunteer-grid");
      const volunteerFilters = document.getElementById("volunteer-filters");
      const filterVolBloodGroup = document.getElementById(
        "filter-vol-blood-group"
      );
      const adminInfoForm = document.getElementById("admin-info-form");
      const adminSubmitBtn = document.getElementById("admin-submit-btn");
      const allModals = document.querySelectorAll(".modal");
      const modalCloseBtns = document.querySelectorAll(".modal-close-btn");
      const toastNotification = document.getElementById("toast-notification");
      const toastMessage = document.getElementById("toast-message");
      let confirmationModal = document.getElementById("confirmation-modal");
      let confirmTitle = document.getElementById("confirm-title");
      let confirmMessage = document.getElementById("confirm-message");
      let confirmCancelBtn = document.getElementById("confirm-cancel-btn");
      let confirmDeleteBtn = document.getElementById("confirm-delete-btn");

      window.toggleFilter = function (panelId) {
        const panel = document.getElementById(panelId);
        if (panel.classList.contains("hidden")) {
          panel.classList.remove("hidden");
        } else {
          panel.classList.add("hidden");
        }
      };

      function showLoader(show) {
        if (show) {
          globalLoader.classList.remove("hidden-transition");
        } else {
          globalLoader.classList.add("hidden-transition");
        }
      }
      function showToast(message, isError = false) {
        toastMessage.textContent = message;
        toastNotification.classList.remove(
          "hidden-transition",
          "translate-y-20",
          "opacity-0"
        );
        setTimeout(
          () => toastNotification.classList.add("translate-y-20", "opacity-0"),
          3000
        );
      }
      function toggleModal(modal, show) {
        const modalContent = modal.querySelector(".modal-content");
        if (show) {
          modal.classList.remove("hidden");
          setTimeout(() => {
            modal.classList.remove("hidden-transition");
            if (modalContent) modalContent.classList.remove("scale-95");
          }, 20);
        } else {
          modal.classList.add("hidden-transition");
          if (modalContent) modalContent.classList.add("scale-95");
          setTimeout(() => {
            modal.classList.add("hidden");
          }, 250);
        }
      }
      function showConfirmationModal(title, message, onConfirm) {
        confirmTitle.textContent = title;
        confirmMessage.textContent = message;
        toggleModal(confirmationModal, true);
        confirmDeleteBtn = document.getElementById("confirm-delete-btn");
        confirmCancelBtn = document.getElementById("confirm-cancel-btn");
        const newDeleteBtn = confirmDeleteBtn.cloneNode(true);
        confirmDeleteBtn.parentNode.replaceChild(
          newDeleteBtn,
          confirmDeleteBtn
        );
        confirmDeleteBtn = newDeleteBtn;
        confirmDeleteBtn.onclick = () => {
          onConfirm();
          toggleModal(confirmationModal, false);
        };
        confirmCancelBtn.onclick = () => {
          toggleModal(confirmationModal, false);
        };
      }
      function toggleSidebar(show) {
        if (show) {
          sidebar.classList.remove("-translate-x-full");
        } else {
          sidebar.classList.add("-translate-x-full");
        }
      }
      function showAuthError(message) {
        document.querySelector(".auth-error-text").textContent = message;
        authError.classList.remove("hidden");
      }
      function getFriendlyAuthError(error) {
        switch (error.code) {
          case "auth/invalid-email":
            return "অনুগ্রহ করে একটি সঠিক ইমেইল লিখুন।";
          case "auth/user-not-found":
          case "auth/wrong-password":
            return "ইমেইল বা পাসওয়ার্ড ভুল হয়েছে।";
          default:
            return "একটি অজানা ত্রুটি ঘটেছে।";
        }
      }

      window.showPage = function (pageId) {
        pageContents.forEach((page) => page.classList.add("hidden"));
        const targetPage = document.getElementById(pageId);
        if (targetPage) targetPage.classList.remove("hidden");
        sidebarLinks.forEach((link) => {
          if (link.dataset.page === pageId) {
            link.classList.add("active");
          } else {
            link.classList.remove("active");
          }
        });
        if (pageId === "page-volunteers") {
          window.filterVolunteers("all");
        }
        if (window.innerWidth < 768) {
          toggleSidebar(false);
        }
        document.getElementById("main-content").scrollTop = 0;
      };

      setPersistence(auth, browserLocalPersistence);

      onAuthStateChanged(auth, (user) => {
        showLoader(true);
        if (user) {
          currentUserId = user.uid;
          userEmailDisplay.textContent = user.email;
          authContainer.classList.add("hidden");
          appContainer.classList.remove("hidden");
          loadBongshos();
          loadHouseholds();
          loadDashboardStats();
          loadAllPeople();
          loadNotices();
          loadAdminInfo();
          loadRecentDashboardNotices();
          loadDropdownOptions();
          const dateOptions = {
            weekday: "long",
            year: "numeric",
            month: "long",
            day: "numeric",
          };
          dashboardCurrentDate.textContent = new Date().toLocaleDateString(
            "bn-BD",
            dateOptions
          );
          showPage("page-dashboard");
          lucide.createIcons();
          showLoader(false);
        } else {
          currentUserId = null;
          authContainer.classList.remove("hidden");
          appContainer.classList.add("hidden");
          if (householdUnsubscribe) householdUnsubscribe();
          if (familyMemberUnsubscribe) familyMemberUnsubscribe();
          if (populationUnsubscribe) populationUnsubscribe();
          if (noticesUnsubscribe) noticesUnsubscribe();
          if (dashboardNoticesUnsubscribe) dashboardNoticesUnsubscribe();
          if (bongshosUnsubscribe) bongshosUnsubscribe();
          lucide.createIcons();
          showLoader(false);
        }
      });

      loginForm.addEventListener("submit", (e) => {
        e.preventDefault();
        showLoader(true);
        signInWithEmailAndPassword(
          auth,
          loginForm["login-email"].value,
          loginForm["login-password"].value
        ).catch((error) => {
          showAuthError(getFriendlyAuthError(error));
          showLoader(false);
        });
      });
      signupForm.addEventListener("submit", (e) => {
        e.preventDefault();
        showLoader(true);
        createUserWithEmailAndPassword(
          auth,
          signupForm["signup-email"].value,
          signupForm["signup-password"].value
        ).catch((error) => {
          showAuthError(getFriendlyAuthError(error));
          showLoader(false);
        });
      });
      logoutButton.addEventListener("click", () => {
        showLoader(true);
        signOut(auth);
      });
      forgotPasswordLink.addEventListener("click", (e) => {
        e.preventDefault();
        authError.classList.add("hidden");
        forgotPasswordForm.reset();
        toggleModal(forgotPasswordModal, true);
      });
      forgotPasswordForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const email = document.getElementById("reset-email").value;
        forgotPasswordSubmit.disabled = true;
        forgotPasswordSubmit.textContent = "পাঠানো হচ্ছে...";
        try {
          await sendPasswordResetEmail(auth, email);
          toggleModal(forgotPasswordModal, false);
          showToast("রিসেট লিঙ্ক পাঠানো হয়েছে।");
        } catch (error) {
          showToast(getFriendlyAuthError(error), true);
        } finally {
          forgotPasswordSubmit.disabled = false;
          forgotPasswordSubmit.textContent = "রিসেট লিঙ্ক পাঠান";
        }
      });
      showLoginTab.addEventListener("click", () => {
        loginForm.classList.remove("hidden");
        signupForm.classList.add("hidden");
        showLoginTab.classList.add("text-blue-600", "bg-white", "shadow-sm");
        showLoginTab.classList.remove("text-slate-500");
        showSignupTab.classList.add("text-slate-500");
        showSignupTab.classList.remove(
          "text-blue-600",
          "bg-white",
          "shadow-sm"
        );
        authError.classList.add("hidden");
      });
      showSignupTab.addEventListener("click", () => {
        loginForm.classList.add("hidden");
        signupForm.classList.remove("hidden");
        showLoginTab.classList.remove("text-blue-600", "bg-white", "shadow-sm");
        showLoginTab.classList.add("text-slate-500");
        showSignupTab.classList.remove("text-slate-500");
        showSignupTab.classList.add("text-blue-600", "bg-white", "shadow-sm");
        authError.classList.add("hidden");
      });

      async function loadDashboardStats() {
        try {
          const bongshosRef = collection(db, bongshosCollectionPath);
          const bongshosSnapshot = await getCountFromServer(bongshosRef);
          statTotalBongshos.textContent = `${bongshosSnapshot.data().count}`;
          const householdsRef = collection(db, householdsCollectionPath);
          const householdsSnapshot = await getCountFromServer(householdsRef);
          statTotalHouseholds.textContent = `${
            householdsSnapshot.data().count
          }`;
          const peopleRef = collection(db, allPeopleCollectionPath);
          const peopleSnapshot = await getCountFromServer(peopleRef);
          statTotalPopulation.textContent = `${peopleSnapshot.data().count}`;
          const noticesRef = collection(db, noticesCollectionPath);
          const noticesSnapshot = await getCountFromServer(noticesRef);
          // statTotalNotices.textContent = `${noticesSnapshot.data().count}`; // Removed from UI in this design
        } catch (error) {
          console.error("Error stats", error);
        }
      }

      function loadRecentDashboardNotices() {
        if (dashboardNoticesUnsubscribe) dashboardNoticesUnsubscribe();
        const q = query(
          collection(db, noticesCollectionPath),
          orderBy("date", "desc"),
          limit(3)
        );
        dashboardNoticesUnsubscribe = onSnapshot(q, (snapshot) => {
          dashboardRecentNotices.innerHTML = "";
          if (snapshot.empty) {
            dashboardNoticesLoading.textContent = "কোনো নোটিশ নেই।";
            dashboardRecentNotices.appendChild(dashboardNoticesLoading);
            return;
          }
          snapshot.docs.forEach((doc) => {
            const data = doc.data();
            const item = document.createElement("div");
            item.className =
              "bg-white p-4 rounded-xl shadow-sm border border-slate-100";
            item.innerHTML = `<div class="flex items-start gap-3"><div class="p-2 bg-amber-50 rounded-lg text-amber-500"><i data-lucide="megaphone" class="w-4 h-4"></i></div><div><h5 class="font-semibold text-slate-800 text-sm">${
              data.title
            }</h5><p class="text-xs text-slate-400 mb-1 mt-0.5">${data.date
              .toDate()
              .toLocaleDateString(
                "bn-BD"
              )}</p><p class="text-sm text-slate-600 line-clamp-2">${
              data.details
            }</p></div></div>`;
            dashboardRecentNotices.appendChild(item);
          });
          lucide.createIcons();
        });
      }

      function updateDashboardRecentActivity() {
        if (!householdDataCache || householdDataCache.length === 0) {
          dashboardRecentActivity.innerHTML =
            '<p class="p-6 text-center text-slate-400 text-sm">কোনো তথ্য পাওয়া যায়নি।</p>';
          return;
        }
        const recentItems = householdDataCache.slice(0, 5);
        dashboardRecentActivity.innerHTML = "";
        recentItems.forEach((item) => {
          const div = document.createElement("div");
          div.className =
            "px-6 py-3 flex items-center justify-between hover:bg-slate-50 transition group";
          div.innerHTML = `<div class="flex items-center gap-3"><div class="bg-blue-50 text-blue-600 p-2 rounded-lg"><i data-lucide="home" class="w-4 h-4"></i></div><div><p class="text-sm font-medium text-slate-800 group-hover:text-blue-600 transition">${
            item.commonName || "N/A"
          }</p><p class="text-xs text-slate-500">মালিক: ${
            item.ownerName
          }</p></div></div><span class="text-xs text-slate-400 whitespace-nowrap bg-slate-100 px-2 py-1 rounded">${
            item.createdAt
              ? item.createdAt.toDate().toLocaleDateString("bn-BD")
              : ""
          }</span>`;
          dashboardRecentActivity.appendChild(div);
        });
        lucide.createIcons();
      }

      function updateAgeDemographics(allPeople) {
        let child = 0,
          adult = 0,
          senior = 0;
        const currentYear = new Date().getFullYear();
        let counted = 0;
        let volunteerCount = 0;
        allPeople.forEach((person) => {
          if (person.dob) {
            const birthYear = new Date(person.dob).getFullYear();
            const age = currentYear - birthYear;
            if (!isNaN(age)) {
              counted++;
              if (age < 18) child++;
              else if (age >= 18 && age < 60) adult++;
              else senior++;
            }
          }
          if (
            person.isDonor ||
            (person.volunteerServices && person.volunteerServices.length > 0)
          ) {
            volunteerCount++;
          }
        });
        statTotalVolunteers.textContent = volunteerCount;
        ageStatChild.textContent = 0;
        barChild.style.width = "0%";
        ageStatAdult.textContent = 0;
        barAdult.style.width = "0%";
        ageStatSenior.textContent = 0;
        barSenior.style.width = "0%";
        if (counted === 0) return;
        ageStatChild.textContent = child;
        ageStatAdult.textContent = adult;
        ageStatSenior.textContent = senior;
        const total = child + adult + senior;
        setTimeout(() => {
          barChild.style.width = `${(child / total) * 100}%`;
          barAdult.style.width = `${(adult / total) * 100}%`;
          barSenior.style.width = `${(senior / total) * 100}%`;
        }, 100);
      }

      function loadBongshos() {
        if (bongshosUnsubscribe) bongshosUnsubscribe();
        const q = query(
          collection(db, bongshosCollectionPath),
          orderBy("name", "asc")
        );
        bongshosUnsubscribe = onSnapshot(q, (snapshot) => {
          if (snapshot.empty) {
            bongshoList.innerHTML =
              '<tr><td colspan="4" class="p-8 text-center text-slate-400">কোনো বংশ যোগ করা হয়নি।</td></tr>';
            bongshoDataCache = [];
            populateBongshoDropdown([]);
            populateFilterDropdowns();
            return;
          }
          const docs = snapshot.docs.map((doc) => ({
            id: doc.id,
            ...doc.data(),
          }));
          bongshoDataCache = docs;
          populateBongshoDropdown(docs);
          updateBongshoListWithCounts();
          populateFilterDropdowns();
        });
      }
      function updateBongshoListWithCounts() {
        if (!bongshoDataCache.length) return;
        const householdCounts = {};
        for (const household of householdDataCache) {
          const bongshoId = household.bongshoId;
          if (bongshoId) {
            householdCounts[bongshoId] = (householdCounts[bongshoId] || 0) + 1;
          }
        }
        const bongshosWithCounts = bongshoDataCache.map((bongsho) => ({
          ...bongsho,
          householdCount: householdCounts[bongsho.id] || 0,
        }));
        bongshoDataCache = bongshosWithCounts;
        const searchTerm = bongshoSearch.value.toLowerCase();
        const filteredDocs = bongshosWithCounts.filter((data) => {
          const name = (data.name || "").toLowerCase();
          const desc = (data.description || "").toLowerCase();
          return name.includes(searchTerm) || desc.includes(searchTerm);
        });
        renderBongshoTable(filteredDocs);
      }
      function renderBongshoTable(docs) {
        bongshoList.innerHTML = "";
        if (docs.length === 0) {
          bongshoList.innerHTML =
            '<tr><td colspan="4" class="p-8 text-center text-slate-400">কোনো ফলাফল পাওয়া যায়নি।</td></tr>';
          return;
        }
        docs.forEach((data) => {
          const docId = data.id;
          const tr = document.createElement("tr");
          tr.className =
            "hover:bg-slate-50 transition border-b border-slate-50";
          tr.innerHTML = `<td class="p-4 font-medium text-slate-800">${
            data.name
          }</td><td class="p-4 text-slate-500 max-w-sm truncate" title="${
            data.description || ""
          }">${
            data.description || "N/A"
          }</td><td class="p-4 text-slate-600"><span class="bg-slate-100 px-2 py-1 rounded text-xs font-bold">${
            data.householdCount || 0
          } টি</span></td><td class="p-4 text-right space-x-2"><button class="bg-amber-50 text-amber-600 p-2 rounded-lg hover:bg-amber-100 transition" data-action="edit" title="সম্পাদনা"><i data-lucide="pencil" class="w-4 h-4"></i></button><button class="bg-red-50 text-red-600 p-2 rounded-lg hover:bg-red-100 transition" data-action="delete" title="মুছুন"><i data-lucide="trash-2" class="w-4 h-4"></i></button></td>`;
          tr.querySelector('button[data-action="edit"]').addEventListener(
            "click",
            () => {
              openBongshoModalForEdit(docId, data);
            }
          );
          tr.querySelector('button[data-action="delete"]').addEventListener(
            "click",
            () => {
              deleteBongsho(docId, data.name);
            }
          );
          bongshoList.appendChild(tr);
        });
        lucide.createIcons();
      }
      bongshoSearch.addEventListener("input", () => {
        updateBongshoListWithCounts();
      });
      function populateBongshoDropdown(docs) {
        householdBongshoSelect.innerHTML =
          '<option value="">-- বংশ নির্বাচন করুন --</option>';
        docs.forEach((bongsho) => {
          householdBongshoSelect.innerHTML += `<option value="${bongsho.id}">${bongsho.name}</option>`;
        });
      }
      addBongshoBtn.addEventListener("click", () => {
        addBongshoForm.reset();
        bongshoModalTitle.textContent = "নতুন বংশ";
        bongshoFormSubmit.textContent = "বংশ সংরক্ষণ করুন";
        document.getElementById("bongsho-id").value = "";
        toggleModal(addBongshoModal, true);
      });
      function openBongshoModalForEdit(docId, data) {
        addBongshoForm.reset();
        bongshoModalTitle.textContent = "বংশ সম্পাদনা করুন";
        bongshoFormSubmit.textContent = "আপডেট করুন";
        document.getElementById("bongsho-id").value = docId;
        document.getElementById("bongsho-name").value = data.name;
        document.getElementById("bongsho-description").value =
          data.description || "";
        toggleModal(addBongshoModal, true);
      }
      addBongshoForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        bongshoFormSubmit.disabled = true;
        showLoader(true);
        const bongshoId = document.getElementById("bongsho-id").value;
        const data = {
          name: document.getElementById("bongsho-name").value,
          description: document.getElementById("bongsho-description").value,
          lastUpdatedAt: Timestamp.now(),
        };
        try {
          if (bongshoId) {
            await setDoc(doc(db, bongshosCollectionPath, bongshoId), data, {
              merge: true,
            });
            showToast("বংশ সফলভাবে আপডেট করা হয়েছে।");
          } else {
            data.createdAt = Timestamp.now();
            data.name_lowercase = data.name.toLowerCase();
            await addDoc(collection(db, bongshosCollectionPath), data);
            showToast("বংশ সফলভাবে পোস্ট করা হয়েছে।");
            loadDashboardStats();
          }
          toggleModal(addBongshoModal, false);
        } catch (error) {
          showToast("বংশ পোস্ট/আপডেট করার সময় ত্রুটি।", true);
        } finally {
          showLoader(false);
          bongshoFormSubmit.disabled = false;
        }
      });
      async function deleteBongsho(docId, name) {
        const bongshoToDelete = bongshoDataCache.find((b) => b.id === docId);
        showConfirmationModal(
          "বংশ মুছুন?",
          `আপনি কি "${name}" বংশটি মুছে ফেলতে নিশ্চিত?`,
          async () => {
            if (bongshoToDelete && bongshoToDelete.householdCount > 0) {
              showToast(
                `এই বংশ মোছা যাবে না। ${bongshoToDelete.householdCount} টি হোল্ডিং এখনো এই বংশের অধীনে আছে।`,
                true
              );
              return;
            }
            showLoader(true);
            try {
              await deleteDoc(doc(db, bongshosCollectionPath, docId));
              showToast("বংশ সফলভাবে মুছে ফেলা হয়েছে।");
              loadDashboardStats();
            } catch (error) {
              showToast("বংশ মোছার সময় একটি ত্রুটি হয়েছে।", true);
            } finally {
              showLoader(false);
            }
          }
        );
      }

      async function loadDropdownOptions() {
        const villagesRef = doc(
          db,
          `${configCollectionPath}/dropdowns_villages`
        );
        const relationsRef = doc(
          db,
          `${configCollectionPath}/dropdowns_relations`
        );
        onSnapshot(villagesRef, (doc) => {
          if (doc.exists()) {
            dropdownCache.villages = doc.data().options || [];
            renderDropdown("villages");
            populateFilterDropdowns();
          }
        });
        onSnapshot(relationsRef, (doc) => {
          if (doc.exists()) {
            dropdownCache.relations = doc.data().options || [];
            renderDropdown("relations");
          }
        });
      }
      function renderDropdown(type) {
        let selectElement, options, defaultText;
        if (type === "villages") {
          selectElement = householdAreaSelect;
          options = dropdownCache.villages;
          defaultText = "-- পাড়া নির্বাচন করুন --";
        } else if (type === "relations") {
          selectElement = memberRelationSelect;
          options = dropdownCache.relations;
          defaultText = "-- সম্পর্ক নির্বাচন করুন --";
        }
        if (!selectElement) return;
        const currentValue = selectElement.value;
        selectElement.innerHTML = `<option value="">${defaultText}</option>`;
        options.sort().forEach((opt) => {
          selectElement.innerHTML += `<option value="${opt}">${opt}</option>`;
        });
        if (currentValue && options.includes(currentValue)) {
          selectElement.value = currentValue;
        }
      }
      function populateFilterDropdowns() {
        const villages = dropdownCache.villages || [];
        const villageOptionsHtml =
          '<option value="">-- সব গ্রাম/পাড়া --</option>' +
          villages.map((v) => `<option value="${v}">${v}</option>`).join("");
        document.getElementById(
          "filter-household-village"
        ).innerHTML = villageOptionsHtml;
        document.getElementById(
          "filter-pop-village"
        ).innerHTML = villageOptionsHtml;
        const bongshoOptionsHtml =
          '<option value="">-- সব বংশ --</option>' +
          bongshoDataCache
            .map((b) => `<option value="${b.id}">${b.name}</option>`)
            .join("");
        document.getElementById(
          "filter-household-bongsho"
        ).innerHTML = bongshoOptionsHtml;
        const bongshoPopOptionsHtml =
          '<option value="">-- সব বংশ --</option>' +
          bongshoDataCache
            .map((b) => `<option value="${b.name}">${b.name}</option>`)
            .join("");
        document.getElementById(
          "filter-pop-bongsho"
        ).innerHTML = bongshoPopOptionsHtml;
      }
      function openDropdownModal(type) {
        currentDropdownAddingType = type;
        dropdownNewValue.value = "";
        dropdownModalTitle.textContent =
          type === "villages" ? "নতুন পাড়া যোগ করুন" : "নতুন সম্পর্ক যোগ করুন";
        toggleModal(addDropdownOptionModal, true);
      }
      addAreaBtn.addEventListener("click", () => openDropdownModal("villages"));
      addRelationBtn.addEventListener("click", () =>
        openDropdownModal("relations")
      );
      dropdownCancelBtn.addEventListener("click", () =>
        toggleModal(addDropdownOptionModal, false)
      );
      dropdownAddBtn.addEventListener("click", async () => {
        const val = dropdownNewValue.value.trim();
        if (!val) {
          showToast("অনুগ্রহ করে একটি নাম লিখুন।", true);
          return;
        }
        const docId =
          currentDropdownAddingType === "villages"
            ? "dropdowns_villages"
            : "dropdowns_relations";
        const docRef = doc(db, `${configCollectionPath}/${docId}`);
        dropdownAddBtn.textContent = "যোগ করা হচ্ছে...";
        dropdownAddBtn.disabled = true;
        try {
          await setDoc(docRef, { options: arrayUnion(val) }, { merge: true });
          showToast("সফলভাবে যোগ করা হয়েছে।");
          toggleModal(addDropdownOptionModal, false);
          setTimeout(() => {
            if (currentDropdownAddingType === "villages")
              householdAreaSelect.value = val;
            else if (currentDropdownAddingType === "relations")
              memberRelationSelect.value = val;
          }, 500);
        } catch (err) {
          showToast("যোগ করার সময় ত্রুটি হয়েছে।", true);
        } finally {
          dropdownAddBtn.textContent = "যোগ";
          dropdownAddBtn.disabled = false;
        }
      });

      addHouseholdBtn.addEventListener("click", () => {
        addHouseholdForm.reset();
        householdModalTitle.textContent = "নতুন হোল্ডিং যোগ করুন";
        document.getElementById("household-id").value = "";
        householdFormSubmit.textContent = "সংরক্ষণ করুন";
        toggleModal(addHouseholdModal, true);
      });
      addHouseholdForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        householdFormSubmit.disabled = true;
        showLoader(true);
        const holdingId = document.getElementById("household-id").value;
        const bongshoId = householdBongshoSelect.value;
        const bongshoName =
          householdBongshoSelect.options[householdBongshoSelect.selectedIndex]
            .text;
        const villageAreaVal = document.getElementById("household-area").value;
        const ownerOccupation = document.getElementById(
          "household-owner-occupation"
        ).value;
        const ownerBlood = document.getElementById("household-owner-blood")
          .value;
        const selectedServices = [];
        if (document.getElementById("h-vol-blood").checked)
          selectedServices.push("blood");
        if (document.getElementById("h-vol-money").checked)
          selectedServices.push("money");
        if (document.getElementById("h-vol-education").checked)
          selectedServices.push("education");
        if (document.getElementById("h-vol-health").checked)
          selectedServices.push("health");
        if (document.getElementById("h-vol-social").checked)
          selectedServices.push("social");
        const data = {
          commonName: document.getElementById("household-common-name").value,
          holdingNo: document.getElementById("household-official-no").value,
          ownerName: document.getElementById("household-owner-name").value,
          ownerFatherName: document.getElementById("household-owner-father")
            .value,
          villageArea: villageAreaVal,
          mobile: document.getElementById("household-mobile").value,
          bongshoId: bongshoId,
          bongshoName: bongshoName.includes("--") ? "" : bongshoName,
          lastUpdatedBy: currentUserId,
          lastUpdatedAt: Timestamp.now(),
        };
        try {
          let docRef;
          if (holdingId) {
            docRef = doc(db, householdsCollectionPath, holdingId);
            await setDoc(docRef, data, { merge: true });
            showToast("হোল্ডিং সফলভাবে আপডেট করা হয়েছে।");
          } else {
            const batch = writeBatch(db);
            docRef = doc(collection(db, householdsCollectionPath));
            data.createdBy = currentUserId;
            data.createdAt = Timestamp.now();
            batch.set(docRef, data);
            const newHouseholdId = docRef.id;
            const ownerAsMemberData = {
              name: data.ownerName,
              relation: "বাড়ির প্রধান",
              dob: "",
              nid: "",
              mobile: data.mobile,
              occupation: ownerOccupation,
              bloodGroup: ownerBlood,
              volunteerServices: selectedServices,
              createdAt: Timestamp.now(),
              householdId: newHouseholdId,
              commonName: data.commonName,
              householdNo: data.holdingNo,
              householdOwner: data.ownerName,
              bongshoName: data.bongshoName,
              villageArea: data.villageArea,
            };
            const allPeopleDocRef = doc(
              collection(db, allPeopleCollectionPath)
            );
            batch.set(allPeopleDocRef, ownerAsMemberData);
            ownerAsMemberData.allPeopleDocId = allPeopleDocRef.id;
            const membersSubCollRef = doc(
              collection(
                db,
                `${householdsCollectionPath}/${newHouseholdId}/members`
              )
            );
            batch.set(membersSubCollRef, ownerAsMemberData);
            await batch.commit();
            showToast("হোল্ডিং সফলভাবে যোগ করা হয়েছে।");
          }
          toggleModal(addHouseholdModal, false);
          loadDashboardStats();
        } catch (error) {
          showToast("হোল্ডিং সংরক্ষণ করার সময় ত্রুটি।", true);
        } finally {
          showLoader(false);
          householdFormSubmit.disabled = false;
        }
      });
      function loadHouseholds() {
        if (householdUnsubscribe) householdUnsubscribe();
        const q = query(
          collection(db, householdsCollectionPath),
          orderBy("createdAt", "desc")
        );
        householdUnsubscribe = onSnapshot(
          q,
          (snapshot) => {
            const docs = snapshot.docs.map((doc) => ({
              id: doc.id,
              ...doc.data(),
            }));
            householdDataCache = docs;
            applyHouseholdFilters();
            updateBongshoListWithCounts();
            updateDashboardRecentActivity();
          },
          (error) => {
            // Error handling silent
            householdDataCache = [];
          }
        );
      }
      window.applyHouseholdFilters = function () {
        const searchTerm = document
          .getElementById("filter-household-search")
          .value.toLowerCase();
        const bongshoFilter = document.getElementById(
          "filter-household-bongsho"
        ).value;
        const villageFilter = document.getElementById(
          "filter-household-village"
        ).value;
        householdFilters = {
          search: searchTerm,
          bongsho: bongshoFilter,
          village: villageFilter,
        };
        paginationState.households.page = 1;
        renderFilteredHouseholds();
      };
      window.resetHouseholdFilters = function () {
        document.getElementById("filter-household-search").value = "";
        document.getElementById("filter-household-bongsho").value = "";
        document.getElementById("filter-household-village").value = "";
        applyHouseholdFilters();
      };
      window.changePage = function (type, delta) {
        if (type === "households") {
          paginationState.households.page += delta;
          renderFilteredHouseholds();
        } else if (type === "population") {
          paginationState.population.page += delta;
          renderFilteredPopulation();
        } else if (type === "volunteers") {
          paginationState.volunteers.page += delta;
          window.filterVolunteers(currentVolType);
        } else if (type === "notices") {
          paginationState.notices.page += delta;
          renderNoticesPage();
        }
      };
      window.changeRowsPerPage = function (type, val) {
        if (type === "households") {
          paginationState.households.limit = parseInt(val);
          paginationState.households.page = 1;
          renderFilteredHouseholds();
        } else if (type === "population") {
          paginationState.population.limit = parseInt(val);
          paginationState.population.page = 1;
          renderFilteredPopulation();
        } else if (type === "volunteers") {
          paginationState.volunteers.limit = parseInt(val);
          paginationState.volunteers.page = 1;
          window.filterVolunteers(currentVolType);
        } else if (type === "notices") {
          paginationState.notices.limit = parseInt(val);
          paginationState.notices.page = 1;
          renderNoticesPage();
        }
      };
      function renderFilteredHouseholds() {
        let filtered = householdDataCache.filter((item) => {
          const matchesSearch =
            !householdFilters.search ||
            (item.commonName || "")
              .toLowerCase()
              .includes(householdFilters.search) ||
            (item.ownerName || "")
              .toLowerCase()
              .includes(householdFilters.search) ||
            (item.mobile || "").includes(householdFilters.search) ||
            (item.holdingNo || "")
              .toLowerCase()
              .includes(householdFilters.search);
          const matchesBongsho =
            !householdFilters.bongsho ||
            item.bongshoId === householdFilters.bongsho;
          const matchesVillage =
            !householdFilters.village ||
            item.villageArea === householdFilters.village;
          return matchesSearch && matchesBongsho && matchesVillage;
        });
        filtered.sort((a, b) =>
          (a.commonName || "").localeCompare(b.commonName || "", "bn")
        );
        const totalItems = filtered.length;
        const { page, limit } = paginationState.households;
        const totalPages = Math.ceil(totalItems / limit) || 1;
        if (paginationState.households.page > totalPages)
          paginationState.households.page = totalPages;
        if (paginationState.households.page < 1)
          paginationState.households.page = 1;
        const currentPage = paginationState.households.page;
        const startIndex = (currentPage - 1) * limit;
        const endIndex = startIndex + limit;
        const paginatedData = filtered.slice(startIndex, endIndex);
        document.getElementById(
          "pagination-info-household"
        ).textContent = `Showing ${
          totalItems === 0 ? 0 : startIndex + 1
        } to ${Math.min(endIndex, totalItems)} of ${totalItems}`;
        document.getElementById(
          "page-display-household"
        ).textContent = currentPage;
        document.getElementById("prev-btn-household").disabled =
          currentPage === 1;
        document.getElementById("next-btn-household").disabled =
          currentPage === totalPages;
        renderHouseholdCards(paginatedData);
      }
      function renderHouseholdCards(docs) {
        householdList.innerHTML = "";
        if (docs.length === 0) {
          householdList.innerHTML =
            '<p class="text-center text-slate-400 py-10">কোনো ফলাফল পাওয়া যায়নি।</p>';
          return;
        }
        docs.forEach((data) => {
          const card = document.createElement("div");
          card.className =
            "bg-white rounded-xl shadow-soft border border-slate-100 p-5 hover:shadow-lg transition group";
          card.dataset.id = data.id;
          card.innerHTML = `<div class="flex flex-col sm:flex-row justify-between items-start gap-4"><div class="cursor-pointer flex-1" data-action="details"><div class="flex items-center gap-2 mb-2"><div class="p-1.5 bg-blue-50 text-blue-600 rounded-lg"><i data-lucide="home" class="w-4 h-4"></i></div><h3 class="text-lg font-bold text-slate-800 group-hover:text-blue-600 transition">${
            data.commonName || "N/A"
          }</h3></div><div class="grid grid-cols-2 gap-2 text-sm text-slate-600"><p><span class="font-semibold text-slate-400">প্রধান:</span> ${
            data.ownerName
          }</p><p><span class="font-semibold text-slate-400">বংশ:</span> ${
            data.bongshoName || "N/A"
          }</p><p><span class="font-semibold text-slate-400">হোল্ডিং:</span> ${
            data.holdingNo || "N/A"
          }</p><p><span class="font-semibold text-slate-400">গ্রাম:</span> ${
            data.villageArea || "N/A"
          }</p></div>${
            data.mobile
              ? `<p class="text-xs text-slate-400 mt-2 flex items-center gap-1"><i data-lucide="phone" class="w-3 h-3"></i> ${data.mobile}</p>`
              : ""
          }</div><div class="flex gap-2 items-center flex-shrink-0 opacity-100 md:opacity-0 group-hover:opacity-100 transition"><button class="bg-amber-50 text-amber-600 p-2 rounded-lg hover:bg-amber-100 transition" data-action="edit" title="সম্পাদনা"><i data-lucide="pencil" class="w-4 h-4"></i></button><button class="bg-red-50 text-red-600 p-2 rounded-lg hover:bg-red-100 transition" data-action="delete" title="মুছুন"><i data-lucide="trash-2" class="w-4 h-4"></i></button></div></div>`;
          card.addEventListener("click", (e) => {
            const actionEl = e.target.closest("[data-action]");
            if (actionEl) {
              const action = actionEl.dataset.action;
              if (action === "edit") {
                openHouseholdModalForEdit(data.id, data);
              } else if (action === "delete") {
                deleteHousehold(data.id, data.commonName, data.holdingNo);
              } else if (action === "details") {
                openHouseholdDetails(data);
              }
            }
          });
          householdList.appendChild(card);
        });
        lucide.createIcons();
      }
      function openHouseholdModalForEdit(docId, data) {
        addHouseholdForm.reset();
        householdModalTitle.textContent = "হোল্ডিং সম্পাদনা করুন";
        householdFormSubmit.textContent = "আপডেট করুন";
        document.getElementById("household-id").value = docId;
        document.getElementById("household-common-name").value =
          data.commonName || "";
        document.getElementById("household-official-no").value =
          data.holdingNo || "";
        document.getElementById("household-owner-name").value =
          data.ownerName || "";
        document.getElementById("household-owner-father").value =
          data.ownerFatherName || "";
        document.getElementById("household-area").value =
          data.villageArea || "";
        document.getElementById("household-mobile").value = data.mobile || "";
        document.getElementById("household-bongsho").value =
          data.bongshoId || "";
        document.getElementById("household-owner-occupation").value = "";
        document.getElementById("household-owner-blood").value = "";
        document
          .querySelectorAll('#add-household-form input[type="checkbox"]')
          .forEach((cb) => (cb.checked = false));
        toggleModal(addHouseholdModal, true);
      }
      function deleteHousehold(docId, commonName, holdingNo) {
        showConfirmationModal(
          "হোল্ডিং মুছুন?",
          `আপনি কি "${commonName}" হোল্ডিংটি মুছে ফেলতে নিশ্চিত?`,
          async () => {
            showLoader(true);
            try {
              const batch = writeBatch(db);
              const membersPath = `${householdsCollectionPath}/${docId}/members`;
              const membersQuery = query(collection(db, membersPath));
              const membersSnapshot = await getDocs(membersQuery);
              const allPeopleIdsToDelete = [];
              membersSnapshot.forEach((memberDoc) => {
                batch.delete(memberDoc.ref);
                const allPeopleId = memberDoc.data().allPeopleDocId;
                if (allPeopleId) {
                  allPeopleIdsToDelete.push(allPeopleId);
                }
              });
              allPeopleIdsToDelete.forEach((peopleId) => {
                batch.delete(doc(db, allPeopleCollectionPath, peopleId));
              });
              batch.delete(doc(db, householdsCollectionPath, docId));
              await batch.commit();
              showToast("হোল্ডিং মুছে ফেলা হয়েছে।");
              loadDashboardStats();
            } catch (error) {
              showToast("ত্রুটি হয়েছে।", true);
            } finally {
              showLoader(false);
            }
          }
        );
      }

      function openHouseholdDetails(dataset) {
        currentHouseholdId = dataset.id;
        currentHouseholdData = dataset;
        detailCommonName.textContent = dataset.commonName || "N/A";
        detailHoldingNo.textContent = dataset.holdingNo || "N/A";
        detailBongshoName.textContent = dataset.bongshoName || "N/A";
        detailOwnerName.textContent = dataset.ownerName || "N/A";
        detailOwnerFather.textContent = dataset.ownerFatherName || "N/A";
        detailArea.textContent = dataset.villageArea || "N/A";
        detailMobile.textContent = dataset.mobile || "N/A";
        detailsModalTitle.textContent = `${dataset.commonName}`;
        toggleModal(householdDetailsModal, true);
        loadFamilyMembers(currentHouseholdId);
      }
      detailsEditHouseholdBtn.addEventListener("click", () => {
        toggleModal(householdDetailsModal, false);
        openHouseholdModalForEdit(currentHouseholdId, currentHouseholdData);
      });
      function loadFamilyMembers(householdId) {
        if (familyMemberUnsubscribe) familyMemberUnsubscribe();
        familyMemberList.innerHTML = "";
        familyMemberList.innerHTML =
          '<p class="text-center text-slate-400 py-3">লোড হচ্ছে...</p>';
        const membersPath = `${householdsCollectionPath}/${householdId}/members`;
        const q = query(
          collection(db, membersPath),
          orderBy("createdAt", "asc")
        );
        familyMemberUnsubscribe = onSnapshot(q, (snapshot) => {
          familyMemberList.innerHTML = "";
          if (snapshot.empty) {
            familyMemberList.innerHTML =
              '<p class="text-center text-slate-400 py-3 text-sm">সদস্য নেই।</p>';
            return;
          }
          snapshot.docs.forEach((doc) => {
            const data = doc.data();
            const docId = doc.id;
            let badges = "";
            if (data.bloodGroup) {
              badges += `<span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-bold bg-red-50 text-red-600 mt-1 mr-1">🩸 ${data.bloodGroup}</span>`;
            }
            if (data.volunteerServices && data.volunteerServices.length > 0) {
              // Short badges logic
              badges += `<span class="inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-blue-50 text-blue-600 mt-1 mr-1">স্বেচ্ছাসেবী</span>`;
            } else if (data.isDonor) {
              badges += `<span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-50 text-green-600 mt-1">রক্তদাতা</span>`;
            }
            const div = document.createElement("div");
            div.className =
              "bg-slate-50 rounded-xl p-3 flex justify-between items-center border border-slate-100";
            div.innerHTML = `<div><h5 class="font-semibold text-slate-800">${
              data.name
            }</h5><p class="text-xs text-slate-500">সম্পর্ক: ${
              data.relation
            }</p>${
              data.mobile
                ? `<p class="text-xs text-slate-400">${data.mobile}</p>`
                : ""
            }<div class="flex flex-wrap mt-1">${badges}</div></div><div class="flex gap-2 flex-shrink-0"><button class="bg-white text-amber-600 p-1.5 rounded border border-slate-200 hover:border-amber-300 transition" data-action="edit"><i data-lucide="pencil" class="w-3.5 h-3.5"></i></button><button class="bg-white text-red-600 p-1.5 rounded border border-slate-200 hover:border-red-300 transition" data-action="delete"><i data-lucide="trash-2" class="w-3.5 h-3.5"></i></button></div>`;
            div
              .querySelector('button[data-action="edit"]')
              .addEventListener("click", () => {
                openMemberModalForEdit(docId, data);
              });
            div
              .querySelector('button[data-action="delete"]')
              .addEventListener("click", () => {
                deleteFamilyMember(householdId, docId, data);
              });
            familyMemberList.appendChild(div);
          });
          lucide.createIcons();
        });
      }

      openAddMemberModalBtn.addEventListener("click", () => {
        addMemberForm.reset();
        memberModalTitle.textContent = "নতুন পরিবারের সদস্য";
        memberFormSubmit.textContent = "সদস্য সংরক্ষণ করুন";
        document.getElementById("member-id").value = "";
        toggleModal(addMemberModal, true);
      });
      function openMemberModalForEdit(memberId, data) {
        addMemberForm.reset();
        memberModalTitle.textContent = "সদস্যের তথ্য সম্পাদনা";
        memberFormSubmit.textContent = "আপডেট করুন";
        document.getElementById("member-id").value = memberId;
        document.getElementById("member-name").value = data.name || "";
        document.getElementById("member-relation").value = data.relation || "";
        document.getElementById("member-dob").value = data.dob || "";
        document.getElementById("member-nid").value = data.nid || "";
        document.getElementById("member-mobile").value = data.mobile || "";
        document.getElementById("member-occupation").value =
          data.occupation || "";
        document.getElementById("member-blood").value = data.bloodGroup || "";
        if (data.volunteerServices) {
          document.getElementById(
            "vol-blood"
          ).checked = data.volunteerServices.includes("blood");
          document.getElementById(
            "vol-money"
          ).checked = data.volunteerServices.includes("money");
          document.getElementById(
            "vol-education"
          ).checked = data.volunteerServices.includes("education");
          document.getElementById(
            "vol-health"
          ).checked = data.volunteerServices.includes("health");
          document.getElementById(
            "vol-social"
          ).checked = data.volunteerServices.includes("social");
        } else if (data.isDonor) {
          document.getElementById("vol-blood").checked = true;
        }
        toggleModal(addMemberModal, true);
      }
      addMemberForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        memberFormSubmit.disabled = true;
        showLoader(true);
        if (!currentHouseholdId) {
          showToast("ত্রুটি হয়েছে।", true);
          showLoader(false);
          memberFormSubmit.disabled = false;
          return;
        }
        const memberId = document.getElementById("member-id").value;
        const selectedServices = [];
        if (document.getElementById("vol-blood").checked)
          selectedServices.push("blood");
        if (document.getElementById("vol-money").checked)
          selectedServices.push("money");
        if (document.getElementById("vol-education").checked)
          selectedServices.push("education");
        if (document.getElementById("vol-health").checked)
          selectedServices.push("health");
        if (document.getElementById("vol-social").checked)
          selectedServices.push("social");
        const memberData = {
          name: document.getElementById("member-name").value,
          relation: document.getElementById("member-relation").value,
          dob: document.getElementById("member-dob").value,
          nid: document.getElementById("member-nid").value,
          mobile: document.getElementById("member-mobile").value,
          occupation: document.getElementById("member-occupation").value,
          bloodGroup: document.getElementById("member-blood").value,
          volunteerServices: selectedServices,
        };
        try {
          const householdDataSnap = await getDoc(
            doc(db, householdsCollectionPath, currentHouseholdId)
          );
          const householdData = householdDataSnap.data();
          const allPeopleData = {
            name: memberData.name,
            nid: memberData.nid,
            mobile: memberData.mobile,
            householdId: currentHouseholdId,
            commonName: householdData?.commonName || "N/A",
            householdNo: householdData?.holdingNo || "N/A",
            householdOwner: householdData?.ownerName || "N/A",
            bongshoName: householdData?.bongshoName || "N/A",
            villageArea: householdData?.villageArea || "N/A",
            dob: memberData.dob,
            occupation: memberData.occupation,
            bloodGroup: memberData.bloodGroup,
            volunteerServices: memberData.volunteerServices,
          };
          if (memberId) {
            memberData.lastUpdatedAt = Timestamp.now();
            const memberDocRef = doc(
              db,
              `${householdsCollectionPath}/${currentHouseholdId}/members`,
              memberId
            );
            const existingMemberDoc = await getDoc(memberDocRef);
            const allPeopleDocId = existingMemberDoc.data()?.allPeopleDocId;
            const batch = writeBatch(db);
            batch.update(memberDocRef, memberData);
            if (allPeopleDocId) {
              const allPeopleDocRef = doc(
                db,
                allPeopleCollectionPath,
                allPeopleDocId
              );
              batch.update(allPeopleDocRef, allPeopleData);
            }
            await batch.commit();
            showToast("আপডেট করা হয়েছে।");
          } else {
            memberData.createdAt = Timestamp.now();
            const allPeopleDocRef = await addDoc(
              collection(db, allPeopleCollectionPath),
              allPeopleData
            );
            memberData.allPeopleDocId = allPeopleDocRef.id;
            const membersPath = `${householdsCollectionPath}/${currentHouseholdId}/members`;
            await addDoc(collection(db, membersPath), memberData);
            showToast("সদস্য যোগ করা হয়েছে।");
            loadDashboardStats();
          }
          toggleModal(addMemberModal, false);
        } catch (error) {
          showToast("ত্রুটি হয়েছে।", true);
        } finally {
          showLoader(false);
          memberFormSubmit.disabled = false;
        }
      });
      async function deleteFamilyMember(householdId, memberId, memberData) {
        showConfirmationModal(
          "সদস্য মুছুন?",
          `আপনি কি "${memberData.name}"-কে মুছতে নিশ্চিত?`,
          async () => {
            showLoader(true);
            try {
              const batch = writeBatch(db);
              const memberDocRef = doc(
                db,
                `${householdsCollectionPath}/${householdId}/members`,
                memberId
              );
              batch.delete(memberDocRef);
              if (memberData.allPeopleDocId) {
                const allPeopleDocRef = doc(
                  db,
                  allPeopleCollectionPath,
                  memberData.allPeopleDocId
                );
                batch.delete(allPeopleDocRef);
              } else {
                const q = query(
                  collection(db, allPeopleCollectionPath),
                  where("householdId", "==", householdId),
                  where("nid", "==", memberData.nid),
                  where("name", "==", memberData.name)
                );
                const querySnapshot = await getDocs(q);
                if (!querySnapshot.empty) {
                  batch.delete(querySnapshot.docs[0].ref);
                }
              }
              await batch.commit();
              showToast("সদস্য মুছে ফেলা হয়েছে।");
              loadDashboardStats();
            } catch (error) {
              showToast("ত্রুটি হয়েছে।", true);
            } finally {
              showLoader(false);
            }
          }
        );
      }

      window.filterVolunteers = function (type) {
        currentVolType = type;
        document
          .querySelectorAll("#volunteer-filters button")
          .forEach((btn) => {
            if (btn.dataset.type === type) {
              // Active Style
              btn.classList.add("bg-slate-800", "text-white", "shadow-md");
              btn.classList.remove(
                "bg-white",
                "text-slate-600",
                "hover:bg-rose-50",
                "hover:text-rose-600",
                "hover:bg-emerald-50",
                "hover:text-emerald-600",
                "hover:bg-blue-50",
                "hover:text-blue-600",
                "hover:bg-cyan-50",
                "hover:text-cyan-600",
                "hover:bg-orange-50",
                "hover:text-orange-600"
              );
            } else {
              // Inactive Style
              btn.classList.remove("bg-slate-800", "text-white", "shadow-md");
              btn.classList.add("bg-white", "text-slate-600");
              // Add specific hover colors back
              if (btn.dataset.type === "blood")
                btn.classList.add("hover:bg-rose-50", "hover:text-rose-600");
              else if (btn.dataset.type === "money")
                btn.classList.add(
                  "hover:bg-emerald-50",
                  "hover:text-emerald-600"
                );
              else if (btn.dataset.type === "education")
                btn.classList.add("hover:bg-blue-50", "hover:text-blue-600");
              else if (btn.dataset.type === "health")
                btn.classList.add("hover:bg-cyan-50", "hover:text-cyan-600");
              else if (btn.dataset.type === "social")
                btn.classList.add(
                  "hover:bg-orange-50",
                  "hover:text-orange-600"
                );
            }
          });
        applyVolunteerFilters();
      };

      window.applyVolunteerFilters = function () {
        const selectedBlood = document.getElementById("filter-vol-blood-group")
          .value;
        let volunteers = [];
        if (currentVolType === "all") {
          volunteers = populationDataCache.filter(
            (p) =>
              (p.volunteerServices && p.volunteerServices.length > 0) ||
              p.isDonor
          );
        } else {
          volunteers = populationDataCache.filter((p) => {
            if (
              p.volunteerServices &&
              p.volunteerServices.includes(currentVolType)
            )
              return true;
            if (currentVolType === "blood" && p.isDonor) return true;
            return false;
          });
        }
        if (selectedBlood) {
          volunteers = volunteers.filter((v) => v.bloodGroup === selectedBlood);
        }
        const totalItems = volunteers.length;
        const { page, limit } = paginationState.volunteers;
        const totalPages = Math.ceil(totalItems / limit) || 1;
        if (paginationState.volunteers.page > totalPages)
          paginationState.volunteers.page = totalPages;
        if (paginationState.volunteers.page < 1)
          paginationState.volunteers.page = 1;
        const currentPage = paginationState.volunteers.page;
        const startIndex = (currentPage - 1) * limit;
        const endIndex = startIndex + limit;
        const paginatedData = volunteers.slice(startIndex, endIndex);
        document.getElementById(
          "pagination-info-volunteers"
        ).textContent = `Showing ${
          totalItems === 0 ? 0 : startIndex + 1
        } to ${Math.min(endIndex, totalItems)} of ${totalItems}`;
        document.getElementById(
          "page-display-volunteers"
        ).textContent = currentPage;
        document.getElementById("prev-btn-volunteers").disabled =
          currentPage === 1;
        document.getElementById("next-btn-volunteers").disabled =
          currentPage === totalPages;
        renderVolunteerGrid(paginatedData);
      };

      function renderVolunteerGrid(volunteers) {
        volunteerGrid.innerHTML = "";
        if (volunteers.length === 0) {
          volunteerGrid.innerHTML =
            '<p class="col-span-full text-center text-slate-400 py-8">কোনো স্বেচ্ছাসেবী পাওয়া যায়নি।</p>';
          return;
        }
        volunteers.forEach((v) => {
          let badges = "";
          if (v.volunteerServices) {
            v.volunteerServices.forEach((s) => {
              if (s === "blood")
                badges += `<span class="px-2 py-1 rounded-lg bg-rose-50 text-rose-600 text-xs font-bold">রক্তদান</span>`;
              if (s === "money")
                badges += `<span class="px-2 py-1 rounded-lg bg-emerald-50 text-emerald-600 text-xs font-bold">আর্থিক</span>`;
              if (s === "education")
                badges += `<span class="px-2 py-1 rounded-lg bg-blue-50 text-blue-600 text-xs font-bold">শিক্ষা</span>`;
              if (s === "health")
                badges += `<span class="px-2 py-1 rounded-lg bg-cyan-50 text-cyan-600 text-xs font-bold">চিকিৎসা</span>`;
              if (s === "social")
                badges += `<span class="px-2 py-1 rounded-lg bg-orange-50 text-orange-600 text-xs font-bold">সামাজিক</span>`;
            });
          } else if (v.isDonor) {
            badges += `<span class="px-2 py-1 rounded-lg bg-rose-50 text-rose-600 text-xs font-bold">রক্তদান</span>`;
          }
          const card = document.createElement("div");
          card.className =
            "bg-white rounded-2xl shadow-soft border border-slate-100 p-5 flex flex-col items-center text-center hover:shadow-xl transition group relative overflow-hidden";
          card.innerHTML = `
            <div class="w-16 h-16 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center text-2xl font-bold mb-3 shadow-inner">${v.name.charAt(
              0
            )}</div>
            <h3 class="text-lg font-bold text-slate-800">${v.name}</h3>
            <p class="text-sm text-slate-500 mb-1">${
              v.villageArea || "গ্রাম অজানা"
            }</p>
            ${
              v.bloodGroup
                ? `<span class="mb-3 text-xs font-bold text-white bg-rose-500 px-2 py-1 rounded-lg shadow-md shadow-rose-200">🩸 ${v.bloodGroup}</span>`
                : ""
            }
            <div class="flex flex-wrap justify-center gap-1.5 mb-4 w-full">${badges}</div>
            ${
              v.mobile
                ? `<a href="tel:${v.mobile}" class="mt-auto inline-flex items-center justify-center w-full py-2.5 bg-slate-800 text-white rounded-xl hover:bg-slate-900 transition gap-2 text-sm font-medium"><i data-lucide="phone" class="w-4 h-4"></i> কল করুন</a>`
                : `<span class="mt-auto text-slate-300 text-sm italic">মোবাইল নেই</span>`
            }
          `;
          volunteerGrid.appendChild(card);
        });
        lucide.createIcons();
      }

      function loadAllPeople() {
        if (populationUnsubscribe) populationUnsubscribe();
        const q = query(collection(db, allPeopleCollectionPath));
        populationUnsubscribe = onSnapshot(
          q,
          (snapshot) => {
            if (snapshot.empty) {
              populationList.innerHTML =
                '<tr><td colspan="5" class="p-8 text-center text-slate-400">জনগণ নেই।</td></tr>';
              populationDataCache = [];
              updateAgeDemographics([]);
              return;
            }
            populationDataCache = snapshot.docs.map((doc) => ({
              id: doc.id,
              ...doc.data(),
            }));
            applyPopulationFilters();
            updateAgeDemographics(populationDataCache);
            if (
              !document
                .getElementById("page-volunteers")
                .classList.contains("hidden")
            ) {
              window.filterVolunteers(currentVolType);
            }
          },
          (error) => {
            populationListLoading.classList.add("hidden");
          }
        );
      }
      window.applyPopulationFilters = function () {
        const searchTerm = document
          .getElementById("filter-pop-search")
          .value.toLowerCase();
        const ageMin = document.getElementById("filter-pop-age-min").value;
        const ageMax = document.getElementById("filter-pop-age-max").value;
        const village = document.getElementById("filter-pop-village").value;
        const bongsho = document.getElementById("filter-pop-bongsho").value;
        populationFilters = {
          search: searchTerm,
          ageMin: ageMin,
          ageMax: ageMax,
          village: village,
          bongsho: bongsho,
        };
        paginationState.population.page = 1;
        renderFilteredPopulation();
      };
      window.resetPopulationFilters = function () {
        document.getElementById("filter-pop-search").value = "";
        document.getElementById("filter-pop-age-min").value = "";
        document.getElementById("filter-pop-age-max").value = "";
        document.getElementById("filter-pop-village").value = "";
        document.getElementById("filter-pop-bongsho").value = "";
        applyPopulationFilters();
      };
      function renderFilteredPopulation() {
        const currentYear = new Date().getFullYear();
        let filtered = populationDataCache.filter((item) => {
          const matchesSearch =
            !populationFilters.search ||
            (item.name || "")
              .toLowerCase()
              .includes(populationFilters.search) ||
            (item.nid || "").toLowerCase().includes(populationFilters.search) ||
            (item.mobile || "").includes(populationFilters.search);
          const matchesVillage =
            !populationFilters.village ||
            item.villageArea === populationFilters.village;
          const matchesBongsho =
            !populationFilters.bongsho ||
            item.bongshoName === populationFilters.bongsho;
          let matchesAge = true;
          if (populationFilters.ageMin || populationFilters.ageMax) {
            if (!item.dob) matchesAge = false;
            else {
              const birthYear = new Date(item.dob).getFullYear();
              const age = currentYear - birthYear;
              if (
                populationFilters.ageMin &&
                age < parseInt(populationFilters.ageMin)
              )
                matchesAge = false;
              if (
                populationFilters.ageMax &&
                age > parseInt(populationFilters.ageMax)
              )
                matchesAge = false;
            }
          }
          return (
            matchesSearch && matchesVillage && matchesAge && matchesBongsho
          );
        });
        filtered.sort((a, b) =>
          (a.name || "").localeCompare(b.name || "", "bn")
        );
        const totalItems = filtered.length;
        const { page, limit } = paginationState.population;
        const totalPages = Math.ceil(totalItems / limit) || 1;
        if (paginationState.population.page > totalPages)
          paginationState.population.page = totalPages;
        if (paginationState.population.page < 1)
          paginationState.population.page = 1;
        const currentPage = paginationState.population.page;
        const startIndex = (currentPage - 1) * limit;
        const endIndex = startIndex + limit;
        const paginatedData = filtered.slice(startIndex, endIndex);
        document.getElementById(
          "pagination-info-population"
        ).textContent = `Showing ${
          totalItems === 0 ? 0 : startIndex + 1
        } to ${Math.min(endIndex, totalItems)} of ${totalItems}`;
        document.getElementById(
          "page-display-population"
        ).textContent = currentPage;
        document.getElementById("prev-btn-population").disabled =
          currentPage === 1;
        document.getElementById("next-btn-population").disabled =
          currentPage === totalPages;
        renderPopulationTableRows(paginatedData);
      }
      function renderPopulationTableRows(data) {
        populationList.innerHTML = "";
        if (data.length === 0) {
          populationList.innerHTML =
            '<tr><td colspan="5" class="p-8 text-center text-slate-400">কোনো ফলাফল পাওয়া যায়নি।</td></tr>';
          return;
        }
        data.forEach((data) => {
          const row = document.createElement("tr");
          row.className =
            "border-b border-slate-50 hover:bg-blue-50/50 cursor-pointer transition";
          row.innerHTML = `<td class="p-4 font-medium text-slate-800">${
            data.name
          }</td><td class="p-4 text-slate-600 hidden md:table-cell">${
            data.occupation
              ? `<div class="text-xs font-semibold text-slate-500 mb-1 uppercase tracking-wide">${data.occupation}</div>`
              : ""
          }<div class="flex items-center">${
            data.bloodGroup
              ? `<span class="text-xs font-bold text-rose-600 bg-rose-50 px-2 py-0.5 rounded-md">🩸 ${data.bloodGroup}</span>`
              : ""
          }</div></td><td class="p-4 text-slate-500 hidden md:table-cell font-mono text-sm">${
            data.nid || "N/A"
          }</td><td class="p-4 text-slate-500 hidden md:table-cell font-mono text-sm">${
            data.mobile || "N/A"
          }</td><td class="p-4 text-sm"><p class="text-slate-800 font-medium">${
            data.commonName || data.householdOwner || "N/A"
          }</p><span class="text-xs text-slate-400">${
            data.bongshoName || "N/A"
          }</span></td>`;
          row.addEventListener("click", async () => {
            showLoader(true);
            try {
              if (!data.householdId) {
                throw new Error("ID missing");
              }
              const householdDoc = await getDoc(
                doc(db, householdsCollectionPath, data.householdId)
              );
              if (householdDoc.exists()) {
                openHouseholdDetails({
                  id: householdDoc.id,
                  ...householdDoc.data(),
                });
              } else {
                showToast("পাওয়া যায়নি।", true);
              }
            } catch (err) {
              showToast("ত্রুটি।", true);
            } finally {
              showLoader(false);
            }
          });
          populationList.appendChild(row);
        });
        lucide.createIcons();
      }

      addNoticeBtn.addEventListener("click", () => {
        addNoticeForm.reset();
        noticeModalTitle.textContent = "নতুন নোটিশ";
        noticeFormSubmit.textContent = "নোটিশ পোস্ট করুন";
        document.getElementById("notice-id").value = "";
        toggleModal(addNoticeModal, true);
      });
      function openNoticeModalForEdit(docId, data) {
        addNoticeForm.reset();
        noticeModalTitle.textContent = "নোটিশ সম্পাদনা করুন";
        noticeFormSubmit.textContent = "আপডেট করুন";
        document.getElementById("notice-id").value = docId;
        document.getElementById("notice-title").value = data.title;
        document.getElementById("notice-details").value = data.details;
        toggleModal(addNoticeModal, true);
      }
      addNoticeForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        noticeFormSubmit.disabled = true;
        showLoader(true);
        const noticeId = document.getElementById("notice-id").value;
        const data = {
          title: document.getElementById("notice-title").value,
          details: document.getElementById("notice-details").value,
          lastUpdatedAt: Timestamp.now(),
          postedBy: currentUserId,
        };
        try {
          if (noticeId) {
            await setDoc(doc(db, noticesCollectionPath, noticeId), data, {
              merge: true,
            });
            showToast("নোটিশ আপডেট করা হয়েছে।");
          } else {
            data.date = Timestamp.now();
            await addDoc(collection(db, noticesCollectionPath), data);
            showToast("নোটিশ পোস্ট করা হয়েছে।");
            loadDashboardStats();
          }
          toggleModal(addNoticeModal, false);
        } catch (error) {
          showToast("ত্রুটি হয়েছে।", true);
        } finally {
          showLoader(false);
          noticeFormSubmit.disabled = false;
        }
      });
      function loadNotices() {
        if (noticesUnsubscribe) noticesUnsubscribe();
        const q = query(
          collection(db, noticesCollectionPath),
          orderBy("date", "desc")
        );
        noticesUnsubscribe = onSnapshot(
          q,
          (snapshot) => {
            if (snapshot.empty) {
              noticeList.innerHTML =
                '<p class="text-center text-slate-400 py-8 col-span-full">কোনো নোটিশ নেই।</p>';
              noticesDataCache = [];
              return;
            }
            noticesDataCache = snapshot.docs.map((doc) => ({
              id: doc.id,
              ...doc.data(),
            }));
            renderNoticesPage();
          },
          (error) => {
            noticeList.innerHTML =
              '<p class="text-center text-red-500 py-4 col-span-full">ত্রুটি হয়েছে।</p>';
          }
        );
      }
      function renderNoticesPage() {
        const totalItems = noticesDataCache.length;
        const { page, limit } = paginationState.notices;
        const totalPages = Math.ceil(totalItems / limit) || 1;
        if (paginationState.notices.page > totalPages)
          paginationState.notices.page = totalPages;
        if (paginationState.notices.page < 1) paginationState.notices.page = 1;
        const currentPage = paginationState.notices.page;
        const startIndex = (currentPage - 1) * limit;
        const endIndex = startIndex + limit;
        const paginatedData = noticesDataCache.slice(startIndex, endIndex);
        noticeList.innerHTML = "";
        paginatedData.forEach((data) => {
          const item = document.createElement("div");
          item.className =
            "bg-white rounded-2xl shadow-soft border border-slate-100 p-6 relative hover:shadow-md transition group";
          item.innerHTML = `
                <div class="absolute top-4 right-4 text-slate-300"><i data-lucide="pin" class="w-5 h-5"></i></div>
                <h4 class="text-lg font-bold text-slate-800 mb-2 pr-8">${
                  data.title
                }</h4>
                <div class="flex items-center mb-4">
                    <span class="bg-blue-50 text-blue-600 text-xs font-bold px-2.5 py-1 rounded-md flex items-center">
                        <i data-lucide="calendar" class="w-3 h-3 mr-1.5"></i>
                        ${
                          data.date
                            ? data.date.toDate().toLocaleDateString("bn-BD")
                            : ""
                        }
                    </span>
                </div>
                <div class="text-slate-600 whitespace-pre-wrap text-sm leading-relaxed mb-4">
                   <p class="line-clamp-3" id="notice-text-${data.id}">${
            data.details
          }</p>
                </div>
                 <div class="flex gap-2 justify-end border-t border-slate-50 pt-4 mt-auto">
                    <button class="bg-white border border-amber-200 text-amber-600 p-2 rounded-lg hover:bg-amber-50 transition" data-action="edit" title="সম্পাদনা">
                        <i data-lucide="pencil" class="w-4 h-4"></i>
                    </button>
                    <button class="bg-white border border-red-200 text-red-600 p-2 rounded-lg hover:bg-red-50 transition" data-action="delete" title="মুছুন">
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                </div>
              `;
          item
            .querySelector('button[data-action="edit"]')
            .addEventListener("click", () => {
              openNoticeModalForEdit(data.id, data);
            });
          item
            .querySelector('button[data-action="delete"]')
            .addEventListener("click", () => {
              deleteNotice(data.id, data.title);
            });
          noticeList.appendChild(item);
        });
        document.getElementById(
          "pagination-info-notices"
        ).textContent = `Showing ${
          totalItems === 0 ? 0 : startIndex + 1
        } to ${Math.min(endIndex, totalItems)} of ${totalItems}`;
        document.getElementById(
          "page-display-notices"
        ).textContent = currentPage;
        document.getElementById("prev-btn-notices").disabled =
          currentPage === 1;
        document.getElementById("next-btn-notices").disabled =
          currentPage === totalPages;
        lucide.createIcons();
      }
      window.toggleNoticeExpand = function (id) {
        const textEl = document.getElementById(`notice-text-${id}`);
        if (textEl.classList.contains("line-clamp-3")) {
          textEl.classList.remove("line-clamp-3");
        } else {
          textEl.classList.add("line-clamp-3");
        }
      };
      function deleteNotice(docId, title) {
        showConfirmationModal(
          "নোটিশ মুছুন?",
          `আপনি কি "${title}" নোটিশটি মুছতে নিশ্চিত?`,
          async () => {
            showLoader(true);
            try {
              await deleteDoc(doc(db, noticesCollectionPath, docId));
              showToast("মুছে ফেলা হয়েছে।");
              loadDashboardStats();
            } catch (error) {
              showToast("ত্রুটি হয়েছে।", true);
            } finally {
              showLoader(false);
            }
          }
        );
      }

      async function loadAdminInfo() {
        try {
          const docRef = doc(db, adminDocPath);
          const docSnap = await getDoc(docRef);
          if (docSnap.exists()) {
            const data = docSnap.data();
            document.getElementById("admin-chairman-name").value =
              data.chairmanName || "";
            document.getElementById("admin-chairman-mobile").value =
              data.chairmanMobile || "";
            document.getElementById("admin-member-name").value =
              data.memberName || "";
            document.getElementById("admin-member-mobile").value =
              data.memberMobile || "";
            document.getElementById("admin-police-name").value =
              data.policeName || "";
            document.getElementById("admin-police-mobile").value =
              data.policeMobile || "";
            dashAdminChairman.textContent = data.chairmanName || "তথ্য নেই";
            dashAdminChairmanCall.textContent = ""; // Clean
            dashAdminChairmanCall.href = data.chairmanMobile
              ? `tel:${data.chairmanMobile}`
              : "#";
            dashAdminMember.textContent = data.memberName || "তথ্য নেই";
            dashAdminMemberCall.textContent = "";
            dashAdminMemberCall.href = data.memberMobile
              ? `tel:${data.memberMobile}`
              : "#";
            dashAdminPolice.textContent = data.policeName || "তথ্য নেই";
            dashAdminPoliceCall.textContent = "";
            dashAdminPoliceCall.href = data.policeMobile
              ? `tel:${data.policeMobile}`
              : "#";
          }
        } catch (error) {
          showToast("লোড করা যায়নি।", true);
        }
      }
      adminInfoForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        adminSubmitBtn.disabled = true;
        showLoader(true);
        const data = {
          chairmanName: document.getElementById("admin-chairman-name").value,
          chairmanMobile: document.getElementById("admin-chairman-mobile")
            .value,
          memberName: document.getElementById("admin-member-name").value,
          memberMobile: document.getElementById("admin-member-mobile").value,
          policeName: document.getElementById("admin-police-name").value,
          policeMobile: document.getElementById("admin-police-mobile").value,
          lastUpdatedBy: currentUserId,
          lastUpdatedAt: Timestamp.now(),
        };
        try {
          await setDoc(doc(db, adminDocPath), data, { merge: true });
          showToast("সংরক্ষণ করা হয়েছে।");
          loadAdminInfo();
        } catch (error) {
          showToast("ত্রুটি হয়েছে।", true);
        } finally {
          showLoader(false);
          adminSubmitBtn.disabled = false;
        }
      });

      sidebarLinks.forEach((link) => {
        link.addEventListener("click", (e) => {
          e.preventDefault();
          showPage(link.dataset.page);
        });
      });
      modalCloseBtns.forEach((btn) => {
        btn.addEventListener("click", () => {
          toggleModal(btn.closest(".modal"), false);
        });
      });
      allModals.forEach((modal) => {
        modal.addEventListener("click", (e) => {
          if (e.target === modal) {
            toggleModal(modal, false);
          }
        });
      });
      openSidebarBtn.addEventListener("click", () => toggleSidebar(true));
      closeSidebarBtn.addEventListener("click", () => toggleSidebar(false));
      lucide.createIcons();
    </script>
  </body>
</html>
