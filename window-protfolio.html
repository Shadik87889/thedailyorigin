<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Windows 11 Portfolio OS Pro</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              "win-blue": "#0078d4",
              "win-dark": "#202020",
            },
            animation: {
              "fade-in-up": "fadeInUp 0.8s ease-out forwards",
            },
            keyframes: {
              fadeInUp: {
                "0%": { opacity: "0", transform: "translateY(20px)" },
                "100%": { opacity: "1", transform: "translateY(0)" },
              },
            },
          },
        },
      };
    </script>

    <style>
      @font-face {
        font-family: "Segoe UI Variable";
        src: local("Segoe UI Variable"), local("Segoe UI"), sans-serif;
      }

      body {
        font-family: "Segoe UI Variable", "Segoe UI", sans-serif;
        overflow: hidden;
        user-select: none;
        cursor: default;
      }

      #desktop {
        background-image: url("https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=2564&auto=format&fit=crop");
        background-size: cover;
        background-position: center;
        transition: background-image 0.5s ease;
      }

      .glass {
        background: rgba(243, 243, 243, 0.85);
        backdrop-filter: blur(20px) saturate(150%);
        -webkit-backdrop-filter: blur(20px) saturate(150%);
        border-top: 1px solid rgba(255, 255, 255, 0.4);
      }

      .dark .glass {
        background: rgba(32, 32, 32, 0.85);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        color: white;
      }

      @keyframes slideUpFade {
        0% {
          transform: translate(-50%, 40px);
          opacity: 0;
        }
        100% {
          transform: translate(-50%, 0);
          opacity: 1;
        }
      }

      @keyframes scaleIn {
        0% {
          transform: scale(0.95);
          opacity: 0;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      @keyframes slideUpScreen {
        0% {
          transform: translateY(0);
          opacity: 1;
        }
        100% {
          transform: translateY(-100%);
          opacity: 0;
        }
      }

      .animate-start-menu {
        animation: slideUpFade 0.25s cubic-bezier(0.1, 0.9, 0.2, 1) forwards;
      }
      .animate-window {
        animation: scaleIn 0.2s cubic-bezier(0.1, 0.9, 0.2, 1) forwards;
      }
      .animate-unlock {
        animation: slideUpScreen 0.5s cubic-bezier(0.1, 0.9, 0.2, 1) forwards;
      }

      .taskbar-icon-container {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 4px;
        transition: background-color 0.2s;
        position: relative;
      }
      .taskbar-icon-container:hover {
        background-color: rgba(255, 255, 255, 0.5);
      }
      .dark .taskbar-icon-container:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }
      .taskbar-icon-container:active {
        background-color: rgba(255, 255, 255, 0.3);
        transform: scale(0.95);
      }

      .taskbar-item::after {
        content: "";
        position: absolute;
        bottom: 0px;
        left: 50%;
        transform: translateX(-50%);
        width: 6px;
        height: 3px;
        background-color: #0078d4;
        border-radius: 2px;
        transition: width 0.3s cubic-bezier(0.1, 0.9, 0.2, 1), opacity 0.2s;
        opacity: 0;
      }
      .taskbar-item.open::after {
        opacity: 1;
        width: 6px;
        background-color: #767676;
      }
      .dark .taskbar-item.open::after {
        background-color: #d1d5db;
      }
      .taskbar-item.focused {
        background-color: rgba(255, 255, 255, 0.5);
      }
      .dark .taskbar-item.focused {
        background-color: rgba(255, 255, 255, 0.1);
      }
      .taskbar-item.focused::after {
        opacity: 1;
        width: 16px;
        background-color: #0078d4;
      }

      #context-menu {
        display: none;
        position: absolute;
        z-index: 9999;
      }

      .terminal-scrollbar::-webkit-scrollbar {
        width: 8px;
      }
      .terminal-scrollbar::-webkit-scrollbar-track {
        background: #1e1e1e;
      }
      .terminal-scrollbar::-webkit-scrollbar-thumb {
        background: #555;
        border-radius: 4px;
      }

      .custom-scrollbar::-webkit-scrollbar {
        width: 6px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: transparent;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background-color: rgba(0, 0, 0, 0.2);
        border-radius: 4px;
      }
      .dark .custom-scrollbar::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.2);
      }
      .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background-color: rgba(0, 0, 0, 0.4);
      }

      iframe {
        pointer-events: auto;
      }

      .resizer {
        position: absolute;
        user-select: none;
        touch-action: none;
      }
      .resizer-r {
        right: -4px;
        top: 0;
        bottom: 0;
        width: 8px;
        cursor: e-resize;
        z-index: 50;
      }
      .resizer-l {
        left: -4px;
        top: 0;
        bottom: 0;
        width: 8px;
        cursor: w-resize;
        z-index: 50;
      }
      .resizer-b {
        bottom: -4px;
        left: 0;
        right: 0;
        height: 8px;
        cursor: s-resize;
        z-index: 50;
      }
      .resizer-t {
        top: -4px;
        left: 0;
        right: 0;
        height: 8px;
        cursor: n-resize;
        z-index: 50;
      }
      .resizer-br {
        right: -4px;
        bottom: -4px;
        width: 16px;
        height: 16px;
        cursor: se-resize;
        z-index: 60;
      }
      .resizer-bl {
        left: -4px;
        bottom: -4px;
        width: 16px;
        height: 16px;
        cursor: sw-resize;
        z-index: 60;
      }
      .resizer-tr {
        right: -4px;
        top: -4px;
        width: 16px;
        height: 16px;
        cursor: ne-resize;
        z-index: 60;
      }
      .resizer-tl {
        left: -4px;
        top: -4px;
        width: 16px;
        height: 16px;
        cursor: nw-resize;
        z-index: 60;
      }
    </style>
  </head>
  <body
    class="h-screen w-screen overflow-hidden text-sm text-slate-900 bg-black selection:bg-blue-500 selection:text-white transition-colors duration-300"
  >
    <!-- Lock Screen -->
    <div
      id="lock-screen"
      class="fixed inset-0 z-[1000] bg-cover bg-center flex flex-col items-center pt-32 text-white transition-all duration-500"
      style="
        background-image: url('https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=2564');
      "
      onclick="window.unlockScreen()"
    >
      <div class="text-8xl font-thin tracking-tighter mb-4" id="lock-time">
        12:00
      </div>
      <div class="text-2xl font-medium" id="lock-date">Monday, January 1</div>
      <div class="mt-auto mb-24 animate-bounce text-sm opacity-80">
        Click anywhere to unlock
      </div>
    </div>

    <!-- Notification Area -->
    <div
      id="notification-area"
      class="fixed bottom-14 right-4 z-[900] flex flex-col gap-2 items-end pointer-events-none"
    ></div>

    <!-- Context Menu -->
    <div
      id="context-menu"
      class="w-64 bg-[#f9f9f9]/90 dark:bg-[#2c2c2c]/95 backdrop-blur-md border border-gray-300 dark:border-gray-600 rounded-lg shadow-xl py-1 text-sm animate-window"
    ></div>

    <!-- Desktop Environment -->
    <div id="desktop" class="relative w-full h-full flex flex-col">
      <div
        id="desktop-icons"
        class="absolute top-0 left-0 w-full h-full z-0 pointer-events-auto"
      ></div>
      <div
        id="window-area"
        class="absolute inset-0 z-10 pointer-events-none overflow-hidden pb-12"
      ></div>

      <!-- Start Menu -->
      <div
        id="start-menu"
        class="hidden fixed bottom-16 left-1/2 transform -translate-x-1/2 w-[640px] h-[700px] glass rounded-lg shadow-2xl z-50 flex flex-col animate-start-menu overflow-hidden pb-16 border border-gray-200/50 dark:border-gray-700"
        onclick="event.stopPropagation()"
      >
        <div class="p-8 pb-4">
          <div class="relative group">
            <i
              class="fa-solid fa-magnifying-glass absolute left-4 top-3 text-slate-500 group-focus-within:text-blue-600"
            ></i>
            <input
              type="text"
              id="start-search"
              placeholder="Search for apps, settings, and documents"
              class="w-full bg-[#f3f3f3] dark:bg-[#333] border border-gray-300 dark:border-gray-600 rounded-full py-2.5 pl-12 pr-4 focus:outline-none focus:ring-2 focus:ring-blue-400 dark:focus:ring-blue-500 focus:bg-white dark:focus:bg-[#404040] transition-all shadow-sm text-sm dark:text-white"
              onkeyup="window.filterStartMenu(this.value)"
            />
          </div>
        </div>
        <div class="px-8 flex-1 overflow-y-auto custom-scrollbar">
          <div class="flex justify-between items-center mb-4">
            <h3 class="font-bold text-slate-700 dark:text-gray-200">Pinned</h3>
            <button
              class="bg-white dark:bg-[#333] dark:text-gray-200 dark:border-gray-600 px-3 py-1 rounded text-xs border shadow-sm hover:bg-gray-50 dark:hover:bg-[#404040] flex items-center gap-2"
            >
              All apps <i class="fa-solid fa-chevron-right text-[10px]"></i>
            </button>
          </div>
          <div
            class="grid grid-cols-6 gap-y-6 gap-x-2"
            id="start-menu-pinned"
          ></div>
          <div class="mt-8">
            <div class="flex justify-between items-center mb-4">
              <h3 class="font-bold text-slate-700 dark:text-gray-200">
                Recommended
              </h3>
              <button
                class="bg-white dark:bg-[#333] dark:text-gray-200 dark:border-gray-600 px-3 py-1 rounded text-xs border shadow-sm hover:bg-gray-50 dark:hover:bg-[#404040] flex items-center gap-2"
              >
                More <i class="fa-solid fa-chevron-right text-[10px]"></i>
              </button>
            </div>
            <div class="grid grid-cols-2 gap-4">
              <div
                class="flex items-center gap-3 p-2 hover:bg-black/5 dark:hover:bg-white/10 rounded cursor-pointer transition-colors"
                onclick="window.openFile('Resume.html')"
              >
                <img
                  src="https://img.icons8.com/fluency/48/null/resume-website.png"
                  class="w-8 h-8"
                  alt="Resume"
                />
                <div class="flex flex-col">
                  <span class="font-medium text-xs dark:text-gray-200"
                    >Resume.html</span
                  ><span class="text-[10px] text-gray-500 dark:text-gray-400"
                    >Just now</span
                  >
                </div>
              </div>
              <div
                class="flex items-center gap-3 p-2 hover:bg-black/5 dark:hover:bg-white/10 rounded cursor-pointer transition-colors"
                onclick="window.openWindow('vscode')"
              >
                <img
                  src="https://img.icons8.com/fluency/48/null/visual-studio-code-2019.png"
                  class="w-8 h-8"
                  alt="VS Code"
                />
                <div class="flex flex-col">
                  <span class="font-medium text-xs dark:text-gray-200"
                    >Portfolio_Source.js</span
                  ><span class="text-[10px] text-gray-500 dark:text-gray-400"
                    >Yesterday</span
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
        <div
          class="absolute bottom-0 w-full h-16 bg-[#f3f3f3]/90 dark:bg-[#202020]/90 backdrop-blur-md border-t border-gray-200 dark:border-gray-700 flex justify-between items-center px-12"
        >
          <div
            class="flex items-center gap-3 hover:bg-white dark:hover:bg-[#333] p-2 rounded-lg cursor-pointer transition-colors"
            onclick="window.openWindow('settings')"
          >
            <div
              class="w-8 h-8 rounded-full bg-gradient-to-tr from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-xs"
            >
              ME
            </div>
            <span class="text-xs font-semibold dark:text-gray-200">Admin</span>
          </div>
          <div
            class="hover:bg-white dark:hover:bg-[#333] p-3 rounded-lg cursor-pointer transition-colors group"
            onclick="window.location.reload()"
          >
            <i
              class="fa-solid fa-power-off text-slate-600 dark:text-gray-300 group-hover:text-red-500"
            ></i>
          </div>
        </div>
      </div>

      <!-- Taskbar -->
      <div
        id="taskbar"
        class="absolute bottom-0 w-full h-12 glass flex items-center justify-between px-2 z-50 shadow-lg"
      >
        <div class="w-48 flex items-center pl-2 hidden sm:flex">
          <div
            class="flex items-center gap-3 hover:bg-white/50 dark:hover:bg-white/10 px-3 py-1 rounded-md cursor-pointer transition-colors group h-10"
          >
            <div class="relative">
              <img
                src="https://img.icons8.com/fluency/48/null/partly-cloudy-day.png"
                class="w-6 h-6 drop-shadow-sm group-hover:scale-110 transition-transform"
              />
            </div>
            <div class="flex flex-col leading-tight justify-center h-full">
              <span
                class="text-xs font-medium text-slate-800 dark:text-gray-200"
                >24Â°C</span
              ><span class="text-[10px] text-slate-600 dark:text-gray-400"
                >Sunny</span
              >
            </div>
          </div>
        </div>
        <div class="flex items-center gap-1 h-full" id="taskbar-apps">
          <div
            id="start-btn"
            class="taskbar-icon-container cursor-pointer group"
          >
            <img
              src="https://img.icons8.com/fluency/48/null/windows-11.png"
              class="w-6 h-6 drop-shadow-sm group-hover:scale-105 transition-transform"
            />
          </div>
          <div class="w-px h-6 bg-gray-400/30 dark:bg-gray-500/30 mx-1"></div>
        </div>
        <div class="w-auto flex justify-end items-center gap-1 h-full pr-2">
          <div
            class="taskbar-icon-container w-6 h-full hover:bg-white/10 rounded-md cursor-pointer hidden sm:flex items-center justify-center transition-colors"
          >
            <i
              class="fa-solid fa-angle-up text-xs text-gray-800 dark:text-gray-200"
            ></i>
          </div>
          <div
            class="flex items-center gap-2 px-2 h-[80%] hover:bg-white/10 rounded-md cursor-pointer transition-colors ml-1 border border-transparent hover:border-white/5 hover:shadow-sm"
          >
            <i
              class="fa-solid fa-wifi text-xs text-gray-800 dark:text-gray-200"
            ></i>
            <i
              class="fa-solid fa-volume-high text-xs text-gray-800 dark:text-gray-200"
            ></i>
            <i
              class="fa-solid fa-battery-three-quarters text-xs text-gray-800 dark:text-gray-200 rotate-0"
            ></i>
          </div>
          <div
            class="flex flex-col items-end justify-center px-2 h-[90%] hover:bg-white/10 rounded-md cursor-pointer transition-colors min-w-[70px] text-right ml-1 border border-transparent hover:border-white/5 hover:shadow-sm"
            onclick="window.pushNotification('Calendar', 'No events for today')"
          >
            <span
              id="clock-time"
              class="text-xs font-medium text-gray-800 dark:text-gray-100 leading-tight"
            ></span>
            <span
              id="clock-date"
              class="text-[11px] text-gray-600 dark:text-gray-300 leading-tight"
            ></span>
          </div>
          <div
            class="w-[2px] h-4 bg-gray-400/30 ml-2 rounded-full hidden sm:block"
          ></div>
        </div>
      </div>
    </div>

    <script>
      // --- HELPER: Get Icon URL ---
      function getIconPath(item) {
        if (item.icon) return item.icon;
        if (item.type === "folder")
          return "https://img.icons8.com/fluency/48/null/folder-invoices--v1.png";
        if (item.fileType === "pdf")
          return "https://img.icons8.com/fluency/48/null/pdf.png";
        if (item.fileType === "image")
          return "https://img.icons8.com/fluency/48/null/image-file.png";
        if (item.fileType === "txt")
          return "https://img.icons8.com/fluency/48/null/txt.png";
        if (item.fileType === "link")
          return "https://img.icons8.com/fluency/48/null/internet.png";
        if (item.fileType === "html")
          return "https://img.icons8.com/fluency/48/null/resume-website.png";
        if (item.fileType === "exe")
          return "https://img.icons8.com/fluency/48/null/software-installer.png";
        return "https://img.icons8.com/fluency/48/null/file.png";
      }

      /* --- CUSTOM CONTENT: RESUME --- */
      const resumeHtmlContent = `
        <div class="min-h-full bg-[#0f0f11] text-white font-sans overflow-x-hidden">
            <header class="relative p-8 md:p-16 flex flex-col justify-center items-start min-h-[60vh]">
                <div class="absolute inset-0 overflow-hidden z-0 pointer-events-none">
                    <div class="absolute top-0 right-0 w-[600px] h-[600px] bg-purple-600/30 rounded-full blur-[120px] animate-pulse"></div>
                    <div class="absolute bottom-0 left-0 w-[500px] h-[500px] bg-blue-600/20 rounded-full blur-[100px]"></div>
                </div>
                <div class="relative z-10 max-w-4xl animate-fade-in-up">
                    <span class="inline-block py-1 px-3 rounded-full bg-gradient-to-r from-pink-500 to-purple-500 text-xs font-bold tracking-wider uppercase mb-6 shadow-lg shadow-purple-500/20">Full Stack Developer & Entrepreneur</span>
                    <h1 class="text-6xl md:text-8xl font-black tracking-tight leading-tight mb-6 bg-clip-text text-transparent bg-gradient-to-r from-white via-gray-200 to-gray-400">
                        Building the <br/> <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400">Digital Future.</span>
                    </h1>
                    <p class="text-xl text-gray-400 max-w-2xl leading-relaxed mb-10">
                        A high-achieving student combining academic excellence (GPA-5 x2) with leadership, tech entrepreneurship, and journalism. Founder of SoftShillo & Rural Peace.
                    </p>
                    <div class="flex gap-4">
                        <button class="px-8 py-4 rounded-full bg-white text-black font-bold text-sm hover:scale-105 transition-transform shadow-[0_0_40px_rgba(255,255,255,0.3)]">Contact Me</button>
                        <button class="px-8 py-4 rounded-full border border-white/20 backdrop-blur-sm bg-white/5 font-bold text-sm hover:bg-white/10 transition-colors">Download CV</button>
                    </div>
                </div>
            </header>
            <div class="px-8 pb-16 max-w-7xl mx-auto">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="col-span-1 md:col-span-2 bg-gradient-to-br from-gray-900 to-gray-800 rounded-3xl p-8 border border-white/10 hover:border-blue-500/50 transition-all group relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-32 h-32 bg-blue-500/20 rounded-full blur-[60px] group-hover:bg-blue-500/40 transition-all"></div>
                        <h2 class="text-2xl font-bold mb-4 flex items-center gap-3"><img src="https://img.icons8.com/fluency/48/null/student-center.png" class="w-8 h-8"> Academic Excellence</h2>
                        <div class="flex gap-6">
                            <div class="flex-1 p-4 rounded-2xl bg-black/40 border border-white/5 text-center"><div class="text-4xl font-black text-white mb-1">5.0</div><div class="text-xs text-gray-400 uppercase tracking-wider">SSC GPA</div></div>
                            <div class="flex-1 p-4 rounded-2xl bg-black/40 border border-white/5 text-center"><div class="text-4xl font-black text-white mb-1">5.0</div><div class="text-xs text-gray-400 uppercase tracking-wider">HSC GPA</div></div>
                        </div>
                    </div>
                    <div class="col-span-1 bg-gradient-to-br from-red-900/40 to-gray-900 rounded-3xl p-8 border border-white/10 hover:border-red-500/50 transition-all relative overflow-hidden group">
                        <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1504711434969-e33886168f5c?q=80&w=1000')] bg-cover opacity-20 mix-blend-overlay transition-opacity group-hover:opacity-30"></div>
                        <h3 class="text-xl font-bold mb-2 relative z-10">The Daily Origin</h3>
                        <p class="text-gray-400 text-sm mb-4 relative z-10">Founder & Chief Editor</p>
                        <div class="inline-block px-3 py-1 rounded-full bg-red-500/20 text-red-400 text-xs font-bold border border-red-500/30 relative z-10">Journalism</div>
                    </div>
                    <div class="col-span-1 md:col-span-3 bg-gradient-to-r from-indigo-900/40 to-purple-900/40 rounded-3xl p-10 border border-white/10 hover:border-purple-500/50 transition-all relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"></div>
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-8 relative z-10">
                            <div><h2 class="text-3xl font-bold mb-2">SoftShillo Suite</h2><p class="text-gray-400 max-w-xl">A comprehensive ecosystem of software solutions ranging from business management to social development.</p></div>
                            <div class="flex flex-wrap gap-2">
                                <span class="px-4 py-2 rounded-xl bg-white/5 border border-white/10 backdrop-blur-md text-xs hover:bg-white/10 transition-colors cursor-default">CashShilpo</span>
                                <span class="px-4 py-2 rounded-xl bg-white/5 border border-white/10 backdrop-blur-md text-xs hover:bg-white/10 transition-colors cursor-default">TypeShilpo</span>
                                <span class="px-4 py-2 rounded-xl bg-white/5 border border-white/10 backdrop-blur-md text-xs hover:bg-white/10 transition-colors cursor-default">SportsShilpo</span>
                                <span class="px-4 py-2 rounded-xl bg-white/5 border border-white/10 backdrop-blur-md text-xs hover:bg-white/10 transition-colors cursor-default">Village System</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-span-1 bg-gradient-to-br from-emerald-900/40 to-gray-900 rounded-3xl p-8 border border-white/10 hover:border-emerald-500/50 transition-all">
                        <div class="w-12 h-12 rounded-full bg-emerald-500/20 flex items-center justify-center mb-4"><img src="https://img.icons8.com/fluency/48/null/dove.png" class="w-8 h-8"></div>
                        <h3 class="text-xl font-bold mb-2">Rural Peace</h3>
                        <p class="text-gray-400 text-sm">Founder of NGO focused on rural development & digital outreach.</p>
                    </div>
                    <div class="col-span-1 md:col-span-2 bg-gray-900 rounded-3xl p-8 border border-white/10 hover:border-pink-500/50 transition-all flex flex-col justify-between relative overflow-hidden">
                        <div class="absolute -right-10 -bottom-10 w-64 h-64 bg-pink-500/10 rounded-full blur-[80px]"></div>
                        <div>
                            <h3 class="text-xl font-bold mb-6 flex items-center gap-2"><img src="https://img.icons8.com/fluency/48/null/books.png" class="w-8 h-8"> Published Author</h3>
                            <div class="flex gap-4 overflow-x-auto pb-2">
                                <div class="min-w-[100px] h-[140px] bg-gradient-to-b from-gray-700 to-gray-800 rounded shadow-lg border-l-4 border-white/20 flex items-center justify-center p-2 text-center text-xs font-bold text-gray-300">The<br>Experience</div>
                                <div class="min-w-[100px] h-[140px] bg-gradient-to-b from-indigo-700 to-indigo-900 rounded shadow-lg border-l-4 border-white/20 flex items-center justify-center p-2 text-center text-xs font-bold text-indigo-100">The<br>Incidents<br>I Faced</div>
                                <div class="min-w-[100px] h-[140px] border-2 border-dashed border-gray-700 rounded flex items-center justify-center text-gray-600 text-xs">Coming<br>Soon</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
      `;

      /* --- FILE SYSTEM DATA --- */
      let fileSystem = {
        root: { name: "This PC", type: "folder", children: ["C:", "D:"] },
        "C:": {
          name: "Local Disk (C:)",
          type: "drive",
          children: ["Users", "Windows", "Program Files"],
        },
        "D:": {
          name: "Data (D:)",
          type: "drive",
          children: ["Projects", "Personal"],
        },
        Users: { name: "Users", type: "folder", children: ["Admin"] },
        Admin: {
          name: "Admin",
          type: "folder",
          children: ["Documents", "Downloads", "Pictures", "Desktop"],
        },
        Documents: {
          name: "Documents",
          type: "folder",
          children: ["Project_Specs.txt"],
        },
        Downloads: {
          name: "Downloads",
          type: "folder",
          children: ["installer.exe"],
        },
        Pictures: {
          name: "Pictures",
          type: "folder",
          children: ["Me.jpg", "Design_Mockup.png", "Wallpaper.jpg"],
        },
        Desktop: {
          name: "Desktop",
          type: "folder",
          children: [
            "Resume.html",
            "SoftShillo",
            "The Daily Origin",
            "Rural Peace",
          ],
        },
        Projects: {
          name: "Projects",
          type: "folder",
          children: ["SoftShillo_Dev", "Client_Websites", "Books_Drafts"],
        },
        Windows: { name: "Windows", type: "folder", children: ["System32"] },
        "Program Files": {
          name: "Program Files",
          type: "folder",
          children: [],
        },
        Personal: {
          name: "Personal",
          type: "folder",
          children: ["Travel.jpg"],
        },

        SoftShillo: {
          name: "SoftShillo",
          type: "folder",
          children: [
            "CashShilpo",
            "TypeShilpo",
            "SportsShilpo",
            "Election Campaign",
            "Hostel Manager",
            "Village System",
            "Rural Peace Mgmt",
          ],
        },
        SoftShillo_Dev: {
          name: "SoftShillo Source",
          type: "folder",
          children: [],
        },
        Client_Websites: {
          name: "Client Websites",
          type: "folder",
          children: ["IELTS_Mahir.link", "FishCompany.link"],
        },
        Books_Drafts: {
          name: "Books",
          type: "folder",
          children: ["The_Experience.pdf", "The_Incidents_I_Faced.pdf"],
        },

        "Resume.html": {
          name: "Resume.html",
          type: "file",
          fileType: "html",
          content: resumeHtmlContent,
        },
        "The Daily Origin": {
          name: "The Daily Origin",
          type: "file",
          fileType: "link",
          content: "thedailyorigin.com",
          icon: "https://img.icons8.com/fluency/48/null/news.png",
        },
        "Rural Peace": {
          name: "Rural Peace",
          type: "file",
          fileType: "link",
          content: "ruralpeace.org",
          icon: "https://img.icons8.com/fluency/48/null/dove.png",
        },

        CashShilpo: {
          name: "CashShilpo",
          type: "file",
          fileType: "link",
          content: "cashshilpo.softshilpo.com",
          icon: "https://img.icons8.com/fluency/48/null/cash-register.png",
        },
        TypeShilpo: {
          name: "TypeShilpo",
          type: "file",
          fileType: "link",
          content: "typeshilpo.softshilpo.com",
          icon: "https://img.icons8.com/fluency/48/null/keyboard.png",
        },
        SportsShilpo: {
          name: "SportsShilpo",
          type: "file",
          fileType: "link",
          content: "sportsshilpo.softshilpo.com",
          icon: "",
        },
        "Election Campaign": {
          name: "Election Campaign",
          type: "file",
          fileType: "link",
          content: "election.softshilpo.com",
          icon: "https://img.icons8.com/fluency/48/null/elections.png",
        },
        "Hostel Manager": {
          name: "Hostel Manager",
          type: "file",
          fileType: "link",
          content: "hostel.softshilpo.com",
          icon: "https://img.icons8.com/fluency/96/hotel-bed.png",
        },
        "Village System": {
          name: "Village System",
          type: "file",
          fileType: "link",
          content: "village.softshilpo.com",
          icon: "https://img.icons8.com/fluency/48/null/village.png",
        },
        "Rural Peace Mgmt": {
          name: "Rural Peace Mgmt",
          type: "file",
          fileType: "link",
          content: "rpm.softshilpo.com",
          icon: "https://img.icons8.com/fluency/48/null/handshake.png",
        },

        "The_Experience.pdf": {
          name: "The Experience.pdf",
          type: "file",
          fileType: "pdf",
          content: "Book 1 Content",
        },
        "The_Incidents_I_Faced.pdf": {
          name: "The Incidents I Faced.pdf",
          type: "file",
          fileType: "pdf",
          content: "Book 2 Content",
        },
        "IELTS_Mahir.link": {
          name: "IELTS Mahir",
          type: "file",
          fileType: "link",
          content: "ieltsmahir.com",
        },
        "FishCompany.link": {
          name: "Fish Company",
          type: "file",
          fileType: "link",
          content: "fishcompany.com",
        },
        "Project_Specs.txt": {
          name: "Project_Specs.txt",
          type: "file",
          fileType: "txt",
          content: "1. Build cool UI\n2. Integrate API\n3. Deploy to cloud",
        },
        "Me.jpg": {
          name: "Me.jpg",
          type: "file",
          fileType: "image",
          content:
            "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=400&fit=crop",
        },
        "Design_Mockup.png": {
          name: "Design_Mockup.png",
          type: "file",
          fileType: "image",
          content:
            "https://images.unsplash.com/photo-1581291518633-83b4ebd1d83e?w=800&q=80",
        },
        "Wallpaper.jpg": {
          name: "Wallpaper.jpg",
          type: "file",
          fileType: "image",
          content:
            "https://images.unsplash.com/photo-1506744038136-46273834b3fb?w=800&q=80",
        },
        "Travel.jpg": {
          name: "Travel.jpg",
          type: "file",
          fileType: "image",
          content:
            "https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?w=800&q=80",
        },
        "Portfolio Link": {
          name: "Portfolio Link",
          type: "file",
          fileType: "link",
          content: "https://github.com",
        },
        "installer.exe": {
          name: "installer.exe",
          type: "file",
          fileType: "exe",
          content: "",
        },
        System32: { name: "System32", type: "folder", children: [] },
      };

      const codeFiles = {
        "index.html": `<!-- Portfolio Main -->\n<div class="hero">\n  <h1>Hi, I'm a Tech Entrepreneur</h1>\n  <p>Founder of SoftShillo & Rural Peace</p>\n  <p>Journalist @ The Daily Origin</p>\n</div>`,
        "main.js": `const portfolio = {\n  founder: ["SoftShillo", "Rural Peace"],\n  author: ["The Experience", "The Incidents I Faced"],\n  skills: ["JS", "Node", "UI/UX", "Leadership"],\n  gpa: "5.0 (SSC & HSC)"\n};\n\nconsole.log("Welcome to my digital world.");`,
        "styles.css": `body {\n  background: #f0f0f0;\n  color: #333;\n  font-family: 'Segoe UI', sans-serif;\n}\n\n.hero {\n  text-align: center;\n  padding: 50px;\n}`,
        "package.json": `{\n  "name": "softshillo-core",\n  "version": "2.0.0",\n  "author": "Admin",\n  "dependencies": {\n    "react": "^18.0.0",\n    "firebase": "^9.0.0"\n  }\n}`,
      };

      const appStates = {
        explorer: { path: ["root"], historyIndex: 0 },
        chrome: { url: "google.com", history: ["google.com"] },
        vscode: { activeFile: "main.js", openFiles: ["main.js", "index.html"] },
        settings: { activeTab: "System", darkMode: false },
        notepad: { content: "", filename: "Untitled.txt" },
        photos: { currentImage: "" },
        terminal: { history: [], cwd: "Admin", input: "" },
        calculator: { display: "0", expression: "" },
      };

      const apps = [
        {
          id: "explorer",
          title: "File Explorer",
          iconUrl:
            "https://img.icons8.com/fluency/48/null/folder-invoices--v1.png",
          width: 800,
          height: 500,
          render: () => {
            const state = appStates.explorer;
            const currentPathKey = state.path[state.path.length - 1];
            const currentFolder =
              fileSystem[currentPathKey] || fileSystem["root"];
            const children = currentFolder.children || [];
            const breadcrumb = state.path
              .map((k) => fileSystem[k]?.name || k)
              .join(" > ");

            // Helper for active sidebar
            const getNavClass = (target) =>
              currentPathKey === target
                ? "bg-gray-200 dark:bg-gray-700 font-medium text-blue-600 dark:text-blue-400"
                : "hover:bg-gray-200 dark:hover:bg-gray-700";

            let gridContent = "";
            if (children.length === 0) {
              gridContent = `<div class="col-span-full text-center text-gray-400 mt-10 dark:text-gray-500">This folder is empty.</div>`;
            } else {
              children.forEach((childKey) => {
                const item = fileSystem[childKey];
                if (!item) return;
                const isFolder =
                  item.type === "folder" || item.type === "drive";
                const iconSrc = getIconPath(item);
                const clickAction = isFolder
                  ? `window.explorerNavigate('${childKey}')`
                  : `window.openFile('${childKey}')`;
                const contextAction = `event.stopPropagation(); window.showContextMenu(event, '${childKey}', '${
                  isFolder ? "folder" : "file"
                }')`;
                gridContent += `<div class="explorer-grid-item p-2 rounded flex flex-col items-center gap-2 cursor-pointer transition-colors group hover:bg-blue-50 dark:hover:bg-white/10 dark:border-transparent" onclick="${clickAction}" oncontextmenu="${contextAction}"><img src="${iconSrc}" class="w-10 h-10 drop-shadow-sm group-hover:scale-105 transition-transform"><span class="text-xs text-center break-words w-full line-clamp-2 select-none dark:text-gray-200">${item.name}</span></div>`;
              });
            }
            return `<div class="flex flex-col h-full bg-[#f3f3f3] dark:bg-[#191919] transition-colors" oncontextmenu="event.preventDefault(); window.showContextMenu(event, '${currentPathKey}', 'folder-bg')"><div class="h-14 bg-[#f3f3f3] dark:bg-[#202020] border-b border-gray-200 dark:border-gray-700 flex items-center px-4 gap-4 draggable-header"><div class="flex gap-2 text-gray-500"><button class="hover:bg-gray-200 dark:hover:bg-gray-700 p-1.5 rounded disabled:opacity-30" onclick="window.explorerGoBack()" ${
              state.path.length <= 1 ? "disabled" : ""
            }><i class="fa-solid fa-arrow-left"></i></button><button class="hover:bg-gray-200 dark:hover:bg-gray-700 p-1.5 rounded" onclick="window.explorerGoUp()"><i class="fa-solid fa-arrow-up"></i></button></div><div class="flex-1 bg-white dark:bg-[#2c2c2c] border border-gray-300 dark:border-gray-600 rounded-md px-3 py-1.5 text-sm flex items-center gap-2 shadow-sm overflow-hidden"><img src="https://img.icons8.com/fluency/48/null/computer.png" class="w-4 h-4"><span class="truncate select-text dark:text-gray-200">${breadcrumb}</span></div><div class="w-48 bg-white dark:bg-[#2c2c2c] border border-gray-300 dark:border-gray-600 rounded-md px-3 py-1.5 text-sm flex items-center shadow-sm"><i class="fa-solid fa-magnifying-glass text-gray-400 mr-2"></i><input type="text" placeholder="Search" class="w-full outline-none text-sm bg-transparent dark:text-white"></div></div><div class="flex-1 flex overflow-hidden"><div class="w-48 pt-2 pl-1 flex flex-col gap-0.5 text-sm overflow-y-auto border-r border-gray-200 dark:border-gray-700 bg-[#f3f3f3] dark:bg-[#202020] hidden sm:flex text-gray-700 dark:text-gray-300"><div class="px-3 py-1.5 rounded flex items-center gap-3 cursor-pointer explorer-sidebar-item ${getNavClass(
              "root"
            )}" onclick="window.explorerNavigate('root')"><img src="https://img.icons8.com/fluency/48/null/computer.png" class="w-4 h-4"> <span class="">This PC</span></div><div class="pl-8 py-1 flex items-center gap-2 rounded cursor-pointer ${getNavClass(
              "Desktop"
            )}" onclick="window.explorerNavigate('Desktop')"><img src="https://img.icons8.com/fluency/48/null/desktop.png" class="w-4 h-4"> Desktop</div><div class="pl-8 py-1 flex items-center gap-2 rounded cursor-pointer ${getNavClass(
              "Documents"
            )}" onclick="window.explorerNavigate('Documents')"><img src="https://img.icons8.com/fluency/48/null/documents.png" class="w-4 h-4"> Documents</div><div class="pl-8 py-1 flex items-center gap-2 rounded cursor-pointer ${getNavClass(
              "Downloads"
            )}" onclick="window.explorerNavigate('Downloads')"><img src="https://img.icons8.com/fluency/48/null/downloads.png" class="w-4 h-4"> Downloads</div><div class="pl-8 py-1 flex items-center gap-2 rounded cursor-pointer ${getNavClass(
              "Pictures"
            )}" onclick="window.explorerNavigate('Pictures')"><img src="https://img.icons8.com/fluency/48/null/image-file.png" class="w-4 h-4"> Pictures</div></div><div class="flex-1 bg-white dark:bg-[#191919] p-4 overflow-y-auto" onclick="window.hideContextMenu()"><div class="grid gap-2" style="grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));">${gridContent}</div></div></div><div class="h-6 bg-[#f3f3f3] dark:bg-[#202020] border-t border-gray-200 dark:border-gray-700 flex items-center px-4 text-xs text-gray-500 dark:text-gray-400"><span>${
              children.length
            } items</span></div></div>`;
          },
        },
        {
          id: "terminal",
          title: "Terminal",
          iconUrl: "https://img.icons8.com/fluency/48/null/console.png",
          width: 700,
          height: 450,
          render: () => {
            const state = appStates.terminal;
            const historyHtml = state.history
              .map((line) => `<div>${line}</div>`)
              .join("");
            setTimeout(() => {
              const el = document.getElementById("terminal-input");
              if (el) el.focus();
              const container = document.getElementById("terminal-content");
              if (container) container.scrollTop = container.scrollHeight;
            }, 10);
            return `<div class="flex flex-col h-full bg-[#0c0c0c] text-gray-200 font-mono text-sm" onclick="document.getElementById('terminal-input').focus()"><div class="h-8 bg-[#2d2d2d] flex items-center px-3 draggable-header justify-between border-b border-black"><span class="text-xs">Administrator: Windows PowerShell</span></div><div id="terminal-content" class="flex-1 p-2 overflow-y-auto terminal-scrollbar"><div class="mb-2 text-gray-400">Windows PowerShell<br>Copyright (C) Microsoft Corporation. All rights reserved.</div>${historyHtml}<div class="flex"><span class="text-green-400 mr-2">PS C:\\Users\\${state.cwd}></span><input id="terminal-input" type="text" class="flex-1 bg-transparent outline-none text-gray-200" autocomplete="off" onkeydown="if(event.key === 'Enter') window.terminalExecute(this.value)"></div></div></div>`;
          },
        },
        {
          id: "calculator",
          title: "Calculator",
          iconUrl: "https://img.icons8.com/fluency/48/null/calculator.png",
          width: 320,
          height: 480,
          render: () => {
            const st = appStates.calculator;
            const btns = [
              "CE",
              "C",
              "<",
              "/",
              "7",
              "8",
              "9",
              "*",
              "4",
              "5",
              "6",
              "-",
              "1",
              "2",
              "3",
              "+",
              "+/-",
              "0",
              ".",
              "=",
            ];
            const btnGrid = btns
              .map((b) => {
                let bg =
                  "bg-white dark:bg-[#333] hover:bg-gray-100 dark:hover:bg-[#444]";
                if (["/", "*", "-", "+", "="].includes(b))
                  bg = "bg-blue-500 text-white hover:bg-blue-600";
                if (b === "=") bg = "bg-blue-600 text-white hover:bg-blue-700";
                return `<button class="${bg} rounded shadow-sm text-lg font-medium transition-colors p-3" onclick="window.calcInput('${b}')">${b}</button>`;
              })
              .join("");
            return `<div class="flex flex-col h-full bg-[#f3f3f3] dark:bg-[#202020]"><div class="h-8 flex items-center px-3 draggable-header text-xs dark:text-gray-200">Calculator</div><div class="h-32 p-4 flex flex-col items-end justify-end text-right break-all"><div class="text-gray-500 text-sm h-6">${st.expression}</div><div class="text-4xl font-semibold dark:text-white">${st.display}</div></div><div class="flex-1 grid grid-cols-4 gap-1 p-1">${btnGrid}</div></div>`;
          },
        },
        {
          id: "chrome",
          title: "Google Chrome",
          iconUrl: "https://img.icons8.com/fluency/48/null/chrome.png",
          width: 900,
          height: 600,
          render: () => {
            const state = appStates.chrome;
            const url = state.url.toLowerCase();
            const isGoogleHome =
              (url.includes("google.com") && !url.includes("search?")) ||
              url === "google" ||
              url === "";
            const isSearch =
              url.includes("google.com/search") ||
              url.startsWith("search:") ||
              (url.includes("?q=") && !url.includes("http"));
            const isHtmlFile = url.startsWith("file://");
            let query = "";
            if (isSearch) {
              try {
                if (url.includes("q="))
                  query = decodeURIComponent(url.split("q=")[1].split("&")[0]);
                else if (url.startsWith("search:"))
                  query = url.replace("search:", "");
              } catch (e) {
                query = "Search";
              }
            }
            const isBlockedSite =
              !isSearch &&
              !isHtmlFile &&
              (url.includes("youtube.com") ||
                url.includes("facebook.com") ||
                url.includes("twitter.com") ||
                url.includes("reddit.com"));

            let content = "";
            if (isHtmlFile)
              content = `<div class="w-full h-full overflow-y-auto bg-white dark:bg-[#202124] custom-scrollbar">${state.htmlContent}</div>`;
            else if (isGoogleHome)
              content = `<div class="flex flex-col items-center justify-center h-full bg-white dark:bg-[#202124] transition-colors"><div class="flex flex-col items-center gap-8 w-full max-w-2xl px-4 -mt-20"><div class="text-[5rem] font-medium tracking-tighter text-slate-700 dark:text-white select-none"><span class="text-[#4285f4]">G</span><span class="text-[#ea4335]">o</span><span class="text-[#fbbc05]">o</span><span class="text-[#4285f4]">g</span><span class="text-[#34a853]">l</span><span class="text-[#ea4335]">e</span></div><div class="w-full relative group"><i class="fa-solid fa-magnifying-glass absolute left-4 top-3.5 text-gray-400 group-focus-within:text-blue-500"></i><input type="text" class="w-full h-12 rounded-full border border-gray-200 dark:border-gray-500 bg-white dark:bg-[#303134] pl-12 pr-12 shadow-sm hover:shadow-md focus:shadow-md outline-none dark:text-white transition-shadow" placeholder="Search Google or type a URL" onkeydown="if(event.key === 'Enter') window.chromeNavigate(this.value)"><i class="fa-solid fa-microphone absolute right-4 top-3.5 text-[#4285f4] cursor-pointer"></i></div><div class="flex gap-4"><button class="bg-[#f8f9fa] dark:bg-[#303134] text-sm text-[#3c4043] dark:text-[#e8eaed] px-4 py-2 rounded hover:shadow-sm hover:border-gray-300 border border-transparent transition-all" onclick="window.chromeNavigate('search:I am feeling lucky')">I'm Feeling Lucky</button><button class="bg-[#f8f9fa] dark:bg-[#303134] text-sm text-[#3c4043] dark:text-[#e8eaed] px-4 py-2 rounded hover:shadow-sm hover:border-gray-300 border border-transparent transition-all">Google Search</button></div></div></div>`;
            else if (isSearch) {
              content = `<div class="flex flex-col h-full bg-white dark:bg-[#202124] overflow-y-auto"><div class="flex items-center gap-6 p-4 border-b border-gray-100 dark:border-gray-700 sticky top-0 bg-white dark:bg-[#202124] z-10"><span class="text-2xl font-medium select-none"><span class="text-[#4285f4]">G</span><span class="text-[#ea4335]">o</span><span class="text-[#fbbc05]">o</span><span class="text-[#4285f4]">g</span><span class="text-[#34a853]">l</span><span class="text-[#ea4335]">e</span></span><div class="flex-1 max-w-2xl relative group"><input type="text" value="${query}" class="w-full h-10 rounded-full border border-gray-200 dark:border-gray-500 bg-white dark:bg-[#303134] pl-4 pr-10 shadow-sm focus:shadow-md outline-none dark:text-white" onkeydown="if(event.key === 'Enter') window.chromeNavigate(this.value)"><i class="fa-solid fa-magnifying-glass absolute right-4 top-3 text-blue-500 cursor-pointer"></i></div><div class="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center text-xs font-bold">US</div></div><div class="px-4 md:px-36 py-6 flex-1"><div class="text-xs text-slate-400 mb-4">About 1,200,000 results (0.42 seconds)</div><div class="mb-6 max-w-2xl"><div class="text-xs text-slate-500 dark:text-gray-400 mb-0.5 truncate">https://en.wikipedia.org/wiki/${query}</div><a href="#" class="text-xl text-[#1a0dab] dark:text-[#8ab4f8] hover:underline cursor-pointer block mb-1">${query} - Wikipedia</a><div class="text-sm text-slate-600 dark:text-gray-300 leading-normal">${query} is a common term used in various contexts. Click to read more on Wikipedia.</div></div><div class="mb-6 max-w-2xl"><div class="text-xs text-slate-500 dark:text-gray-400 mb-0.5 truncate">https://github.com/my-portfolio</div><a href="#" class="text-xl text-[#1a0dab] dark:text-[#8ab4f8] hover:underline cursor-pointer block mb-1">My Portfolio - The Best Developer</a><div class="text-sm text-slate-600 dark:text-gray-300 leading-normal">Looking for ${query}? While I can't search the whole web, I can tell you I am the developer you are looking for!</div></div></div></div>`;
            } else if (isBlockedSite)
              content = `<div class="flex flex-col items-center justify-center h-full bg-gray-100 dark:bg-[#1a1a1a] p-8 text-center"><i class="fa-solid fa-face-frown text-6xl text-gray-400 mb-6"></i><h2 class="text-xl font-bold text-gray-700 dark:text-gray-200 mb-2">This website cannot be displayed in a frame</h2><a href="${state.url}" target="_blank" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-colors flex items-center gap-2">Open in New Tab <i class="fa-solid fa-arrow-up-right-from-square text-xs"></i></a></div>`;
            else
              content = `<iframe src="${state.url}" class="w-full h-full border-none bg-white" sandbox="allow-scripts allow-same-origin allow-forms allow-popups"></iframe>`;

            return `<div class="flex flex-col h-full bg-white dark:bg-[#2c2c2c] transition-colors"><div class="h-9 bg-[#f7f7f7] dark:bg-[#202020] flex items-end px-2 gap-2 border-b border-gray-200 dark:border-gray-700 draggable-header pt-1"><div class="w-48 bg-white dark:bg-[#333] h-full rounded-t-lg shadow-[0_0_5px_rgba(0,0,0,0.1)] flex items-center px-3 gap-2 relative"><span class="text-xs flex-1 truncate dark:text-gray-200">${
              isGoogleHome ? "Google" : isHtmlFile ? "Local File" : "Browser"
            }</span><i class="fa-solid fa-xmark text-xs hover:bg-gray-200 dark:hover:bg-gray-600 dark:text-gray-400 rounded p-1 cursor-pointer"></i></div><div class="p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md cursor-pointer mb-1"><i class="fa-solid fa-plus text-xs dark:text-gray-400"></i></div></div><div class="h-10 bg-white dark:bg-[#2c2c2c] flex items-center px-4 gap-3 border-b border-gray-100 dark:border-gray-700 shadow-sm z-10"><div class="flex gap-3 text-gray-500 dark:text-gray-400"><i class="fa-solid fa-arrow-left cursor-pointer hover:text-black dark:hover:text-white" onclick="window.chromeHome()"></i><i class="fa-solid fa-arrow-right cursor-pointer hover:text-black dark:hover:text-white opacity-50"></i><i class="fa-solid fa-rotate-right cursor-pointer hover:text-black dark:hover:text-white" onclick="window.chromeNavigate(appStates.chrome.url)"></i></div><div class="flex-1 bg-[#f3f3f3] dark:bg-[#1e1e1e] rounded-full px-4 py-1.5 text-sm flex items-center group focus-within:ring-2 focus-within:ring-blue-500 focus-within:bg-white dark:focus:bg-[#333] transition-all shadow-sm"><div class="mr-2 text-gray-400">${
              isGoogleHome
                ? '<i class="fa-brands fa-google"></i>'
                : '<i class="fa-solid fa-lock text-xs"></i>'
            }</div><input id="edge-url-input" type="text" value="${
              isGoogleHome || isSearch
                ? ""
                : isHtmlFile
                ? "Resume.html"
                : state.url
            }" placeholder="Search Google or enter a URL" class="flex-1 bg-transparent outline-none text-gray-700 dark:text-gray-200" onkeydown="if(event.key === 'Enter') window.chromeNavigate(this.value)"></div></div><div class="flex-1 relative bg-white dark:bg-[#1e1e1e] overflow-hidden">${content}</div></div>`;
          },
        },
        {
          id: "vscode",
          title: "Visual Studio Code",
          iconUrl:
            "https://img.icons8.com/fluency/48/null/visual-studio-code-2019.png",
          width: 900,
          height: 600,
          render: () => {
            const state = appStates.vscode;
            const content = codeFiles[state.activeFile];
            const tabsHtml = state.openFiles
              .map(
                (file) =>
                  `<div class="px-3 py-2 ${
                    file === state.activeFile
                      ? "bg-[#1e1e1e] border-t-2 border-blue-500"
                      : "bg-[#2d2d2d] border-t-2 border-transparent hover:bg-[#2d2d2d]"
                  } flex items-center gap-2 text-white min-w-[100px] cursor-pointer group" onclick="window.vscodeOpenFile('${file}')"><i class="${
                    file.endsWith(".js")
                      ? "fa-brands fa-js text-yellow-400"
                      : file.endsWith(".html")
                      ? "fa-brands fa-html5 text-orange-500"
                      : "fa-brands fa-css3-alt text-blue-400"
                  }"></i><span class="text-xs">${file}</span><i class="fa-solid fa-xmark ml-auto text-xs opacity-0 group-hover:opacity-100 hover:bg-gray-600 rounded p-0.5 transition-opacity" onclick="event.stopPropagation(); window.vscodeCloseFile('${file}')"></i></div>`
              )
              .join("");
            const fileListHtml = Object.keys(codeFiles)
              .map(
                (file) =>
                  `<div class="pl-4 py-1 hover:bg-[#2a2d2e] cursor-pointer flex items-center gap-2 ${
                    state.activeFile === file ? "bg-[#37373d]" : ""
                  }" onclick="window.vscodeOpenFile('${file}')"><i class="${
                    file.endsWith(".js")
                      ? "fa-brands fa-js text-yellow-400"
                      : file.endsWith(".html")
                      ? "fa-brands fa-html5 text-orange-500"
                      : "fa-brands fa-css3-alt text-blue-400"
                  } text-[10px]"></i> <span class="text-xs">${file}</span></div>`
              )
              .join("");
            return `<div class="flex h-full bg-[#1e1e1e] text-[#cccccc] font-mono text-sm overflow-hidden"><div class="w-12 bg-[#333333] flex flex-col items-center py-2 gap-4 text-[#858585]"><i class="fa-regular fa-file text-white text-xl cursor-pointer border-l-2 border-white pl-2 -ml-2"></i><i class="fa-solid fa-magnifying-glass hover:text-white cursor-pointer text-xl"></i><i class="fa-solid fa-code-branch hover:text-white cursor-pointer text-xl"></i><i class="fa-solid fa-gear hover:text-white cursor-pointer text-xl mt-auto pb-2"></i></div><div class="w-48 bg-[#252526] flex flex-col hidden sm:flex"><div class="h-8 px-4 flex items-center text-xs font-bold uppercase tracking-wider text-gray-400">Explorer</div><div class="px-2 py-1 flex items-center gap-1 bg-[#37373d] text-white cursor-pointer"><i class="fa-solid fa-chevron-down text-[10px]"></i><span class="font-bold text-xs">PORTFOLIO</span></div>${fileListHtml}</div><div class="flex-1 flex flex-col bg-[#1e1e1e]"><div class="h-9 bg-[#252526] flex overflow-x-auto draggable-header">${tabsHtml}</div><div class="flex-1 p-0 overflow-auto font-mono relative"><textarea class="w-full h-full bg-[#1e1e1e] text-[#d4d4d4] outline-none resize-none font-mono leading-relaxed p-4 text-sm" spellcheck="false" oninput="codeFiles['${state.activeFile}'] = this.value">${content}</textarea></div><div class="h-6 bg-[#007acc] text-white text-xs flex items-center justify-between px-3"><div class="flex gap-3"><span><i class="fa-solid fa-code-branch"></i> main*</span></div><div class="flex gap-3"><span>Ln 1, Col 1</span><span>UTF-8</span><span>JavaScript</span></div></div></div></div>`;
          },
        },
        {
          id: "settings",
          title: "Settings",
          iconUrl: "https://img.icons8.com/fluency/48/null/settings.png",
          width: 800,
          height: 550,
          render: () => {
            const activeTab = appStates.settings.activeTab;
            const darkMode = appStates.settings.darkMode;
            const renderContent = () => {
              if (activeTab === "System")
                return `<h1 class="text-2xl font-semibold mb-6 dark:text-white">System</h1><div class="flex flex-col gap-2"><div class="w-full bg-white dark:bg-[#333] rounded-lg p-4 border border-gray-200 dark:border-gray-600 shadow-sm flex items-center gap-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-[#444]"><img src="https://img.icons8.com/fluency/48/null/monitor--v1.png" class="w-8 h-8"><div class="flex-1"><div class="font-medium dark:text-white">Display</div><div class="text-xs text-gray-500 dark:text-gray-400">Monitors, brightness</div></div></div></div>`;
              else if (activeTab === "Personalization")
                return `<h1 class="text-2xl font-semibold mb-6 dark:text-white">Personalization</h1><div class="flex items-center justify-between bg-white dark:bg-[#333] p-4 rounded-lg border border-gray-200 dark:border-gray-600 mb-6"><span class="font-medium dark:text-white">Dark Mode</span><div class="relative w-11 h-6 bg-gray-200 dark:bg-blue-600 rounded-full cursor-pointer transition-colors" onclick="window.toggleDarkMode()"><div class="absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform ${
                  darkMode ? "translate-x-5" : ""
                }"></div></div></div><h2 class="font-semibold mb-4 dark:text-white">Background</h2><div class="grid grid-cols-3 gap-4"><div onclick="window.setWallpaper('https://images.unsplash.com/photo-1633511090164-b43840ea1607?q=80&w=2560')" class="h-24 rounded-lg cursor-pointer border-2 hover:border-blue-500 overflow-hidden bg-cover bg-center shadow-sm" style="background-image: url('https://images.unsplash.com/photo-1633511090164-b43840ea1607?q=80&w=400')"></div><div onclick="window.setWallpaper('https://images.unsplash.com/photo-1506744038136-46273834b3fb?w=2560&q=80')" class="h-24 rounded-lg cursor-pointer border-2 hover:border-blue-500 overflow-hidden bg-cover bg-center shadow-sm" style="background-image: url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?w=400')"></div><div onclick="window.setWallpaper('https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?w=2560&q=80')" class="h-24 rounded-lg cursor-pointer border-2 hover:border-blue-500 overflow-hidden bg-cover bg-center shadow-sm" style="background-image: url('https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?w=400')"></div></div>`;
              return `<h1 class="text-2xl font-semibold mb-6 dark:text-white">${activeTab}</h1><p class="dark:text-gray-400">Not implemented in this demo.</p>`;
            };
            const sidebarItem = (name, icon, color) =>
              `<div class="px-3 py-1.5 rounded-md ${
                activeTab === name
                  ? "bg-white dark:bg-[#444] shadow-sm"
                  : "hover:bg-gray-200 dark:hover:bg-[#333]"
              } flex items-center gap-3 cursor-pointer text-gray-600 dark:text-gray-300 transition-colors" onclick="window.settingsSwitch('${name}')"><i class="${icon} ${color} w-4"></i> <span class="text-sm ${
                activeTab === name
                  ? "font-semibold text-black dark:text-white"
                  : ""
              }">${name}</span></div>`;
            return `<div class="flex h-full bg-[#f3f3f3] dark:bg-[#191919]"><div class="w-64 p-4 flex flex-col gap-1 overflow-y-auto hidden sm:flex"><div class="flex items-center gap-3 px-3 py-3 mb-2"><div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white text-xs">US</div><div class="flex flex-col"><span class="font-semibold text-sm dark:text-white">User</span><span class="text-xs text-gray-500 dark:text-gray-400">Local Account</span></div></div><div class="relative mb-2"><i class="fa-solid fa-magnifying-glass absolute left-3 top-2.5 text-gray-400 text-xs"></i><input type="text" placeholder="Find a setting" class="w-full pl-8 py-1.5 rounded-md border border-gray-300 dark:border-gray-600 text-sm outline-none bg-white dark:bg-[#333] dark:text-white"></div>${sidebarItem(
              "System",
              "fa-solid fa-laptop",
              "text-blue-500"
            )}${sidebarItem(
              "Bluetooth",
              "fa-brands fa-bluetooth",
              "text-blue-500"
            )}${sidebarItem(
              "Network",
              "fa-solid fa-wifi",
              "text-blue-500"
            )}${sidebarItem(
              "Personalization",
              "fa-solid fa-paintbrush",
              "text-blue-500"
            )}${sidebarItem(
              "Apps",
              "fa-solid fa-list-check",
              "text-blue-500"
            )}</div><div class="flex-1 bg-[#f9f9f9] dark:bg-[#202020] p-6 overflow-y-auto sm:rounded-tl-lg shadow-inner border-l border-gray-200 dark:border-gray-700 draggable-header h-full">${renderContent()}</div></div>`;
          },
        },
        {
          id: "notepad",
          title: "Notepad",
          iconUrl: "https://img.icons8.com/fluency/48/null/notepad.png",
          width: 600,
          height: 400,
          render: () =>
            `<div class="flex flex-col h-full bg-white dark:bg-[#1e1e1e]"><div class="h-8 bg-white dark:bg-[#2c2c2c] border-b border-gray-200 dark:border-gray-700 flex items-center px-2 draggable-header gap-2 text-xs dark:text-gray-200"><span class="px-2 py-1 hover:bg-gray-100 dark:hover:bg-[#444] rounded cursor-pointer">File</span><span class="px-2 py-1 hover:bg-gray-100 dark:hover:bg-[#444] rounded cursor-pointer">Edit</span></div><textarea class="flex-1 p-4 outline-none resize-none font-mono text-sm bg-transparent dark:text-white" spellcheck="false">${appStates.notepad.content}</textarea><div class="h-6 bg-gray-100 dark:bg-[#2c2c2c] border-t border-gray-200 dark:border-gray-700 flex items-center px-2 text-xs text-gray-500 dark:text-gray-400 justify-end gap-4"><span>Ln 1, Col 1</span><span>100%</span><span>UTF-8</span></div></div>`,
        },
        {
          id: "photos",
          title: "Photos",
          iconUrl: "https://img.icons8.com/fluency/48/null/gallery.png",
          width: 700,
          height: 500,
          render: () => {
            const img =
              appStates.photos.currentImage ||
              "https://via.placeholder.com/600x400?text=No+Image+Selected";
            return `<div class="flex flex-col h-full bg-[#202020] text-white"><div class="h-10 flex items-center px-4 draggable-header justify-between"><span class="text-xs">Photos</span><div class="flex gap-4 text-sm"><i class="fa-solid fa-magnifying-glass-plus cursor-pointer hover:text-gray-300"></i><i class="fa-solid fa-trash cursor-pointer hover:text-red-400"></i></div></div><div class="flex-1 flex items-center justify-center overflow-hidden p-2 bg-black"><img src="${img}" class="max-w-full max-h-full object-contain shadow-lg"></div></div>`;
          },
        },
      ];

      let openWindows = [];
      let activeWindowId = null;
      let zIndexCounter = 100;
      let startMenuOpen = false;
      let isLocked = true;

      const desktopIconsRef = document.getElementById("desktop-icons");
      const startMenuRef = document.getElementById("start-menu");
      const startMenuPinnedRef = document.getElementById("start-menu-pinned");
      const taskbarAppsRef = document.getElementById("taskbar-apps");
      const windowAreaRef = document.getElementById("window-area");
      const startBtnRef = document.getElementById("start-btn");
      const desktopRef = document.getElementById("desktop");
      const contextMenuRef = document.getElementById("context-menu");
      const notificationAreaRef = document.getElementById("notification-area");

      function init() {
        renderDesktopIcons();
        renderStartMenu();
        renderTaskbar();
        updateClock();
        setInterval(updateClock, 1000);

        startBtnRef.addEventListener("click", (e) => {
          e.stopPropagation();
          toggleStartMenu();
        });

        window.addEventListener("click", (e) => {
          hideContextMenu();
          if (
            startMenuOpen &&
            !startMenuRef.contains(e.target) &&
            !startBtnRef.contains(e.target)
          ) {
            toggleStartMenu();
          }
        });

        desktopRef.addEventListener("contextmenu", (e) => {
          if (e.target === desktopRef || e.target === desktopIconsRef) {
            e.preventDefault();
            window.showContextMenu(e, "desktop", "desktop");
          }
        });
      }

      window.unlockScreen = () => {
        const screen = document.getElementById("lock-screen");
        screen.classList.add("animate-unlock");
        setTimeout(() => {
          screen.style.display = "none";
          isLocked = false;
          window.pushNotification("Welcome", "OS loaded successfully.");
        }, 450);
      };

      window.openWindow = (appId) => {
        const app = apps.find((a) => a.id === appId);
        if (!app) return;

        if (openWindows.includes(appId)) {
          const win = document.getElementById(`window-${appId}`);
          if (win.classList.contains("hidden")) {
            win.classList.remove("hidden");
            win.classList.remove("animate-window");
            void win.offsetWidth;
            win.classList.add("animate-window");
          }
          bringToFront(appId);
          return;
        }

        const win = document.createElement("div");
        win.id = `window-${appId}`;
        win.className =
          "absolute bg-[#f3f3f3] dark:bg-[#2c2c2c] rounded-lg shadow-[0_20px_50px_rgba(0,0,0,0.3)] flex flex-col overflow-hidden border border-gray-300 dark:border-gray-600 animate-window pointer-events-auto resize-both";
        win.style.width = `${app.width}px`;
        win.style.height = `${app.height}px`;
        const left = Math.max(
          0,
          (window.innerWidth - app.width) / 2 + (Math.random() * 40 - 20)
        );
        const top = Math.max(
          0,
          (window.innerHeight - app.height) / 2 + (Math.random() * 40 - 20)
        );
        win.style.left = `${left}px`;
        win.style.top = `${top}px`;
        win.style.zIndex = ++zIndexCounter;

        if (window.innerWidth < 640) {
          win.style.width = "100%";
          win.style.height = "calc(100% - 48px)";
          win.style.top = "0";
          win.style.left = "0";
          win.classList.remove("rounded-lg");
        }

        win.innerHTML = `
                <div class="h-9 bg-white/50 dark:bg-black/20 backdrop-blur-sm flex justify-between items-center select-none title-bar pl-3 pr-1 border-b border-gray-200/50 dark:border-gray-700/50 draggable-header group">
                    <div class="flex items-center gap-3 text-xs font-medium text-gray-600 dark:text-gray-300">
                        <img src="${
                          app.iconUrl ||
                          "https://img.icons8.com/fluency/48/null/application-window.png"
                        }" class="w-4 h-4">
                        <span>${app.title}</span>
                    </div>
                    <div class="flex h-full items-center">
                        <div class="h-full w-11 flex items-center justify-center hover:bg-gray-200 dark:hover:bg-white/10 transition-colors cursor-pointer" onclick="window.minimizeWindow('${appId}')"><i class="fa-solid fa-minus text-[10px] text-gray-800 dark:text-gray-300"></i></div>
                        <div class="h-full w-11 flex items-center justify-center hover:bg-gray-200 dark:hover:bg-white/10 transition-colors cursor-pointer" onclick="window.toggleMaximize('${appId}')"><i class="fa-regular fa-square text-[10px] text-gray-800 dark:text-gray-300"></i></div>
                        <div class="h-full w-12 flex items-center justify-center hover:bg-red-500 hover:text-white transition-colors cursor-pointer rounded-tr-lg" onclick="window.closeWindow('${appId}')"><i class="fa-solid fa-xmark text-sm dark:text-gray-300"></i></div>
                    </div>
                </div>
                <div class="flex-1 overflow-hidden relative app-content-area text-slate-800 dark:text-gray-200">${app.render(
                  appId
                )}</div>
                <div class="resizer resizer-r"></div><div class="resizer resizer-b"></div><div class="resizer resizer-l"></div><div class="resizer resizer-t"></div><div class="resizer resizer-br"></div><div class="resizer resizer-bl"></div><div class="resizer resizer-tr"></div><div class="resizer resizer-tl"></div>`;

        win.addEventListener("mousedown", () => bringToFront(appId));
        windowAreaRef.appendChild(win);
        openWindows.push(appId);
        makeDraggable(win);
        makeResizable(win);
        updateTaskbarState();
        bringToFront(appId);
      };

      window.closeWindow = (appId) => {
        const win = document.getElementById(`window-${appId}`);
        win.style.opacity = "0";
        win.style.transform = "scale(0.9)";
        setTimeout(() => {
          win.remove();
          openWindows = openWindows.filter((id) => id !== appId);
          if (activeWindowId === appId) activeWindowId = null;
          updateTaskbarState();
        }, 150);
      };

      window.minimizeWindow = (appId) => {
        const win = document.getElementById(`window-${appId}`);
        win.classList.add("hidden");
        activeWindowId = null;
        updateTaskbarState();
      };

      window.toggleMaximize = (appId) => {
        const win = document.getElementById(`window-${appId}`);
        if (win.dataset.maximized === "true") {
          win.style.width = win.dataset.prevWidth;
          win.style.height = win.dataset.prevHeight;
          win.style.top = win.dataset.prevTop;
          win.style.left = win.dataset.prevLeft;
          win.classList.add("rounded-lg");
          win.dataset.maximized = "false";
        } else {
          win.dataset.prevWidth = win.style.width;
          win.dataset.prevHeight = win.style.height;
          win.dataset.prevTop = win.style.top;
          win.dataset.prevLeft = win.style.left;
          win.style.width = "100%";
          win.style.height = "calc(100% - 48px)";
          win.style.top = "0";
          win.style.left = "0";
          win.classList.remove("rounded-lg");
          win.dataset.maximized = "true";
        }
      };

      window.toggleWindow = (appId) => {
        if (!openWindows.includes(appId)) {
          window.openWindow(appId);
        } else {
          const win = document.getElementById(`window-${appId}`);
          if (win.classList.contains("hidden")) {
            win.classList.remove("hidden");
            bringToFront(appId);
          } else {
            if (activeWindowId === appId) window.minimizeWindow(appId);
            else bringToFront(appId);
          }
        }
      };

      window.explorerNavigate = (key) => {
        if (fileSystem[key]) {
          if (key === "root") appStates.explorer.path = ["root"];
          else appStates.explorer.path.push(key);
          refreshWindowContent("explorer");
        }
      };

      window.explorerGoBack = () => {
        if (appStates.explorer.path.length > 1) {
          appStates.explorer.path.pop();
          refreshWindowContent("explorer");
        }
      };

      window.explorerGoUp = () => {
        if (appStates.explorer.path.length > 1) {
          appStates.explorer.path.pop();
          refreshWindowContent("explorer");
        }
      };

      window.openFile = (filename) => {
        const file = Object.values(fileSystem).find(
          (item) => item.name === filename && item.type === "file"
        );
        if (!file) return;

        if (file.fileType === "html") {
          appStates.chrome.url = "file://" + filename;
          appStates.chrome.htmlContent = file.content;
          window.openWindow("chrome");
          refreshWindowContent("chrome");
          return;
        }

        if (file.fileType === "pdf" || file.fileType === "link") {
          if (
            file.content.startsWith("http") ||
            file.content.startsWith("www") ||
            file.content.includes(".com")
          ) {
            window.chromeNavigate(file.content);
            window.openWindow("chrome");
          } else {
            alert(
              "Mock PDF Viewer: Opening " + filename + "\n\n(Content simulated)"
            );
          }
        } else if (file.fileType === "txt") {
          appStates.notepad.content = file.content;
          appStates.notepad.filename = filename;
          window.openWindow("notepad");
          refreshWindowContent("notepad");
        } else if (file.fileType === "image") {
          appStates.photos.currentImage = file.content;
          window.openWindow("photos");
          refreshWindowContent("photos");
        } else if (file.fileType === "exe") {
          alert(
            "Installing " +
              filename +
              "...\n\n(Just kidding, this is a simulation!)"
          );
        }
      };

      window.chromeNavigate = (url) => {
        if (!url) return;
        const isUrl =
          url.includes(".") ||
          url.startsWith("localhost") ||
          url.startsWith("file://");
        const hasProtocol =
          url.startsWith("http://") || url.startsWith("https://");

        if (
          !isUrl &&
          !hasProtocol &&
          url !== "google" &&
          !url.startsWith("search:")
        ) {
          url = `search:${encodeURIComponent(url)}`;
        } else if (isUrl && !hasProtocol && !url.startsWith("file:")) {
          url = "https://" + url;
        }
        appStates.chrome.url = url;
        refreshWindowContent("chrome");
      };

      window.chromeHome = () => {
        appStates.chrome.url = "google.com";
        refreshWindowContent("chrome");
      };

      window.vscodeOpenFile = (filename) => {
        if (!appStates.vscode.openFiles.includes(filename))
          appStates.vscode.openFiles.push(filename);
        appStates.vscode.activeFile = filename;
        refreshWindowContent("vscode");
      };

      window.vscodeCloseFile = (filename) => {
        appStates.vscode.openFiles = appStates.vscode.openFiles.filter(
          (f) => f !== filename
        );
        if (appStates.vscode.activeFile === filename)
          appStates.vscode.activeFile = appStates.vscode.openFiles[0] || "";
        refreshWindowContent("vscode");
      };

      window.settingsSwitch = (tabName) => {
        appStates.settings.activeTab = tabName;
        refreshWindowContent("settings");
      };

      window.setWallpaper = (url) => {
        desktopRef.style.backgroundImage = `url('${url}')`;
        document.getElementById(
          "lock-screen"
        ).style.backgroundImage = `url('${url}')`;
      };

      window.toggleDarkMode = () => {
        document.documentElement.classList.toggle("dark");
        appStates.settings.darkMode = !appStates.settings.darkMode;
        refreshWindowContent("settings");
      };

      window.calcInput = (v) => {
        const st = appStates.calculator;
        if (v === "C") {
          st.display = "0";
          st.expression = "";
        } else if (v === "CE") {
          st.display = "0";
        } else if (v === "=") {
          try {
            const res = eval(st.expression + st.display);
            st.expression = "";
            st.display = String(res);
          } catch (e) {
            st.display = "Error";
          }
        } else if (["+", "-", "*", "/"].includes(v)) {
          st.expression += st.display + " " + v + " ";
          st.display = "0";
        } else if (v === "+/-") {
          st.display = String(Number(st.display) * -1);
        } else {
          if (st.display === "0") st.display = v;
          else st.display += v;
        }
        refreshWindowContent("calculator");
      };

      window.terminalExecute = (cmd) => {
        const st = appStates.terminal;
        const parts = cmd.trim().split(" ");
        const command = parts[0].toLowerCase();
        const args = parts.slice(1);
        st.history.push(
          `<div class="mt-1"><span class="text-green-400">PS C:\\Users\\${st.cwd}></span> ${cmd}</div>`
        );

        if (command === "clear" || command === "cls") st.history = [];
        else if (command === "help")
          st.history.push(
            `<div class="text-yellow-200">Available commands: ls, dir, cd, cat, echo, mkdir, clear, whoami, help</div>`
          );
        else if (command === "whoami")
          st.history.push(`<div>admin\\user</div>`);
        else if (command === "echo")
          st.history.push(`<div>${args.join(" ")}</div>`);
        else if (command === "ls" || command === "dir") {
          const currentFolder = fileSystem[st.cwd] || fileSystem["Admin"];
          if (currentFolder && currentFolder.children) {
            const items = currentFolder.children
              .map((c) => {
                const item = fileSystem[c];
                const type = item.type === "folder" ? "d----" : "-a---";
                return `${type}  ${item.name}`;
              })
              .join("<br>");
            st.history.push(`<div class="pl-2 text-cyan-200">${items}</div>`);
          } else {
            st.history.push(
              `<div class="text-red-400">Error reading directory.</div>`
            );
          }
        } else if (command === "cd") {
          const target = args[0];
          if (target === "..") {
            if (st.cwd !== "root") st.cwd = "Admin";
          } else if (
            fileSystem[target] &&
            fileSystem[target].type === "folder"
          ) {
            st.cwd = target;
          } else {
            st.history.push(
              `<div class="text-red-400">Cannot find path '${target}' because it does not exist.</div>`
            );
          }
        } else if (command === "mkdir") {
          const name = args[0];
          if (name) {
            fileSystem[name] = { name: name, type: "folder", children: [] };
            const currentFolder = fileSystem[st.cwd];
            if (currentFolder) currentFolder.children.push(name);
            st.history.push(`<div>Directory created: ${name}</div>`);
          }
        } else if (command === "") {
        } else {
          st.history.push(
            `<div class="text-red-400">'${command}' is not recognized as a command.</div>`
          );
        }
        refreshWindowContent("terminal");
      };

      window.pinToTaskbar = (id) => {
        const item = fileSystem[id];
        if (!item) return;
        // Create a taskbar item for this file/folder
        const el = document.createElement("div");
        el.className =
          "taskbar-icon-container cursor-pointer taskbar-item group taskbar-app-item";
        const iconSrc = getIconPath(item);
        el.innerHTML = `<img src="${iconSrc}" class="w-6 h-6 transition-transform group-hover:-translate-y-0.5 group-active:scale-90"><div class="absolute -top-12 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-[60] shadow-lg border border-gray-600 font-medium">${item.name}</div>`;
        el.onclick = () => {
          if (item.type === "folder") {
            window.explorerNavigate(id);
            window.openWindow("explorer");
          } else {
            window.openFile(id);
          }
        };
        const taskbarContainer = document.getElementById("taskbar-apps");
        if (taskbarContainer) {
          taskbarContainer.appendChild(el);
        }
      };

      window.showContextMenu = (e, id, type) => {
        e.preventDefault();
        const menu = contextMenuRef;
        menu.style.display = "block";
        menu.style.left = `${e.pageX}px`;
        menu.style.top = `${e.pageY}px`;
        let items = [];
        if (type === "desktop" || type === "folder-bg") {
          items = [
            { label: "View", icon: "fa-regular fa-eye" },
            { label: "Sort by", icon: "fa-solid fa-arrow-down-a-z" },
            {
              label: "Refresh",
              icon: "fa-solid fa-rotate-right",
              action: "window.location.reload()",
            },
            { type: "sep" },
            {
              label: "New Folder",
              icon: "fa-solid fa-folder-plus",
              action: `window.createItem('${id}', 'folder')`,
            },
            {
              label: "New Text Document",
              icon: "fa-regular fa-file-lines",
              action: `window.createItem('${id}', 'file')`,
            },
            { type: "sep" },
            {
              label: "Personalize",
              icon: "fa-solid fa-paintbrush",
              action:
                "window.openWindow('settings'); window.settingsSwitch('Personalization')",
            },
            {
              label: "Open Terminal",
              icon: "fa-solid fa-terminal",
              action: "window.openWindow('terminal')",
            },
          ];
        } else {
          items = [
            {
              label: "Open",
              icon: "fa-solid fa-arrow-up-right-from-square",
              action:
                type === "folder"
                  ? `window.explorerNavigate('${id}')`
                  : `window.openFile('${id}')`,
            },
            {
              label: "Pin to taskbar",
              icon: "fa-solid fa-thumbtack",
              action: `window.pinToTaskbar('${id}')`,
            }, // NEW ACTION
            { label: "Copy", icon: "fa-regular fa-copy" },
            {
              label: "Delete",
              icon: "fa-regular fa-trash-can",
              action: `window.deleteItem('${id}')`,
              color: "text-red-500",
            },
            { type: "sep" },
            { label: "Properties", icon: "fa-solid fa-circle-info" },
          ];
        }
        menu.innerHTML = items
          .map((item) => {
            if (item.type === "sep")
              return `<div class="h-px bg-gray-200 dark:bg-gray-600 my-1 mx-2"></div>`;
            return `<div class="px-4 py-1.5 hover:bg-blue-500 hover:text-white cursor-pointer flex items-center gap-3 ${
              item.color || "dark:text-gray-200"
            }" onclick="${
              item.action || ""
            }; window.hideContextMenu()"><i class="${
              item.icon
            } w-4 text-center"></i><span>${item.label}</span></div>`;
          })
          .join("");
      };

      window.hideContextMenu = () => {
        contextMenuRef.style.display = "none";
      };

      window.createItem = (parentId, type) => {
        const name =
          type === "folder"
            ? `New Folder ${Math.floor(Math.random() * 100)}`
            : `New Text ${Math.floor(Math.random() * 100)}.txt`;
        fileSystem[name] = {
          name: name,
          type: type,
          fileType: type === "file" ? "txt" : undefined,
          children: [],
          content: "",
        };
        const parent =
          parentId === "desktop" ? fileSystem["Desktop"] : fileSystem[parentId];
        if (parent) {
          parent.children.push(name);
          if (parentId === "desktop") renderDesktopIcons();
          else refreshWindowContent("explorer");
        }
      };

      window.deleteItem = (id) => {
        alert("Deleted " + id);
      };

      window.pushNotification = (title, msg) => {
        const notif = document.createElement("div");
        notif.className =
          "w-80 bg-white dark:bg-[#2c2c2c] p-4 rounded-lg shadow-xl border border-gray-200 dark:border-gray-600 animate-start-menu cursor-pointer";
        notif.innerHTML = `<div class="flex items-center gap-2 mb-1"><div class="w-4 h-4 bg-blue-500 rounded-sm"></div><span class="text-xs font-bold text-gray-500 dark:text-gray-400">System</span><span class="text-xs ml-auto text-gray-400">Now</span></div><div class="font-semibold text-sm dark:text-white">${title}</div><div class="text-xs text-gray-600 dark:text-gray-300">${msg}</div>`;
        notificationAreaRef.appendChild(notif);
        setTimeout(() => {
          notif.style.opacity = "0";
          setTimeout(() => notif.remove(), 300);
        }, 5000);
      };

      function refreshWindowContent(appId) {
        const win = document.getElementById(`window-${appId}`);
        if (win) {
          const contentArea = win.querySelector(".app-content-area");
          const app = apps.find((a) => a.id === appId);
          contentArea.innerHTML = app.render(appId);
        }
      }

      function bringToFront(appId) {
        const win = document.getElementById(`window-${appId}`);
        if (win) {
          win.style.zIndex = ++zIndexCounter;
          activeWindowId = appId;
          updateTaskbarState();
        }
      }

      function renderDesktopIcons() {
        desktopIconsRef.innerHTML = "";
        const desktopApps = apps.filter((a) =>
          ["explorer", "chrome", "vscode", "terminal"].includes(a.id)
        );
        const GRID_W = 84 + 10;
        const GRID_H = 100;
        const maxRows = Math.floor((window.innerHeight - 48) / GRID_H);
        let col = 0;
        let row = 0;

        const createAndPlaceIcon = (name, iconUrl, onClick, onContext) => {
          const el = document.createElement("div");
          el.className =
            "absolute w-[84px] flex flex-col items-center gap-1 p-2 rounded hover:bg-white/10 hover:border hover:border-white/10 border border-transparent cursor-pointer transition-colors group z-0";
          el.style.top = row * GRID_H + 10 + "px";
          el.style.left = col * GRID_W + 10 + "px";
          row++;
          if (row >= maxRows) {
            row = 0;
            col++;
          }
          el.innerHTML = `<div class="w-10 h-10 flex items-center justify-center bg-white/10 backdrop-blur-[2px] rounded-lg shadow-sm group-hover:bg-white/20 transition-colors pointer-events-none"><img src="${iconUrl}" class="w-10 h-10 pointer-events-none drop-shadow-md"></div><span class="text-white text-xs text-center drop-shadow-md line-clamp-2 leading-tight text-shadow-md pointer-events-none select-none">${name}</span>`;
          el.onclick = (e) => {
            if (!el.hasAttribute("data-dragged")) onClick(e);
          };
          if (onContext) {
            el.oncontextmenu = (e) => {
              e.stopPropagation();
              if (!el.hasAttribute("data-dragged")) onContext(e);
            };
          }
          makeIconDraggable(el);
          desktopIconsRef.appendChild(el);
        };

        desktopApps.forEach((app) => {
          createAndPlaceIcon(
            app.title,
            app.iconUrl,
            () => window.openWindow(app.id),
            null
          );
        });

        fileSystem["Desktop"].children.forEach((childName) => {
          const item = fileSystem[childName];
          if (item) {
            const iconSrc = getIconPath(item);
            createAndPlaceIcon(
              item.name,
              iconSrc,
              () => {
                if (item.type === "folder") {
                  window.explorerNavigate(childName);
                  window.openWindow("explorer");
                } else {
                  window.openFile(childName);
                }
              },
              (e) =>
                window.showContextMenu(
                  e,
                  childName,
                  item.type === "folder" ? "folder" : "file"
                )
            );
          }
        });
      }

      function makeIconDraggable(elmnt) {
        let pos1 = 0,
          pos2 = 0,
          pos3 = 0,
          pos4 = 0,
          startX = 0,
          startY = 0;
        elmnt.onmousedown = dragMouseDown;
        function dragMouseDown(e) {
          e.preventDefault();
          e.stopPropagation();
          pos3 = e.clientX;
          pos4 = e.clientY;
          startX = e.clientX;
          startY = e.clientY;
          document.onmouseup = closeDragElement;
          document.onmousemove = elementDrag;
        }
        function elementDrag(e) {
          e.preventDefault();
          pos1 = pos3 - e.clientX;
          pos2 = pos4 - e.clientY;
          pos3 = e.clientX;
          pos4 = e.clientY;
          elmnt.style.top = elmnt.offsetTop - pos2 + "px";
          elmnt.style.left = elmnt.offsetLeft - pos1 + "px";
          if (
            Math.abs(e.clientX - startX) > 5 ||
            Math.abs(e.clientY - startY) > 5
          ) {
            elmnt.setAttribute("data-dragged", "true");
          }
        }
        function closeDragElement() {
          document.onmouseup = null;
          document.onmousemove = null;
          setTimeout(() => {
            elmnt.removeAttribute("data-dragged");
          }, 100);
        }
      }

      function renderStartMenu() {
        startMenuPinnedRef.innerHTML = "";
        apps.forEach((app) => {
          const el = document.createElement("div");
          el.className =
            "flex flex-col items-center gap-2 p-2 rounded hover:bg-black/5 dark:hover:bg-white/10 cursor-pointer active:scale-95 transition-all";
          el.innerHTML = `<div class="w-8 h-8 flex items-center justify-center bg-white rounded shadow-sm"><img src="${app.iconUrl}" class="w-6 h-6"></div><span class="text-[11px] text-center font-medium text-slate-700 dark:text-gray-200 truncate w-full">${app.title}</span>`;
          el.onclick = () => {
            window.openWindow(app.id);
            toggleStartMenu();
          };
          startMenuPinnedRef.appendChild(el);
        });
      }

      function renderTaskbar() {
        const existingApps = taskbarAppsRef.querySelectorAll(
          ".taskbar-app-item"
        );
        existingApps.forEach((el) => el.remove());
        apps.forEach((app) => {
          if (["notepad", "photos"].includes(app.id)) return;
          const el = document.createElement("div");
          el.id = `taskbar-item-${app.id}`;
          el.className =
            "taskbar-icon-container cursor-pointer taskbar-item group taskbar-app-item";
          el.innerHTML = `<img src="${app.iconUrl}" class="w-6 h-6 transition-transform group-hover:-translate-y-0.5 group-active:scale-90"><div class="absolute -top-12 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-[60] shadow-lg border border-gray-600 font-medium">${app.title}</div>`;
          el.onclick = () => window.toggleWindow(app.id);
          taskbarAppsRef.appendChild(el);
        });
        updateTaskbarState();
      }

      function updateTaskbarState() {
        apps.forEach((app) => {
          const item = document.getElementById(`taskbar-item-${app.id}`);
          if (item) {
            item.classList.remove("open", "focused");
            if (openWindows.includes(app.id)) {
              item.classList.add("open");
              if (activeWindowId === app.id) {
                item.classList.add("focused");
              }
            }
          }
        });
      }

      function toggleStartMenu() {
        startMenuOpen = !startMenuOpen;
        if (startMenuOpen) {
          startMenuRef.classList.remove("hidden");
          startMenuRef.classList.remove("animate-start-menu");
          void startMenuRef.offsetWidth;
          startMenuRef.classList.add("animate-start-menu");
          startBtnRef.classList.add("bg-white/50");
          document.getElementById("start-search").focus();
        } else {
          startMenuRef.classList.add("hidden");
          startBtnRef.classList.remove("bg-white/50");
        }
      }

      function makeDraggable(element) {
        let pos1 = 0,
          pos2 = 0,
          pos3 = 0,
          pos4 = 0;
        const header = element.querySelector(".draggable-header");
        if (header) header.onmousedown = dragMouseDown;
        function dragMouseDown(e) {
          if (e.target.closest("button") || e.target.closest("input")) return;
          e.preventDefault();
          pos3 = e.clientX;
          pos4 = e.clientY;
          document.onmouseup = closeDragElement;
          document.onmousemove = elementDrag;
        }
        function elementDrag(e) {
          e.preventDefault();
          pos1 = pos3 - e.clientX;
          pos2 = pos4 - e.clientY;
          pos3 = e.clientX;
          pos4 = e.clientY;
          element.style.top = element.offsetTop - pos2 + "px";
          element.style.left = element.offsetLeft - pos1 + "px";
        }
        function closeDragElement() {
          document.onmouseup = null;
          document.onmousemove = null;
        }
      }

      function updateClock() {
        const now = new Date();
        const time = now.toLocaleTimeString("en-US", {
          hour: "numeric",
          minute: "2-digit",
          hour12: true,
        });
        const date = now.toLocaleDateString("en-US", {
          month: "2-digit",
          day: "2-digit",
          year: "numeric",
        });
        document.getElementById("clock-time").innerText = time;
        document.getElementById("clock-date").innerText = date;
        document.getElementById(
          "lock-time"
        ).innerText = now.toLocaleTimeString([], {
          hour: "2-digit",
          minute: "2-digit",
          hour12: false,
        });
        document.getElementById("lock-date").innerText = date;
      }

      function makeResizable(div) {
        const resizers = div.querySelectorAll(".resizer");
        const minWidth = 300;
        const minHeight = 200;
        let original_width = 0;
        let original_height = 0;
        let original_x = 0;
        let original_y = 0;
        let original_mouse_x = 0;
        let original_mouse_y = 0;
        for (let i = 0; i < resizers.length; i++) {
          const currentResizer = resizers[i];
          currentResizer.addEventListener("mousedown", function (e) {
            e.preventDefault();
            original_width = parseFloat(
              getComputedStyle(div, null)
                .getPropertyValue("width")
                .replace("px", "")
            );
            original_height = parseFloat(
              getComputedStyle(div, null)
                .getPropertyValue("height")
                .replace("px", "")
            );
            original_x = div.getBoundingClientRect().left;
            original_y = div.getBoundingClientRect().top;
            original_mouse_x = e.pageX;
            original_mouse_y = e.pageY;
            window.addEventListener("mousemove", resize);
            window.addEventListener("mouseup", stopResize);
          });
          function resize(e) {
            const pageX = e.pageX;
            const pageY = e.pageY;
            if (currentResizer.classList.contains("resizer-br")) {
              const width = original_width + (pageX - original_mouse_x);
              const height = original_height + (pageY - original_mouse_y);
              if (width > minWidth) div.style.width = width + "px";
              if (height > minHeight) div.style.height = height + "px";
            } else if (currentResizer.classList.contains("resizer-bl")) {
              const height = original_height + (pageY - original_mouse_y);
              const width = original_width - (pageX - original_mouse_x);
              if (height > minHeight) div.style.height = height + "px";
              if (width > minWidth) {
                div.style.width = width + "px";
                div.style.left = original_x + (pageX - original_mouse_x) + "px";
              }
            } else if (currentResizer.classList.contains("resizer-tr")) {
              const width = original_width + (pageX - original_mouse_x);
              const height = original_height - (pageY - original_mouse_y);
              if (width > minWidth) div.style.width = width + "px";
              if (height > minHeight) {
                div.style.height = height + "px";
                div.style.top = original_y + (pageY - original_mouse_y) + "px";
              }
            } else if (currentResizer.classList.contains("resizer-tl")) {
              const width = original_width - (pageX - original_mouse_x);
              const height = original_height - (pageY - original_mouse_y);
              if (width > minWidth) {
                div.style.width = width + "px";
                div.style.left = original_x + (pageX - original_mouse_x) + "px";
              }
              if (height > minHeight) {
                div.style.height = height + "px";
                div.style.top = original_y + (pageY - original_mouse_y) + "px";
              }
            } else if (currentResizer.classList.contains("resizer-r")) {
              const width = original_width + (pageX - original_mouse_x);
              if (width > minWidth) div.style.width = width + "px";
            } else if (currentResizer.classList.contains("resizer-b")) {
              const height = original_height + (pageY - original_mouse_y);
              if (height > minHeight) div.style.height = height + "px";
            } else if (currentResizer.classList.contains("resizer-t")) {
              const height = original_height - (pageY - original_mouse_y);
              if (height > minHeight) {
                div.style.height = height + "px";
                div.style.top = original_y + (pageY - original_mouse_y) + "px";
              }
            } else if (currentResizer.classList.contains("resizer-l")) {
              const width = original_width - (pageX - original_mouse_x);
              if (width > minWidth) {
                div.style.width = width + "px";
                div.style.left = original_x + (pageX - original_mouse_x) + "px";
              }
            }
          }
          function stopResize() {
            window.removeEventListener("mousemove", resize);
            window.removeEventListener("mouseup", stopResize);
          }
        }
      }

      init();
    </script>
  </body>
</html>
