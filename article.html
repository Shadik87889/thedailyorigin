<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- 
      ======================================================================
      GAME-CHANGING SEO (DYNAMICALLY POPULATED)
      ======================================================================
    -->
    <title>Loading Article... | The Daily Origin</title>
    <meta id="meta-description" name="description" content="Loading content..." />
    <link id="canonical-link" rel="canonical" href="https://www.thedailyorigin.com/home" />
    <link rel="shortcut icon" href="the_daily_origin_favicon.png" type="image/x-icon" />

    <!-- Open Graph -->
    <meta property="og:site_name" content="The Daily Origin" />
    <meta property="og:type" content="article" />
    <meta id="og-url" property="og:url" content="" />
    <meta id="og-title" property="og:title" content="" />
    <meta id="og-description" property="og:description" content="" />
    <meta id="og-image" property="og:image" content="" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta id="twitter-title" name="twitter:title" content="" />
    <meta id="twitter-description" name="twitter:description" content="" />
    <meta id="twitter-image" name="twitter:image" content="" />

    <!-- JSON-LD Schema -->
    <script type="application/ld+json" id="dynamic-schema-json"></script>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,400&family=Playfair+Display:ital,wght@0,400;0,600;0,700;0,900;1,400&display=swap"
      rel="stylesheet"
    />

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Professional Styles (Unified with Index) -->
    <style>
      :root {
        --font-sans: "Inter", sans-serif;
        --font-serif: "Merriweather", serif;
        --font-display: "Playfair Display", serif;
        --color-brand: #000000;
        --color-accent: #C90000;
        --color-bg: #FFFFFF;
      }

      body {
        font-family: var(--font-serif);
        background-color: var(--color-bg);
        color: #111;
        overflow-x: hidden;
        -webkit-font-smoothing: antialiased;
        border-top: 5px solid var(--color-accent);
      }

      h1, h2, h3, h4, h5, h6 {
        font-family: var(--font-display);
        letter-spacing: -0.02em;
      }

      .font-sans { font-family: var(--font-sans); }
      .font-serif { font-family: var(--font-serif); }
      .font-display { font-family: var(--font-display); }

      /* Navigation */
      .masthead { border-bottom: 1px solid #111; }
      .nav-strip { border-top: 1px solid #111; border-bottom: 1px solid #111; }
      .nav-link {
        position: relative;
        color: #111;
        font-family: var(--font-sans);
        font-weight: 700;
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        padding: 0.5rem 0;
        transition: color 0.2s ease;
      }
      .nav-link:hover { color: var(--color-accent); }

      /* Article Body Typography */
      .article-body p {
        font-size: 1.125rem; /* 18px */
        line-height: 1.8;
        margin-bottom: 1.5rem;
        color: #222;
      }
      .article-body h2 {
        font-size: 2rem;
        font-weight: 700;
        margin-top: 3rem;
        margin-bottom: 1.25rem;
        color: #000;
      }
      .article-body h3 {
        font-size: 1.5rem;
        font-weight: 700;
        margin-top: 2.5rem;
        margin-bottom: 1rem;
      }
      .article-body blockquote {
        border-left: 4px solid var(--color-accent);
        padding-left: 1.5rem;
        margin: 2.5rem 0;
        font-family: var(--font-display);
        font-size: 1.5rem;
        font-style: italic;
        color: #444;
        background-color: #fafafa;
        padding-top: 1rem;
        padding-bottom: 1rem;
      }
      .article-body a {
        color: var(--color-accent);
        text-decoration: underline;
        text-underline-offset: 3px;
      }
      .article-body ul, .article-body ol {
        margin-bottom: 1.5rem;
        padding-left: 2rem;
      }
      .article-body ul { list-style-type: disc; }
      .article-body ol { list-style-type: decimal; }
      
      /* Utilities */
      .section-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1.5rem;
        border-top: 1px solid #111;
        padding-top: 0.75rem;
      }
      .section-title {
        font-family: var(--font-sans);
        font-size: 0.8rem;
        font-weight: 900;
        color: var(--color-accent);
        text-transform: uppercase;
        letter-spacing: 0.1em;
      }

      /* Ticker */
      .ticker-wrap { width: 100%; overflow: hidden; background-color: #000; color: white; }
      .ticker-move { display: flex; width: fit-content; animation: ticker 45s linear infinite; }
      .ticker-content { display: flex; align-items: center; flex-shrink: 0; }
      .ticker-move:hover { animation-play-state: paused; }
      @keyframes ticker { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

      /* Modals */
      .modal-enter { opacity: 0; transform: translateY(10px); }
      .modal-enter-active { opacity: 1; transform: translateY(0); transition: all 0.3s ease; }
    </style>
  </head>
  <body class="bg-white selection:bg-[#E90606] selection:text-white">

    <!-- Loading Overlay -->
    <div
      id="loading-overlay"
      class="fixed inset-0 z-[60] bg-white flex flex-col justify-center items-center"
    >
      <div class="flex flex-col items-center animate-pulse">
        <span class="font-display font-black text-5xl tracking-tighter text-black">The Daily Origin</span>
        <div class="h-1 w-16 bg-[#E90606] mt-4"></div>
        <p id="loading-text" class="mt-4 font-sans text-xs uppercase tracking-widest text-gray-400">Loading Article...</p>
      </div>
    </div>

    <!-- Top Bar -->
    <div class="bg-black text-white text-xs py-2 relative z-50">
      <div class="container mx-auto px-4 lg:px-8 flex items-center justify-between">
         <!-- Ticker placeholder -->
         <div class="flex items-center overflow-hidden w-full lg:w-3/4">
            <span class="text-[#E90606] font-bold uppercase tracking-widest mr-4 flex-shrink-0 text-[10px] font-sans">Trending</span>
            <div class="ticker-wrap flex-1">
               <div class="ticker-move">
                  <div class="ticker-content">
                    <span class="mx-4 text-gray-400 font-sans uppercase tracking-widest">Global Markets Rally on Tech Earnings</span>
                    <span class="text-[#E90606] mx-2">///</span>
                    <span class="mx-4 text-gray-400 font-sans uppercase tracking-widest">New Climate Accord Signed in Geneva</span>
                    <span class="text-[#E90606] mx-2">///</span>
                    <span class="mx-4 text-gray-400 font-sans uppercase tracking-widest">Senate Passes Education Reform Bill</span>
                  </div>
               </div>
            </div>
         </div>
         
         <!-- Auth / Actions -->
         <div class="hidden lg:flex items-center space-x-6 ml-6 font-sans text-[11px] font-bold uppercase tracking-widest">
            <button id="nav-subscribe-btn" class="text-white hover:text-[#E90606] transition-colors">Subscribe</button>
            <div class="h-3 w-px bg-gray-700"></div>
            <button id="nav-signin-btn" class="text-white hover:text-[#E90606] transition-colors">Sign In</button>
            <div id="user-profile-display" class="hidden flex items-center space-x-2 cursor-pointer">
                <span class="w-6 h-6 rounded-full bg-[#E90606] flex items-center justify-center text-[10px]">DJ</span>
                <span>Account</span>
            </div>
         </div>
      </div>
    </div>

    <!-- Navigation Header -->
    <header class="masthead bg-white sticky top-0 z-40 w-full transition-shadow duration-300 border-b border-black md:border-none shadow-sm md:shadow-none" id="main-header">
      <div class="container mx-auto px-4 lg:px-8 py-3 md:pt-6 md:pb-4">
        
        <!-- Logo Row -->
        <div class="flex justify-between items-center md:mb-6">
          <button id="mobile-menu-btn" class="lg:hidden text-black hover:text-[#E90606] transition-colors -ml-1">
            <i data-lucide="menu" class="w-6 h-6"></i>
          </button>

          <!-- Masthead Logo -->
          <a href="./home" class="flex-1 flex justify-center group px-2">
             <div class="flex flex-col items-center">
                <h1 class="font-display font-black text-2xl sm:text-3xl md:text-6xl lg:text-7xl text-black tracking-tight leading-none group-hover:scale-[1.01] transition-transform duration-300 text-center">
                    The Daily Origin
                </h1>
                <span class="hidden md:block font-sans text-[10px] uppercase tracking-[0.3em] text-gray-500 mt-2 font-bold">Unbiased • Unfiltered • Uncompromising</span>
             </div>
          </a>

          <button id="search-open-btn" class="text-black hover:text-[#E90606] transition-colors -mr-1">
             <i data-lucide="search" class="w-5 h-5"></i>
          </button>
        </div>

        <!-- Desktop Navigation Strip -->
        <div class="hidden lg:block nav-strip py-3">
          <nav class="flex justify-center items-center space-x-10">
             <a href="./category?category=World" class="nav-link">World</a>
             <a href="./category?category=Tech" class="nav-link">Tech</a>
             <a href="./category?category=Politics" class="nav-link">Politics</a>
             <a href="./category?category=Business" class="nav-link">Business</a>
             <a href="./category?category=Health" class="nav-link">Health</a>
             <a href="./category?category=Science" class="nav-link">Science</a>
             <a href="./category?category=Sports" class="nav-link">Sports</a>
             <a href="./category?category=Others" class="nav-link">Others</a>
          </nav>
        </div>
      </div>
    </header>

    <!-- Mobile Menu Drawer -->
    <div id="mobile-menu-overlay" class="fixed inset-0 bg-black/50 z-40 hidden backdrop-blur-sm opacity-0 transition-opacity duration-300"></div>
    <div id="mobile-menu" class="fixed top-0 left-0 h-full w-[280px] bg-white z-50 transform -translate-x-full transition-transform duration-300 shadow-2xl flex flex-col border-r-4 border-[#E90606]">
       <div class="p-6 border-b border-gray-100 flex justify-between items-center bg-black text-white">
          <span class="font-sans font-bold text-lg uppercase tracking-wider">Sections</span>
          <button id="mobile-menu-close-btn" class="text-white hover:text-gray-300">
             <i data-lucide="x" class="w-6 h-6"></i>
          </button>
       </div>
       <nav class="flex-grow overflow-y-auto py-6 px-4 space-y-2">
          <a href="./category?category=World" class="block py-2 text-xl font-display font-bold text-black border-b border-gray-100 hover:text-[#E90606]">World</a>
          <a href="./category?category=Tech" class="block py-2 text-xl font-display font-bold text-black border-b border-gray-100 hover:text-[#E90606]">Tech</a>
          <a href="./category?category=Politics" class="block py-2 text-xl font-display font-bold text-black border-b border-gray-100 hover:text-[#E90606]">Politics</a>
          <a href="./category?category=Culture" class="block py-2 text-xl font-display font-bold text-black border-b border-gray-100 hover:text-[#E90606]">Culture</a>
          <a href="./category?category=Science" class="block py-2 text-xl font-display font-bold text-black border-b border-gray-100 hover:text-[#E90606]">Science</a>
          <a href="./category?category=Sports" class="block py-2 text-xl font-display font-bold text-black border-b border-gray-100 hover:text-[#E90606]">Sports</a>
       </nav>
    </div>

    <!-- Main Content Area -->
    <main class="container mx-auto px-4 lg:px-8 py-10 md:py-16 min-h-screen">
      
      <!-- Error Message -->
      <div id="article-error" class="hidden text-center py-20">
          <h2 class="font-display text-4xl font-bold mb-4">Article Not Found</h2>
          <p class="font-serif text-gray-500 mb-8">This content may have been moved or deleted.</p>
          <a href="./home" class="inline-block bg-black text-white px-8 py-3 font-sans font-bold uppercase tracking-widest hover:bg-[#E90606] transition-colors">Return Home</a>
      </div>

      <!-- Article Layout -->
      <article id="main-article-container" class="grid grid-cols-1 lg:grid-cols-12 gap-8 lg:gap-16">
        
        <!-- Left Column: Content (Span 8) -->
        <div class="lg:col-span-8">
            
            <!-- Article Header -->
            <header class="mb-8">
                <a href="#" id="article-category-link" class="text-[#E90606] font-bold uppercase tracking-widest text-xs font-sans mb-4 block hover:underline">
                    Loading Category...
                </a>
                <h1 id="article-title" class="font-display font-black text-4xl md:text-5xl lg:text-6xl text-black leading-[1.1] mb-6">
                    Loading Headline...
                </h1>
                
                <!-- Metadata Row -->
                <div class="flex items-center justify-between border-y border-gray-100 py-4 mb-8 font-sans text-xs font-bold uppercase tracking-widest text-gray-500">
                    <div class="flex items-center space-x-2">
                        <span class="text-black">By</span>
                        <span id="article-author" class="text-[#E90606]">The Daily Origin Staff</span>
                    </div>
                    <span id="article-date">Loading Date...</span>
                </div>
            </header>

            <!-- Hero Image -->
            <figure class="mb-10 relative">
                <img 
                    id="article-image" 
                    src="https://placehold.co/1200x700/f3f4f6/9ca3af?text=Loading..." 
                    alt="Article Hero" 
                    class="w-full h-auto object-cover grayscale-[20%]"
                >
                <figcaption id="article-image-caption" class="mt-3 text-xs text-gray-400 font-sans uppercase tracking-wider text-right">
                    Source: The Daily Origin
                </figcaption>
            </figure>

            <!-- Article Body -->
            <div id="article-content-body" class="article-body font-serif text-lg leading-loose text-gray-900">
                <!-- Content injected here -->
                <p class="text-xl font-medium text-gray-500 italic">Loading full story...</p>
            </div>

            <!-- Author Bio Box -->
            <div id="author-bio-box" class="hidden mt-16 p-8 bg-gray-50 border border-gray-100 flex flex-col sm:flex-row items-center sm:items-start text-center sm:text-left gap-6">
                <img id="author-bio-image" src="" class="w-20 h-20 rounded-full object-cover grayscale border border-gray-200" alt="Author">
                <div>
                    <span class="block text-[10px] font-sans font-bold uppercase tracking-widest text-gray-400 mb-2">About The Author</span>
                    <h3 id="author-bio-name" class="font-display font-bold text-xl text-black mb-2">Author Name</h3>
                    <p id="author-bio-text" class="font-serif text-sm text-gray-600 leading-relaxed">
                        Author bio content goes here.
                    </p>
                </div>
            </div>

        </div>

        <!-- Right Column: Sidebar (Span 4) -->
        <aside class="lg:col-span-4 space-y-16 pl-0 lg:pl-10 lg:border-l lg:border-gray-200">
            
            <!-- Newsletter Widget (Reused) -->
            <div class="bg-[#E90606] text-white p-8 relative overflow-hidden">
                <div class="absolute top-0 right-0 -mt-10 -mr-10 w-32 h-32 bg-white/10 rounded-full blur-2xl"></div>
                <span class="block text-[10px] font-sans font-bold uppercase tracking-[0.2em] mb-3 text-white/80">Newsletter</span>
                <h3 class="font-display text-3xl font-black mb-4 leading-none">The Daily<br>Origin</h3>
                <p class="mb-6 font-serif text-sm text-white/90 leading-relaxed">Essential insight delivered to your inbox every morning.</p>
                <button class="w-full bg-black hover:bg-gray-900 text-white font-sans font-bold uppercase text-xs tracking-[0.2em] py-4 transition-colors">Sign Up</button>
            </div>

            <!-- Related Stories -->
            <section>
                <div class="section-header">
                    <h2 class="section-title text-black">Related Stories</h2>
                </div>
                <div id="related-articles-list" class="space-y-6">
                    <p class="text-gray-400 text-sm font-serif italic">Loading related stories...</p>
                </div>
            </section>

             <!-- Ad Placeholder -->
            <div class="bg-gray-50 h-[300px] flex flex-col items-center justify-center text-gray-400 text-[10px] border border-gray-100">
                <span class="uppercase tracking-[0.2em] font-sans font-bold">Advertisement</span>
            </div>

        </aside>

      </article>
    </main>

    <!-- Footer -->
    <footer class="bg-black text-white border-t-[6px] border-[#E90606]">
      <div class="container mx-auto px-4 lg:px-8 py-20">
        <div class="flex flex-col md:flex-row justify-between items-start mb-16">
            <div class="mb-10 md:mb-0">
               <h2 class="font-display font-black text-5xl mb-6 tracking-tight">The Daily Origin</h2>
               <div class="flex space-x-8 text-xs font-sans font-bold uppercase tracking-widest text-gray-500">
                  <a href="#" class="hover:text-white transition-colors">About</a>
                  <a href="#" class="hover:text-white transition-colors">Contact</a>
                  <a href="#" class="hover:text-white transition-colors">Careers</a>
               </div>
            </div>
            <div class="flex space-x-4">
               <a href="#" class="w-10 h-10 border border-gray-800 flex items-center justify-center hover:bg-[#E90606] hover:border-[#E90606] transition-all"><i data-lucide="twitter" class="w-4 h-4"></i></a>
               <a href="#" class="w-10 h-10 border border-gray-800 flex items-center justify-center hover:bg-[#E90606] hover:border-[#E90606] transition-all"><i data-lucide="facebook" class="w-4 h-4"></i></a>
            </div>
        </div>
        <div class="border-t border-gray-900 pt-8 text-center md:text-left">
            <p class="font-sans text-[10px] uppercase tracking-widest text-gray-600">© 2025 The Daily Origin. All rights reserved.</p>
        </div>
      </div>
    </footer>

    <!-- Search Modal -->
    <div id="search-overlay" class="fixed inset-0 bg-white/95 z-[70] hidden transition-opacity duration-300"></div>
    <div id="search-modal" class="fixed top-0 left-0 z-[80] w-full hidden">
       <div class="container mx-auto px-4 py-8">
          <div class="flex items-center border-b-[3px] border-black pb-6">
             <i data-lucide="search" class="w-8 h-8 text-black mr-4"></i>
             <input type="text" id="search-input" placeholder="SEARCH STORIES" class="w-full text-3xl md:text-5xl font-display font-black text-black placeholder-gray-200 focus:outline-none bg-transparent uppercase tracking-tight">
             <button id="search-close-btn" class="p-2 hover:bg-gray-100 rounded-full"><i data-lucide="x" class="w-8 h-8"></i></button>
          </div>
       </div>
    </div>

     <!-- Sign In Modal -->
    <div id="signin-overlay" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[90] hidden transition-opacity duration-300"></div>
    <div id="signin-modal" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-[100] w-full max-w-md hidden">
       <div class="bg-white p-8 md:p-12 shadow-2xl relative border-t-8 border-[#E90606]">
          <button id="signin-close-btn" class="absolute top-4 right-4 text-gray-400 hover:text-black">
             <i data-lucide="x" class="w-6 h-6"></i>
          </button>
          <div class="text-center mb-6">
             <h2 class="font-display font-black text-3xl mb-2">Welcome Back</h2>
             <p class="font-serif text-gray-500 italic">Sign in to access your personalized feed.</p>
          </div>
          <button class="w-full bg-black text-white font-sans font-bold uppercase tracking-[0.2em] py-4 hover:bg-[#E90606] transition-colors">Sign In</button>
       </div>
    </div>


    <!-- Logic -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
      import {
        getFirestore, doc, getDoc, collection, query, where, limit, onSnapshot, getDocs
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
      import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

      // --- Config ---
      const firebaseConfig = {
        apiKey: "AIzaSyCFVD4Ts03OXJ14aJ5h_HGAAuiIg5nme7A",
        authDomain: "edu-env.firebaseapp.com",
        projectId: "edu-env",
        storageBucket: "edu-env.firebasestorage.app",
        messagingSenderId: "259668089849",
        appId: "1:259668089849:web:70a92e04ce3331ed533b28",
        measurementId: "G-VK9WTY47JB",
      };

      const appId = typeof __app_id !== "undefined" ? __app_id : "default-news-app";
      const initialAuthToken = typeof __initial_auth_token !== "undefined" ? __initial_auth_token : null;

      // Initialize globally to avoid re-init errors
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      let currentArticleId = null;

      // --- Refs ---
      const loadingOverlay = document.getElementById("loading-overlay");
      const loadingText = document.getElementById("loading-text");
      const articleError = document.getElementById("article-error");
      const mainArticleContainer = document.getElementById("main-article-container");

      const articleCategoryLink = document.getElementById("article-category-link");
      const articleTitle = document.getElementById("article-title");
      const articleDate = document.getElementById("article-date");
      const articleAuthor = document.getElementById("article-author");
      const articleImage = document.getElementById("article-image");
      const articleImageCaption = document.getElementById("article-image-caption");
      const articleContentBody = document.getElementById("article-content-body");

      const authorBioBox = document.getElementById("author-bio-box");
      const authorBioImage = document.getElementById("author-bio-image");
      const authorBioName = document.getElementById("author-bio-name");
      const authorBioText = document.getElementById("author-bio-text");

      const relatedArticlesList = document.getElementById("related-articles-list");

      // SEO Refs
      const metaDescription = document.getElementById("meta-description");
      const canonicalLink = document.getElementById("canonical-link");
      const dynamicSchema = document.getElementById("dynamic-schema-json");

      // --- UI Functions (Mobile Menu, Search, Auth) ---
      // Mobile Menu
      const mobileMenu = document.getElementById("mobile-menu");
      const mobileMenuOverlay = document.getElementById("mobile-menu-overlay");
      const mobileMenuBtn = document.getElementById("mobile-menu-btn");
      const mobileMenuCloseBtn = document.getElementById("mobile-menu-close-btn");

      function toggleMenu(show) {
         if (show) {
            mobileMenu.classList.remove("-translate-x-full");
            mobileMenuOverlay.classList.remove("hidden");
            setTimeout(() => mobileMenuOverlay.classList.remove("opacity-0"), 10);
            document.body.style.overflow = "hidden";
         } else {
            mobileMenu.classList.add("-translate-x-full");
            mobileMenuOverlay.classList.add("opacity-0");
            setTimeout(() => mobileMenuOverlay.classList.add("hidden"), 300);
            document.body.style.overflow = "";
         }
      }
      mobileMenuBtn.addEventListener("click", () => toggleMenu(true));
      mobileMenuCloseBtn.addEventListener("click", () => toggleMenu(false));
      mobileMenuOverlay.addEventListener("click", () => toggleMenu(false));

      // Search
      const searchOverlay = document.getElementById("search-overlay");
      const searchModal = document.getElementById("search-modal");
      const searchOpenBtn = document.getElementById("search-open-btn");
      const searchCloseBtn = document.getElementById("search-close-btn");

      function toggleSearch(show) {
         if (show) {
            searchOverlay.classList.remove("hidden");
            searchModal.classList.remove("hidden");
            setTimeout(() => searchOverlay.classList.remove("opacity-0"), 10);
         } else {
            searchOverlay.classList.add("opacity-0");
            setTimeout(() => {
                searchOverlay.classList.add("hidden");
                searchModal.classList.add("hidden");
            }, 300);
         }
      }
      searchOpenBtn.addEventListener("click", () => toggleSearch(true));
      searchCloseBtn.addEventListener("click", () => toggleSearch(false));

      // Auth
      const signinOverlay = document.getElementById("signin-overlay");
      const signinModal = document.getElementById("signin-modal");
      const navSigninBtn = document.getElementById("nav-signin-btn");
      const signinCloseBtn = document.getElementById("signin-close-btn");
      
      navSigninBtn.addEventListener("click", () => {
         signinOverlay.classList.remove("hidden");
         signinModal.classList.remove("hidden");
         setTimeout(() => {
             signinOverlay.classList.remove("opacity-0");
             signinModal.classList.add("opacity-100");
         }, 10);
      });
      function closeSignin() {
          signinOverlay.classList.add("opacity-0");
          setTimeout(() => {
             signinOverlay.classList.add("hidden");
             signinModal.classList.add("hidden");
          }, 300);
      }
      signinCloseBtn.addEventListener("click", closeSignin);
      signinOverlay.addEventListener("click", closeSignin);


      // --- Helper: Format Time ---
      function formatRelativeTime(date) {
        if (date?.toDate) date = date.toDate();
        const now = new Date();
        const seconds = Math.floor((now - date) / 1000);
        if (seconds < 60) return "Just Now";
        const minutes = Math.floor(seconds / 60);
        if (minutes < 60) return `${minutes} MIN AGO`;
        const hours = Math.floor(minutes / 60);
        if (hours < 24) return `${hours}H AGO`;
        return date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
      }

      function generateArticleBody(summary) {
        return `
            <p class="text-2xl font-display italic text-gray-700 leading-relaxed mb-8 border-b border-gray-100 pb-8">${summary}</p>
            <p>This is a developing story. The Daily Origin is actively gathering more information and will provide updates as they become available. The situation remains fluid, and officials are urging the public to rely on verified sources.</p>
            <h2>The Core of the Issue</h2>
            <p>At the heart of this development lies a complex web of factors that have been culminating for months. Sources close to the matter indicate that the primary catalyst was a decision made in the early hours of Tuesday morning, a decision that has sent ripples across the industry.</p>
            <blockquote>"We are witnessing a paradigm shift, the likes of which haven't been seen since the dawn of the internet age. The implications are simply staggering."</blockquote>
            <p>Analysts suggest that this move could redefine market expectations for the coming decade.</p>
            <h3>What Happens Next?</h3>
            <p>All eyes are now on the upcoming emergency meeting scheduled for this Friday. The outcome of this meeting will likely set the course for the next quarter and could have ramifications that extend far beyond the immediate stakeholders.</p>
            <p><strong>The Daily Origin</strong> will have live coverage of the event as it unfolds.</p>
        `;
      }

      // --- Rendering Logic ---

      function renderArticle(article) {
          document.title = `${article.title} | The Daily Origin`;
          
          articleCategoryLink.innerText = article.category || "General";
          articleCategoryLink.href = `./category?category=${article.category}`;
          articleTitle.innerText = article.title;
          articleDate.innerText = formatRelativeTime(article.publishedAt);
          articleAuthor.innerText = article.authorName || "The Daily Origin Staff";
          
          articleImage.src = article.imageUrl || "https://source.unsplash.com/random/1200x800?news";
          articleImageCaption.innerText = `Photo Illustration: ${article.title}`;

          if (article.body) {
              articleContentBody.innerHTML = article.body;
          } else {
              articleContentBody.innerHTML = generateArticleBody(article.summary);
          }
          
          loadingOverlay.classList.add("hidden");
      }

      function renderRelatedArticles(articles) {
          if (articles.length === 0) {
              relatedArticlesList.innerHTML = '<p class="text-gray-400 text-sm italic">No related stories found.</p>';
              return;
          }
          
          relatedArticlesList.innerHTML = articles.map(a => `
             <a href="./article?id=${a.id}" class="block group border-b border-gray-100 pb-4 last:border-0">
                <span class="text-[9px] font-bold text-[#E90606] uppercase tracking-[0.15em] mb-1 block font-sans">${a.category}</span>
                <h4 class="font-display font-bold text-lg text-black group-hover:text-[#E90606] transition-colors leading-tight">
                   ${a.title}
                </h4>
             </a>
          `).join("");
      }

      // --- Author & SEO ---

      async function loadAuthorInfo(authorId) {
          if (!authorId) return null;
          try {
             const docRef = doc(db, `artifacts/${appId}/public/data/authors`, authorId);
             const snap = await getDoc(docRef);
             if (snap.exists()) {
                 const data = snap.data();
                 authorBioBox.classList.remove("hidden");
                 authorBioName.innerText = data.name;
                 authorBioText.innerText = data.bio;
                 if(data.imageUrl) authorBioImage.src = data.imageUrl;
                 return data;
             }
          } catch(e) { console.error("Author load error", e); }
          return null;
      }

      function updateSeoTags(article, author) {
         const url = window.location.href;
         const desc = article.summary || "Latest news from The Daily Origin";
         const img = article.imageUrl || "";

         metaDescription.content = desc;
         canonicalLink.href = url;
         
         // OG
         document.getElementById("og-url").content = url;
         document.getElementById("og-title").content = article.title;
         document.getElementById("og-description").content = desc;
         document.getElementById("og-image").content = img;

         // Schema
         const schema = {
             "@context": "https://schema.org",
             "@type": "NewsArticle",
             "headline": article.title,
             "image": [img],
             "datePublished": article.publishedAt?.toDate().toISOString(),
             "author": {
                 "@type": "Person",
                 "name": author ? author.name : (article.authorName || "Staff")
             }
         };
         dynamicSchema.textContent = JSON.stringify(schema);
      }


      // --- Init ---

      async function init() {
         const params = new URLSearchParams(window.location.search);
         currentArticleId = params.get("id");

         if (!currentArticleId) {
             loadingOverlay.classList.add("hidden");
             mainArticleContainer.classList.add("hidden");
             articleError.classList.remove("hidden");
             return;
         }

         try {
             // Robust Authentication Flow (Try-Catch wrapped)
             if (initialAuthToken) {
                 await signInWithCustomToken(auth, initialAuthToken);
             } else {
                 await auth.authStateReady(); 
                 if (!auth.currentUser) {
                     try {
                        // This may fail on mobile IP addresses (domain restriction)
                        await signInAnonymously(auth);
                     } catch (authErr) {
                         console.warn("Authentication failed (likely domain restriction). Attempting to load public data anyway.", authErr);
                         // We continue execution to try and fetch data
                     }
                 }
             }

             // Fetch Article
             const docRef = doc(db, `artifacts/${appId}/public/data/articles`, currentArticleId);
             const snap = await getDoc(docRef);

             if (snap.exists()) {
                 const article = { id: snap.id, ...snap.data() };
                 renderArticle(article);
                 
                 // Fetch Related
                 try {
                    const q = query(
                        collection(db, `artifacts/${appId}/public/data/articles`),
                        where("category", "==", article.category),
                        limit(4)
                    );
                    const qs = await getDocs(q);
                    const related = [];
                    qs.forEach(d => { if(d.id !== article.id) related.push({id: d.id, ...d.data()}) });
                    renderRelatedArticles(related);
                 } catch(err) {
                     console.warn("Could not fetch related articles", err);
                 }

                 // Author & SEO
                 const author = await loadAuthorInfo(article.authorId);
                 updateSeoTags(article, author);

             } else {
                 loadingOverlay.classList.add("hidden");
                 mainArticleContainer.classList.add("hidden");
                 articleError.classList.remove("hidden");
             }

         } catch (e) {
             console.error("Init Error", e);
             // CRITICAL FIX: Hide the loader even if everything fails
             loadingOverlay.classList.add("hidden");
             
             // Show Error UI
             mainArticleContainer.classList.add("hidden");
             articleError.classList.remove("hidden");
             
             // Add helpful debug info for mobile users
             const errTitle = articleError.querySelector("h2");
             const errText = articleError.querySelector("p");
             if(errTitle) errTitle.innerText = "Connection Error";
             if(errText) errText.innerText = "Could not load content. If you are on a local network, check Firebase Authorized Domains. (Error: " + e.message + ")";
         }
      }

      document.addEventListener("DOMContentLoaded", () => {
         lucide.createIcons();
         init();
      });

    </script>
  </body>
</html>