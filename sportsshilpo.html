<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sports Shilpo - Pro Management</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Font: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Icons: Lucide.dev -->
    <script type="module" src="https://unpkg.com/lucide-react@latest/dist/lucide-react.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* ================================================================
          NEW: BBL/IPL BROADCAST THEME
          ================================================================
        */
        :root {
            --bbl-dark: #1e293b; /* slate-800 */
            --bbl-dark-alt: #334155; /* slate-700 */
            --bbl-darker: #0f172a; /* slate-900 */
            --bbl-darkest: #020617; /* slate-950 */
            --bbl-highlight: #fde047; /* yellow-300 */
            --bbl-highlight-hover: #facc15; /* yellow-400 */
            --bbl-accent: #db2777; /* pink-600 */
            --bbl-accent-hover: #be185d; /* pink-700 */
            --bbl-white: #FFFFFF;
            --bbl-gray: #9ca3af; /* gray-400 */
            --bbl-gray-light: #cbd5e1; /* slate-300 */
            --bbl-success: #22c55e; /* green-500 */
            --bbl-danger: #ef4444; /* red-500 */
        }
        
        /* --- Base Styles --- */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: var(--bbl-darkest);
            color: var(--bbl-gray-light);
        }

        /* Page switching utility */
        .page { display: none; }
        .page.active { display: block; }

        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bbl-darker); }
        ::-webkit-scrollbar-thumb { background: var(--bbl-dark-alt); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--bbl-accent); }
        
        /* Dotted background pattern */
        .bg-dots-pattern {
            background-color: var(--bbl-darkest);
            background-image: radial-gradient(var(--bbl-dark) 1.5px, transparent 1.5px);
            background-size: 20px 20px;
        }

        /* --- Auth & Sport Selection --- */
        .auth-card {
            background-color: var(--bbl-darker);
            border: 1px solid var(--bbl-dark-alt);
            backdrop-filter: blur(4px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.4);
        }
        .auth-tab.active {
            color: var(--bbl-highlight);
            border-color: var(--bbl-highlight);
        }
        .sport-select-card {
            background-color: var(--bbl-darker);
            border: 1px solid var(--bbl-dark-alt);
            backdrop-filter: blur(4px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.4);
            transition: all 0.2s;
        }
        .sport-select-card:hover {
            border-color: var(--bbl-highlight);
            transform: translateY(-4px);
            box-shadow: 0 0 20px var(--bbl-highlight);
        }
        .sport-select-card.football:hover {
            border-color: var(--bbl-accent);
            box-shadow: 0 0 20px var(--bbl-accent);
        }

        /* --- Main App UI --- */
        #sidebar {
            background-color: #000; /* Sidebar is jet black */
            border-color: var(--bbl-dark-alt);
        }
        #app-title {
            /* Keep the gradient title */
            color: var(--bbl-highlight);
        }
        .nav-link {
            color: var(--bbl-gray);
            transition: all 0.2s;
        }
        .nav-link:hover {
            background-color: var(--bbl-dark);
            color: var(--bbl-white);
        }
        .nav-link.active {
            background-color: var(--bbl-dark);
            color: var(--bbl-highlight);
            font-weight: 600;
        }
        
        main {
            background-color: var(--bbl-darkest);
        }
        
        h1, h2, h3, h4 {
            color: var(--bbl-white);
        }

        /* --- UI Elements: Cards, Modals, Forms --- */
        .ui-card {
            background-color: var(--bbl-dark);
            border: 1px solid var(--bbl-dark-alt);
            border-radius: 0.5rem; /* rounded-lg */
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .ui-table {
            background-color: var(--bbl-dark);
            border: 1px solid var(--bbl-dark-alt);
            border-radius: 0.5rem; /* rounded-lg */
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .ui-table thead {
            background-color: var(--bbl-darker);
        }
        .ui-table th {
            color: var(--bbl-gray);
        }
        .ui-table tbody tr {
            border-color: var(--bbl-dark-alt);
        }
        .ui-table tbody tr:hover {
            background-color: var(--bbl-darker);
        }
        .ui-table .text-highlight {
            color: var(--bbl-highlight);
            font-weight: 500;
        }
        
        .ui-modal {
            background-color: var(--bbl-dark);
            border: 1px solid var(--bbl-dark-alt);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .ui-modal-header {
            background-color: var(--bbl-dark);
            border-bottom: 1px solid var(--bbl-dark-alt);
        }
        .ui-modal-footer {
            background-color: var(--bbl-dark);
            border-top: 1px solid var(--bbl-dark-alt);
        }

        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="number"],
        input[type="datetime-local"],
        select {
            background-color: var(--bbl-darker);
            border: 1px solid var(--bbl-dark-alt);
            color: var(--bbl-white);
            border-radius: 0.375rem; /* rounded-md */
        }
        input:focus, select:focus {
            outline: none;
            border-color: var(--bbl-highlight);
            box-shadow: 0 0 0 2px var(--bbl-highlight);
        }
        
        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem; /* rounded-md */
            font-weight: 500;
            transition: all 0.2s;
            border: 1px solid transparent;
        }
        .btn-primary {
            background-color: var(--bbl-highlight);
            color: var(--bbl-darker);
            border-color: var(--bbl-highlight);
        }
        .btn-primary:hover {
            background-color: var(--bbl-highlight-hover);
            border-color: var(--bbl-highlight-hover);
        }
        .btn-secondary {
            background-color: var(--bbl-dark-alt);
            color: var(--bbl-white);
            border-color: var(--bbl-dark-alt);
        }
        .btn-secondary:hover {
            background-color: #475569; /* slate-600 */
        }
        .btn-danger {
            background-color: var(--bbl-accent);
            color: var(--bbl-white);
            border-color: var(--bbl-accent);
        }
        .btn-danger:hover {
            background-color: var(--bbl-accent-hover);
            border-color: var(--bbl-accent-hover);
        }
        .btn-link {
            color: var(--bbl-highlight);
        }
        .btn-link:hover {
            color: var(--bbl-highlight-hover);
        }
        .btn-icon {
            color: var(--bbl-gray);
            border-radius: 9999px;
            padding: 0.5rem;
        }
        .btn-icon:hover {
            background-color: var(--bbl-dark-alt);
            color: var(--bbl-white);
        }
        .btn-icon.danger:hover {
            background-color: var(--bbl-accent);
            color: var(--bbl-white);
        }
        
        /* Pagination Buttons */
        .pagination-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem; /* rounded-md */
            font-weight: 500;
            transition: all 0.2s;
            border: 1px solid var(--bbl-dark-alt);
            background-color: var(--bbl-dark);
            color: var(--bbl-gray-light);
            margin: 0 0.25rem;
        }
        .pagination-btn:hover:not(:disabled) {
            background-color: var(--bbl-dark-alt);
            color: var(--bbl-white);
        }
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .pagination-btn.active {
            background-color: var(--bbl-highlight);
            color: var(--bbl-darker);
            border-color: var(--bbl-highlight);
        }

        /* Radio/Checkbox Labels */
        .player-select-label, .format-select-label {
            display: block;
            padding: 0.75rem 1rem;
            border: 1px solid var(--bbl-dark-alt);
            border-radius: 0.375rem; /* rounded-md */
            cursor: pointer;
            transition: all 0.2s;
            background-color: var(--bbl-darker);
        }
        .player-select-label:hover, .format-select-label:hover {
            background-color: var(--bbl-dark);
        }
        .player-select-label input:checked + div,
        .format-select-label input:checked + div {
            border-color: var(--bbl-highlight);
            background-color: var(--bbl-dark);
            box-shadow: 0 0 10px var(--bbl-highlight);
        }
        .player-select-label input:disabled + div {
            opacity: 0.5;
            cursor: not-allowed;
            background-color: var(--bbl-dark-alt);
        }
        .format-select-label h3 { color: white; font-weight: 600; }
        .format-select-label p { color: var(--bbl-gray); font-size: 0.875rem; }


        /* Spinner */
        .spinner {
            border: 4px solid var(--bbl-dark-alt);
            border-top: 4px solid var(--bbl-highlight);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ================================================================
          LIVE CRICKET THEME (Already done, just ensuring it fits)
          ================================================================
        */
        .over-ball {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-weight: 700;
            font-size: 1rem;
            margin: 0 4px;
            background-color: var(--bbl-darker);
            color: var(--bbl-white);
            border: 2px solid var(--bbl-dark-alt);
        }
        .over-ball.wicket { background-color: var(--bbl-accent); border-color: var(--bbl-accent); color: white; }
        .over-ball.four { background-color: var(--bbl-highlight); border-color: var(--bbl-highlight); color: var(--bbl-darker); }
        .over-ball.six { background-color: var(--bbl-highlight); border-color: var(--bbl-highlight); color: var(--bbl-darker); font-size: 1.25rem; }
        .over-ball.extra { background-color: var(--bbl-gray); border-color: var(--bbl-dark-alt); color: white; font-size: 0.875rem; }
        .over-ball.dot { background-color: var(--bbl-darker); color: var(--bbl-gray); border-color: var(--bbl-dark-alt); }

        #page-live-cricket {
            background-image: radial-gradient(var(--bbl-dark) 2px, transparent 2px);
            background-size: 20px 20px;
        }
        .scorebug-bbl {
            background: linear-gradient(to right, var(--bbl-accent), var(--bbl-darker) 70%);
            border: 2px solid var(--bbl-accent);
            border-left-width: 8px;
            border-radius: 0.75rem; /* rounded-xl */
            padding: 1rem;
            box-shadow: 0 10px 20px rgba(0,0,0,0.4);
        }
        .lower-third-container {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 1.5rem;
        }
        @media (min-width: 1024px) {
            .lower-third-container {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        .batsman-card, .bowler-card {
            background: var(--bbl-dark);
            border: 1px solid #334155; /* slate-700 */
            border-radius: 0.5rem; /* rounded-lg */
            padding: 1rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }
        
        .batsman-card.on-strike {
            border-left: 4px solid var(--bbl-highlight);
        }
        
        .batsman-card .strike-indicator {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--bbl-highlight);
            background: rgba(253, 224, 71, 0.1);
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            border: 1px solid var(--bbl-highlight);
        }

   .batsman-stats, .bowler-stats {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid #334155; /* slate-700 */
        }
        
        .batsman-stats .stat, .bowler-stats .stat {
            text-align: center;
        }
        
        .batsman-stats .stat .label, .bowler-stats .stat .label {
            font-size: 0.75rem;
            color: var(--bbl-gray);
            font-weight: 500;
            margin-right: 0.3rem !important;
        }
        
        .batsman-stats .stat .value, .bowler-stats .stat .value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--bbl-white);
        }
        
        .scorecard-table-bbl {
            background: var(--bbl-dark);
            border: 1px solid var(--bbl-dark-alt);
            border-radius: 0.5rem; /* rounded-lg */
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .scorecard-table-bbl thead { background-color: var(--bbl-darker); }
        .scorecard-table-bbl th { color: var(--bbl-gray); }
        .scorecard-table-bbl tbody tr { border-color: var(--bbl-dark-alt); }
        .scorecard-table-bbl tbody tr.not-out { background-color: var(--bbl-dark); }
        .scorecard-table-bbl .batsman-name { color: var(--bbl-highlight); font-weight: 600; }
        .scorecard-table-bbl .batsman-out-info { color: var(--bbl-gray); font-size: 0.75rem; }
        .scorecard-table-bbl .bowler-name { color: var(--bbl-highlight); font-weight: 600; }
        
        .scoring-controls-bbl {
            background: var(--bbl-dark);
            border: 1px solid var(--bbl-dark-alt);
            border-radius: 0.5rem; /* rounded-lg */
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .score-btn-bbl {
            background-color: var(--bbl-dark-alt);
            color: var(--bbl-white);
            border-radius: 0.375rem; /* rounded-md */
            font-weight: 600;
            transition: all 0.2s;
            padding: 0.75rem;
        }
        .score-btn-bbl:hover { background-color: #475569; /* slate-600 */ transform: translateY(-2px); }
        .score-btn-bbl.boundary { background-color: var(--bbl-highlight); color: var(--bbl-darker); }
        .score-btn-bbl.boundary:hover { background-color: var(--bbl-highlight-hover); }
        .score-btn-bbl.extra { background-color: var(--bbl-gray); color: var(--bbl-darker); }
        .score-btn-bbl.extra:hover { background-color: #94a3b8; /* slate-400 */ }
        .score-btn-bbl.wicket { background-color: var(--bbl-accent); }
        .score-btn-bbl.wicket:hover { background-color: var(--bbl-accent-hover); }
        .score-btn-bbl.action { background-color: var(--bbl-dark-alt); }
        .score-btn-bbl.action:hover { background-color: #475569; /* slate-600 */ }

    </style>
</head>
<body class="h-full overflow-hidden">

    <!-- 
      ================================================================
      AUTH CONTAINER (LOGIN/REGISTER)
      ================================================================
    -->
    <div id="auth-container" class="flex items-center justify-center min-h-full p-4 bg-dots-pattern">
        <!-- Re-themed auth card -->
        <div class="auth-card w-full max-w-md rounded-2xl p-8">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 to-pink-600">
                    Sports Shilpo
                </h1>
                <p class="text-gray-400 mt-2">Pro Management Suite</p>
            </div>

            <!-- Auth Tabs -->
            <div class="mb-4 border-b border-b-dark-alt">
                <nav class="flex -mb-px" aria-label="Tabs">
                    <button id="tab-login" class="auth-tab active w-1/2 py-4 px-1 text-center border-b-2 font-medium text-sm">
                        Sign In
                    </button>
                    <button id="tab-register" class="auth-tab w-1/2 py-4 px-1 text-center border-b-2 font-medium text-sm text-gray-400 border-transparent hover:text-gray-300 hover:border-gray-500">
                        Create Account
                    </button>
                </nav>
            </div>

            <!-- Auth Error Message Display -->
            <div id="auth-error" class="hidden p-3 rounded-lg bg-pink-900 border border-pink-700 text-pink-100 text-sm mb-4"></div>

            <!-- Login Form -->
            <form id="login-form" class="space-y-6">
                <div>
                    <label for="login-email" class="block text-sm font-medium text-gray-300">Email address</label>
                    <div class="mt-1">
                        <input id="login-email" name="email" type="email" autocomplete="email" required
                            class="block w-full px-3 py-2 placeholder-gray-500 focus:shadow-[0_0_10px_theme(colors.yellow.300)] transition-all sm:text-sm">
                    </div>
                </div>

                <div>
                    <label for="login-password" class="block text-sm font-medium text-gray-300">Password</label>
                    <div class="mt-1">
                        <input id="login-password" name="password" type="password" autocomplete="current-password" required
                            class="block w-full px-3 py-2 placeholder-gray-500 focus:shadow-[0_0_10px_theme(colors.yellow.300)] transition-all sm:text-sm">
                    </div>
                </div>

                <div>
                    <button type="submit" class="btn btn-primary w-full">
                        Sign In
                    </button>
                </div>
            </form>

            <!-- Register Form (hidden by default) -->
            <form id="register-form" class="space-y-6 hidden">
                <div>
                    <label for="register-email" class="block text-sm font-medium text-gray-300">Email address</label>
                    <div class="mt-1">
                        <input id="register-email" name="email" type="email" autocomplete="email" required
                            class="block w-full px-3 py-2 placeholder-gray-500 focus:shadow-[0_0_10px_theme(colors.yellow.300)] transition-all sm:text-sm">
                    </div>
                </div>

                <div>
                    <label for="register-password" class="block text-sm font-medium text-gray-300">Password</label>
                    <div class="mt-1">
                        <input id="register-password" name="password" type="password" autocomplete="new-password" required
                            class="block w-full px-3 py-2 placeholder-gray-500 focus:shadow-[0_0_10px_theme(colors.yellow.300)] transition-all sm:text-sm">
                    </div>
                </div>
                
                <div>
                    <label for="register-password-confirm" class="block text-sm font-medium text-gray-300">Confirm Password</label>
                    <div class="mt-1">
                        <input id="register-password-confirm" name="password-confirm" type="password" autocomplete="new-password" required
                            class="block w-full px-3 py-2 placeholder-gray-500 focus:shadow-[0_0_10px_theme(colors.yellow.300)] transition-all sm:text-sm">
                    </div>
                </div>

                <div>
                    <button type="submit" class="btn btn-primary w-full">
                        Create Account
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- 
      ================================================================
      SPORT SELECTION CONTAINER
      ================================================================
    -->
    <div id="sport-selection-container" class="hidden flex items-center justify-center min-h-full p-4 bg-dots-pattern">
        <div class="w-full max-w-3xl text-center">
            <h1 class="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 to-pink-600 mb-4">
                Welcome to Sports Shilpo
            </h1>
            <p class="text-2xl text-gray-300 mb-12">Which sport would you like to manage first?</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Cricket Choice -->
                <button id="select-sport-cricket" class="sport-select-card group rounded-2xl p-10">
                    <i data-lucide="siren" class="h-20 w-20 mx-auto text-yellow-300 transition-colors"></i> 
                    <h2 class="text-3xl font-bold text-white mt-6">Cricket</h2>
                    <p class="text-gray-400 mt-2">Manage teams, players, and live scorecards for Cricket.</p>
                </button>
                
                <!-- Football Choice -->
                <button id="select-sport-football" class="sport-select-card football group rounded-2xl p-10">
                    <i data-lucide="siren" class="h-20 w-20 mx-auto text-pink-600 transition-colors"></i>
                    <h2 class="text-3xl font-bold text-white mt-6">Football</h2>
                    <p class="text-gray-400 mt-2">Manage teams, players, and live match events for Football.</p>
                </button>
            </div>
            
            <p class="text-gray-500 mt-12">You can switch to the other sport at any time from the main menu.</p>
        </div>
    </div>


    <!-- 
      ================================================================
      MAIN APP CONTAINER
      ================================================================
    -->
    <div id="app-container" class="hidden h-full flex flex-col md:flex-row">

        <!-- Sidebar -->
        <nav id="sidebar" class="w-full md:w-64 border-b md:border-b-0 md:border-r flex-shrink-0">
            <div class="flex flex-col h-full">
                <!-- Logo -->
                <div class="flex items-center justify-center h-16 flex-shrink-0 px-4 border-b border-b-dark-alt">
                    <h1 id="app-title" class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 to-pink-600">
                        Sports Shilpo
                    </h1>
                </div>
                
                <!-- Nav Links -->
                <div class="flex-1 overflow-y-auto p-4 space-y-2" id="nav-links">
                    <!-- Navigation items -->
                    <a href="#" data-page="dashboard" class="nav-link active group flex items-center px-3 py-2 text-sm font-medium rounded-md">
                        <i data-lucide="layout-grid" class="mr-3 h-5 w-5"></i>
                        Dashboard
                    </a>
                    
                    <a href="#" data-page="teams" class="nav-link group flex items-center px-3 py-2 text-sm font-medium rounded-md">
                        <i data-lucide="shield" class="mr-3 h-5 w-5"></i>
                        Team Management
                    </a>
                    
                    <a href="#" data-page="players" class="nav-link group flex items-center px-3 py-2 text-sm font-medium rounded-md">
                        <i data-lucide="users" class="mr-3 h-5 w-5"></i>
                        Player Hub
                    </a>
                    <a href="#" data-page="competitions" class="nav-link group flex items-center px-3 py-2 text-sm font-medium rounded-md">
                        <i data-lucide="trophy" class="mr-3 h-5 w-5"></i>
                        Competitions
                    </a>
                    <a href="#" data-page="live" class="nav-link group flex items-center px-3 py-2 text-sm font-medium rounded-md">
                        <i data-lucide="radio-tower" class="mr-3 h-5 w-5"></i>
                        Live Match Center
                    </a>
                </div>

                <!-- User Info & Logout -->
                <div class="p-4 border-t border-t-dark-alt flex-shrink-0 space-y-2">
                    <!-- Switch Sport Button -->
                    <button id="switch-sport-button" class="nav-link w-full group flex items-center px-3 py-2 text-sm font-medium rounded-md">
                        <i data-lucide="repeat" class="mr-3 h-5 w-5"></i>
                        Switch Sport
                    </button>
                    
                    <div class="flex items-center pt-2 border-t border-t-dark-alt">
                        <div class="flex-1">
                            <p class="text-sm font-medium text-white truncate" id="user-email-display">user@example.com</p>
                            <p class="text-xs text-yellow-300" id="user-status-display">Online</p>
                        </div>
                        <button id="logout-button" class="btn-icon ml-3 flex-shrink-0" title="Sign Out">
                            <i data-lucide="log-out" class="h-5 w-5"></i>
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="flex-1 overflow-y-auto bg-dots-pattern">
            
            <!-- Page: Dashboard -->
            <div id="page-dashboard" class="page active p-6 md:p-10">
                <h1 id="dashboard-title" class="text-3xl font-bold mb-8 text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 to-pink-600">Dashboard</h1>
                
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="ui-card p-6 transition-all hover:border-yellow-300">
                        <h3 class="text-sm font-medium text-gray-400 uppercase tracking-wider">Total Teams</h3>
                        <p class="text-3xl font-extrabold text-white mt-2" id="stats-total-teams">0</p>
                    </div>
                    <div class="ui-card p-6 transition-all hover:border-yellow-300">
                        <h3 class="text-sm font-medium text-gray-400 uppercase tracking-wider">Total Players</h3>
                        <p class="text-3xl font-extrabold text-white mt-2" id="stats-total-players">0</p>
                    </div>
                    <div class="ui-card p-6 transition-all hover:border-yellow-300">
                        <h3 class="text-sm font-medium text-gray-400 uppercase tracking-wider">Upcoming Fixtures</h3>
                        <p class="text-3xl font-extrabold text-white mt-2" id="stats-upcoming-fixtures">0</p>
                    </div>
                    <div class="ui-card p-6 transition-all hover:border-yellow-300">
                        <h3 class="text-sm font-medium text-gray-400 uppercase tracking-wider">Live Matches</h3>
                        <p class="text-3xl font-extrabold text-white mt-2" id="stats-live-matches">0</p>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <button data-page="teams" class="quick-action-btn ui-card p-6 text-left hover:bg-bbl-darker transition-all">
                        <i data-lucide="shield-plus" class="h-8 w-8 text-yellow-300 mb-3"></i>
                        <h3 class="text-lg font-semibold text-white">Manage Teams</h3>
                        <p class="text-sm text-gray-400">Add, edit, or delete your teams.</p>
                    </button>
                    <button data-page="competitions" class="quick-action-btn ui-card p-6 text-left hover:bg-bbl-darker transition-all">
                        <i data-lucide="calendar-plus" class="h-8 w-8 text-yellow-300 mb-3"></i>
                        <h3 class="text-lg font-semibold text-white">Create Fixture</h3>
                        <p class="text-sm text-gray-400">Schedule a new match or event.</p>
                    </button>
                    <button data-page="live" class="quick-action-btn ui-card p-6 text-left hover:bg-bbl-darker transition-all">
                        <i data-lucide="radio-tower" class="h-8 w-8 text-yellow-300 mb-3"></i>
                        <h3 class="text-lg font-semibold text-white">Go to Live Scoring</h3>
                        <p class="text-sm text-gray-400">Open the live match center.</p>
                    </button>
                </div>
            </div>

            <!-- Page: Team Management -->
            <div id="page-teams" class="page p-6 md:p-10">
                <div class="flex justify-between items-center mb-8">
                    <h1 id="team-management-title" class="text-3xl font-bold">Team Management</h1>
                    <button id="open-add-team-modal-btn" class="btn btn-primary">
                        <i data-lucide="plus" class="mr-2 -ml-1 h-5 w-5"></i>
                        Add New Team
                    </button>
                </div>

                <!-- Team List Grid -->
                <div id="team-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Team cards will be injected here by JavaScript -->
                    <p id="team-list-placeholder" class="text-gray-500 col-span-full text-center py-12">
                        No teams found. Add your first team to get started!
                    </p>
                </div>
            </div>
            
            <!-- Page: Team Detail -->
            <div id="page-team-detail" class="page p-6 md:p-10">
                <!-- Header -->
                <div class="flex items-center mb-8">
                    <button id="back-to-teams-btn" class="btn-icon mr-3">
                        <i data-lucide="arrow-left" class="h-6 w-6"></i>
                    </button>
                    <h1 class="text-3xl font-bold" id="team-detail-name">Team Name</h1>
                    <span id="team-detail-sport-badge" class="ml-4 inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium"></span>
                </div>
                
                <!-- Grid: Add Player & Roster -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Column 1: Add Player Form -->
                    <div class="lg:col-span-1">
                        <form id="add-player-form" class="ui-card p-6 space-y-4">
                            <h2 class="text-xl font-semibold text-white mb-4">Add New Player</h2>
                            
                            <div>
                                <label for="player-name" class="block text-sm font-medium text-gray-300">Player Name</label>
                                <input type="text" id="player-name" required class="mt-1 block w-full px-3 py-2 placeholder-gray-500 sm:text-sm">
                            </div>
                            
                            <div>
                                <label for="player-position" class="block text-sm font-medium text-gray-300">Position / Role</label>
                                <select id="player-position" required class="mt-1 block w-full pl-3 pr-10 py-2 sm:text-sm">
                                    <option value="">Select role...</option>
                                </select>
                            </div>
                            
                            <div>
                                <label for="player-number" class="block text-sm font-medium text-gray-300">Jersey Number</label>
                                <input type="number" id="player-number" required class="mt-1 block w-full px-3 py-2 placeholder-gray-500 sm:text-sm">
                            </div>

                            <div id="player-form-error" class="hidden p-3 rounded-lg bg-pink-900 border border-pink-700 text-pink-100 text-sm"></div>
                            
                            <button type="submit" id="save-player-btn" class="btn btn-primary w-full">
                                Add Player
                            </button>
                        </form>
                    </div>
                    
                    <!-- Column 2: Player Roster -->
                    <div class="lg:col-span-2">
                        <h2 class="text-xl font-semibold text-white mb-4">Player Roster</h2>
                        <div class="ui-table">
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-y-dark-alt">
                                    <thead>
                                        <tr>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">#</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Name</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Position / Role</th>
                                            <th scope="col" class="relative px-6 py-3">
                                                <span class="sr-only">Delete</span>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody id="player-roster-body" class="divide-y divide-y-dark-alt">
                                        <!-- Player rows will be injected here -->
                                        <tr id="player-list-placeholder">
                                            <td colspan="4" class="px-6 py-12 text-center text-gray-500">
                                                No players added to this team yet.
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page: Player Hub -->
            <div id="page-players" class="page p-6 md:p-10">
                <h1 id="player-hub-title" class="text-3xl font-bold mb-8">Player Hub</h1>
                
                <!-- Filters -->
                <div class="flex flex-col md:flex-row gap-4 mb-6">
                    <div class="relative flex-1">
                        <input type="text" id="player-hub-search" placeholder="Search players..."
                            class="block w-full pl-10 pr-4 py-2 placeholder-gray-500 sm:text-sm">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i data-lucide="search" class="h-5 w-5 text-gray-400"></i>
                        </div>
                    </div>
                    <select id="player-hub-filter-team" class="sm:text-sm">
                        <option value="all">All Teams</option>
                        <!-- Team options populated by JS -->
                    </select>
                </div>
                
                <!-- Player List -->
                <div class="ui-table">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-y-dark-alt">
                            <thead>
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Name</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Team</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Position</th>
                                    <th scope="col" class="relative px-6 py-3">
                                        <span class="sr-only">Delete</span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="player-hub-list" class="divide-y divide-y-dark-alt">
                                <!-- Player rows will be injected here -->
                                <tr id="player-hub-placeholder">
                                    <td colspan="4" class="px-6 py-12 text-center text-gray-500">
                                        No players found. Add players via Team Management.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pagination Controls -->
                <div id="player-hub-pagination" class="mt-6 flex justify-between items-center text-sm">
                    <!-- Pagination buttons will be injected here -->
                </div>
            </div>

            <!-- Page: Competitions (Replaces Schedule) -->
            <div id="page-competitions" class="page p-6 md:p-10">
                <div class="flex justify-between items-center mb-8">
                    <h1 id="competitions-title" class="text-3xl font-bold">Competitions</h1>
                    <button id="open-add-competition-modal-btn" class="btn btn-primary">
                        <i data-lucide="plus" class="mr-2 -ml-1 h-5 w-5"></i>
                        New Competition
                    </button>
                </div>
                
                <!-- Competition List Grid -->
                <div id="competition-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Competition cards will be injected here by JavaScript -->
                    <p id="competition-list-placeholder" class="text-gray-500 col-span-full text-center py-12">
                        No competitions found. Create one to get started!
                    </p>
                </div>
            </div>

            <!-- Page: Competition Detail -->
            <div id="page-competition-detail" class="page p-6 md:p-10">
                <!-- Header -->
                <div class="flex items-center mb-8">
                    <button id="back-to-competitions-btn" class="btn-icon mr-3">
                        <i data-lucide="arrow-left" class="h-6 w-6"></i>
                    </button>
                    <div>
                        <h1 class="text-3xl font-bold" id="competition-detail-name">Competition Name</h1>
                        <p class="text-yellow-300" id="competition-detail-type">Competition Type</p>
                    </div>
                </div>

                <!-- Fixture List for this Competition -->
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-2xl font-bold">Fixtures</h2>
                    <button id="open-add-fixture-modal-btn" class="btn btn-primary">
                        <i data-lucide="calendar-plus" class="mr-2 -ml-1 h-5 w-5"></i>
                        Add New Fixture
                    </button>
                </div>
                
                <div id="fixture-list" class="space-y-6">
                    <!-- Fixture items will be injected here -->
                    <p id="fixture-list-placeholder" class="text-gray-500 text-center py-12">
                        No fixtures scheduled for this competition.
                    </p>
                </div>
            </div>
            
            <!-- Page: Live Match Center (Landing) -->
            <div id="page-live" class="page p-6 md:p-10">
                <h1 class="text-3xl font-bold mb-8">Live Match Center</h1>
                <div id="live-match-list" class="space-y-4">
                     <!-- Active matches will be listed here -->
                </div>
                <div id="live-match-placeholder" class="ui-card p-6">
                    <h2 class="text-xl font-semibold mb-4">No Live Matches</h2>
                    <div class="text-center text-gray-500 py-12">
                        <i data-lucide="radio-tower" class="mx-auto h-12 w-12"></i>
                        <p class="mt-4">Please go to the <a href="#" data-page="schedule" class="font-medium btn-link nav-link-inline">Schedule & Fixtures</a> page to start a new match.</p>
                        <p class="text-sm mt-2">Active live matches will appear here.</p>
                    </div>
                </div>
            </div>

            <!-- 
              ================================================================
              LIVE CRICKET SCORECARD (BROADCAST THEME)
              ================================================================
            -->
            <div id="page-live-cricket" class="page p-6 md:p-10 space-y-6">
                <!-- Header -->
                <div class="flex items-center">
                    <button id="back-to-live-center-btn-cricket" class="btn-icon mr-3">
                        <i data-lucide="arrow-left" class="h-6 w-6"></i>
                    </button>
                    <div>
                        <h1 class="text-2xl font-bold" id="cricket-match-title">Team A vs Team B</h1>
                        <p class="text-sm text-pink-400" id="cricket-match-subtitle">Live Cricket Scorecard</p>
                    </div>
                </div>
                
                <!-- BBL/IPL Scorebug -->
                <div class="scorebug-bbl">
                    <!-- ... (no changes to BBL theme internals) ... -->
                    <div class="flex justify-between items-center">
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-400">BATTING</p>
                            <p class="text-3xl font-bold text-white uppercase" id="cricket-scorebug-team-name">TEAM A</p>
                        </div>
                        <div class="text-right">
                            <p class="text-5xl font-extrabold text-white" id="cricket-scorebug-score">0/0</p>
                            <p class="text-lg font-medium text-white" id="cricket-scorebug-overs">(0.0)</p>
                        </div>
                    </div>
                    <div class="mt-4 pt-3 border-t border-pink-500/30 flex justify-between text-sm items-center">
                        <p class="text-white font-semibold">CRR: <span id="cricket-scorebug-crr" class="text-lg text-yellow-300 ml-1">0.00</span></p>
                        <p id="cricket-scorebug-target" class="text-gray-400 text-xs">Target: 0</p>
                        <p class="text-white font-semibold">RRR: <span id="cricket-scorebug-rrr" class="text-lg text-yellow-300 ml-1">0.00</span></p>
                    </div>
                    <p class="text-center text-sm text-yellow-300 font-medium mt-3" id="cricket-scorebug-status">Team A requires 0 runs to win.</p>
                </div>

                <!-- BBL/IPL Lower Third (Batsmen & Bowler) -->
                <div class="lower-third-container">
                    <!-- ... (no changes to BBL theme internals) ... -->
                    <div class="batsman-card on-strike">
                        <span class="strike-indicator">
                            <i data-lucide="bat" class="inline h-3 w-3"></i> STRIKE
                        </span>
                        <h3 class="text-xl font-bold text-white" id="cricket-batsman-1-name">Batsman 1</h3>
                        <div class="batsman-stats">
                            <div class="stat"><span class="label">R</span><span class="value" id="cricket-batsman-1-runs">0</span></div>
                            <div class="stat"><span class="label">B</span><span class="value" id="cricket-batsman-1-balls">0</span></div>
                            <div class="stat"><span class="label">4s</span><span class="value" id="cricket-batsman-1-4s">0</span></div>
                            <div class="stat"><span class="label">6s</span><span class="value" id="cricket-batsman-1-6s">0</span></div>
                            <div class="stat"><span class="label">SR</span><span class="value" id="cricket-batsman-1-sr">0.00</span></div>
                        </div>
                    </div>
                    <div class="batsman-card">
                        <h3 class="text-xl font-bold text-gray-300" id="cricket-batsman-2-name">Batsman 2</h3>
                        <div class="batsman-stats">
                            <div class="stat"><span class="label">R</span><span class="value" id="cricket-batsman-2-runs">0</span></div>
                            <div class="stat"><span class="label">B</span><span class="value" id="cricket-batsman-2-balls">0</span></div>
                            <div class="stat"><span class="label">4s</span><span class="value" id="cricket-batsman-2-4s">0</span></div>
                            <div class="stat"><span class="label">6s</span><span class="value" id="cricket-batsman-2-6s">0</span></div>
                            <div class="stat"><span class="label">SR</span><span class="value" id="cricket-batsman-2-sr">0.00</span></div>
                        </div>
                    </div>
                    <div class="bowler-card">
                        <h3 class="text-xl font-bold text-white" id="cricket-bowler-name">Bowler</h3>
                        <div class="bowler-stats">
                            <div class="stat"><span class="label">O</span><span class="value" id="cricket-bowler-overs">0.0</span></div>
                            <div class="stat"><span class="label">M</span><span class="value" id="cricket-bowler-maidens">0</span></div>
                            <div class="stat"><span class="label">R</span><span class="value" id="cricket-bowler-runs">0</span></div>
                            <div class="stat"><span class="label">W</span><span class="value text-pink-500" id="cricket-bowler-wickets">0</span></div>
                            <div class="stat"><span class="label">Econ</span><span class="value" id="cricket-bowler-econ">0.00</span></div>
                        </div>
                    </div>
                </div>

                <!-- This Over -->
                <div class="ui-card p-4">
                    <h3 class="text-sm font-medium text-gray-400 uppercase tracking-wider mb-3">This Over</h3>
                    <div id="cricket-this-over" class="flex flex-wrap">
                        <p class="text-gray-500">No balls bowled yet.</p>
                    </div>
                </div>

                <!-- Scoring Controls (Re-styled) -->
                <div id="scoring-controls" class="scoring-controls-bbl p-6">
                    <!-- ... (no changes to BBL theme internals) ... -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-semibold mb-4 text-white">Runs</h3>
                            <div class="grid grid-cols-3 gap-3">
                                <button class="score-btn-bbl" data-event='{"type": "run", "value": 0}'>0</button>
                                <button class="score-btn-bbl" data-event='{"type": "run", "value": 1}'>1</button>
                                <button class="score-btn-bbl" data-event='{"type": "run", "value": 2}'>2</button>
                                <button class="score-btn-bbl" data-event='{"type": "run", "value": 3}'>3</button>
                                <button class="score-btn-bbl boundary" data-event='{"type": "run", "value": 4}'>4</button>
                                <button class="score-btn-bbl boundary" data-event='{"type": "run", "value": 6}'>6</button>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold mb-4 text-white">Extras & Actions</h3>
                            <div class="grid grid-cols-2 gap-3">
                                <button class="score-btn-bbl extra" data-event='{"type": "extra", "value": "wd"}'>Wide (WD)</button>
                                <button class="score-btn-bbl extra" data-event='{"type": "extra", "value": "nb"}'>No Ball (NB)</button>
                                <button class="score-btn-bbl extra" data-event='{"type": "extra", "value": "b"}'>Bye (B)</button>
                                <button class="score-btn-bbl extra" data-event='{"type": "extra", "value": "lb"}'>Leg Bye (LB)</button>
                                <button id="wicket-btn" class="score-btn-bbl wicket" data-event='{"type": "wicket"}'>WICKET</button>
                                <div class="grid grid-cols-2 gap-3">
                                    <button class="score-btn-bbl action" data-event='{"type": "action", "value": "swap"}' title="Swap Batsmen"><i data-lucide="repeat" class="pointer-events-none mx-auto"></i></button>
                                    <button class="score-btn-bbl action" data-event='{"type": "action", "value": "undo"}' title="Undo"><i data-lucide="undo-2" class="pointer-events-none mx-auto"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Full Scorecard Tables (Re-styled) -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="scorecard-table-bbl overflow-hidden">
                        <!-- ... (no changes to BBL theme internals) ... -->
                        <h3 class="text-xl font-semibold p-4" id="cricket-batting-table-name">Team A Batting</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full">
                                <thead>
                                    <tr>
                                        <th class="px-4 py-2 text-left text-xs font-medium uppercase">Batsman</th>
                                        <th class="px-2 py-2 text-right text-xs font-medium uppercase">R</th>
                                        <th class="px-2 py-2 text-right text-xs font-medium uppercase">B</th>
                                        <th class="px-2 py-2 text-right text-xs font-medium uppercase">4s</th>
                                        <th class="px-2 py-2 text-right text-xs font-medium uppercase">6s</th>
                                        <th class="px-4 py-2 text-right text-xs font-medium uppercase">SR</th>
                                    </tr>
                                </thead>
                                <tbody id="cricket-batting-table" class="divide-y">
                                    <tr id="cricket-batting-placeholder"><td colspan="6" class="p-4 text-center text-gray-500">Match has not started.</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="scorecard-table-bbl overflow-hidden">
                        <!-- ... (no changes to BBL theme internals) ... -->
                        <h3 class="text-xl font-semibold p-4" id="cricket-bowling-table-name">Team B Bowling</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full">
                                <thead>
                                    <tr>
                                        <th class="px-4 py-2 text-left text-xs font-medium uppercase">Bowler</th>
                                        <th class="px-2 py-2 text-right text-xs font-medium uppercase">O</th>
                                        <th class="px-2 py-2 text-right text-xs font-medium uppercase">M</th>
                                        <th class="px-2 py-2 text-right text-xs font-medium uppercase">R</th>
                                        <th class="px-2 py-2 text-right text-xs font-medium uppercase">W</th>
                                        <th class="px-4 py-2 text-right text-xs font-medium uppercase">Econ</th>
                                    </tr>
                                </thead>
                                <tbody id="cricket-bowling-table" class="divide-y">
                                    <tr id="cricket-bowling-placeholder"><td colspan="6" class="p-4 text-center text-gray-500">Match has not started.</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Page: Live Football Scorecard -->
            <div id="page-live-football" class="page p-6 md:p-10">
                <!-- Header -->
                <div class="flex items-center mb-6">
                    <button id="back-to-live-center-btn-football" class="btn-icon mr-3">
                        <i data-lucide="arrow-left" class="h-6 w-6"></i>
                    </button>
                    <div>
                        <h1 class="text-3xl font-bold" id="football-match-title">Team A vs Team B</h1>
                        <p class="text-sm text-yellow-300">Live Football Match</p>
                    </div>
                </div>
                
                <!-- Main Score -->
                <div class="ui-card p-6 mb-6 flex items-center justify-between">
                    <div class="text-center">
                        <p class="text-2xl font-bold text-white" id="football-team-1-name">Team A</p>
                    </div>
                    <div class="text-center">
                        <p class="text-6xl font-extrabold text-white" id="football-score">0 - 0</p>
                        <p class="text-2xl font-medium text-yellow-300 mt-2" id="football-timer">00:00</p>
                        <p class="text-sm text-gray-400" id="football-match-status">First Half</p>
                    </div>
                    <div class="text-center">
                        <p class="text-2xl font-bold text-white" id="football-team-2-name">Team B</p>
                    </div>
                </div>

                <!-- Match Controls -->
                <div class="ui-card p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-4">Match Controls</h3>
                    <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
                        <button id="football-timer-toggle" class="btn btn-primary flex items-center justify-center">
                            <i data-lucide="play" class="mr-2 h-5 w-5"></i>
                            Start Timer
                        </button>
                        <button class="football-event-btn btn bg-green-600 hover:bg-green-500" data-event="goal">Goal</button>
                        <button class="football-event-btn btn bg-yellow-500 hover:bg-yellow-400 text-bbl-darker" data-event="yellow">Yellow Card</button>
                        <button class="football-event-btn btn bg-red-600 hover:bg-red-500" data-event="red">Red Card</button>
                        <button class="football-event-btn btn bg-blue-600 hover:bg-blue-500" data-event="sub">Substitution</button>
                    </div>
                </div>

                <!-- Match Content Tabs -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Match Events -->
                    <div class="lg:col-span-2 ui-table">
                        <h3 class="text-xl font-semibold p-4">Match Events</h3>
                        <div id="football-event-log" class="p-4 space-y-4 h-96 overflow-y-auto">
                            <!-- Events populated by JS -->
                            <p class-"text-gray-500 text-center p-8">Match has not started. No events yet.</p>
                        </div>
                    </div>
                    <!-- Lineups -->
                    <div class="lg:col-span-1 ui-table">
                        <h3 class="text-xl font-semibold p-4">Lineups</h3>
                        <div class="grid grid-cols-2 gap-4 p-4">
                            <div>
                                <h4 class="font-semibold text-white mb-2" id="football-lineup-team-1-name">Team A</h4>
                                <ul id="football-lineup-team-1" class="text-sm text-gray-300 space-y-1">
                                    <!-- Players populated by JS -->
                                    <li>Player 1</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-white mb-2" id="football-lineup-team-2-name">Team B</h4>
                                <ul id="football-lineup-team-2" class="text-sm text-gray-300 space-y-1">
                                    <!-- Players populated by JS -->
                                    <li>Player A</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>
<!-- Page: Competitions (Replaces Schedule) -->
<div id="page-competitions" class="page p-6 md:p-10">
    <div class="flex justify-between items-center mb-8">
        <h1 id="competitions-title" class="text-3xl font-bold">Competitions</h1>
        <button id="open-add-competition-modal-btn" class="btn btn-primary">
            <i data-lucide="plus" class="mr-2 -ml-1 h-5 w-5"></i>
            New Competition
        </button>
    </div>
    
    <!-- Competition List Grid -->
    <div id="competition-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Competition cards will be injected here by JavaScript -->
        <p id="competition-list-placeholder" class="text-gray-500 col-span-full text-center py-12">
            No competitions found. Create one to get started!
        </p>
    </div>
</div>
<!-- Page: Competition Detail -->
<div id="page-competition-detail" class="page p-6 md:p-10">
    <!-- Header -->
    <div class="flex items-center mb-8">
        <button id="back-to-competitions-btn" class="btn-icon mr-3">
            <i data-lucide="arrow-left" class="h-6 w-6"></i>
        </button>
        <div>
            <h1 class="text-3xl font-bold" id="competition-detail-name">Competition Name</h1>
            <p class="text-yellow-300" id="competition-detail-type">Competition Type</p>
        </div>
    </div>

    <!-- Fixture List for this Competition -->
    <div class="flex justify-between items-center mb-8">
        <h2 class="text-2xl font-bold">Fixtures</h2>
        <button id="open-add-fixture-modal-btn" class="btn btn-primary">
            <i data-lucide="calendar-plus" class="mr-2 -ml-1 h-5 w-5"></i>
            Add New Fixture
        </button>
    </div>
    
    <div id="fixture-list" class="space-y-6">
        <!-- Fixture items will be injected here -->
        <p id="fixture-list-placeholder" class="text-gray-500 text-center py-12">
            No fixtures scheduled for this competition.
        </p>
    </div>
</div>
    <!-- 
      ================================================================
      MODALS (Re-themed)
      ================================================================
    -->

    <!-- Add Team Modal -->
    <div id="add-team-modal" class="hidden fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div id="add-team-modal-overlay" class="fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity" aria-hidden="true"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="ui-modal inline-block align-bottom rounded-lg text-left overflow-hidden transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <form id="add-team-form">
                    <div class="px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-yellow-900 sm:mx-0 sm:h-10 sm:w-10">
                                <i data-lucide="shield-plus" class="h-6 w-6 text-yellow-300"></i>
                            </div>
                            <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                                <h3 class="text-lg leading-6 font-medium text-white" id="modal-title">Create New Team</h3>
                                <div class="mt-4 space-y-4">
                                    <div>
                                        <label for="team-name" class="block text-sm font-medium text-gray-300">Team Name</label>
                                        <input type="text" name="team-name" id="team-name" required class="mt-1 block w-full px-3 py-2 placeholder-gray-500 sm:text-sm">
                                    </div>
                                    <p class="text-sm text-gray-400">This team will be added to your <strong id="add-team-modal-sport-label" class="text-yellow-300"></strong> management suite.</p>
                                    <div id="form-error" class="hidden p-3 rounded-lg bg-pink-900 border border-pink-700 text-pink-100 text-sm"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="ui-modal-footer px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="submit" id="save-team-btn" class="btn btn-primary w-full sm:ml-3 sm:w-auto sm:text-sm">
                            Create Team
                        </button>
                        <button type="button" id="close-add-team-modal-btn" class="btn btn-secondary mt-3 w-full sm:mt-0 sm:w-auto sm:text-sm">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Add Fixture Modal -->
    <div id="add-fixture-modal" class="hidden fixed inset-0 z-50 overflow-y-auto" aria-labelledby="fixture-modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div id="add-fixture-modal-overlay" class="fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity" aria-hidden="true"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="ui-modal inline-block align-bottom rounded-lg text-left overflow-hidden transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <form id="add-fixture-form">
                    <div class="px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-yellow-900 sm:mx-0 sm:h-10 sm:w-10">
                                <i data-lucide="calendar-plus" class="h-6 w-6 text-yellow-300"></i>
                            </div>
                            <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                                <h3 class="text-lg leading-6 font-medium text-white" id="fixture-modal-title">Create New Fixture</h3>
                                <div class="mt-4 space-y-4">
                                    <p class="text-sm text-gray-400">Fixture will be for your active <strong id="add-fixture-modal-sport-label" class="text-yellow-300"></strong> suite.</p>
                                    <div>
                                        <label for="fixture-team1" class="block text-sm font-medium text-gray-300">Team 1 (Home)</label>
                                        <select id="fixture-team1" name="fixture-team1" required class="mt-1 block w-full pl-3 pr-10 py-2 sm:text-sm">
                                            <option value="">Loading teams...</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="fixture-team2" class="block text-sm font-medium text-gray-300">Team 2 (Away)</label>
                                        <select id="fixture-team2" name="fixture-team2" required class="mt-1 block w-full pl-3 pr-10 py-2 sm:text-sm">
                                            <option value="">Loading teams...</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="fixture-datetime" class="block text-sm font-medium text-gray-300">Date & Time</label>
                                        <input type="datetime-local" id="fixture-datetime" required class="mt-1 block w-full px-3 py-2 sm:text-sm">
                                    </div>
                                    <div>
                                        <label for="fixture-venue" class="block text-sm font-medium text-gray-300">Venue</label>
                                        <input type="text" id="fixture-venue" required placeholder="e.g. National Stadium" class="mt-1 block w-full px-3 py-2 placeholder-gray-500 sm:text-sm">
                                    </div>
                                    <div id="fixture-form-error" class="hidden p-3 rounded-lg bg-pink-900 border border-pink-700 text-pink-100 text-sm"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="ui-modal-footer px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="submit" id="save-fixture-btn" class="btn btn-primary w-full sm:ml-3 sm:w-auto sm:text-sm">
                            Schedule Fixture
                        </button>
                        <button type="button" id="close-add-fixture-modal-btn" class="btn btn-secondary mt-3 w-full sm:mt-0 sm:w-auto sm:text-sm">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="hidden fixed inset-0 z-50 overflow-y-auto" aria-labelledby="confirm-modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div id="confirm-modal-overlay" class="fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity" aria-hidden="true"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="ui-modal inline-block align-bottom rounded-lg text-left overflow-hidden transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-pink-900 sm:mx-0 sm:h-10 sm:w-10">
                            <i data-lucide="alert-triangle" class="h-6 w-6 text-pink-500"></i>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <h3 class="text-lg leading-6 font-medium text-white" id="confirm-title">Confirmation</h3>
                            <div class="mt-2">
                                <p class="text-sm text-gray-300" id="confirm-message">Are you sure?</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ui-modal-footer px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="confirm-action-btn" class="btn btn-danger w-full sm:ml-3 sm:w-auto sm:text-sm">
                        Confirm Action
                    </button>
                    <button type="button" id="confirm-cancel-btn" class="btn btn-secondary mt-3 w-full sm:mt-0 sm:w-auto sm:text-sm">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div id="add-competition-modal" class="hidden fixed inset-0 z-50 overflow-y-auto" aria-labelledby="competition-modal-title" role="dialog" aria-modal="true">
    <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <div id="add-competition-modal-overlay" class="fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity" aria-hidden="true"></div>
        <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
        <div class="ui-modal inline-block align-bottom rounded-lg text-left overflow-hidden transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
            <form id="add-competition-form">
                <div class="px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-yellow-900 sm:mx-0 sm:h-10 sm:w-10">
                            <i data-lucide="trophy" class="h-6 w-6 text-yellow-300"></i>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <h3 class="text-lg leading-6 font-medium text-white" id="competition-modal-title">Create New Competition</h3>
                            <div class="mt-4 space-y-4">
                                <div>
                                    <label for="competition-name" class="block text-sm font-medium text-gray-300">Competition Name</label>
                                    <input type="text" name="competition-name" id="competition-name" required placeholder="e.g. Summer League 2025" class="mt-1 block w-full px-3 py-2 placeholder-gray-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="competition-type" class="block text-sm font-medium text-gray-300">Competition Type</label>
                                    <select id="competition-type" name="competition-type" required class="mt-1 block w-full pl-3 pr-10 py-2 sm:text-sm">
                                        <option value="">Select type...</option>
                                        <option value="Tournament">Tournament</option>
                                        <option value="Series">Series</option>
                                        <option value="Friendly">Friendly</option>
                                    </select>
                                </div>
                                <p class="text-sm text-gray-400">This competition will be for your active <strong id="add-competition-modal-sport-label" class="text-yellow-300"></strong> suite.</p>
                                <div id="competition-form-error" class="hidden p-3 rounded-lg bg-pink-900 border border-pink-700 text-pink-100 text-sm"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ui-modal-footer px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="submit" id="save-competition-btn" class="btn btn-primary w-full sm:ml-3 sm:w-auto sm:text-sm">
                        Create Competition
                    </button>
                    <button type="button" id="close-add-competition-modal-btn" class="btn btn-secondary mt-3 w-full sm:mt-0 sm:w-auto sm:text-sm">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

    <!-- 
      ================================================================
      MATCH SETUP & SCORING MODALS (Re-themed)
      ================================================================
    -->

    <!-- UPDATED: Match Setup Modal (Multi-step) -->
    <div id="match-setup-modal" class="hidden fixed inset-0 z-50 overflow-y-auto" aria-labelledby="match-setup-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity" aria-hidden="true"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="ui-modal inline-block align-bottom rounded-lg text-left overflow-hidden transform transition-all sm:my-8 sm:align-middle sm:max-w-3xl sm:w-full">
                <div class="ui-modal-header px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-yellow-900 sm:mx-0 sm:h-10 sm:w-10">
                            <i data-lucide="settings-2" class="h-6 w-6 text-yellow-300"></i>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <h3 class="text-lg leading-6 font-medium text-white" id="match-setup-title">Cricket Match Setup</h3>
                            <p class="text-sm text-gray-400" id="match-setup-subtitle">Prepare the live scorecard.</p>
                            <div id="match-setup-error" class="hidden p-3 rounded-lg bg-pink-900 border border-pink-700 text-pink-100 text-sm my-4"></div>
                        </div>
                    </div>
                </div>

                <!-- Step 1: Match Format -->
                <div id="match-setup-step-format" class="px-6 pb-6 pt-4">
                    <h4 class="text-md font-semibold text-white mb-4">Step 1: Select Match Format</h4>
                    <div class="space-y-4">
                        <!-- T20 -->
                        <label class="format-select-label">
                            <input type="radio" name="match-format" value="t20" class="hidden" checked>
                            <div class="format-select-label-content p-4">
                                <h3>T20 (20 Overs)</h3>
                                <p>Standard 20 overs, 10 wickets per innings.</p>
                            </div>
                        </label>
                        <!-- ODI -->
                        <label class="format-select-label">
                            <input type="radio" name="match-format" value="odi" class="hidden">
                            <div class="format-select-label-content p-4">
                                <h3>ODI (50 Overs)</h3>
                                <p>Standard 50 overs, 10 wickets per innings.</p>
                            </div>
                        </label>
                        <!-- Custom -->
                        <label class="format-select-label">
                            <input type="radio" name="match-format" value="custom" class="hidden">
                            <div class="format-select-label-content p-4">
                                <h3>Custom Format</h3>
                                <p>Set your own number of overs and wickets.</p>
                            </div>
                        </label>
                    </div>
                    <div id="match-setup-custom-options" class="hidden mt-4 space-y-4 p-4 bg-bbl-darker rounded-lg">
                        <div>
                            <label for="custom-overs" class="block text-sm font-medium text-gray-300">Total Overs per Innings</label>
                            <input type="number" id="custom-overs" value="10" class="mt-1 block w-full px-3 py-2 placeholder-gray-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="custom-wickets" class="block text-sm font-medium text-gray-300">Total Wickets per Innings</label>
                            <input type="number" id="custom-wickets" value="10" class="mt-1 block w-full px-3 py-2 placeholder-gray-500 sm:text-sm">
                        </div>
                    </div>
                </div>

                <!-- Step 2: Select Playing XI -->
                <div id="match-setup-step-players" class="hidden px-6 pb-6 pt-4">
                    <h4 class="text-md font-semibold text-white mb-2">Step 2: Select Playing XI (11 players per team)</h4>
                    <div class="grid grid-cols-2 gap-6 max-h-96 overflow-y-auto p-4 bg-bbl-darkest rounded-lg">
                        <!-- Team 1 Player List -->
                        <div>
                            <h5 class="text-lg font-semibold text-yellow-300 mb-2" id="match-setup-team1-name">Team 1</h5>
                            <div id="match-setup-team1-players" class="space-y-2">
                                <div class="spinner mx-auto"></div>
                            </div>
                        </div>
                        <!-- Team 2 Player List -->
                        <div>
                            <h5 class="text-lg font-semibold text-pink-500 mb-2" id="match-setup-team2-name">Team 2</h5>
                            <div id="match-setup-team2-players" class="space-y-2">
                                <div class="spinner mx-auto"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Toss -->
                <div id="match-setup-step-toss" class="hidden px-6 pb-6 pt-4">
                    <h4 class="text-md font-semibold text-white mb-4">Step 3: Toss Details</h4>
                    <div class="space-y-4">
                        <div>
                            <label for="match-setup-toss-winner" class="block text-sm font-medium text-gray-300">Toss Winner</label>
                            <select id="match-setup-toss-winner" required class="mt-1 block w-full pl-3 pr-10 py-2 sm:text-sm">
                                <!-- Populated by JS -->
                            </select>
                        </div>
                        <div>
                            <label for="match-setup-toss-decision" class="block text-sm font-medium text-gray-300">Decision</label>
                            <select id="match-setup-toss-decision" required class="mt-1 block w-full pl-3 pr-10 py-2 sm:text-sm">
                                <option value="bat">Elected to Bat</option>
                                <option value="bowl">Elected to Bowl</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Step 4: Select Openers -->
                <div id="match-setup-step-openers" class="hidden px-6 pb-6 pt-4">
                    <h4 class="text-md font-semibold text-white mb-4">Step 4: Select Openers for <span id="match-setup-batting-team-name" class="text-yellow-300"></span></h4>
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <label for="match-setup-batsman-1" class="block text-sm font-medium text-gray-300">Opening Batsman (Strike)</label>
                            <select id="match-setup-batsman-1" required class="mt-1 block w-full pl-3 pr-10 py-2 sm:text-sm">
                                <!-- Populated by JS -->
                            </select>
                        </div>
                        <div>
                            <label for="match-setup-batsman-2" class="block text-sm font-medium text-gray-300">Opening Batsman (Non-Strike)</label>
                            <select id="match-setup-batsman-2" required class="mt-1 block w-full pl-3 pr-10 py-2 sm:text-sm">
                                <!-- Populated by JS -->
                            </select>
                        </div>
                        <div class="col-span-2">
                            <label for="match-setup-bowler" class="block text-sm font-medium text-gray-300">Opening Bowler (for <span id="match-setup-bowling-team-name" class="text-pink-500"></span>)</label>
                            <select id="match-setup-bowler" required class="mt-1 block w-full pl-3 pr-10 py-2 sm:text-sm">
                                <!-- Populated by JS -->
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Footer / Navigation -->
                <div class="ui-modal-footer px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="match-setup-next-btn" class="btn btn-primary w-full sm:ml-3 sm:w-auto sm:text-sm">
                        Next
                    </button>
                    <button type="button" id="match-setup-start-btn"
                        class="hidden btn bg-green-600 hover:bg-green-500 text-white w-full sm:ml-3 sm:w-auto sm:text-sm">
                        Start Match
                    </button>
                    <button type="button" id="match-setup-back-btn" class="hidden btn btn-secondary mt-3 w-full sm:mt-0 sm:w-auto sm:text-sm">
                        Back
                    </button>
                    <button type="button" id="match-setup-cancel-btn" class="btn btn-secondary mt-3 w-full sm:mt-0 sm:w-auto sm:text-sm">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- NEW: Select Player Modal (Generic) -->
    <div id="select-player-modal" class="hidden fixed inset-0 z-50 overflow-y-auto" aria-labelledby="select-player-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity" aria-hidden="true"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="ui-modal inline-block align-bottom rounded-lg text-left overflow-hidden transform transition-all sm:my-8 sm:align-middle sm:max-w-md sm:w-full">
                <div class="px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <h3 class="text-lg leading-6 font-medium text-white" id="select-player-modal-title">Select Player</h3>
                    <div id="select-player-error" class="hidden p-3 rounded-lg bg-pink-900 border border-pink-700 text-pink-100 text-sm my-4"></div>
                    <div id="select-player-list" class="mt-4 space-y-2 max-h-80 overflow-y-auto">
                        <!-- Player list will be injected here -->
                    </div>
                </div>
                <div class="ui-modal-footer px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="select-player-confirm-btn" class="btn btn-primary w-full sm:ml-3 sm:w-auto sm:text-sm">
                        Confirm
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- NEW: Wicket Modal -->
    <div id="wicket-modal" class="hidden fixed inset-0 z-50 overflow-y-auto" aria-labelledby="wicket-modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity" aria-hidden="true"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="ui-modal inline-block align-bottom rounded-lg text-left overflow-hidden transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <form id="wicket-form">
                    <div class="px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-pink-900 sm:mx-0 sm:h-10 sm:w-10">
                                <i data-lucide="x" class="h-6 w-6 text-pink-500"></i>
                            </div>
                            <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                                <h3 class="text-lg leading-6 font-medium text-white" id="wicket-modal-title">Wicket Details</h3>
                                <div id="wicket-form-error" class="hidden p-3 rounded-lg bg-pink-900 border border-pink-700 text-pink-100 text-sm my-4"></div>
                                <div class="mt-4 space-y-4">
                                    <!-- --- FIX: ADDED MISSING WICKET FORM FIELDS --- -->
                                    <div>
                                        <label for="wicket-batsman-out" class="block text-sm font-medium text-gray-300">Batsman Out</label>
                                        <select id="wicket-batsman-out" required class="mt-1 block w-full pl-3 pr-10 py-2 sm:text-sm">
                                            <!-- Populated by JS -->
                                        </select>
                                    </div>
                                    <div>
                                        <label for="wicket-method" class="block text-sm font-medium text-gray-300">Method of Dismissal</label>
                                        <select id="wicket-method" required class="mt-1 block w-full pl-3 pr-10 py-2 sm:text-sm">
                                            <option value="">Select method...</option>
                                            <option value="bowled">Bowled</option>
                                            <option value="caught">Caught</option>
                                            <option value="lbw">LBW</option>
                                            <option value="run_out">Run Out</option>
                                            <option value="stumped">Stumped</option>
                                            <option value="hit_wicket">Hit Wicket</option>
                                            <option value="retired_hurt">Retired Hurt</option>
                                        </select>
                                    </div>
                                    <div id="wicket-fielder-container" class="hidden">
                                        <label for="wicket-fielder" class="block text-sm font-medium text-gray-300">Fielder (if any)</label>
                                        <select id="wicket-fielder" class="mt-1 block w-full pl-3 pr-10 py-2 sm:text-sm">
                                            <!-- Populated by JS -->
                                        </select>
                                    </div>
                                    <!-- --- END FIX --- -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="ui-modal-footer px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="submit" id="wicket-confirm-btn" class="btn btn-danger w-full sm:ml-3 sm:w-auto sm:text-sm">
                            Confirm Wicket
                        </button>
                        <button type="button" id="wicket-cancel-btn" class="btn btn-secondary mt-3 w-full sm:mt-0 sm:w-auto sm:text-sm">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <!-- 
      ================================================================
      FIREBASE & APP SCRIPT
      ================================================================
    -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            signOut, 
            onAuthStateChanged,
            signInWithCustomToken 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            setDoc,
            addDoc, 
            collection, 
            onSnapshot, 
            query, 
            deleteDoc,
            getDocs,
            getDoc,
            updateDoc,
            where,
            Timestamp,
            setLogLevel,
            orderBy,
            limit
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- USER'S FIREBASE CONFIG ---
        const firebaseConfig = typeof __firebase_config !== 'undefined' 
            ? JSON.parse(__firebase_config)
            : {
                apiKey: "AIzaSyALDvARNn53B2zwf1jw8JPttLEhCD1ffrk",
                authDomain: "sportsshilpo.firebaseapp.com",
                projectId: "sportsshilpo",
                storageBucket: "sportsshilpo.firebasestorage.app",
                messagingSenderId: "635482595748",
                appId: "1:635482595748:web:45758a2a58b50a458f2131",
                measurementId: "G-70DSXBKX41"
            };

        // --- INITIALIZE FIREBASE ---
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        setLogLevel('Debug'); // Enable Firestore debug logging

        // --- GLOBAL APP STATE ---
        let currentUserId = null;
        let currentSportMode = null; // 'cricket' or 'football'
        let currentTeamId = null; 
        let currentTeamName = null;
        let currentTeamSport = null;
        let currentMatchId = null;
        let currentMatchState = null; // Holds the live match data object
        let currentMatchSetupData = {}; // Temp object for match setup flow
          let currentCompetitionId = null;
        let currentCompetitionName = null;
        let allUserTeams = []; // Cache for team data (sport-specific)
        let allUserPlayers = []; // Cache for player data (sport-specific)
        let playerHubCurrentPage = 1;
        const playerHubItemsPerPage = 10;

        let unsubscribeFromTeams = null;
        let unsubscribeFromPlayers = null;
        let unsubscribeFromPlayerHub = null;
        let unsubscribeFromFixtures = null;
        let unsubscribeFromLiveMatches = null;
        let unsubscribeFromMatch = null;
         let unsubscribeFromCompetitions = null;
        let confirmAction = null;
        let selectPlayerCallback = null; // Callback for generic player selector

        // --- APP ID (for Firestore paths) ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'sportsshilpo';

        // --- DOM ELEMENT REFERENCES ---
        const authContainer = document.getElementById('auth-container');
        const sportSelectionContainer = document.getElementById('sport-selection-container');
        const appContainer = document.getElementById('app-container');
        const authError = document.getElementById('auth-error');
        const formError = document.getElementById('form-error');
        
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const tabLogin = document.getElementById('tab-login');
        const tabRegister = document.getElementById('tab-register');
        
        const selectSportCricket = document.getElementById('select-sport-cricket');
        const selectSportFootball = document.getElementById('select-sport-football');
        
        const navLinksContainer = document.getElementById('nav-links');
        const allPages = document.querySelectorAll('.page');
        const logoutButton = document.getElementById('logout-button');
        const switchSportButton = document.getElementById('switch-sport-button');
        const userEmailDisplay = document.getElementById('user-email-display');
        const userStatusDisplay = document.getElementById('user-status-display');
        const appTitle = document.getElementById('app-title');

        const dashboardTitle = document.getElementById('dashboard-title');
        const statsTotalTeams = document.getElementById('stats-total-teams');
        const statsTotalPlayers = document.getElementById('stats-total-players');
        const statsUpcomingFixtures = document.getElementById('stats-upcoming-fixtures');
        const statsLiveMatches = document.getElementById('stats-live-matches');

        const teamManagementTitle = document.getElementById('team-management-title');
        const teamList = document.getElementById('team-list');
        const teamListPlaceholder = document.getElementById('team-list-placeholder');
        
        const addTeamModal = document.getElementById('add-team-modal');
        const addTeamForm = document.getElementById('add-team-form');
        const openModalBtn = document.getElementById('open-add-team-modal-btn');
        const closeModalBtn = document.getElementById('close-add-team-modal-btn');
        const modalOverlay = document.getElementById('add-team-modal-overlay');
        const addTeamModalSportLabel = document.getElementById('add-team-modal-sport-label');
        
        const pageTeamDetail = document.getElementById('page-team-detail');
        const teamDetailName = document.getElementById('team-detail-name');
        const teamDetailSportBadge = document.getElementById('team-detail-sport-badge');
        const backToTeamsBtn = document.getElementById('back-to-teams-btn');
        const addPlayerForm = document.getElementById('add-player-form');
        const playerFormError = document.getElementById('player-form-error');
        const playerRosterBody = document.getElementById('player-roster-body');
        const playerListPlaceholder = document.getElementById('player-list-placeholder');
        const savePlayerBtn = document.getElementById('save-player-btn');
        
        const playerPositionSelect = document.getElementById('player-position');

        const playerHubTitle = document.getElementById('player-hub-title');
        const playerHubList = document.getElementById('player-hub-list');
        const playerHubPlaceholder = document.getElementById('player-hub-placeholder');
        const playerHubSearch = document.getElementById('player-hub-search');
        const playerHubFilterTeam = document.getElementById('player-hub-filter-team');
        const playerHubPagination = document.getElementById('player-hub-pagination');

        const scheduleTitle = document.getElementById('schedule-title');
        const fixtureList = document.getElementById('fixture-list');
        const fixtureListPlaceholder = document.getElementById('fixture-list-placeholder');
        // --- ADD THESE ---
        const competitionsTitle = document.getElementById('competitions-title');
        const competitionList = document.getElementById('competition-list');
        const competitionListPlaceholder = document.getElementById('competition-list-placeholder');
        
        const pageCompetitionDetail = document.getElementById('page-competition-detail');
        const competitionDetailName = document.getElementById('competition-detail-name');
        const competitionDetailType = document.getElementById('competition-detail-type');
        const backToCompetitionsBtn = document.getElementById('back-to-competitions-btn');
        
        const addCompetitionModal = document.getElementById('add-competition-modal');
        const addCompetitionForm = document.getElementById('add-competition-form');
        const openCompetitionModalBtn = document.getElementById('open-add-competition-modal-btn');
        const closeCompetitionModalBtn = document.getElementById('close-add-competition-modal-btn');
        const competitionModalOverlay = document.getElementById('add-competition-modal-overlay');
        const competitionFormError = document.getElementById('competition-form-error');
        const addCompetitionModalSportLabel = document.getElementById('add-competition-modal-sport-label');
        // --- END ADD ---
        const addFixtureModal = document.getElementById('add-fixture-modal');
        const addFixtureForm = document.getElementById('add-fixture-form');
        const openFixtureModalBtn = document.getElementById('open-add-fixture-modal-btn');
        const closeFixtureModalBtn = document.getElementById('close-add-fixture-modal-btn');
        const fixtureModalOverlay = document.getElementById('add-fixture-modal-overlay');
        const fixtureFormError = document.getElementById('fixture-form-error');
        const fixtureTeam1Select = document.getElementById('fixture-team1');
        const fixtureTeam2Select = document.getElementById('fixture-team2');
        const addFixtureModalSportLabel = document.getElementById('add-fixture-modal-sport-label');

        // Live Center
        const liveMatchList = document.getElementById('live-match-list');
        const liveMatchPlaceholder = document.getElementById('live-match-placeholder');

        // Live Cricket Page (NEW UI)
        const pageLiveCricket = document.getElementById('page-live-cricket');
        const backToLiveCenterBtnCricket = document.getElementById('back-to-live-center-btn-cricket');
        const cricketMatchTitle = document.getElementById('cricket-match-title');
        const cricketMatchSubtitle = document.getElementById('cricket-match-subtitle');
        
        const cricketScorebugTeamName = document.getElementById('cricket-scorebug-team-name');
        const cricketScorebugTarget = document.getElementById('cricket-scorebug-target');
        const cricketScorebugScore = document.getElementById('cricket-scorebug-score');
        const cricketScorebugOvers = document.getElementById('cricket-scorebug-overs');
        const cricketScorebugCrr = document.getElementById('cricket-scorebug-crr');
        const cricketScorebugRrr = document.getElementById('cricket-scorebug-rrr');
        const cricketScorebugStatus = document.getElementById('cricket-scorebug-status');
        
        const cricketBatsman1Name = document.getElementById('cricket-batsman-1-name');
        const cricketBatsman1Runs = document.getElementById('cricket-batsman-1-runs');
        const cricketBatsman1Balls = document.getElementById('cricket-batsman-1-balls');
        const cricketBatsman1Fours = document.getElementById('cricket-batsman-1-4s');
        const cricketBatsman1Sixes = document.getElementById('cricket-batsman-1-6s');
        const cricketBatsman1Sr = document.getElementById('cricket-batsman-1-sr');
        
        const cricketBatsman2Name = document.getElementById('cricket-batsman-2-name');
        const cricketBatsman2Runs = document.getElementById('cricket-batsman-2-runs');
        const cricketBatsman2Balls = document.getElementById('cricket-batsman-2-balls');
        const cricketBatsman2Fours = document.getElementById('cricket-batsman-2-4s');
        const cricketBatsman2Sixes = document.getElementById('cricket-batsman-2-6s');
        const cricketBatsman2Sr = document.getElementById('cricket-batsman-2-sr');
        
        const cricketBowlerName = document.getElementById('cricket-bowler-name');
        const cricketBowlerRuns = document.getElementById('cricket-bowler-runs');
        const cricketBowlerWickets = document.getElementById('cricket-bowler-wickets');
        const cricketBowlerOvers = document.getElementById('cricket-bowler-overs');
        const cricketBowlerMaidens = document.getElementById('cricket-bowler-maidens');
        const cricketBowlerEcon = document.getElementById('cricket-bowler-econ');

        const cricketThisOver = document.getElementById('cricket-this-over');
        
        const scoringControls = document.getElementById('scoring-controls');
        const wicketBtn = document.getElementById('wicket-btn');
        const cricketBattingTable = document.getElementById('cricket-batting-table');
        const cricketBowlingTable = document.getElementById('cricket-bowling-table');
        const cricketBattingTableName = document.getElementById('cricket-batting-table-name');
        const cricketBowlingTableName = document.getElementById('cricket-bowling-table-name');
        
        // Live Football Page
        const backToLiveCenterBtnFootball = document.getElementById('back-to-live-center-btn-football');
        const footballMatchTitle = document.getElementById('football-match-title');
        // ... (other football elements)

        // Confirmation Modal
        const confirmModal = document.getElementById('confirm-modal');
        const confirmModalOverlay = document.getElementById('confirm-modal-overlay');
        const confirmActionBtn = document.getElementById('confirm-action-btn');
        const confirmCancelBtn = document.getElementById('confirm-cancel-btn');
        const confirmTitle = document.getElementById('confirm-title');
        const confirmMessage = document.getElementById('confirm-message');
        
        // Match Setup Modal
        const matchSetupModal = document.getElementById('match-setup-modal');
        const matchSetupError = document.getElementById('match-setup-error');
        const matchSetupStepFormat = document.getElementById('match-setup-step-format');
        const matchSetupCustomOptions = document.getElementById('match-setup-custom-options');
        const matchSetupStepPlayers = document.getElementById('match-setup-step-players');
        const matchSetupStepToss = document.getElementById('match-setup-step-toss');
        const matchSetupStepOpeners = document.getElementById('match-setup-step-openers');
        
        const matchSetupTeam1Name = document.getElementById('match-setup-team1-name');
        const matchSetupTeam1Players = document.getElementById('match-setup-team1-players');
        const matchSetupTeam2Name = document.getElementById('match-setup-team2-name');
        const matchSetupTeam2Players = document.getElementById('match-setup-team2-players');
        const matchSetupTossWinner = document.getElementById('match-setup-toss-winner');
        const matchSetupTossDecision = document.getElementById('match-setup-toss-decision');
        const matchSetupBattingTeamName = document.getElementById('match-setup-batting-team-name');
        const matchSetupBowlingTeamName = document.getElementById('match-setup-bowling-team-name');
        const matchSetupBatsman1 = document.getElementById('match-setup-batsman-1');
        const matchSetupBatsman2 = document.getElementById('match-setup-batsman-2');
        const matchSetupBowler = document.getElementById('match-setup-bowler');
        const matchSetupNextBtn = document.getElementById('match-setup-next-btn');
        const matchSetupStartBtn = document.getElementById('match-setup-start-btn');
        const matchSetupBackBtn = document.getElementById('match-setup-back-btn');
        const matchSetupCancelBtn = document.getElementById('match-setup-cancel-btn');
        
        // Select Player Modal
        const selectPlayerModal = document.getElementById('select-player-modal');
        const selectPlayerModalTitle = document.getElementById('select-player-modal-title');
        const selectPlayerError = document.getElementById('select-player-error');
        const selectPlayerList = document.getElementById('select-player-list');
        const selectPlayerConfirmBtn = document.getElementById('select-player-confirm-btn');
        
        // Wicket Modal
        const wicketModal = document.getElementById('wicket-modal');
        const wicketForm = document.getElementById('wicket-form');
        const wicketFormError = document.getElementById('wicket-form-error');
        const wicketBatsmanOut = document.getElementById('wicket-batsman-out');
        const wicketMethod = document.getElementById('wicket-method');
        const wicketFielderContainer = document.getElementById('wicket-fielder-container');
        const wicketFielder = document.getElementById('wicket-fielder');
        const wicketConfirmBtn = document.getElementById('wicket-confirm-btn');
        const wicketCancelBtn = document.getElementById('wicket-cancel-btn');


        // --- UTILITY FUNCTIONS ---
        
        function showFormError(message, errorElement) {
            errorElement.textContent = message;
            errorElement.classList.remove('hidden');
        }

        function clearFormError(errorElement) {
            errorElement.textContent = '';
            errorElement.classList.add('hidden');
        }
        
        function switchAuthTab(tabName) {
            clearFormError(authError);
            if (tabName === 'login') {
                tabLogin.classList.add('active');
                tabLogin.classList.remove('text-gray-400', 'border-transparent', 'hover:text-gray-300', 'hover:border-gray-500');
                
                tabRegister.classList.remove('active');
                tabRegister.classList.add('text-gray-400', 'border-transparent', 'hover:text-gray-300', 'hover:border-gray-500');

                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
            } else {
                tabRegister.classList.add('active');
                tabRegister.classList.remove('text-gray-400', 'border-transparent', 'hover:text-gray-300', 'hover:border-gray-500');
                
                tabLogin.classList.remove('active');
                tabLogin.classList.add('text-gray-400', 'border-transparent', 'hover:text-gray-300', 'hover:border-gray-500');

                registerForm.classList.remove('hidden');
                loginForm.classList.add('hidden');
            }
        }
        
          function switchAppPage(pageId) {
            allPages.forEach(page => page.classList.remove('active'));
            const activePage = document.getElementById(`page-${pageId}`);
            if (activePage) {
                activePage.classList.add('active');
            } else {
                document.getElementById('page-dashboard').classList.add('active');
                pageId = 'dashboard';
            }
            
            // Update active nav link
            navLinksContainer.querySelectorAll('.nav-link').forEach(link => {
                if (link.dataset.page === pageId) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
            
            // Clear match state if we leave a scoring page
            if (pageId !== 'live-cricket' && pageId !== 'live-football') {
                 if (unsubscribeFromMatch) {
                    unsubscribeFromMatch();
                    unsubscribeFromMatch = null;
                }
                currentMatchId = null;
                currentMatchState = null;
                localStorage.removeItem('lastActiveMatchId');
            }
            
            // Clear team/competition state if we go "up" a level
            if (pageId !== 'team-detail') {
                currentTeamId = null;
                currentTeamName = null;
                currentTeamSport = null;
            }
            if (pageId !== 'competition-detail') {
                currentCompetitionId = null;
                currentCompetitionName = null;
            }

            // Load data for specific pages
            if (pageId === 'players') {
                playerHubCurrentPage = 1; // Reset page on navigation
                renderPlayerHubList();
            }
            if (pageId === 'live') {
                loadLiveMatches();
            }
            if (pageId === 'competitions') {
                loadCompetitions();
            }
            if (pageId === 'competition-detail') {
                // This page is loaded by clicking, so data *should* be present
                // But we reload fixtures just in case
                if (currentCompetitionId) {
                    loadFixtures(currentCompetitionId);
                } else {
                    // Safety check, send back to competitions
                    switchAppPage('competitions');
                }
            }
            
            localStorage.setItem('lastActivePage', pageId);
        }
        function toggleAddTeamModal(show) {
            if (show) {
                addTeamModalSportLabel.textContent = currentSportMode;
                addTeamModal.classList.remove('hidden');
            } else {
                addTeamModal.classList.add('hidden');
                addTeamForm.reset();
                clearFormError(formError);
            }
        }
        
        function toggleAddFixtureModal(show) {
            if (show) {
                addFixtureForm.reset();
                clearFormError(fixtureFormError);
                const sportName = currentSportMode.charAt(0).toUpperCase() + currentSportMode.slice(1);
                addFixtureModalSportLabel.textContent = sportName;
                updateFixtureTeamSelects(currentSportMode);
                addFixtureModal.classList.remove('hidden');
            } else {
                addFixtureModal.classList.add('hidden');
            }
        }
                // --- ADD THIS NEW FUNCTION ---
        function toggleAddCompetitionModal(show) {
            if (show) {
                addCompetitionForm.reset();
                clearFormError(competitionFormError);
                const sportName = currentSportMode.charAt(0).toUpperCase() + currentSportMode.slice(1);
                addCompetitionModalSportLabel.textContent = sportName;
                addCompetitionModal.classList.remove('hidden');
            } else {
                addCompetitionModal.classList.add('hidden');
            }
        }
        // --- END ADD ---
        function updateFixtureTeamSelects(sport) {
            const selects = [fixtureTeam1Select, fixtureTeam2Select];
            const filteredTeams = allUserTeams.filter(team => team.sport === sport);
            
            selects.forEach(select => {
                select.innerHTML = ''; // Clear options
                if (filteredTeams.length === 0) {
                    select.add(new Option(`No ${sport} teams found`, ''));
                    select.disabled = true;
                } else {
                    select.add(new Option(`Select ${sport} team`, ''));
                    filteredTeams.forEach(team => {
                        select.add(new Option(team.name, team.id));
                    });
                    select.disabled = false;
                }
            });
        }
        
        function toggleConfirmModal(show) {
            if (show) {
                confirmModal.classList.remove('hidden');
            } else {
                confirmModal.classList.add('hidden');
                confirmTitle.textContent = 'Confirmation';
                confirmMessage.textContent = 'Are you sure?';
                confirmAction = null;
            }
        }
        
        function showConfirmModal(title, message, onConfirm) {
            confirmTitle.textContent = title;
            confirmMessage.textContent = message;
            confirmAction = onConfirm;
            toggleConfirmModal(true);
        }
        
        function openSelectPlayerModal(title, playerList, disabledPlayerIds = [], onConfirm) {
            selectPlayerModalTitle.textContent = title;
            selectPlayerList.innerHTML = '';
            clearFormError(selectPlayerError);
            
            if (!playerList || playerList.length === 0) {
                selectPlayerList.innerHTML = '<p class="text-gray-500">No available players found.</p>';
                return;
            }
            
            playerList.forEach((player, index) => {
                const isDisabled = disabledPlayerIds.includes(player.id);
                selectPlayerList.innerHTML += `
                    <label class="player-select-label">
                        <input type="radio" name="selected-player" value="${player.id}" class="hidden" ${isDisabled ? 'disabled' : ''}>
                        <div class="player-select-label-content p-3">
                            <span class="font-medium text-white">${player.name}</span>
                        </div>
                    </label>
                `;
            });
            
            selectPlayerCallback = onConfirm;
            selectPlayerModal.classList.remove('hidden');
        }
        
        function closeSelectPlayerModal() {
            selectPlayerModal.classList.add('hidden');
            selectPlayerCallback = null;
        }

        function toggleWicketModal(show) {
            if (show) {
                if (!currentMatchState) return;
                
                wicketBatsmanOut.innerHTML = `
                    <option value="${currentMatchState.batsmanOnStrike.id}">${currentMatchState.batsmanOnStrike.name}</option>
                    <option value="${currentMatchState.batsmanNonStrike.id}">${currentMatchState.batsmanNonStrike.name}</option>
                `;
                
                wicketFielder.innerHTML = '<option value="">(No Fielder)</option>';
                const fielders = Object.values(currentMatchState.bowlingCard);
                fielders.forEach(fielder => {
                    wicketFielder.add(new Option(fielder.name, fielder.id));
                });
                
                wicketForm.reset();
                wicketFielderContainer.classList.add('hidden');
                clearFormError(wicketFormError);
                wicketModal.classList.remove('hidden');
            } else {
                wicketModal.classList.add('hidden');
            }
        }
        
        // --- RENDERING FUNCTIONS ---

        function renderTeamCard(teamData, docId) {
            const isCricket = teamData.sport === 'cricket';
            const card = document.createElement('div');
            card.className = `ui-card p-5 flex flex-col justify-between transition-all hover:border-yellow-300`;
            
            const sportIcon = isCricket ? 
                `<i data-lucide="siren" class="mr-1.5 h-4 w-4"></i>Cricket` :
                `<i data-lucide="siren" class="mr-1.5 h-4 w-4"></i>Football`;

            card.innerHTML = `
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <span class="inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium ${isCricket ? 'bg-emerald-900 text-emerald-200' : 'bg-pink-900 text-pink-200'}">
                            ${sportIcon}
                        </span>
                        <button class="delete-team-btn btn-icon danger" data-id="${docId}" data-name="${teamData.name}" title="Delete Team">
                            <i data-lucide="trash-2" class="h-5 w-5"></i>
                        </button>
                    </div>
                    <h3 class="text-xl font-bold text-white truncate">${teamData.name}</h3>
                </div>
                <div class="mt-4 pt-4 border-t border-t-dark-alt">
                    <button class="manage-team-btn btn-link text-sm font-medium" data-id="${docId}" data-name="${teamData.name}" data-sport="${teamData.sport}">
                        Manage Team &rarr;
                    </button>
                </div>
            `;
            
            card.querySelector('.delete-team-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                const id = e.currentTarget.dataset.id;
                const name = e.currentTarget.dataset.name;
                showConfirmModal('Delete Team?', `Are you sure you want to delete "${name}"? This will also delete all its players. This cannot be undone.`, () => {
                    handleDeleteTeam(id);
                });
            });

            teamList.appendChild(card);
        }
        
        function renderPlayerRow(playerData, docId) {
            const row = document.createElement('tr');
            
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-highlight">${playerData.number}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-100">${playerData.name}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">${playerData.position}</td>
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                    <button class="delete-player-btn btn-icon danger" data-id="${docId}" data-name="${playerData.name}" title="Delete Player">
                        <i data-lucide="trash-2" class="h-5 w-5"></i>
                    </button>
                </td>
            `;
            
            row.querySelector('.delete-player-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                const id = e.currentTarget.dataset.id;
                const name = e.currentTarget.dataset.name;
                showConfirmModal('Delete Player?', `Are you sure you want to delete "${name}" from the roster?`, () => {
                    handleDeletePlayer(id, currentTeamId);
                });
            });

            playerRosterBody.appendChild(row);
        }
        
        function renderPlayerHubList() {
            const searchTerm = playerHubSearch.value.toLowerCase();
            const teamFilter = playerHubFilterTeam.value;
            
            const filteredPlayers = allUserPlayers.filter(player => {
                const nameMatch = player.name.toLowerCase().includes(searchTerm);
                const teamMatch = (teamFilter === 'all') || (player.teamId === teamFilter);
                return nameMatch && teamMatch;
            });

            // --- Pagination Logic ---
            const totalItems = filteredPlayers.length;
            const totalPages = Math.ceil(totalItems / playerHubItemsPerPage);
            if (playerHubCurrentPage > totalPages && totalPages > 0) {
                playerHubCurrentPage = totalPages; // Go to last page if current page is out of bounds
            } else if (totalPages === 0) {
                playerHubCurrentPage = 1; // Reset if no items
            }
            const startIndex = (playerHubCurrentPage - 1) * playerHubItemsPerPage;
            const endIndex = startIndex + playerHubItemsPerPage;
            
            const paginatedPlayers = filteredPlayers.slice(startIndex, endIndex);
            // --- End Pagination Logic ---
            
            playerHubList.innerHTML = '';
            
            if (paginatedPlayers.length === 0) {
                playerHubList.appendChild(playerHubPlaceholder);
            } else {
                paginatedPlayers.forEach(player => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-highlight">${player.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">${player.teamName || 'N/A'}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">${player.position}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            <button class="delete-player-btn btn-icon danger" data-id="${player.id}" data-team-id="${player.teamId}" data-name="${player.name}" title="Delete Player">
                                <i data-lucide="trash-2" class="h-5 w-5"></i>
                            </button>
                        </td>
                    `;
                    
                    row.querySelector('.delete-player-btn').addEventListener('click', (e) => {
                        e.stopPropagation();
                        const id = e.currentTarget.dataset.id;
                        const teamId = e.currentTarget.dataset.teamId;
                        const name = e.currentTarget.dataset.name;
                        showConfirmModal('Delete Player?', `Are you sure you want to delete "${name}" from all records?`, () => {
                            handleDeletePlayer(id, teamId);
                        });
                    });
                    
                    playerHubList.appendChild(row);
                });
            }
            
            renderPlayerHubPagination(totalPages, totalItems, startIndex);
            lucide.createIcons(); // Re-run lucide to create icons in new rows
        }

        function renderPlayerHubPagination(totalPages, totalItems, startIndex) {
            playerHubPagination.innerHTML = ''; // Clear old buttons
            
            if (totalItems <= playerHubItemsPerPage) {
                return; // Don't show pagination if not needed
            }

            const startItem = totalItems === 0 ? 0 : startIndex + 1;
            const endItem = Math.min(startIndex + playerHubItemsPerPage, totalItems);
            
            let summary = document.createElement('div');
            summary.className = 'text-gray-400';
            summary.textContent = `Showing ${startItem} to ${endItem} of ${totalItems} players`;
            
            let buttonsContainer = document.createElement('div');
            
            // Previous Button
            let prevBtn = document.createElement('button');
            prevBtn.className = 'pagination-btn';
            prevBtn.innerHTML = `<i data-lucide="chevron-left" class="h-5 w-5 mr-1 pointer-events-none"></i> Prev`;
            prevBtn.disabled = playerHubCurrentPage === 1;
            prevBtn.addEventListener('click', () => {
                if (playerHubCurrentPage > 1) {
                    playerHubCurrentPage--;
                    renderPlayerHubList();
                }
            });
            buttonsContainer.appendChild(prevBtn);

            // Page Number
            let pageIndicator = document.createElement('span');
            pageIndicator.className = 'pagination-btn active';
            pageIndicator.textContent = `${playerHubCurrentPage} / ${totalPages}`;
            buttonsContainer.appendChild(pageIndicator);
            
            // Next Button
            let nextBtn = document.createElement('button');
            nextBtn.className = 'pagination-btn';
            nextBtn.innerHTML = `Next <i data-lucide="chevron-right" class="h-5 w-5 ml-1 pointer-events-none"></i>`;
            nextBtn.disabled = playerHubCurrentPage === totalPages;
            nextBtn.addEventListener('click', () => {
                if (playerHubCurrentPage < totalPages) {
                    playerHubCurrentPage++;
                    renderPlayerHubList();
                }
            });
            buttonsContainer.appendChild(nextBtn);

            playerHubPagination.appendChild(summary);
            playerHubPagination.appendChild(buttonsContainer);
            lucide.createIcons();
        }
        
        function renderFixtureCard(fixtureData, docId, container) { 
            const card = document.createElement('div');
            card.className = "ui-card p-5 flex flex-col md:flex-row md:items-center justify-between";
            
            const isCricket = fixtureData.sport === 'cricket';
            const sportIcon = isCricket ? 
                `<i data-lucide="siren" class="mr-1.5 h-4 w-4"></i>Cricket` :
                `<i data-lucide="siren" class="mr-1.5 h-4 w-4"></i>Football`;
                
            const matchTime = fixtureData.dateTime.toDate();
            const formattedDate = matchTime.toLocaleDateString(undefined, {
                weekday: 'short', month: 'short', day: 'numeric'
            });
            const formattedTime = matchTime.toLocaleTimeString(undefined, {
                hour: '2-digit', minute: '2-digit'
            });

            card.innerHTML = `
                <div class="flex-1 mb-4 md:mb-0">
                    <div class="flex items-center mb-2">
                        <span class="inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium ${isCricket ? 'bg-emerald-900 text-emerald-200' : 'bg-pink-900 text-pink-200'}">
                            ${sportIcon}
                        </span>
                        <span class="ml-3 text-sm text-gray-400">${fixtureData.venue}</span>
                    </div>
                    <h3 class="text-xl font-bold text-white">${fixtureData.team1Name} <span class="text-gray-400 font-light mx-1">vs</span> ${fixtureData.team2Name}</h3>
                    <p class="text-yellow-300 font-medium">${formattedDate} at ${formattedTime}</p>
                </div>
                <div class="flex-shrink-0 flex flex-col md:flex-row gap-3">
                    <button class="start-match-btn btn btn-primary w-full md:w-auto" data-id="${docId}" data-sport="${fixtureData.sport}">
                        <i data-lucide="play" class="mr-2 -ml-1 h-5 w-5"></i>
                        Start Match
                    </button>
                    <button class="delete-fixture-btn btn-icon danger w-full md:w-auto" data-id="${docId}" title="Delete Fixture">
                        <i data-lucide="trash-2" class="h-5 w-5"></i>
                    </button>
                </div>
            `;
            
            card.querySelector('.delete-fixture-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                const id = e.currentTarget.dataset.id;
                showConfirmModal('Delete Fixture?', 'Are you sure you want to delete this fixture?', () => {
                    handleDeleteFixture(id);
                });
            });
            
            card.querySelector('.start-match-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                const id = e.currentTarget.dataset.id;
                const sport = e.currentTarget.dataset.sport;
                handleStartMatch(id, sport);
            });

             container.appendChild(card); 
        }

        function renderLiveMatchCard(matchData) {
            const card = document.createElement('button');
            card.className = "ui-card w-full text-left p-5 transition-all hover:border-yellow-300";
            card.dataset.id = matchData.id;
            card.dataset.sport = matchData.sport;
            
            let scoreline = '';
            if (matchData.sport === 'cricket') {
                const overs = `${Math.floor(matchData.balls / 6)}.${matchData.balls % 6}`;
                scoreline = `<p class="text-2xl font-bold text-white">${matchData.battingTeamName}</p>
                             <p class="text-3xl font-extrabold text-yellow-300">${matchData.score}/${matchData.wickets} <span class="text-2xl text-gray-300">(${overs})</span></p>`;
            } else { // Football
                scoreline = `<p class="text-2xl font-bold text-white">${matchData.fixtureData.team1Name} <span class="text-3xl font-extrabold text-yellow-300">${matchData.team1Score}</span></p>
                             <p class="text-2xl font-bold text-white">${matchData.fixtureData.team2Name} <span class="text-3xl font-extrabold text-yellow-300">${matchData.team2Score}</span></p>`;
            }

            card.innerHTML = `
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="text-lg font-semibold text-white">${matchData.fixtureData.team1Name} vs ${matchData.fixtureData.team2Name}</h3>
                        <p class="text-sm text-gray-400">${matchData.fixtureData.venue}</p>
                    </div>
                    <div class="text-right">
                        ${scoreline}
                    </div>
                </div>
            `;
            
            card.addEventListener('click', () => {
                currentMatchId = matchData.id;
                listenToLiveMatch(currentMatchId);
                switchAppPage(matchData.sport === 'cricket' ? 'live-cricket' : 'live-football');
            });
            liveMatchList.appendChild(card);
        }

        // --- FIREBASE AUTH HANDLERS ---
        
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                handleUserLogin(user);
            } else if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                try {
                    const userCredential = await signInWithCustomToken(auth, __initial_auth_token);
                    handleUserLogin(userCredential.user);
                } catch (error) {
                    console.error("Custom Auth Error:", error);
                    showAuthUI();
                }
            } else {
                showAuthUI();
            }
        });
        
        async function handleUserLogin(user) {
            currentUserId = user.uid;
            userEmailDisplay.textContent = user.email || 'Anonymous User';
            userStatusDisplay.textContent = 'Online';
            
            const localSport = localStorage.getItem('lastActiveSport');
            if (localSport) {
                currentSportMode = localSport;
                authContainer.classList.add('hidden');
                sportSelectionContainer.classList.add('hidden');
                appContainer.classList.remove('hidden');
                initializeAppUI(); // Removed sport param, it's global
                return; 
            }

            const settingsDocRef = doc(db, `/artifacts/${appId}/users/${currentUserId}/settings/userSettings`);
            let sportFromSettings = null; 
            try {
                const docSnap = await getDoc(settingsDocRef);
                if (docSnap.exists()) {
                    sportFromSettings = docSnap.data().preferredSport; 
                } else {
                    console.log("No sport preference found in Firestore.");
                }
            } catch (error) {
                console.error("Error fetching user settings: ", error);
            }
            
            if (sportFromSettings) {
                currentSportMode = sportFromSettings;
                localStorage.setItem('lastActiveSport', currentSportMode);
                authContainer.classList.add('hidden');
                sportSelectionContainer.classList.add('hidden');
                appContainer.classList.remove('hidden');
                initializeAppUI();
            } else {
                authContainer.classList.add('hidden');
                appContainer.classList.add('hidden');
                sportSelectionContainer.style.display = 'flex';
                lucide.createIcons();
            }
        }
        
        function showAuthUI() {
            authContainer.classList.remove('hidden');
            sportSelectionContainer.classList.add('hidden');
            appContainer.classList.add('hidden');
            
            detachAllListeners();
            currentUserId = null;
            currentSportMode = null;
            
            localStorage.removeItem('lastActivePage');
            localStorage.removeItem('lastActiveSport');
            localStorage.removeItem('lastActiveMatchId');
        }

        async function handleSportSelection(sport) {
            if (!currentUserId) return;
            currentSportMode = sport;
            localStorage.setItem('lastActiveSport', sport);
            localStorage.setItem('lastActivePage', 'dashboard');
            localStorage.removeItem('lastActiveMatchId');
            
            const settingsDocRef = doc(db, `/artifacts/${appId}/users/${currentUserId}/settings/userSettings`);
            try {
                await setDoc(settingsDocRef, { preferredSport: sport });
                sportSelectionContainer.classList.add('hidden');
                appContainer.classList.remove('hidden');
                initializeAppUI();
            } catch (error) {
                console.error("Error saving sport preference: ", error);
            }
        }
        
        function initializeAppUI() {
            if (!currentSportMode) {
                console.error("Cannot init UI, no sport selected.");
                return;
            }
            
            // Set dashboard/team titles based on sport
            const sportCap = currentSportMode.charAt(0).toUpperCase() + currentSportMode.slice(1);
            dashboardTitle.textContent = `${sportCap} Dashboard`;
            teamManagementTitle.textContent = `${sportCap} Team Management`;
            playerHubTitle.textContent = `${sportCap} Player Hub`;
           competitionsTitle.textContent = `${sportCap} Competitions`;
            
            // Set correct gradient on logo
            if (currentSportMode === 'football') {
                appTitle.classList.remove('from-yellow-300', 'to-pink-600');
                appTitle.classList.add('from-pink-500', 'to-violet-500'); // Example for football
            } else {
                appTitle.classList.remove('from-pink-500', 'to-violet-500');
                appTitle.classList.add('from-yellow-300', 'to-pink-600');
            }
            
            // Detach old listeners before attaching new ones
            detachAllListeners();
            
            // Load all data for the current sport
            loadTeams();
            loadPlayerHub();
            loadCompetitions(); 
            loadLiveMatches();
            
            const lastPage = localStorage.getItem('lastActivePage');
            
            if (lastPage === 'live-cricket' || lastPage === 'live-football') {
                const lastMatchId = localStorage.getItem('lastActiveMatchId');
                if (lastMatchId) {
                    listenToLiveMatch(lastMatchId);
                } else {
                    localStorage.setItem('lastActivePage', 'live');
                    switchAppPage('live');
                    lucide.createIcons();
                    return; 
                }
            }
            
            switchAppPage(lastPage || 'dashboard');
            
            lucide.createIcons();
        }
        
        function detachAllListeners() {
            if (unsubscribeFromTeams) unsubscribeFromTeams();
            if (unsubscribeFromPlayers) unsubscribeFromPlayers();
            if (unsubscribeFromPlayerHub) unsubscribeFromPlayerHub();
            if (unsubscribeFromFixtures) unsubscribeFromFixtures();
            if (unsubscribeFromLiveMatches) unsubscribeFromLiveMatches();
            if (unsubscribeFromMatch) unsubscribeFromMatch();
            if (unsubscribeFromCompetitions) unsubscribeFromCompetitions();
        }
 function getCompetitionsCollectionPath() {
            if (!currentUserId) return null;
            return `/artifacts/${appId}/users/${currentUserId}/competitions`;
        }

        function loadCompetitions() {
            if (unsubscribeFromCompetitions) unsubscribeFromCompetitions();
            const collectionPath = getCompetitionsCollectionPath();
            if (!collectionPath || !currentSportMode) return;
            
            const q = query(
                collection(db, collectionPath),
                where("sport", "==", currentSportMode)
            );
            
            unsubscribeFromCompetitions = onSnapshot(q, (querySnapshot) => {
                competitionList.innerHTML = '';
                if (querySnapshot.empty) {
                    competitionList.appendChild(competitionListPlaceholder);
                } else {
                    querySnapshot.forEach(doc => {
                        renderCompetitionCard(doc.data(), doc.id);
                    });
                }
                lucide.createIcons();
            }, (error) => {
                console.error("Error loading competitions: ", error);
            });
        }

        function renderCompetitionCard(compData, docId) {
            const card = document.createElement('div');
            card.className = `ui-card p-5 flex flex-col justify-between transition-all hover:border-yellow-300`;
            
            const sportIcon = compData.sport === 'cricket' ? 
                `<i data-lucide="siren" class="mr-1.5 h-4 w-4"></i>Cricket` :
                `<i data-lucide="siren" class="mr-1.5 h-4 w-4"></i>Football`;

            card.innerHTML = `
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <span class="inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium bg-blue-900 text-blue-200">
                            ${compData.type}
                        </span>
                        <button class="delete-competition-btn btn-icon danger" data-id="${docId}" data-name="${compData.name}" title="Delete Competition">
                            <i data-lucide="trash-2" class="h-5 w-5"></i>
                        </button>
                    </div>
                    <h3 class="text-xl font-bold text-white truncate">${compData.name}</h3>
                </div>
                <div class="mt-4 pt-4 border-t border-t-dark-alt">
                    <button class
="manage-competition-btn btn-link text-sm font-medium" data-id="${docId}" data-name="${compData.name}" data-type="${compData.type}">
                        Manage Fixtures &rarr;
                    </button>
                </div>
            `;
            
            card.querySelector('.delete-competition-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                const id = e.currentTarget.dataset.id;
                const name = e.currentTarget.dataset.name;
                showConfirmModal('Delete Competition?', `Are you sure you want to delete "${name}"? This will also delete all its fixtures. This cannot be undone.`, () => {
                    handleDeleteCompetition(id);
                });
            });

            competitionList.appendChild(card);
        }

        async function handleDeleteCompetition(docId) {
            const competitionDocPath = `${getCompetitionsCollectionPath()}/${docId}`;
            const fixturesPath = getCollectionPath('fixtures');
            if (!competitionDocPath || !fixturesPath) return;

            try {
                // 1. Find all fixtures for this competition
                const q = query(collection(db, fixturesPath), where("competitionId", "==", docId));
                const fixturesSnapshot = await getDocs(q);
                
                const deletePromises = [];

                // 2. Delete all found fixtures
                fixturesSnapshot.forEach(fixtureDoc => {
                    deletePromises.push(deleteDoc(fixtureDoc.ref));
                });
                
                // 3. Delete the competition itself
                deletePromises.push(deleteDoc(doc(db, competitionDocPath)));
                
                await Promise.all(deletePromises);
            } catch (error) {
                console.error("Error deleting competition and fixtures: ", error);
            }
        }
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            clearFormError(authError);
            const email = registerForm['register-email'].value;
            const password = registerForm['register-password'].value;
            const confirmPassword = registerForm['register-password-confirm'].value;
            if (password !== confirmPassword) {
                showFormError("Passwords do not match.", authError);
                return;
            }
            try {
                await createUserWithEmailAndPassword(auth, email, password);
                registerForm.reset();
            } catch (error) {
                console.error("Registration Error:", error);
                showFormError(error.message, authError);
            }
        });

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            clearFormError(authError);
            const email = loginForm['login-email'].value;
            const password = loginForm['login-password'].value;
            try {
                await signInWithEmailAndPassword(auth, email, password);
                loginForm.reset();
            } catch (error) {
                console.error("Login Error:", error);
                showFormError(error.message, authError);
            }
        });
        
        logoutButton.addEventListener('click', async () => {
            try {
                await signOut(auth);
                showAuthUI(); // Explicitly call showAuthUI on logout
            } catch (error) {
                console.error("Logout Error:", error);
                showFormError(error.message, authError);
            }
        });

        // Sport selection
        selectSportCricket.addEventListener('click', () => handleSportSelection('cricket'));
        selectSportFootball.addEventListener('click', () => handleSportSelection('football'));

        // --- FIRESTORE COLLECTION PATHS ---
        
        function getCollectionPath(collectionName) {
            if (!currentUserId) return null;
            return `/artifacts/${appId}/users/${currentUserId}/${collectionName}`;
        }

        function getPlayersSubcollectionPath(teamId) {
            const teamsPath = getCollectionPath('teams');
            if (!teamsPath || !teamId) return null;
            return `${teamsPath}/${teamId}/players`;
        }

        // --- FIRESTORE DATA HANDLERS ---
        
        function loadTeams() {
            if (unsubscribeFromTeams) unsubscribeFromTeams();
            const collectionPath = getCollectionPath('teams');
            if (!collectionPath || !currentSportMode) return;
            const q = query(
                collection(db, collectionPath),
                where("sport", "==", currentSportMode)
            );
            unsubscribeFromTeams = onSnapshot(q, (querySnapshot) => {
                teamList.innerHTML = '';
                allUserTeams = [];
                if (querySnapshot.empty) {
                    teamListPlaceholder.classList.remove('hidden');
                    statsTotalTeams.textContent = 0;
                } else {
                    teamListPlaceholder.classList.add('hidden');
                    querySnapshot.forEach((doc) => {
                        const team = { id: doc.id, ...doc.data() };
                        allUserTeams.push(team);
                        renderTeamCard(team, team.id);
                    });
                    statsTotalTeams.textContent = querySnapshot.size;
                }
                playerHubFilterTeam.innerHTML = '<option value="all">All Teams</option>';
                allUserTeams.forEach(team => {
                    playerHubFilterTeam.add(new Option(team.name, team.id));
                });
                lucide.createIcons();
            }, (error) => {
                console.error("Error loading teams: ", error);
            });
        }
        
        function loadPlayerHub() {
            if (unsubscribeFromPlayerHub) unsubscribeFromPlayerHub();
            const collectionPath = getCollectionPath('players');
            if (!collectionPath || !currentSportMode) return;
            const q = query(
                collection(db, collectionPath),
                where("sport", "==", currentSportMode)
            );
            unsubscribeFromPlayerHub = onSnapshot(q, (querySnapshot) => {
                allUserPlayers = [];
                querySnapshot.forEach(doc => {
                    allUserPlayers.push({ id: doc.id, ...doc.data() });
                });
                statsTotalPlayers.textContent = allUserPlayers.length;
                renderPlayerHubList();
            }, (error) => {
                console.error("Error loading player hub: ", error);
            });
        }
        
        function loadPlayers(teamId) {
            if (unsubscribeFromPlayers) unsubscribeFromPlayers();
            const collectionPath = getPlayersSubcollectionPath(teamId);
            if (!collectionPath) return;
            const q = query(collection(db, collectionPath));
            unsubscribeFromPlayers = onSnapshot(q, (querySnapshot) => {
                playerRosterBody.innerHTML = '';
                if (querySnapshot.empty) {
                    playerRosterBody.appendChild(playerListPlaceholder);
                } else {
                    querySnapshot.forEach((doc) => {
                        renderPlayerRow(doc.data(), doc.id);
                    });
                }
                lucide.createIcons();
            }, (error) => {
                console.error("Error loading players: ", error);
                showFormError("Could not load player data.", playerFormError);
            });
        }
        
        function loadFixtures(competitionId) {
            if (unsubscribeFromFixtures) unsubscribeFromFixtures();
            
            // Ensure fixture list is attached to the correct page
            const fixtureListContainer = document.querySelector('#page-competition-detail #fixture-list');
            const placeholder = document.querySelector('#page-competition-detail #fixture-list-placeholder');

            if (!fixtureListContainer || !placeholder) {
                console.error("Fixture list container not found on competition detail page.");
                return;
            }

            const collectionPath = getCollectionPath('fixtures');
            if (!collectionPath || !currentSportMode || !competitionId) {
                fixtureListContainer.innerHTML = ''; // Clear
                fixtureListContainer.appendChild(placeholder);
                return;
            }
            
            const q = query(
                collection(db, collectionPath),
                where("sport", "==", currentSportMode),
                where("competitionId", "==", competitionId),
                where("status", "==", "upcoming")
            );
            
            unsubscribeFromFixtures = onSnapshot(q, (querySnapshot) => {
                fixtureListContainer.innerHTML = '';
                if (querySnapshot.empty) {
                    fixtureListContainer.appendChild(placeholder);
                } else {
                    querySnapshot.forEach(doc => {
                        // Pass the container to render into
                        renderFixtureCard(doc.data(), doc.id, fixtureListContainer); 
                    });
                }
                // Recalculate dashboard stats (or move this to a separate function)
                statsUpcomingFixtures.textContent = querySnapshot.size;
                lucide.createIcons();
            }, (error) => {
                console.error("Error loading fixtures: ", error);
            });
        }
        
        function loadLiveMatches() {
            if (unsubscribeFromLiveMatches) unsubscribeFromLiveMatches();
            
            const collectionPath = getCollectionPath('matches');
            if (!collectionPath || !currentSportMode) return;
            
            const q = query(
                collection(db, collectionPath),
                where("sport", "==", currentSportMode),
                where("status", "==", "live")
            );
            
            unsubscribeFromLiveMatches = onSnapshot(q, (querySnapshot) => {
                liveMatchList.innerHTML = '';
                
                if (querySnapshot.empty) {
                    liveMatchPlaceholder.classList.remove('hidden');
                } else {
                    liveMatchPlaceholder.classList.add('hidden');
                    querySnapshot.forEach(doc => {
                        renderLiveMatchCard({ id: doc.id, ...doc.data() });
                    });
                }
                statsLiveMatches.textContent = querySnapshot.size;
                
            }, (error) => {
                console.error("Error loading live matches: ", error);
            });
        }

        addTeamForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            clearFormError(formError);
            const teamName = addTeamForm['team-name'].value;
            const teamSport = currentSportMode;
            const collectionPath = getCollectionPath('teams');
            if (!teamName || !teamSport || !collectionPath) {
                showFormError("Team name is required or user is not logged in.", formError);
                return;
            }
            const saveButton = document.getElementById('save-team-btn');
            try {
                saveButton.disabled = true;
                saveButton.textContent = 'Saving...';
                await addDoc(collection(db, collectionPath), {
                    name: teamName,
                    sport: teamSport,
                    createdAt: Timestamp.now()
                });
                toggleAddTeamModal(false);
            } catch (error) {
                console.error("Error adding team: ", error);
                showFormError(error.message, formError);
            } finally {
                saveButton.disabled = false;
                saveButton.textContent = 'Create Team';
            }
        });
        
        async function handleDeleteTeam(docId) {
            const teamDocPath = `${getCollectionPath('teams')}/${docId}`;
            const playersSubcolPath = `${teamDocPath}/players`;
            const playersTopLevelPath = getCollectionPath('players');
            if (!teamDocPath || !playersTopLevelPath) return;
            try {
                const playersSnapshot = await getDocs(collection(db, playersSubcolPath));
                const deletePromises = [];
                playersSnapshot.forEach(playerDoc => {
                    deletePromises.push(deleteDoc(playerDoc.ref));
                    deletePromises.push(deleteDoc(doc(db, playersTopLevelPath, playerDoc.id)));
                });
                deletePromises.push(deleteDoc(doc(db, teamDocPath)));
                await Promise.all(deletePromises);
            } catch (error) {
                console.error("Error deleting team and players: ", error);
            }
        }
        
        addPlayerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            clearFormError(playerFormError);
            const playerName = addPlayerForm['player-name'].value;
            const playerPosition = playerPositionSelect.value;
            const playerNumber = addPlayerForm['player-number'].value;
            const playersSubcolPath = getPlayersSubcollectionPath(currentTeamId);
            const playersTopLevelPath = getCollectionPath('players');
            if (!playerName || !playerPosition || !playerNumber || !playersSubcolPath || !playersTopLevelPath) {
                showFormError("All fields are required.", playerFormError);
                return;
            }
            const playerData = {
                name: playerName,
                position: playerPosition,
                number: parseInt(playerNumber, 10),
                teamId: currentTeamId,
                teamName: currentTeamName,
                sport: currentTeamSport,
                createdAt: Timestamp.now()
            };
            try {
                savePlayerBtn.disabled = true;
                savePlayerBtn.textContent = 'Adding...';
                const playerSubDocRef = await addDoc(collection(db, playersSubcolPath), playerData);
                await setDoc(doc(db, playersTopLevelPath, playerSubDocRef.id), playerData);
                addPlayerForm.reset();
            } catch (error) {
                console.error("Error adding player: ", error);
                showFormError(error.message, playerFormError);
            } finally {
                savePlayerBtn.disabled = false;
                savePlayerBtn.textContent = 'Add Player';
            }
        });
        
        async function handleDeletePlayer(playerId, teamId) {
            const playerSubcolPath = getPlayersSubcollectionPath(teamId);
            const playersTopLevelPath = getCollectionPath('players');
            if (!playerId || !teamId || !playerSubcolPath || !playersTopLevelPath) return;
            try {
                const delete1 = deleteDoc(doc(db, playerSubcolPath, playerId));
                const delete2 = deleteDoc(doc(db, playersTopLevelPath, playerId));
                await Promise.all([delete1, delete2]);
            } catch (error) {
                console.error("Error deleting player: ", error);
            }
        }
        
        addFixtureForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            clearFormError(fixtureFormError);
            const sport = currentSportMode;
            const competitionId = currentCompetitionId;
            const team1Id = fixtureTeam1Select.value;
            const team2Id = fixtureTeam2Select.value;
            const dateTime = addFixtureForm['fixture-datetime'].value;
            const venue = addFixtureForm['fixture-venue'].value;
            if (!sport || !team1Id || !team2Id || !dateTime || !venue || !competitionId) {
                showFormError("All fields are required and competition must be set.", fixtureFormError);
                return;
            }
            if (team1Id === team2Id) {
                showFormError("A team cannot play against itself.", fixtureFormError);
                return;
            }
            const collectionPath = getCollectionPath('fixtures');
            if (!collectionPath) return;
            const team1Name = fixtureTeam1Select.options[fixtureTeam1Select.selectedIndex].text;
            const team2Name = fixtureTeam2Select.options[fixtureTeam2Select.selectedIndex].text;
            const saveButton = document.getElementById('save-fixture-btn');
            try {
                saveButton.disabled = true;
                saveButton.textContent = 'Saving...';
                await addDoc(collection(db, collectionPath), {
                    sport: sport,
                    competitionId: competitionId,
                    team1Id: team1Id,
                    team1Name: team1Name,
                    team2Id: team2Id,
                    team2Name: team2Name,
                    dateTime: Timestamp.fromDate(new Date(dateTime)),
                    venue: venue,
                    status: 'upcoming'
                });
                toggleAddFixtureModal(false);
            } catch (error) {
                console.error("Error adding fixture: ", error);
                showFormError(error.message, fixtureFormError);
            } finally {
                saveButton.disabled = false;
                saveButton.textContent = 'Schedule Fixture';
            }
        });
        
        async function handleDeleteFixture(fixtureId) {
            const collectionPath = getCollectionPath('fixtures');
            if (!collectionPath || !fixtureId) return;
            try {
                await deleteDoc(doc(db, collectionPath, fixtureId));
            } catch (error) {
                console.error("Error deleting fixture: ", error);
            }
        }
        
        // --- UNDO LOGIC FUNCTIONS ---
        
        async function saveStateToUndoStack() {
            if (!currentMatchState || !currentMatchId) return;
            const undoStackPath = `${getCollectionPath('matches')}/${currentMatchId}/undoStack`;
            if (!undoStackPath) return;
            
            try {
                await addDoc(collection(db, undoStackPath), {
                    state: currentMatchState, 
                    createdAt: Timestamp.now()
                });
                console.log("Saved state to undo stack.");
            } catch (error) {
                console.error("Error saving undo state: ", error);
            }
        }
        
        async function handleUndo() {
            if (!currentMatchId) return;
            
            const undoStackPath = `${getCollectionPath('matches')}/${currentMatchId}/undoStack`;
            const matchDocRef = doc(db, getCollectionPath('matches'), currentMatchId);
            if (!undoStackPath || !matchDocRef) return;

            try {
                const q = query(collection(db, undoStackPath), orderBy('createdAt', 'desc'), limit(1));
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    console.warn("Nothing to undo.");
                    return;
                }
                
                const undoDoc = querySnapshot.docs[0];
                const previousState = undoDoc.data().state;
                await setDoc(matchDocRef, previousState);
                await deleteDoc(undoDoc.ref);
                
                console.log("Undo successful.");
                
            } catch (error) {
                console.error("Error during undo: ", error);
            }
        }
        
        
        // --- MATCH SETUP AND SCORING LOGIC ---
        
        async function handleStartMatch(fixtureId, sport) {
            const fixturesPath = getCollectionPath('fixtures');
            if (!fixturesPath) return;
            
            try {
                const fixtureDoc = await getDoc(doc(db, fixturesPath, fixtureId));
                if (!fixtureDoc.exists()) {
                    console.error("Fixture not found");
                    return;
                }
                
                currentMatchSetupData = {
                    fixture: { id: fixtureId, ...fixtureDoc.data() },
                    step: 1
                };

                if (sport === 'cricket') {
                    matchSetupModal.classList.remove('hidden');
                    navigateMatchSetup(1);
                    clearFormError(matchSetupError);
                    
                    matchSetupTeam1Name.textContent = currentMatchSetupData.fixture.team1Name;
                    matchSetupTeam2Name.textContent = currentMatchSetupData.fixture.team2Name;
                    
                    await loadPlayersForMatchSetup(currentMatchSetupData.fixture.team1Id, matchSetupTeam1Players);
                    await loadPlayersForMatchSetup(currentMatchSetupData.fixture.team2Id, matchSetupTeam2Players);
                } else {
                    alert("Football live scoring setup is not yet implemented.");
                }
                
            } catch (error) {
                console.error("Error starting match setup: ", error);
            }
        }
        
        async function loadPlayersForMatchSetup(teamId, container) {
            container.innerHTML = `<div class="spinner mx-auto"></div>`;
            const playersPath = getPlayersSubcollectionPath(teamId);
            if (!playersPath) {
                container.innerHTML = `<p class="text-pink-400">Error loading players.</p>`;
                return;
            }
            
            const playersSnapshot = await getDocs(query(collection(db, playersPath)));
            if (playersSnapshot.empty) {
                container.innerHTML = `<p class="text-gray-500">No players found for this team. Add players in Team Management.</p>`;
                return;
            }
            
            container.innerHTML = '';
            playersSnapshot.forEach(doc => {
                const player = { id: doc.id, ...doc.data() };
                container.innerHTML += `
                    <label class="player-select-label">
                        <input type="checkbox" name="team-${teamId}-player" value="${player.id}" data-name="${player.name}" class="hidden">
                        <div class="player-select-label-content p-2">
                            <span class="font-medium text-white">${player.name}</span>
                            <span class="text-sm text-gray-400 block">${player.position}</span>
                        </div>
                    </label>
                `;
            });
        }
        
        function navigateMatchSetup(step) {
            clearFormError(matchSetupError);
            
            matchSetupStepFormat.classList.add('hidden');
            matchSetupStepPlayers.classList.add('hidden');
            matchSetupStepToss.classList.add('hidden');
            matchSetupStepOpeners.classList.add('hidden');
            
            matchSetupNextBtn.classList.add('hidden');
            matchSetupStartBtn.classList.add('hidden');
            matchSetupBackBtn.classList.add('hidden');
            
            currentMatchSetupData.step = step;
            
            if (step === 1) {
                matchSetupStepFormat.classList.remove('hidden');
                matchSetupNextBtn.classList.remove('hidden');
            } 
            else if (step === 2) {
                const formatType = document.querySelector('input[name="match-format"]:checked').value;
                let matchFormat = {};
                
                if (formatType === 't20') {
                    matchFormat = { type: 'T20', totalOvers: 20, maxWickets: 10 };
                } else if (formatType === 'odi') {
                    matchFormat = { type: 'ODI', totalOvers: 50, maxWickets: 10 };
                } else if (formatType === 'custom') {
                    const customOvers = parseInt(document.getElementById('custom-overs').value, 10);
                    const customWickets = parseInt(document.getElementById('custom-wickets').value, 10);
                    if (isNaN(customOvers) || customOvers <= 0 || isNaN(customWickets) || customWickets <= 0) {
                        showFormError("Custom overs and wickets must be valid numbers greater than 0.", matchSetupError);
                        navigateMatchSetup(1);
                        return;
                    }
                    matchFormat = { type: 'Custom', totalOvers: customOvers, maxWickets: customWickets };
                }
                
                currentMatchSetupData.matchFormat = matchFormat;

                matchSetupStepPlayers.classList.remove('hidden');
                matchSetupNextBtn.classList.remove('hidden');
                matchSetupBackBtn.classList.remove('hidden');
            } 
            else if (step === 3) {
                const team1Players = Array.from(document.querySelectorAll(`input[name="team-${currentMatchSetupData.fixture.team1Id}-player"]:checked`));
                const team2Players = Array.from(document.querySelectorAll(`input[name="team-${currentMatchSetupData.fixture.team2Id}-player"]:checked`));

                if (team1Players.length !== 11 || team2Players.length !== 11) {
                    showFormError("You must select exactly 11 players for each team.", matchSetupError);
                    navigateMatchSetup(2);
                    return;
                }
                
                currentMatchSetupData.playingXI_team1 = team1Players.map(el => ({ id: el.value, name: el.dataset.name }));
                currentMatchSetupData.playingXI_team2 = team2Players.map(el => ({ id: el.value, name: el.dataset.name }));
                
                matchSetupTossWinner.innerHTML = `
                    <option value="">Select Toss Winner</option>
                    <option value="${currentMatchSetupData.fixture.team1Id}">${currentMatchSetupData.fixture.team1Name}</option>
                    <option value="${currentMatchSetupData.fixture.team2Id}">${currentMatchSetupData.fixture.team2Name}</option>
                `;
                
                matchSetupStepToss.classList.remove('hidden');
                matchSetupNextBtn.classList.remove('hidden');
                matchSetupBackBtn.classList.remove('hidden');
            }
            else if (step === 4) {
                const tossWinnerId = matchSetupTossWinner.value;
                const tossDecision = matchSetupTossDecision.value;
                
                if (!tossWinnerId) {
                    showFormError("You must select a toss winner.", matchSetupError);
                    navigateMatchSetup(3);
                    return;
                }
                
                const tossWinnerName = tossWinnerId === currentMatchSetupData.fixture.team1Id ? currentMatchSetupData.fixture.team1Name : currentMatchSetupData.fixture.team2Name;
                const tossLoserId = tossWinnerId === currentMatchSetupData.fixture.team1Id ? currentMatchSetupData.fixture.team2Id : currentMatchSetupData.fixture.team1Id;
                
                let battingTeamId, bowlingTeamId, battingTeamName, bowlingTeamName, battingXI, bowlingXI;
                
                if ((tossWinnerId === currentMatchSetupData.fixture.team1Id && tossDecision === 'bat') || 
                    (tossWinnerId === currentMatchSetupData.fixture.team2Id && tossDecision === 'bowl')) {
                    battingTeamId = currentMatchSetupData.fixture.team1Id;
                    battingTeamName = currentMatchSetupData.fixture.team1Name;
                    battingXI = currentMatchSetupData.playingXI_team1;
                    bowlingTeamId = currentMatchSetupData.fixture.team2Id;
                    bowlingTeamName = currentMatchSetupData.fixture.team2Name;
                    bowlingXI = currentMatchSetupData.playingXI_team2;
                } else {
                    battingTeamId = currentMatchSetupData.fixture.team2Id;
                    battingTeamName = currentMatchSetupData.fixture.team2Name;
                    battingXI = currentMatchSetupData.playingXI_team2;
                    bowlingTeamId = currentMatchSetupData.fixture.team1Id;
                    bowlingTeamName = currentMatchSetupData.fixture.team1Name;
                    bowlingXI = currentMatchSetupData.playingXI_team1;
                }
                
                currentMatchSetupData.toss = { winnerId: tossWinnerId, winnerName: tossWinnerName, decision: tossDecision };
                currentMatchSetupData.battingTeamId = battingTeamId;
                currentMatchSetupData.battingTeamName = battingTeamName;
                currentMatchSetupData.battingXI = battingXI;
                currentMatchSetupData.bowlingTeamId = bowlingTeamId;
                currentMatchSetupData.bowlingTeamName = bowlingTeamName;
                currentMatchSetupData.bowlingXI = bowlingXI;
                
                matchSetupBattingTeamName.textContent = battingTeamName;
                matchSetupBowlingTeamName.textContent = bowlingTeamName;
                
                const selects = [matchSetupBatsman1, matchSetupBatsman2];
                selects.forEach(sel => {
                    sel.innerHTML = '<option value="">Select Batsman</option>';
                    battingXI.forEach(p => sel.add(new Option(p.name, p.id)));
                });
                
                matchSetupBowler.innerHTML = '<option value="">Select Bowler</option>';
                bowlingXI.forEach(p => matchSetupBowler.add(new Option(p.name, p.id)));
                
                matchSetupStepOpeners.classList.remove('hidden');
                matchSetupStartBtn.classList.remove('hidden');
                matchSetupBackBtn.classList.remove('hidden');
            }
        }
        
        async function finalizeMatchSetup() {
            clearFormError(matchSetupError);
            
            const batsman1Id = matchSetupBatsman1.value;
            const batsman2Id = matchSetupBatsman2.value;
            const bowlerId = matchSetupBowler.value;
            
            if (!batsman1Id || !batsman2Id || !bowlerId) {
                showFormError("You must select both opening batsmen and the opening bowler.", matchSetupError);
                return;
            }
            if (batsman1Id === batsman2Id) {
                showFormError("Batsmen cannot be the same player.", matchSetupError);
                return;
            }
            
            const battingCard = {};
            currentMatchSetupData.battingXI.forEach(p => {
                battingCard[p.id] = { id: p.id, name: p.name, runs: 0, balls: 0, fours: 0, sixes: 0, sr: "0.00", status: 'did_not_bat', outInfo: '' };
            });
            
            const bowlingCard = {};
            currentMatchSetupData.bowlingXI.forEach(p => {
                bowlingCard[p.id] = { id: p.id, name: p.name, overs: 0.0, balls: 0, maidens: 0, runs: 0, wickets: 0, econ: "0.00" };
            });
            
            battingCard[batsman1Id].status = 'not_out';
            battingCard[batsman2Id].status = 'not_out';
            
            const batsman1Name = currentMatchSetupData.battingXI.find(p => p.id === batsman1Id).name;
            const batsman2Name = currentMatchSetupData.battingXI.find(p => p.id === batsman2Id).name;
            const bowlerName = currentMatchSetupData.bowlingXI.find(p => p.id === bowlerId).name;

            const newMatchData = {
                fixtureData: currentMatchSetupData.fixture,
                toss: currentMatchSetupData.toss,
                matchFormat: currentMatchSetupData.matchFormat,
                status: 'live',
                sport: 'cricket',
                createdAt: Timestamp.now(),
                
                currentInnings: 1,
                target: 0,
                inningsData: {}, 
                
                battingTeamId: currentMatchSetupData.battingTeamId,
                battingTeamName: currentMatchSetupData.battingTeamName,
                bowlingTeamId: currentMatchSetupData.bowlingTeamId,
                bowlingTeamName: currentMatchSetupData.bowlingTeamName,
                
                score: 0,
                wickets: 0,
                overs: 0,
                balls: 0,
                extras: { wd: 0, nb: 0, b: 0, lb: 0 },
                
                batsmanOnStrike: { id: batsman1Id, name: batsman1Name },
                batsmanNonStrike: { id: batsman2Id, name: batsman2Name },
                currentBowler: { id: bowlerId, name: bowlerName },
                
                battingCard: battingCard,
                bowlingCard: bowlingCard,
                
                fallOfWickets: [],
                thisOver: [],
            };
            
            const matchesPath = getCollectionPath('matches');
            const fixturesPath = getCollectionPath('fixtures');
            if (!matchesPath || !fixturesPath) return;

            try {
                matchSetupStartBtn.disabled = true;
                matchSetupStartBtn.innerHTML = `<div class="spinner mx-auto"></div>`;
                
                const matchDocRef = await addDoc(collection(db, matchesPath), newMatchData);
                currentMatchId = matchDocRef.id;
                
                await updateDoc(doc(db, fixturesPath, currentMatchSetupData.fixture.id), { status: 'live' });
                
                matchSetupModal.classList.add('hidden');
                listenToLiveMatch(currentMatchId);
                switchAppPage('live-cricket');

            } catch (error) {
                console.error("Error finalizing match setup: ", error);
                showFormError(error.message, matchSetupError);
            } finally {
                matchSetupStartBtn.disabled = false;
                matchSetupStartBtn.textContent = 'Start Match';
            }
        }

        
        function listenToLiveMatch(matchId) {
            if (unsubscribeFromMatch) unsubscribeFromMatch();
            const matchPath = `${getCollectionPath('matches')}/${matchId}`;
            if (!matchPath) return;
            
            currentMatchId = matchId; 
            localStorage.setItem('lastActiveMatchId', matchId);
            
            unsubscribeFromMatch = onSnapshot(doc(db, matchPath), (docSnap) => {
                if (!docSnap.exists()) {
                    console.warn("Live match data not found.");
                    currentMatchState = null;
                    switchAppPage('live'); 
                    return;
                }
                
                currentMatchState = docSnap.data(); 
                
                if (currentMatchState.sport === 'cricket') {
                    updateCricketUI(currentMatchState);
                } else {
                    updateFootballUI(currentMatchState);
                }
                lucide.createIcons();
            });
        }
        
        async function handleScoreEvent(event) {
            if (!currentMatchState || !currentMatchId) return;
            
            let newState = JSON.parse(JSON.stringify(currentMatchState));
            
            if (!newState.batsmanOnStrike || !newState.batsmanNonStrike || !newState.currentBowler) {
                console.error("Match state is incomplete. Missing player data.", newState);
                return;
            }
            
            let onStrikeId = newState.batsmanOnStrike.id;
            let nonStrikeId = newState.batsmanNonStrike.id;
            let bowlerId = newState.currentBowler.id;
            
            let batsman = newState.battingCard[onStrikeId];
            let bowler = newState.bowlingCard[bowlerId];
            
            let isOverEnd = false;
            let thisBallEvent = "";
            let isUndoableEvent = false;
            
            if (event.type === 'run') {
                const runs = event.value;
                thisBallEvent = runs.toString();
                
                newState.score += runs;
                batsman.runs += runs;
                batsman.balls += 1;
                bowler.runs += runs;
                newState.balls += 1;
                bowler.balls += 1;
                
                if (runs === 4) batsman.fours += 1;
                if (runs === 6) batsman.sixes += 1;
                
                if (runs % 2 !== 0) {
                    [newState.batsmanOnStrike, newState.batsmanNonStrike] = [newState.batsmanNonStrike, newState.batsmanOnStrike];
                }
                
                isUndoableEvent = true;
                
            } else if (event.type === 'extra') {
                if (event.value === 'wd') {
                    thisBallEvent = "WD";
                    newState.score += 1;
                    bowler.runs += 1;
                    newState.extras.wd += 1;
                }
                if (event.value === 'nb') {
                    thisBallEvent = "NB";
                    newState.score += 1;
                    bowler.runs += 1;
                    newState.extras.nb += 1;
                }
                if (event.value === 'b') {
                    thisBallEvent = "B";
                    newState.score += 1; 
                    newState.extras.b += 1;
                    newState.balls += 1;
                    bowler.balls += 1;
                }
                if (event.value === 'lb') {
                    thisBallEvent = "LB";
                    newState.score += 1;
                    newState.extras.lb += 1;
                    batsman.balls += 1;
                    newState.balls += 1;
                    bowler.balls += 1;
                }
                isUndoableEvent = true;
            } else if (event.type === 'action') {
                if (event.value === 'swap') {
                    [newState.batsmanOnStrike, newState.batsmanNonStrike] = [newState.batsmanNonStrike, newState.batsmanOnStrike];
                    
                    const matchDocRef = doc(db, getCollectionPath('matches'), currentMatchId);
                    await updateDoc(matchDocRef, { 
                        batsmanOnStrike: newState.batsmanOnStrike,
                        batsmanNonStrike: newState.batsmanNonStrike
                    });
                    
                    return;
                }
                if (event.value === 'undo') {
                    await handleUndo();
                    return;
                }
            }
            
            if (thisBallEvent) {
                newState.thisOver.push(thisBallEvent);
            }
            
            if (newState.balls === 6) {
                isOverEnd = true;
                newState.overs += 1;
                newState.balls = 0;
                bowler.overs = Math.floor(bowler.balls / 6) + (bowler.balls % 6 / 10); 
                
                [newState.batsmanOnStrike, newState.batsmanNonStrike] = [newState.batsmanNonStrike, newState.batsmanOnStrike];
                newState.thisOver = [];
            }
            
            if (newState.overs === newState.matchFormat.totalOvers) {
                alert("Innings Over!");
                isOverEnd = false; 
                newState.status = 'innings_break';
            }
            
            batsman.sr = (batsman.balls > 0) ? ((batsman.runs / batsman.balls) * 100).toFixed(2) : "0.00";
            const bowlerOversDecimal = Math.floor(bowler.balls / 6) + (bowler.balls % 6 / 6);
            bowler.econ = (bowlerOversDecimal > 0) ? (bowler.runs / bowlerOversDecimal).toFixed(2) : "0.00";
            bowler.overs = Math.floor(bowler.balls / 6) + (bowler.balls % 6 / 10);
            
            const matchDocRef = doc(db, getCollectionPath('matches'), currentMatchId);
            try {
                if (isUndoableEvent) {
                    await saveStateToUndoStack();
                }
                
                await updateDoc(matchDocRef, newState);
                
                if (isOverEnd) {
                    const availableBowlers = Object.values(newState.bowlingCard).map(p => ({id: p.id, name: p.name}));
                    openSelectPlayerModal(
                        'Select New Bowler', 
                        availableBowlers, 
                        [bowlerId], 
                        (newBowlerId) => {
                            const newBowler = newState.bowlingCard[newBowlerId];
                            updateDoc(matchDocRef, {
                                currentBowler: { id: newBowler.id, name: newBowler.name }
                            });
                            closeSelectPlayerModal();
                        }
                    );
                }
                
            } catch (error) {
                console.error("Error updating score: ", error);
            }
        }
        
        async function handleWicket(details) {
            if (!currentMatchState || !currentMatchId) return;
            
            await saveStateToUndoStack();
            
            let newState = JSON.parse(JSON.stringify(currentMatchState));
            
            if (!newState.batsmanOnStrike || !newState.batsmanNonStrike || !newState.currentBowler) {
                console.error("Match state is incomplete. Cannot process wicket.", newState);
                return;
            }
            
            let bowler = newState.bowlingCard[newState.currentBowler.id];
            
            newState.wickets += 1;
            newState.thisOver.push("W");
            
            if (details.method !== 'run_out') {
                bowler.wickets += 1;
                newState.balls += 1;
                bowler.balls += 1;
            }
            
            const batsmanOut = newState.battingCard[details.batsmanOutId];
            batsmanOut.status = 'out';
            
            let outInfo = `${details.method}`;
            if (details.fielderId) {
                const fielderName = newState.bowlingCard[details.fielderId].name;
                if(details.method === 'caught') outInfo += ` c ${fielderName}`;
                if(details.method === 'stumped') outInfo += ` st ${fielderName}`;
                if(details.method === 'run_out') outInfo += ` (run out) ${fielderName}`;
            }
            if (details.method !== 'run_out') {
                outInfo += ` b ${newState.currentBowler.name}`;
            }
            batsmanOut.outInfo = outInfo;
            
            
            newState.fallOfWickets.push({
                score: newState.score,
                wickets: newState.wickets,
                overs: `${newState.overs}.${newState.balls}`,
                batsmanOutName: batsmanOut.name
            });
            
            bowler.overs = Math.floor(bowler.balls / 6) + (bowler.balls % 6 / 10);
            const bowlerOversDecimal = Math.floor(bowler.balls / 6) + (bowler.balls % 6 / 6);
            bowler.econ = (bowlerOversDecimal > 0) ? (bowler.runs / bowlerOversDecimal).toFixed(2) : "0.00";

            if (newState.wickets === newState.matchFormat.maxWickets) {
                alert("Innings Over!");
                newState.status = 'innings_break';
                await updateDoc(doc(db, getCollectionPath('matches'), currentMatchId), newState);
                switchAppPage('live');
                return;
            }
            
            const availableBatsmen = Object.values(newState.battingCard)
                .filter(p => p.status === 'did_not_bat')
                .map(p => ({id: p.id, name: p.name}));
                
            openSelectPlayerModal('Select New Batsman', availableBatsmen, [], (newBatsmanId) => {
                const newBatsman = newState.battingCard[newBatsmanId];
                newBatsman.status = 'not_out';
                
                if (newState.batsmanOnStrike.id === details.batsmanOutId) {
                    newState.batsmanOnStrike = { id: newBatsman.id, name: newBatsman.name };
                } else {
                    newState.batsmanNonStrike = { id: newBatsman.id, name: newBatsman.name };
                }
                
                let isOverEnd = false;
                if (newState.balls === 6) {
                    isOverEnd = true;
                    newState.overs += 1;
                    newState.balls = 0;
                    [newState.batsmanOnStrike, newState.batsmanNonStrike] = [newState.batsmanNonStrike, newState.batsmanOnStrike];
                    newState.thisOver = [];
                }
                
                const matchDocRef = doc(db, getCollectionPath('matches'), currentMatchId);
                updateDoc(matchDocRef, newState).then(() => {
                    closeSelectPlayerModal();
                    
                    if (isOverEnd) {
                        const availableBowlers = Object.values(newState.bowlingCard).map(p => ({id: p.id, name: p.name}));
                        openSelectPlayerModal(
                            'Select New Bowler', 
                            availableBowlers, 
                            [bowler.id], 
                            (newBowlerId) => {
                                const newBowler = newState.bowlingCard[newBowlerId];
                                updateDoc(matchDocRef, {
                                    currentBowler: { id: newBowler.id, name: newBowler.name }
                                });
                                closeSelectPlayerModal();
                            }
                        );
                    }
                });
            });
        }
        
        
        function updateCricketUI(data) {
            if (!data) return;
            
            if (!data.matchFormat) {
                console.warn("Match data missing 'matchFormat'. Using default T20 settings.");
                data.matchFormat = { type: 'T20', totalOvers: 20, maxWickets: 10 };
            }
            
            if (!data.batsmanOnStrike || !data.batsmanNonStrike || !data.currentBowler) {
                console.warn("Incomplete match data received, skipping UI update.");
                cricketMatchTitle.textContent = "Loading match data...";
                return;
            }
            
            const batsman1 = data.battingCard[data.batsmanOnStrike.id];
            const batsman2 = data.battingCard[data.batsmanNonStrike.id];
            const bowler = data.bowlingCard[data.currentBowler.id];
            const totalBalls = (data.overs * 6) + data.balls;
            
            cricketMatchTitle.textContent = `${data.fixtureData.team1Name} vs ${data.fixtureData.team2Name}`;
            cricketMatchSubtitle.textContent = `${data.matchFormat.type} Match - ${data.fixtureData.venue}`;
            
            cricketScorebugTeamName.textContent = data.battingTeamName;
            cricketScorebugScore.textContent = `${data.score}/${data.wickets}`;
            cricketScorebugOvers.textContent = `(${data.overs}.${data.balls}/${data.matchFormat.totalOvers})`;
            
            const crr = (totalBalls > 0) ? ((data.score / totalBalls) * 6).toFixed(2) : "0.00";
            cricketScorebugCrr.textContent = `CRR: ${crr}`;
            
            if (data.target > 0) {
                const runsNeeded = data.target - data.score;
                const ballsRemaining = (data.matchFormat.totalOvers * 6) - totalBalls;
                const rrr = (ballsRemaining > 0) ? ((runsNeeded / ballsRemaining) * 6).toFixed(2) : "0.00";
                
                cricketScorebugTarget.textContent = `Target: ${data.target}`;
                cricketScorebugRrr.textContent = `RRR: ${rrr}`;
                cricketScorebugStatus.textContent = `${data.battingTeamName} need ${runsNeeded} runs from ${ballsRemaining} balls.`;
                
                cricketScorebugTarget.classList.remove('hidden');
                cricketScorebugRrr.classList.remove('hidden');
                cricketScorebugStatus.classList.remove('hidden');
            } else {
                cricketScorebugTarget.classList.add('hidden');
                cricketScorebugRrr.classList.add('hidden');
                cricketScorebugStatus.classList.add('hidden');
            }

            cricketBatsman1Name.textContent = batsman1.name;
            cricketBatsman1Runs.textContent = batsman1.runs;
            cricketBatsman1Balls.textContent = batsman1.balls;
            cricketBatsman1Fours.textContent = batsman1.fours;
            cricketBatsman1Sixes.textContent = batsman1.sixes;
            cricketBatsman1Sr.textContent = batsman1.sr;
            
            cricketBatsman2Name.textContent = batsman2.name;
            cricketBatsman2Runs.textContent = batsman2.runs;
            cricketBatsman2Balls.textContent = batsman2.balls;
            cricketBatsman2Fours.textContent = batsman2.fours;
            cricketBatsman2Sixes.textContent = batsman2.sixes;
            cricketBatsman2Sr.textContent = batsman2.sr;
            
            cricketBowlerName.textContent = bowler.name;
            cricketBowlerRuns.textContent = bowler.runs;
            cricketBowlerWickets.textContent = bowler.wickets;
            cricketBowlerOvers.textContent = bowler.overs;
            cricketBowlerMaidens.textContent = bowler.maidens;
            cricketBowlerEcon.textContent = bowler.econ;
            
            cricketThisOver.innerHTML = '';
            if (!data.thisOver || data.thisOver.length === 0) {
                cricketThisOver.innerHTML = '<p class="text-gray-500">No balls bowled this over.</p>';
            } else {
                (data.thisOver || []).forEach(ball => {
                    let ballClass = '';
                    let ballText = ball;
                    if (ball === 'W') ballClass = 'wicket';
                    if (ball === '4') ballClass = 'four';
                    if (ball === '6') ballClass = 'six';
                    if (ball === '0') ballText = '.';
                    if (['WD', 'NB', 'B', 'LB'].includes(ball)) {
                        ballClass = 'extra';
                    }
                    if (ballText === '.') ballClass = 'dot'; // Dot ball
                    
                    cricketThisOver.innerHTML += `<span class="over-ball ${ballClass}">${ballText}</span>`;
                });
            }

            cricketBattingTableName.textContent = `${data.battingTeamName} Batting`;
            cricketBattingTable.innerHTML = '';
            const battingOrder = Object.values(data.battingCard).sort((a, b) => {
                if(a.status === 'not_out') return -1;
                if(b.status === 'not_out') return 1;
                if(a.status === 'did_not_bat') return 1;
                if(b.status === 'did_not_bat') return -1;
                return 0; 
            });
            
            battingOrder.forEach(p => {
                const onStrike = (p.id === data.batsmanOnStrike.id && p.status === 'not_out') ? '*' : '';
                const row = document.createElement('tr');
                row.className = (p.status === 'not_out') ? 'not-out' : '';
                
                row.innerHTML = `
                    <td class="px-4 py-2 text-sm font-medium ${p.status === 'not_out' ? 'batsman-name' : 'text-white'}">
                        ${p.name}${onStrike}
                        <span class="block text-xs font-normal batsman-out-info">${p.status === 'out' ? p.outInfo : (p.status === 'not_out' ? 'not out' : 'did not bat')}</span>
                    </td>
                    <td class="px-2 py-2 text-right text-sm font-bold text-white">${p.runs}</td>
                    <td class="px-2 py-2 text-right text-sm text-gray-300">${p.balls}</td>
                    <td class="px-2 py-2 text-right text-sm text-gray-300">${p.fours}</td>
                    <td class="px-2 py-2 text-right text-sm text-gray-300">${p.sixes}</td>
                    <td class="px-4 py-2 text-right text-sm text-gray-300">${p.sr}</td>
                `;
                cricketBattingTable.appendChild(row);
            });

            cricketBowlingTableName.textContent = `${data.bowlingTeamName} Bowling`;
            cricketBowlingTable.innerHTML = '';
            Object.values(data.bowlingCard).filter(p => p.overs > 0 || p.id === data.currentBowler.id).forEach(p => {
                const row = document.createElement('tr');
                row.className = (p.id === data.currentBowler.id) ? 'not-out' : '';
                row.innerHTML = `
                    <td class="px-4 py-2 text-sm font-medium ${p.id === data.currentBowler.id ? 'bowler-name' : 'text-white'}">${p.name}</td>
                    <td class="px-2 py-2 text-right text-sm text-gray-300">${p.overs}</td>
                    <td class="px-2 py-2 text-right text-sm text-gray-300">${p.maidens}</td>
                    <td class="px-2 py-2 text-right text-sm text-gray-300">${p.runs}</td>
                    <td class="px-2 py-2 text-right text-sm font-bold text-white">${p.wickets}</td>
                    <td class="px-4 py-2 text-right text-sm text-gray-300">${p.econ}</td>
                `;
                cricketBowlingTable.appendChild(row);
            });
        }
        
        function updateFootballUI(data) {
            footballMatchTitle.textContent = `${data.fixtureData.team1Name} vs ${data.fixtureData.team2Name}`;
        }
        
        
        // --- GENERAL EVENT LISTENERS ---

        tabLogin.addEventListener('click', () => switchAuthTab('login'));
        tabRegister.addEventListener('click', () => switchAuthTab('register'));
        
        switchSportButton.addEventListener('click', async () => {
            if (!currentUserId || !currentSportMode) return;
            const newSport = currentSportMode === 'cricket' ? 'football' : 'cricket';
            
            localStorage.setItem('lastActiveSport', newSport);
            localStorage.setItem('lastActivePage', 'dashboard');
            
            const settingsDocRef = doc(db, `/artifacts/${appId}/users/${currentUserId}/settings/userSettings`);
            try {
                await setDoc(settingsDocRef, { preferredSport: newSport });
                currentSportMode = newSport;
                initializeAppUI();
            } catch (error) {
                console.error("Error switching sport: ", error);
            }
        });

        navLinksContainer.addEventListener('click', (e) => {
            e.preventDefault();
            const navLink = e.target.closest('.nav-link');
            if (navLink) {
                const pageId = navLink.dataset.page;
                if (pageId) switchAppPage(pageId);
            }
        });
        
        document.body.addEventListener('click', (e) => {
            const navLink = e.target.closest('.nav-link-inline');
            if (navLink) {
                e.preventDefault();
                const pageId = navLink.dataset.page;
                if (pageId) switchAppPage(pageId);
            }
            const quickBtn = e.target.closest('.quick-action-btn');
            if (quickBtn) {
                e.preventDefault();
                const pageId = quickBtn.dataset.page;
                if (pageId) switchAppPage(pageId);
            }
        });
        
        teamList.addEventListener('click', (e) => {
            const manageButton = e.target.closest('.manage-team-btn');
            if (manageButton) {
                e.preventDefault();
                currentTeamId = manageButton.dataset.id;
                currentTeamName = manageButton.dataset.name;
                currentTeamSport = manageButton.dataset.sport;
                
                teamDetailName.textContent = currentTeamName;
                teamDetailSportBadge.textContent = currentTeamSport;
                teamDetailSportBadge.className = `ml-4 inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium ${currentTeamSport === 'cricket' ? 'bg-emerald-900 text-emerald-200' : 'bg-pink-900 text-pink-200'}`;
                
                playerPositionSelect.innerHTML = '';
                if (currentTeamSport === 'cricket') {
                    playerPositionSelect.add(new Option('Select role...', ''));
                    playerPositionSelect.add(new Option('Batsman', 'Batsman'));
                    playerPositionSelect.add(new Option('Bowler', 'Bowler'));
                    playerPositionSelect.add(new Option('All-rounder', 'All-rounder'));
                    playerPositionSelect.add(new Option('Wicketkeeper', 'Wicketkeeper'));
                    playerPositionSelect.add(new Option('Wicketkeeper-Batsman', 'Wicketkeeper-Batsman'));
                } else if (currentTeamSport === 'football') {
                    playerPositionSelect.add(new Option('Select position...', ''));
                    playerPositionSelect.add(new Option('Goalkeeper (GK)', 'Goalkeeper'));
                    playerPositionSelect.add(new Option('Defender (DEF)', 'Defender'));
                    playerPositionSelect.add(new Option('Midfielder (MID)', 'Midfielder'));
                    playerPositionSelect.add(new Option('Forward (FWD)', 'Forward'));
                } else {
                    playerPositionSelect.add(new Option('N/A', ''));
                }
                
                loadPlayers(currentTeamId);
                switchAppPage('team-detail');
            }
        });
        
        backToTeamsBtn.addEventListener('click', () => switchAppPage('teams'));
        backToLiveCenterBtnCricket.addEventListener('click', () => switchAppPage('live'));
        backToLiveCenterBtnFootball.addEventListener('click', () => switchAppPage('live'));

        openModalBtn.addEventListener('click', () => toggleAddTeamModal(true));
        closeModalBtn.addEventListener('click', () => toggleAddTeamModal(false));
        modalOverlay.addEventListener('click', () => toggleAddTeamModal(false));
        
        openFixtureModalBtn.addEventListener('click', () => toggleAddFixtureModal(true));
        closeFixtureModalBtn.addEventListener('click', () => toggleAddFixtureModal(false));
        fixtureModalOverlay.addEventListener('click', () => toggleAddFixtureModal(false));
        
        playerHubSearch.addEventListener('input', () => {
            playerHubCurrentPage = 1; // Reset to first page
            renderPlayerHubList();
        });
        playerHubFilterTeam.addEventListener('change', () => {
            playerHubCurrentPage = 1; // Reset to first page
            renderPlayerHubList();
        });
        
        confirmCancelBtn.addEventListener('click', () => toggleConfirmModal(false));
        confirmModalOverlay.addEventListener('click', () => toggleConfirmModal(false));
        confirmActionBtn.addEventListener('click', () => {
            if (typeof confirmAction === 'function') confirmAction();
            toggleConfirmModal(false);
        });
        
        matchSetupCancelBtn.addEventListener('click', () => {
            matchSetupModal.classList.add('hidden');
            currentMatchSetupData = {};
        });
        matchSetupNextBtn.addEventListener('click', () => {
            navigateMatchSetup(currentMatchSetupData.step + 1);
        });
        matchSetupBackBtn.addEventListener('click', () => {
            navigateMatchSetup(currentMatchSetupData.step - 1);
        });
        matchSetupStartBtn.addEventListener('click', finalizeMatchSetup);
        
        document.querySelectorAll('input[name="match-format"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                if (e.target.value === 'custom') {
                    matchSetupCustomOptions.classList.remove('hidden');
                } else {
                    matchSetupCustomOptions.classList.add('hidden');
                }
            });
        });
        
        scoringControls.addEventListener('click', (e) => {
            const button = e.target.closest('.score-btn-bbl'); // <-- FIX: Class was score-btn
            if (button && button.dataset.event) {
                const event = JSON.parse(button.dataset.event);
                
                if (event.type === 'wicket') {
                    toggleWicketModal(true);
                } else {
                    handleScoreEvent(event);
                }
            }
        });
        
        wicketCancelBtn.addEventListener('click', () => toggleWicketModal(false));
        wicketMethod.addEventListener('change', (e) => {
            const method = e.target.value;
            if (method === 'caught' || method === 'run_out' || method === 'stumped') {
                wicketFielderContainer.classList.remove('hidden');
            } else {
                wicketFielderContainer.classList.add('hidden');
            }
        });
        
        // --- FIX: This listener was completely wrong ---
        wicketForm.addEventListener('submit', (e) => {
            e.preventDefault();
            clearFormError(wicketFormError);
            
            const batsmanOutId = wicketBatsmanOut.value;
            const method = wicketMethod.value;
            const fielderId = wicketFielderContainer.classList.contains('hidden') ? null : wicketFielder.value;

            if (!batsmanOutId || !method) {
                showFormError("Batsman and Method are required.", wicketFormError);
                return;
            }
            
            toggleWicketModal(false);
            handleWicket({ batsmanOutId, method, fielderId });
        });
        // --- END FIX ---
        
        selectPlayerConfirmBtn.addEventListener('click', () => {
            const selected = document.querySelector('input[name="selected-player"]:checked');
            if (!selected) {
                showFormError("Please select a player.", selectPlayerError);
                return;
            }
            if (typeof selectPlayerCallback === 'function') {
                selectPlayerCallback(selected.value);
            }
        });
        
        function handleAppKeydown(e) {
            const isModalOpen = !addTeamModal.classList.contains('hidden') ||
                                !addFixtureModal.classList.contains('hidden') ||
                                !confirmModal.classList.contains('hidden') ||
                                !matchSetupModal.classList.contains('hidden') ||
                                !selectPlayerModal.classList.contains('hidden') ||
                                !wicketModal.classList.contains('hidden');
            
            const isTyping = e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT' || e.target.tagName === 'TEXTAREA';

            if (!isModalOpen && !isTyping) {
                if (document.getElementById('page-live-cricket').classList.contains('active')) {
                    
                    let handled = true;
                    switch (e.key) {
                        case '0': handleScoreEvent({"type": "run", "value": 0}); break;
                        case '1': handleScoreEvent({"type": "run", "value": 1}); break;
                        case '2': handleScoreEvent({"type": "run", "value": 2}); break;
                        case '3': handleScoreEvent({"type": "run", "value": 3}); break;
                        case '4': handleScoreEvent({"type": "run", "value": 4}); break;
                        case '6': handleScoreEvent({"type": "run", "value": 6}); break;
                        case 'w': case 'W': handleScoreEvent({"type": "extra", "value": "wd"}); break;
                        case 'n': case 'N': handleScoreEvent({"type": "extra", "value": "nb"}); break;
                        case 'o': case 'O': toggleWicketModal(true); break;
                        case 's': case 'S': handleScoreEvent({"type": "action", "value": "swap"}); break;
                        case 'z': case 'Z': handleScoreEvent({"type": "action", "value": "undo"}); break;
                        default: handled = false; break;
                    }
                    
                    if (handled) e.preventDefault();
                }
            } else if (!wicketModal.classList.contains('hidden') && e.key === 'Enter') {
                e.preventDefault();
                wicketConfirmBtn.click();
            } else if (!selectPlayerModal.classList.contains('hidden') && e.key === 'Enter') {
                e.preventDefault();
                selectPlayerConfirmBtn.click();
            }
        }
        
        document.addEventListener('keydown', handleAppKeydown);
                // Competition Modal
        openCompetitionModalBtn.addEventListener('click', () => toggleAddCompetitionModal(true));
        closeCompetitionModalBtn.addEventListener('click', () => toggleAddCompetitionModal(false));
        competitionModalOverlay.addEventListener('click', () => toggleAddCompetitionModal(false));

        addCompetitionForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            clearFormError(competitionFormError);
            const compName = addCompetitionForm['competition-name'].value;
            const compType = addCompetitionForm['competition-type'].value;
            const compSport = currentSportMode;
            const collectionPath = getCompetitionsCollectionPath();

            if (!compName || !compType || !compSport || !collectionPath) {
                showFormError("All fields are required.", competitionFormError);
                return;
            }
            const saveButton = document.getElementById('save-competition-btn');
            try {
                saveButton.disabled = true;
                saveButton.textContent = 'Saving...';
                await addDoc(collection(db, collectionPath), {
                    name: compName,
                    type: compType,
                    sport: compSport,
                    createdAt: Timestamp.now()
                });
                toggleAddCompetitionModal(false);
            } catch (error) {
                console.error("Error adding competition: ", error);
                showFormError(error.message, competitionFormError);
            } finally {
                saveButton.disabled = false;
                saveButton.textContent = 'Create Competition';
            }
        });

        // Competition List Clicks
        competitionList.addEventListener('click', (e) => {
            const manageButton = e.target.closest('.manage-competition-btn');
            if (manageButton) {
                e.preventDefault();
                currentCompetitionId = manageButton.dataset.id;
                currentCompetitionName = manageButton.dataset.name;
                
                competitionDetailName.textContent = currentCompetitionName;
                competitionDetailType.textContent = manageButton.dataset.type;
                
                // Load fixtures for this specific competition
                loadFixtures(currentCompetitionId);
                switchAppPage('competition-detail');
            }
        });

        backToCompetitionsBtn.addEventListener('click', () => switchAppPage('competitions'));

        lucide.createIcons();
        
    </script>
</body>
</html>